(function(a){a.fn.extend({HotelSuggest:function(d,c){var b=typeof d=="string";c=a.extend({},a.HotelAutoCompleter.defaults,{url:b?d:null,data:b?null:d,delay:b?a.HotelAutoCompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(e){return e;};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.HotelAutoCompleter(this,c);});},result:function(b){return this.bind("result",b);},search:function(b){return this.trigger("search",[b]);},flushCache:function(){return this.trigger("flushCache");},setOptions:function(b){return this.trigger("setOptions",[b]);},unautocomplete:function(){return this.trigger("unautocomplete");}});a.HotelAutoCompleter=function(i,n){var j={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var b=a(i).attr("autocomplete","off").addClass(n.inputClass);var v;var p="";var d=a.HotelAutoCompleter.Cache(n);var f=0;var k;var e={mouseDownOnSelect:false};var s=a.HotelAutoCompleter.Select(n,i,t,e);var c;a.browser.opera&&a(i.form).bind("submit.autocomplete",function(){if(c){c=false;return false;}});b.bind((a.browser.opera?"keypress":"keydown")+".autocomplete",function(x){f=1;k=x.keyCode;switch(x.keyCode){case j.UP:x.preventDefault();if(s.visible()){s.prev();}else{m(0,true);}break;case j.DOWN:x.preventDefault();if(s.visible()){s.next();}else{m(0,true);}break;case j.PAGEUP:x.preventDefault();if(s.visible()){s.pageUp();}else{m(0,true);}break;case j.PAGEDOWN:x.preventDefault();if(s.visible()){s.pageDown();}else{m(0,true);}break;case n.multiple&&a.trim(n.multipleSeparator)==","&&j.COMMA:case j.TAB:case j.RETURN:if(t()){if(n.isSubmit){return true;}else{x.preventDefault();c=true;return false;}}else{s.hide();}break;case j.ESC:s.hide();break;default:clearTimeout(v);v=setTimeout(m,n.delay);break;}}).focus(function(){f++;}).blur(function(){f=0;if(!e.mouseDownOnSelect){g();}}).click(function(){if(f++>1&&!s.visible()){m(0,true);}}).bind("search",function(){var y=(arguments.length>1)?arguments[1]:null;function x(B,z){var C;if(z&&z.length){for(var A=0;A<z.length;A++){if(z[A].result.toLowerCase()==B.toLowerCase()){C=z[A];break;}}}if(typeof y=="function"){y(C);}else{b.trigger("result",C&&[C.data,C.value]);}}a.each(w(b.val()),function(z,A){});}).bind("flushCache",function(){d.flush();}).bind("input",function(){clearTimeout(v);v=setTimeout(m,n.delay);}).bind("setOptions",function(){a.extend(n,arguments[1]);if("data" in arguments[1]){d.populate();}}).bind("unautocomplete",function(){s.unbind();b.unbind();a(i.form).unbind(".autocomplete");});function t(){var A=s.selected();if(!A){return false;}var C=A;p=C;if(n.multiple){var E=w(b.val());if(E.length>1){var B=n.multipleSeparator.length;var x=a(i).selection().start;var D,z=0;a.each(E,function(F,G){z+=G.length;if(x<=z){D=F;return false;}z+=B;});E[D]=C;C=E.join(n.multipleSeparator);}C+=n.multipleSeparator;}b.focus();var y=a("<div>"+C+"</div>").text();b.val(y);h();b.trigger("result",[A.data,A.value]);return true;}function m(x,z){if(k==j.DEL){s.hide();return;}var y=b.val();if(!z&&y==p){return;}p=y;y=l(y);if(y.length>=n.minChars){b.addClass(n.loadingClass);if(!n.matchCase){y=y.toLowerCase();}r(y,q,h);}else{u();s.hide();}}function w(x){if(!x){return[""];}if(!n.multiple){return[a.trim(x)];}return a.map(x.split(n.multipleSeparator),function(y){return a.trim(x).length?a.trim(y):null;});}function l(y){if(!n.multiple){return y;}var z=w(y);if(z.length==1){return z[0];}var x=a(i).selection().start;if(x==y.length){z=w(y);}else{z=w(y.replace(y.substring(x),""));}return z[z.length-1];}function g(){clearTimeout(v);v=setTimeout(h,200);}function h(){var x=s.visible();s.hide();clearTimeout(v);u();if(n.mustMatch){b.search(function(y){if(!y){if(n.multiple){var z=w(b.val()).slice(0,-1);b.val(z.join(n.multipleSeparator)+(z.length?n.multipleSeparator:""));}else{b.val("");b.trigger("result",null);}}});}}function q(y,x){if(x&&x.length&&f){u();s.display(x,y);s.show();}else{h();}}function r(B,A,z){if(!n.matchCase){B=B.toLowerCase();}var x=n.data;if(x&&x.length){A(B,x);}else{if((typeof n.url=="string")&&(n.url.length>0)){var y={};a.each(n.extraParams,function(C,D){y[C]=typeof D=="function"?D():D;});a.ajax({mode:"abort",port:"autocomplete"+i.name,dataType:n.dataType,url:n.url,type:"GET",jsonp:"callback",data:a.extend({q:l(B),limit:n.max},y),success:function(C){d.add(B,C);A(B,C);}});}else{s.emptyList();z(B);}}}function o(x){var z=[];var B=x.split("\n");for(var y=0;y<B.length;y++){var A=a.trim(B[y]);if(A){A=A.split("|");z[z.length]={data:A,value:A[0],result:n.formatResult&&n.formatResult(A,A[0])||A[0]};}}return z;}function u(){}};a.HotelAutoCompleter.defaults={inputClass:"com_input",resultsClass:"ac_results com_results",minChars:1,submitId:null,delay:400,matchCase:false,matchContains:false,cacheLength:10,max:10,mustMatch:false,extraParams:{},selectFirst:false,formatItem:function(b){return b[0];},contentType:"application/json; charset=GB2312",formatMatch:null,width:230,isSubmit:false,multiple:false,multipleSeparator:", ",highlight:function(c,b){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>");},scroll:true,scrollHeight:180};a.HotelAutoCompleter.Cache=function(f){var c={};var e=0;function b(h,i){if(e>f.cacheLength){d();}if(!c[h]){e++;}c[h]=i;}function g(){if(!f.data){return false;}else{return f.data;}}setTimeout(g,25);function d(){c={};e=0;}return{flush:d,add:b,populate:g,load:function(h){if(!f.cacheLength||!e){return null;}return f.data;}};};a.HotelAutoCompleter.Select=function(p,i,q,d){var c={ACTIVE:"ac_over"};var l,b=-1,e,s="",o=true,f,k;function h(){if(!o){return;}f=a("<div/>").hide().addClass(p.resultsClass).css("position","absolute").appendTo(document.body);k=a("<ul/>").appendTo(f).mouseover(function(t){if(r(t).nodeName&&r(t).nodeName.toUpperCase()=="LI"){b=a("li",k).removeClass(c.ACTIVE).index(r(t));if(b<p.max){a(r(t)).addClass(c.ACTIVE);}else{b=-1;}}}).click(function(t){if(p.max>=e.length){a(r(t)).addClass(c.ACTIVE);q();i.focus();return false;}else{if(Event.element(t).parent().attr("id")=="moreSuggest"){p.submitId.click();f&&f.hide();}else{a(r(t)).addClass(c.ACTIVE);q();i.focus();return false;}}}).mousedown(function(){d.mouseDownOnSelect=true;}).mouseup(function(){d.mouseDownOnSelect=false;});if(p.width>0){f.css("width",p.width);}o=false;}function r(u){var t=u.target;while(t&&t.tagName!="LI"){t=t.parentNode;}if(!t){return[];}return t;}function n(v){l.slice(b,b+1).removeClass(c.ACTIVE);m(v);var t=l.slice(b,b+1).addClass(c.ACTIVE);if(p.scroll){var u=0;l.slice(0,b).each(function(){u+=this.offsetHeight;});if((u+t[0].offsetHeight-k.scrollTop())>k[0].clientHeight){k.scrollTop(u+t[0].offsetHeight-k.innerHeight());}else{if(u<k.scrollTop()){k.scrollTop(u);}}}}function m(u){if(b<p.max){var t=q();b+=u;if(b<0){b=p.max-1;}else{if(b>=p.max){b=0;}}}else{b=-1;}}function j(t){return p.max&&p.max<t?p.max:t;}function g(){k.empty();var x=j(e.length);for(var u=0;u<x;u++){if(!e[u]){continue;}var y=new Array();y=s.split(" ");var t=e[u];for(var v=0;v<y.length;v++){if(a.trim(y[v]).length>0){t=p.highlight(t,a.trim(y[v]));}}var w=a("<li/>").html(p.highlight(t,s)).addClass(u%2==0?"ac_even":"ac_odd").appendTo(k)[0];a.data(w,"ac_data",e[u]);}if(e.length>p.max){var z=a("<li/>").html("<a href='#?' id='moreSuggest'><span style='margin-left:170px;'>更多</span></a>").appendTo(k)[0];}l=k.find("li");if(p.selectFirst){l.slice(0,1).addClass(c.ACTIVE);b=0;}if(a.fn.bgiframe){k.bgiframe();}}return{display:function(t,u){h();e=t;s=u;g();},next:function(){n(1);},prev:function(){n(-1);},pageUp:function(){if(b!=0&&b-8<0){n(-b);}else{n(-8);}},pageDown:function(){if(b!=l.size()-1&&b+8>l.size()){n(l.size()-1-b);}else{n(8);}},hide:function(){f&&f.hide();l&&l.removeClass(c.ACTIVE);b=-1;},visible:function(){return f&&f.is(":visible");},current:function(){return this.visible()&&(l.filter("."+c.ACTIVE)[0]||p.selectFirst&&l[0]);},show:function(){var u=a(i).offset();f.css({width:typeof p.width=="string"||p.width>0?p.width:a(i).width(),top:u.top+i.offsetHeight,left:u.left}).show();if(p.scroll){k.scrollTop(0);k.css({maxHeight:p.scrollHeight,overflow:"auto"});if(a.browser.msie&&typeof document.body.style.maxHeight==="undefined"){if(a.browser.msie&&(a.browser.version=="6.0")&&!a.support.style){var t=0;l.each(function(){t+=this.offsetHeight;});var v=t>p.scrollHeight;k.css("height",v?p.scrollHeight:t);if(!v){}}else{var t=0;l.each(function(){t+=this.offsetHeight;});var v=t>p.scrollHeight;k.css("height",v?p.scrollHeight:t);if(!v){l.width(k.width()-parseInt(l.css("padding-left"))-parseInt(l.css("padding-right")));}}}}},selected:function(){var t=l&&l.filter("."+c.ACTIVE).removeClass(c.ACTIVE);return t&&t.length&&a.data(t[0],"ac_data");},emptyList:function(){k&&k.empty();},unbind:function(){f&&f.remove();}};};a.fn.selection=function(g,c){if(g!==undefined){return this.each(function(){if(this.createTextRange){var j=this.createTextRange();if(c===undefined||g==c){j.move("character",g);j.select();}else{j.collapse(true);j.moveStart("character",g);j.moveEnd("character",c);j.select();}}else{if(this.setSelectionRange){this.setSelectionRange(g,c);}else{if(this.selectionStart){this.selectionStart=g;this.selectionEnd=c;}}}});}var d=this[0];if(d.createTextRange){var f=document.selection.createRange(),e=d.value,h="<->",i=f.text.length;f.text=h;var b=d.value.indexOf(h);d.value=e;this.selection(b,b+i);return{start:b,end:b+i};}else{if(d.selectionStart!==undefined){return{start:d.selectionStart,end:d.selectionEnd};}}};})(jQuery);