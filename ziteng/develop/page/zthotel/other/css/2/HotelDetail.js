var TriggerClient=Elong.Page.TriggerClient;TriggerClient=Class.create();Object.extend(TriggerClient.prototype,{name:"TriggerClient",initialize:function(){},initializeDOM:function(){},destroyDOM:function(){},initializeEvent:function(){},initializeEvent:function(){},destroyEvent:function(){},render:function(){},dispose:function(){this.destroyEvent();this.destroyDOM();},CreateGuid:function(){var a="";for(var b=1;b<=32;b++){var c=Math.floor(Math.random()*16).toString(16);a+=c;if((b==8)||(b==12)||(b==16)||(b==20)){a+="-";}}return a;},CreateAndSaveSearchGuid:function(b){var a=b;if(Object.isNull(b)){a=this.CreateGuid();}Globals.cookie("TriggerSearchGUID","",a,{expires:1,path:"/",secure:false});},GetSearchGUID:function(){var a=Globals.cookie("TriggerSearchGUID");if(Object.isNull(a)){a=this.CreateGuid();this.CreateAndSaveSearchGuid(a);}return a;},GetMachineGUID:function(){var a=Globals.cookie("CookieGuid");if(Object.isNull(a)||String.isNullOrEmpty(a)){a="00000000-0000-0000-0000-000000000000";}return a;},HotelDetailTrigger:function(g,i,m,l,a,b,c,k,h){try{var n=this.GetSearchGUID();var j=this.GetMachineGUID();Elong.sendTJ({TableName:"Trigger_HotelDetail",SearchGUID:n,HotelId:g,CheckInDate:b,CheckOutDate:c,LogTypeID:i,RoomTypeID:m,RatePlanID:l,MachineGUID:j,OrderFromId:k,HotelRankType:h,CardNo:a,SessionGuid:Globals.cookie("SessionGuid"),OperateTime:new Date().toLocaleDateString()});}catch(f){}},BrowserHotelDataCollect:function(a,c){try{var f="http://tj.elong.com/hotel/realTimeBrowserData/realTimeHotel.gif?channel=hotel&CityId="+a+"&HotelId="+c+"&rn=";$("#realTimeCity").remove();$("<img src='"+f+"' id='realTimeCity' width='1' height='1'/>").appendTo($("#m_contentend"));}catch(b){}}});Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a;}}return -1;};var ImageBox=Elong.Control.ImageBox;ImageBox=Class.create();Object.extend(ImageBox.prototype,{name:"ImageBox",options:{initEvent:null,closeEvent:null},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.initializeDOM();this.initializeData();this.window=new LightBox(this.windowElement,this.overlayer,a);if($.browser.msie&&$.browser.version<=6){this.window.Fixed=false;}this.overLay=this.window.OverLay;this.overLay.Color="#131313";if($.browser.msie&&$.browser.version<7){$(this.overlayer.find("iframe")[0].contentWindow.document).bind("click",this.hide.bindAsEventListener(this));}else{this.overlayer.bind("click",this.hide.bindAsEventListener(this));}this.windowElement.bind("click",this.imageBoxClick.bindAsEventListener(this));},initializeDOM:function(){this.contentEndRegion=$("#m_contentend");this.contentEndRegion.html("");this.embedTemplate=new Template('<embed name="VT360" id="VT360" width="485px" height="410px" base="." menu="false" flashvars="#{filepath}" wmode="transparent" allowscriptaccess="sameDomain" quality="High" bgcolor="#FFFFFF" pluginspage="http://www.macromedia.com/go/getflashplayer" src="http://resource.elong.com/cn/hotels/images/vtourlite.swf?#{random}" type="application/x-shockwave-flash">');this.windowElement=$("#ImageBoxContent");this.overlayer=$("<div></div>").appendTo(this.contentEndRegion);this.bigImgBox=this.windowElement.find("#bigImgBox");this.imgDesc=this.windowElement.find("#ImgDesc");},initializeData:function(){this.windowElement.find("img[src4]").each(function(){$(this).attr("src",$(this).attr("src4")).removeAttr("src4");});this.SelectTabIndex=0;this.currSrcIndex=0;this.imageData=[];var a=0;this.imageData.push(this.getImageDate(this.windowElement.find("#allLiImg")));this.windowElement.find("#allLiImg").attr("index",a);if($("#memberLiImg").length>0){a++;this.imageData.push(this.getImageDate(this.windowElement.find("#memberLiImg")));this.windowElement.find("#memberLiImg").attr("index",a);}if($("#360LiImg").length>0){a++;this.imageData.push(this.getImageDate(this.windowElement.find("#360LiImg")));this.windowElement.find("#360LiImg").attr("index",a);}},getImageDate:function(b){var a=[];b.find("li").each(function(){var e=$(this).attr("imgId");var f=$(this).attr("bigImgSrc");var c=$(this).attr("imgDesc");var i=$(this).attr("imageSource");var h=$(this).attr("cardNo");var j=$(this).attr("imgtype");var k=$(this).attr("uploadDate");var g={id:e,src:f,srcDesc:c,imageSource:i,type:j,cardNo:h,uploadDate:k};a.push(g);});return a;},imageBoxClick:function(b){var a=Event.element(b);var e=a.attr("mth");switch(e){case"close":this.hide();if(this.closeEvent!=null){this.closeEvent(this.windowElement);}break;case"prev":this.prevImg();break;case"next":this.nextImg();break;case"liTab":var c=a.attr("mark");this.showLiAndUl(a,c);return;break;case"selectPic":var f=a.parent();this.SelectTabIndex=parseInt(f.parent().attr("index"));this.currSrcIndex=parseInt(f.attr("index"));this.showSelectPic(f.attr("imgId"),f.attr("bigImgSrc"),f.attr("imgDesc"),f.attr("imgtype"),this.SelectTabIndex);break;}},showLiAndUl:function(a,b){a.parent().children().removeClass("mr");a.addClass("mr");this.windowElement.find("#liImgBox").children().hide();switch(b){case"all":this.windowElement.find("#allLiImg").show();break;case"member":this.windowElement.find("#memberLiImg").show();break;case"360":this.windowElement.find("#360LiImg").show();break;}},prevImg:function(){if(this.currSrcIndex>0){this.currSrcIndex--;}else{if(this.SelectTabIndex>0){this.SelectTabIndex--;}else{this.SelectTabIndex=this.imageData.length-1;}this.currSrcIndex=this.imageData[this.SelectTabIndex].length-1;}var a=this.imageData[this.SelectTabIndex][this.currSrcIndex];this.showSelectPic(a.id,a.src,a.srcDesc,a.type,this.SelectTabIndex);},nextImg:function(){if(this.currSrcIndex<(this.imageData[this.SelectTabIndex].length-1)){this.currSrcIndex++;}else{if(this.SelectTabIndex<this.imageData.length-1){this.SelectTabIndex++;}else{this.SelectTabIndex=0;}this.currSrcIndex=0;}var a=this.imageData[this.SelectTabIndex][this.currSrcIndex];this.showSelectPic(a.id,a.src,a.srcDesc,a.type,this.SelectTabIndex);},showSelectPic:function(imgId,bigImgUrl,imgDesc,imgType,tabIndex){if(typeof(bigImgUrl)=="undefined"||String.isNullOrEmpty(bigImgUrl)){bigImgUrl="http://www.elongstatic.com/hotels/pic/detailpic_no.png";}if(imgType=="3"){var rndm=Math.random();var embedHtml=this.embedTemplate.eval({filepath:bigImgUrl,random:rndm});this.bigImgBox.html(embedHtml);}else{this.bigImgBox.html("<img alt='"+imgDesc+"' src='"+bigImgUrl+"'/>");}this.imgDesc.html(imgDesc);this.windowElement.find("li[mark]").removeClass("mr");$(this.windowElement.find("li[mark]").get(tabIndex)).addClass("mr");this.windowElement.find("#liImgBox").children().hide();$(this.windowElement.find("#liImgBox").children().get(tabIndex)).show();this.windowElement.find("#liImgBox li").removeClass("on");$(this.windowElement.find("#liImgBox ul").get(tabIndex)).find("li[imgId='"+imgId+"']").addClass("on");var e=document.getElementById("liImgBox");if(($(this.windowElement.find("#liImgBox ul").get(tabIndex)).find("li[imgId='"+imgId+"']").offset().top-$(e).offset().top)>240){e.scrollTop+=240*(Math.ceil($(this.windowElement.find("#liImgBox ul").get(tabIndex)).find("li[imgId='"+imgId+"']").offset().top/$(e).offset().top)-1);}if(($(e).offset().top-$(this.windowElement.find("#liImgBox ul").get(tabIndex)).find("li[imgId='"+imgId+"']").offset().top)>20){e.scrollTop-=240;}},destroyDOM:function(){this.htmlContent="";this.windowElement.remove();this.overlayer.remove();this.windowElement=null;this.contentEndRegion=null;},show:function(c,a){if(c){var e={1:"all",2:"member",3:"360"}[c];this.showLiAndUl(this.windowElement.find("li[mark='"+e+"']"),e);}if(!String.isNullOrEmpty(a)){var b=this.windowElement.find("li[imgid='"+a+"']");this.SelectTabIndex=parseInt(b.parent().attr("index"));this.currSrcIndex=parseInt(b.attr("index"));this.showSelectPic(b.attr("imgId"),b.attr("bigImgSrc"),b.attr("imgDesc"),b.attr("imgtype"),this.SelectTabIndex);}this.window.Show();},hide:function(){this.window.Close();},close:function(){this.window.Close();this.destroyDOM();}});var HotelMapPopupClient=Elong.Page.HotelMapPopupClient;HotelMapPopupClient=Class.create();Object.extend(HotelMapPopupClient.prototype,{name:"HotelMapPopupClient",options:{HotelId:"",PopupUrl:""},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.initializeData();this.closs.bind("click",this._hide.bindAsEventListener(this));this.render();},initializeData:function(){this.mapPopup=$("#mapPopup");this.loading=$("#mapLoading");this.closs=$("#closs");},render:function(){if(String.isNullOrEmpty(this.PopupUrl)||String.isNullOrEmpty(this.HotelId)){return;}this._show();var iframe=document.createElement("iframe");iframe.height="388px";iframe.width="990px";iframe.scrolling="no";iframe.frameBorder="0";iframe.src=new Template(this.PopupUrl).eval({hotelId:this.HotelId});if(iframe.attachEvent){iframe.attachEvent("onload",function(){$(this.parentElement).find("#mapLoading").hide();});}else{iframe.onload=function(){$(this.parentElement).find("#mapLoading").hide();};}if(this.mapPopup.find("iframe").length==0){this.mapPopup.append($(iframe));}},_show:function(){this.mapPopup.slideDown(400);},_hide:function(){this.mapPopup.slideUp(400);}});var HotelDetailHeadClient=Elong.Page.HotelDetailHeadClient;HotelDetailHeadClient=Class.create();Object.extend(HotelDetailHeadClient.prototype,{name:"HotelDetailHeadClient",upLoadHrefTemplate:"http://My.elong.com/PicUpload_#{language}_#{hotelid}.html?hotelId=#{hotelid}&cityId=#{cityId}&cityName=#{cityName}&hotelName=#{hotelName}",controllerData:HotelDetailNewController,options:{Language:"CN"},initialize:function(options){Object.extend(Object.extend(this,this.options),options);this.upLoadHrefTemplate=new Template(this.upLoadHrefTemplate);this.img350Template=new Template("<div id='img350showHandle' class='po_pic none'><div class='boxt'><div class='boxpic'><img src='#{img350Url}'  /></div></div></div> ");this.controllerData=HotelDetailNewController;this.taiwanCityids=this.controllerData.GoogelMapCityIds;this.CampaignId=this.controllerData.CampaignId;this.lowestPriceTemplate=new Template("<span>#{from}#{price}#{tail}</span>");this.HotelDetailUrlTemplate=new Template(this.controllerData.UrlConfig.HotelDetailViewUrl);this.Language=this.Language.toLowerCase();this.HotelId=this.controllerData.AjaxPropertys.HotelId;this.CityId=this.controllerData.AjaxPropertys.CityId;this.Cityname=this.controllerData.AjaxPropertys.CityNameCn;this.CitynameEn=this.controllerData.AjaxPropertys.CityNameEn!=null?this.controllerData.AjaxPropertys.CityNameEn:"";this.StarLevel=this.controllerData.AjaxPropertys.StarLevel;this.HotelName=this.controllerData.AjaxPropertys.HotelName;this.Address=HotelDetailNewController.AjaxPropertys.Address;this.Lat=this.taiwanCityids.indexOf(this.CityId)>-1?HotelDetailNewController.AjaxPropertys.GoogleLat:HotelDetailNewController.AjaxPropertys.Lat;this.Lng=this.taiwanCityids.indexOf(this.CityId)>-1?HotelDetailNewController.AjaxPropertys.GoogleLng:HotelDetailNewController.AjaxPropertys.Lng;this.WebRequestInfo=this.controllerData.AjaxPropertys.RequestInfo;this.DetailImageList=HotelDetailNewController.AjaxPropertys.DetailImageList;this.HotelstarLevelRemark=this.controllerData.Resources.HotelstarLevelRemark;this.upLoadHref=this.upLoadHrefTemplate.eval({language:this.Language,hotelid:this.HotelId,cityId:this.CityId,cityName:encodeURIComponent(this.Cityname),hotelName:encodeURIComponent(this.HotelName)});this.Traffic=HotelDetailNewController.AjaxPropertys.Traffic;this.TrafficMapUrl=HotelDetailNewController.UrlConfig.TrafficMapUrl;this.initializeDOM();this.initializeClientData();this.initializeEvent();this.render();},initializeDOM:function(){this.ImageDiv=$("#ImageDiv");this.uploadImage=$("#uploadImage");this.ImgArea=$("#ImgArea");this.bigImage350=$("#bigImage350");this.imageName=$("#imageName");this.imageToolDiv=$("#imageToolDiv");this.imageMapShow=$("#imageMapShow");this.mapShow=$("#mapDetial");this.rightCommentDiv=$("#rightCommentDiv");this.hrefViewMap=$("#viewMap");this.img350Template=new Template('<div id="img350showHandle" style="float:left;position:absolute;z-index:9999;display:none;" class="po_pic"><div class="boxt"><div class="boxpic"><img src=\'#{img350Url}\'/></div></div></div>');this.imgToShowArray=this.ImgArea.find("div[handle='playImageItem']");},initializeClientData:function(){},destroyDOM:function(){this.ImageDiv=null;this.uploadImage=null;this.ImgArea=null;this.bigImage350=null;this.imageName=null;this.imgToShowArray=null;this.imageToolDiv=null;this.rightCommentDiv=null;},initializeEvent:function(){this.ImageDiv.bind("click",this.ImageDivClick.bindAsEventListener(this));this.imageToolDiv.bind("click",this.imageToolDivClick.bindAsEventListener(this));this.uploadImage.bind("click",this.btnUploadClick.bindAsEventListener(this));this.imgToShowArray.bind("mouseover",this.onImgShowMouseOver.bindAsEventListener(this));this.imgToShowArray.bind("mouseout",this.onImgShowMouseOut.bindAsEventListener(this));$("#imgPopupPrice").live("click",this.btnLowestPriceClick.bindAsEventListener(this));$("#imageMapDiv").bind("click",this.OnClickImageMapShow.bindAsEventListener(this));this.imageMapShow.bind("click",this.OnClickImageMapShow.bindAsEventListener(this));this.rightCommentDiv.bind("click",this.OnClickCommentDiv.bindAsEventListener(this));},OnClickCommentDiv:function(a){$("#comment").click();},OnClickImageMapShow:function(b){var a=Event.element(b);if(this.Language=="cn"&&this.taiwanCityids.indexOf(this.CityId)==-1){if(this.Lat>0&&this.Lng>0){if(Object.isNull(this.HotelMapPopupClient)){this.HotelMapPopupClient=new HotelMapPopupClient({HotelId:this.HotelId,PopupUrl:this.controllerData.UrlConfig.MapPopupUrl});}else{this.HotelMapPopupClient._show();}}return false;}else{this.OnClickViewMapAction(b);}},OnClickViewMapAction:function(b){if(this.Lat==0){return false;}if(this.Language=="cn"&&this.taiwanCityids.indexOf(this.CityId)==-1){window.location.href=this.TrafficMapUrl+"#iTop";return false;}var a=Event.element(b);var c="";if(this.StarLevel!="0"&&this.StarLevel<10){c="<span class='dx xjjp dx"+this.StarLevel+"' title='"+this.StarLevel+(this.Language=="cn"?"Deluxe Hotel":" Star")+"'></span>";}var e="<div class='maptips'><p class='pt5'><span class='t14 bold pr15'>"+this.HotelName+"</span>"+c+"</p><p class='t12'>"+(this.Language=="cn"?"Address：":"Address:")+this.Address+'</p><div id="t_map" class="map_box" style="margin:0;padding:0;width: 570px; height:300px"></div><div><p class=\'t12 bold pt10\'>'+this.HotelName+(this.Language=="cn"?"交通位置":" Location & Transportation")+"</p><div class='traffic_info'>"+(String.isNullOrEmpty(this.Traffic)?"":this.Traffic.replace(/[\n]/g,"<br>"))+"</div>";var f=new Dialog({title:"Map",htmlContent:e,width:600,initEvent:function(g){FunctionExt.defer(function(){var h=new MapControl({containId:"t_map",showTools:true});h.addLabeledMarker(this.HotelName,this.Lat,this.Lng,"",{url:"http://www.elongstatic.com/hotels/pic/baidu_landmarks.png",width:21,height:25});}.bind(this),1000);}.bind(this)});f.show();return false;},onImgShowMouseOver:function(b){var a=Event.element(b);if(a[0].tagName=="IMG"){var c=$(a).parent().parent().attr("bigimgurl");if(!String.isNullOrEmpty(c)){this.show350Image($(a).parent().parent(),c);$(a).parent().parent().parent().addClass("post");}}},onImgShowMouseOut:function(b){var a=Event.element(b);var c=$("#img350showHandle");$(a).parent().parent().parent().removeClass("post");c.hide();c.remove();return false;},show350Image:function(eventElement,img350Url){var imgHtml=this.img350Template.eval({img350Url:img350Url});$("#img350showHandle").remove();var img350showHandle=$(imgHtml);eventElement.after(img350showHandle);var top=eventElement.height();var left=0;var scroll=Globals.getScrollPosition();var browserRegion=Globals.browserDimensions();if(browserRegion.width-(eventElement.offset().left-scroll.x)>img350showHandle.width()){img350showHandle[0].style.top=top+"px";img350showHandle[0].style.left=left+"px";}else{img350showHandle[0].style.top=top+"px";left=left-img350showHandle.width()+eventElement.width();img350showHandle[0].style.left=left+"px";}img350showHandle.show(500);},ImageDivClick:function(b){b.preventDefault();var a=Event.element(b);var e=a.attr("method");var c=a.attr("ImageId");var f=a.attr("SourceType");if(f!=="3"&&c==""){return;}switch(e){case"showImagePop":if(this.imgbox==null){this.imgbox=new ImageBox({initEvent:null});}this.imgbox.show(1,c);return;break;case"":break;}},imageToolDivClick:function(b){b.preventDefault();var a=Event.element(b);var e=a.attr("method");var c=a.attr("ImageId");switch(e){case"imageAll":if(this.imgbox==null){this.imgbox=new ImageBox({initEvent:function(){}});}this.imgbox.show(1,c);break;case"view360Image":if(this.imgbox==null){this.imgbox=new ImageBox({initEvent:function(){}});}this.imgbox.show(3,c);break;case"":break;}},btnUploadClick:function(){window.location.href=this.upLoadHref;},btnLowestPriceClick:function(a){if(!Object.isNull(this.imgbox)){this.imgbox.hide();}if(HotelDetailNewController.AjaxPropertys.PageType!="hotel"){a.preventDefault();window.location.href="http://"+window.location.host+HotelDetailNewController.UrlConfig.HotelDetailUrl+"#room";}},setMapCss:function(){if(this.Lat>0&&this.Lng>0){$("#imageMapDiv").attr("class","box");}},destroyEvent:function(){this.ImageDiv.unbind("click");this.imageToolDiv.unbind("click");this.uploadImage.unbind("click");},render:function(){this.imageMapShow.attr("src",this.imageMapShow.attr("realSrc"));if(this.taiwanCityids.indexOf(this.CityId)>-1){$("#NoOrGoogleMap").attr("src",$("#NoOrGoogleMap").attr("gSrc")).attr("title","查看Map");$("#NoOrGoogleMap").parent().removeClass("map_no");$("#NoOrGoogleMap").bind("click",this.OnClickImageMapShow.bindAsEventListener(this));}this.writeBrowseHotelsToCookie();this.setMapCss();},writeBrowseHotelsToCookie:function(){var a=this.getBrowseHotelVal(this.HotelId);a=String.format("{0},{1},{2},{3},{4},{5},{6};",this.HotelId,"","","","","","")+a;Globals.cookie("SHBrowseHotel",this.Language.toLowerCase(),a,{expires:30,path:"/",secure:false});},getBrowseHotelVal:function(e){var a="";a=Globals.cookie("SHBrowseHotel",this.Language.toLowerCase());if(a==null){a="";}var c=a.split(";");var h="";var b=0;for(var g=0;b<4&&g<c.length;g++){if(c[g]!=null&&c[g]!=""&&c[g].indexOf(e)<=-1){var f=c[g].split(",");if(f!=""&&f.length==7){h+=c[g]+";";b=b+1;}}}return h;}});var JsElapsedTime=Elong.Page.JsElapsedTime;JsElapsedTime=Class.create();Object.extend(JsElapsedTime.prototype,{name:"jsElapsedTime",options:{Language:"CN"},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.startTime=null;this.endTime=null;},start:function(){this.startTime=new Date();},end:function(b){this.endTime=new Date();if(this.startTime==null||this.endTime==null){return 0;}var a=this.endTime.getTime()-this.startTime.getTime();if(typeof(console)=="undefined"){return false;}if(!String.isNullOrEmpty(b)){console.log(b+a+"毫秒");return b+a+"毫秒";}else{console.log(a+"毫秒");return a+"毫秒";}}});$.extend({includePath:"",include:function(c,h){var f=typeof(c)=="string"?[c]:c;for(var g=0;g<f.length;g++){var j=f[g].replace(/^\s|\s$/g,"");var a=j.split(".");var b=a[a.length-1].toLowerCase();if(b=="js"){var e=document.createElement("script");e.setAttribute("type","text/javascript");e.setAttribute("src",$.includePath+j);}else{if(b=="css"){var e=document.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("type","text/css");e.setAttribute("id",h);e.setAttribute("href",$.includePath+j);}}if(typeof e!="undefined"){if($("#"+h).length>0){$("#"+h).attr("href",$.includePath+j);}else{document.getElementsByTagName("head")[0].appendChild(e);}}}}});var HotelRoomClient=Elong.Page.IndexClient;HotelRoomClient=Class.create();Object.extend(HotelRoomClient.prototype,{name:"HotelRoomClient",Resources:HotelDetailNewController.Resources,Language:HotelDetailNewController.Language.toUpperCase(),AjaxInfo:HotelDetailNewController.AjaxPropertys,HotelUrlTemplate:new Template(HotelDetailNewController.UrlConfig.HotelDynamicDetail),CurrentRoom:HotelDetailNewController.AjaxPropertys.CurrentRoom,HotelRoomList:null,PromotionSummaryInfo:null,tipWindow:null,RoomImageShowed:false,OrderUrlTemplate:new Template(HotelDetailNewController.UrlConfig.OrderUrl.replace("big5.elong.com/gate/big5/","")),HotelDetailFastBooking:new Template(HotelDetailNewController.UrlConfig.HotelDetailFastBooking),HotelDetailUrl:new Template(HotelDetailNewController.UrlConfig.HotelDetailViewUrl),HotelDetailReviewUrl:new Template(HotelDetailNewController.UrlConfig.HotelDetailReviewUrl),DetailQuickOrder:HotelDetailNewController.DetailQuickOrder,CannelHtml:'<p class="popBoxtitle mb5"><span class=icon01></span>免费取消</p><p>订单提交后可随时免费取消/变更。</p>',DanbaoHtml:HotelDetailNewController.Language.toUpperCase()!="EN"?'<p class="mb10">Room type太抢手了！Hotel需要您提供信用卡或支付宝担保预订。</p><p class="l_black">什么叫“信用卡担保”？</p><p class="l_black">我们会预先冻结相应担保金，实际Check in后，担保金会在您离店后3-5个工作日内解冻。</p>':'<p class="mb10">This room is in great demand! The hotel requires your payment details to secure your reservation.</p><p class="l_black">What is credit card guarantee?</p><p class="l_black">You will not be charged for your room until you check out. To guarantee your booking we need to temporarily freeze an amount (usually 1 night room charge) from your credit card that will be released within 3 business days after you check out. Please kindly note that the hotel may require an additional deposit during check-in.</p>',GrouponHtml:'<ul class="roomTypes" method="grouponroom"><li class="rbox groupon">    <p class="rw1"><img width="70" height="40" alt=" Group Purchase" src="http://www.elongstatic.com/hotels/pic/detailgroupon.png"></p>    <p class="rw2"><a title="{0}" href="{1}">{2}</a></p>    <p class="rw3">{3}</p>    <p class="rw3">{4}</p>    <p class="rw3">{5}</p>    <p class="rw4"><span class="priceDesignated">¥{6}</span><span class="price"><dfn>¥</dfn>{7}</span></p>    <p class="rw5">&nbsp;</p>    <p class="rw6">&nbsp;</p>    <p class="rw7"><a class="button" href="{8}">去 Group Purchase</a></p></li></ul>',initialize:function(){this.initializeDOM();this.initializeEvent();this.initTemplate();},initializeDOM:function(){this.serverTime=HotelDetailNewController.ServerTime.substring(0,10);this.CalendarShowYesterday=HotelDetailNewController.CalendarShowYesterday;this.divRoomList=$("#divRoomList");this.divDateRegion=$("#dateRegion");this.divRecommendRegion=$("#divRecommendRegion");this.divHotelPriceRegion=$("#divHotelPrice");this.tabButton=$("#tabButton");this.roomType=$("#roomType");this.roomTypes=$("#roomTypes");this.comment=$("#comment");this.commentDiv=$("#commentDiv");},destroyDOM:function(){this.divDateRegion=null;this.divRoomList=null;this.divRecommendRegion=null;this.divHotelPriceRegion=null;},initializeEvent:function(){this.divDateRegion.bind("click",this.onDetailRegionClick.bindAsEventListener(this));this.divRoomList.bind("click",this.onDetailRegionClick.bindAsEventListener(this));this.divRecommendRegion.bind("click",this.onDetailRegionClick.bindAsEventListener(this));this.divRoomList.bind("mouseover",this.onDetailRegionMouseOver.bindAsEventListener(this));this.divHotelPriceRegion.bind("mouseover",this.onRebateRegionMouseOver.bindAsEventListener(this));this.divHotelPriceRegion.bind("click",this.onDetailRegionClick.bindAsEventListener(this));this.tabButton.bind("click",this.OnClickTabButton.bindAsEventListener(this));$(window).unload(this.dispose.bind(this));},destroyEvent:function(){this.divDateRegion.unbind("click");this.divRoomList.unbind("click");this.divRecommendRegion.unbind("click");this.divRoomList.unbind("mouseover");this.divHotelPriceRegion.unbind("mouseover");$(window).unbind("scroll");},render:function(){FunctionExt.defer(function(){this.getHotelRoomSet(this.AjaxInfo.HotelId,this.AjaxInfo.ShadowHotelId,this.AjaxInfo.RequestInfo,false,false);}.bind(this),100,this);var a=0;switch(this.AjaxInfo.PageType){case"hotel":a=0;break;case"reviews":a=3;break;case"photo":a=5;break;case"maps":a=4;break;case"help":a=6;break;default:a=7;break;}var b=new TriggerClient();b.HotelDetailTrigger(this.AjaxInfo.HotelId,a,"0","0",this.AjaxInfo.RequestInfo.CardNo,this.AjaxInfo.RequestInfo.CheckInDate,this.AjaxInfo.RequestInfo.CheckOutDate,this.AjaxInfo.RequestInfo.OrderFromId,this.AjaxInfo.RequestInfo.RankType);},dispose:function(){this.destroyEvent();this.destroyDOM();},initTemplate:function(){this.NoRoomHtml=$("#NoRoomTemplate").html();this.DayPriceTemplate=new Template("<table cellspacing='0' cellpadding='0' border='0' class='sf_average'><thead><tr> <th>&nbsp;</th>#{Title}</tr></thead><tbody><tr>#{List}</tr></tbody></table>");this.ruleTemplate=new Template("<div class='sf_voucher'>#{hr}#{Rule}</div>");},onRebateRegionMouseOver:function(a){var b=Event.element(a);var c=b.attr("method");switch(c){case"coupon":var e=b.next("span").html();if(!String.isNullOrEmpty(e)){this.openTipDialog(b,e,400);a.preventDefault();}break;case"reduce":var e=b.next("span").html();if(!String.isNullOrEmpty(e)){this.openTipDialog(b,e,400);a.preventDefault();}break;}},onNameBoxMouseOver:function(c){var b=Event.element(c);var e=b.attr("weifang");if(e){var a=this.Language.toLowerCase()=="cn"?"惊喜！请关注含“今日特价”字样的Room type，享受超低价高品质Hotel服务！":'"Last Minute Deal" is a great deal applicable for some rooms. Please get details through the room type and rate section.';if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:a,eventElement:b,defer:true,width:400});}return false;},showSelectRoomDetailAndRatePlan:function(a){if(!String.isNullOrEmpty(a)){var e=a.split("_")[0];var c=a.split("_")[1];$("div[roomid='"+e+"'][mark='d']").removeClass("none");var b=$("div[roomid='"+e+"'][mark='d']").parent().offset().top;$("html, body").animate({scrollTop:(b-90)},100);}else{$("div[roomid][mark='d']:first").removeClass("none");}},getHotelRoomSet:function(a,f,e,b,c){e.StartLat=0;e.StartLng=0;this.jsElapsedTime=new JsElapsedTime();HotelDetailNewController.GetHotelRoomset(a,f,e,this.AjaxInfo.IsPrepayRoomList,function(l){this.jsElapsedTime.start();if(l.success){if(l.value!=null&&l.value.cssUrls!=null&&l.value.cssUrls.length>0){for(var g=0;g<l.value.cssUrls.length;g++){$.include(l.value.cssUrls[g],"imageCss"+g);}}$("#checkInDateApply").attr("class","dateTxt");$("#checkOutDateApply").attr("class","dateTxt");$("#Revise").attr("method","modify").val("Change date");this.HotelRoomList=l.value.HotelRoomList;this.PromotionSummaryInfo=l.value.PromotionSummaryInfo;var p="";var k="";if(this.hasHighspeed(this.HotelRoomList)){this.showInternetIcon();p=this.Language.toLowerCase()=="cn"?"上网服务":"Internet service";k+=(this.Language.toLowerCase()=="cn"?"Hotel提供宽带上网":"Internet available");}if(!Object.isNull($("i.fi_wifi"))&&$("i.fi_wifi").length>0){k+=(this.Language.toLowerCase()=="cn"?(k.length>0?'，公共区域提供<strong class="green">免费</strong>WiFi':'公共区域提供<strong class="green">免费</strong>WiFi'):(k.length>0?' and <strong class="green">Free</strong> Wi-Fi in public area':'<strong class="green">Free</strong> Wi-Fi in public area'));}if(String.isNullOrEmpty(k)){$("#netAndwifi").remove();}else{$("#netAndwifi").empty();$("#netAndwifi").append('<span class="title">'+p+"</span><p>"+k+"</p>");}this.buildTopRightPrice(l.value.PromotionSummaryInfo,l.value.HasWeifang);this.buildRoomMessageHtml(l.value);if(l.value.BookStatus==0||l.value.BookStatus==2){$("#noRoom").hide();$("#divRecommendRegion").hide();$("#divRoomLoading").hide();var m=this.buildRoomHtml(l.value,l.value.usingImagePrice);this.divRoomList.append(m);this.divRoomList.show();var h="免费|Free|free";$.each($("div[roomid][mark]").find("p[class='roomTxt']"),function(q,r){var s=new RegExp("("+h.replace(/,/,"|")+")","g");r.innerHTML=r.innerHTML.replace(s,'<span class="green">$1</span>');});this.showMoreRooms(l.value);var j="";if(l.value.HotelWarmTips!=null&&l.value.HotelWarmTips.length>0){var n=l.value.HotelWarmTips;if(n.length>1){j+="<div style='display:none'><dl class='morePromotion'><dt>"+(this.Language=="CN"?"您可享受更多优惠：":"You can enjoy more promotions:")+"</dt>";for(var g=0;g<n.length;g++){j+="<dd>"+n[g].HelpfullTips+"</dd>";}j+="</dl></div>";j+="<a class='morep' method='moreTips' href=\"javascript:;\" rel='nofollow'>"+(this.Language=="CN"?"更多促销":"more")+"</a>";}var o=n[0].HelpfullTips;if(!String.isNullOrEmpty(j)){o=o.substr(0,(this.Language=="CN"?13:26))+"...";}else{o=o.substr(0,(this.Language=="CN"?19:38))+"...";}$("#promotionHtml").append('<span class="iconCuxiao"></span><a title=\''+n[0].HelpfullTips+"' href=\"javascript:;\" rel='nofollow'>"+o+"</a>"+j);}if(!b){this.divRoomList.after(this.buildRoomTaxAndServiceHtml());this.showSelectRoomDetailAndRatePlan(this.CurrentRoom);}if(Client!=null&&typeof(Client.imgLazyLoad)=="function"){Client.imgLazyLoad();}}if(l.value.BookStatus==1||l.value.BookStatus==2){if(l.value.BookStatus==1){this.divRoomList.hide();$("span[weifang]").hide();$("#divRoomLoading").hide();}if(l.value.BookStatus==1){$("#noRoom").html("<span class='icon'></span>抱歉，该Hotel在此期间无法预订，建议您Change date试试吧：）").show();}else{}e.StartLat=this.AjaxInfo.GoogleLat;e.StartLng=this.AjaxInfo.GoogleLng;HotelDetailNewController.GetRecommendHotel(e,a,function(q){if(q.success&&!Object.isNull(q.value)&&q.value.length>0){var i=$.tmpl("recommendRoomTemp",{hotels:q.value,controller:this});if(!String.isNullOrEmpty(i)){this.divRoomList.append(i).show();if(Client!=null&&typeof(Client.imgLazyLoad)=="function"){Client.imgLazyLoad();}}}}.bind(this));}}else{$("span[weifang]").hide();}if(Client!=null&&typeof(Client.imgLazyLoad)=="function"&&!b){FunctionExt.defer(function(){Client.LoadHistoryBrowseHotels();},200);if(HotelDetailNewController.CampaignId==""){FunctionExt.defer(function(){Client.GetBrowseData();},300);}FunctionExt.defer(function(){Client.GetSeenHotelRank();},800);}this.jsElapsedTime.end("GetHotelRoomset 客户端处理耗时：");}.bind(this),false,"POST");},showMoreRooms:function(a){var c=showRoomCount=currRPNum=0;if(a==null||a.HotelRoomList==null||a.HotelRoomList.length==0){return c;}for(var b=0;b<a.HotelRoomList.length;b++){if(a.HotelRoomList[b].RatePlanList!=null){currRPNum=a.HotelRoomList[b].RatePlanList.length;c+=currRPNum;if(showRoomCount<8){showRoomCount=showRoomCount+currRPNum;}}}if(c>100&&c>showRoomCount){if(this.Language!="EN"){this.divRoomList.append("<div id='rpOpen' method='moreRP' class=\"moerRP\"><a>展开更多"+(c-showRoomCount)+"个Price</a><apan></span></div>");}else{this.divRoomList.append("<div id='rpOpen' method='moreRP' class=\"moerRP\"><a>Show "+(c-showRoomCount)+" More</a><apan></span></div>");}}},buildRoomMessageHtml:function(a){$("#spanLatestOrder").hide();if(Object.isNull(a)){return"";}var b="";if(!String.isNullOrEmpty(a.LatestOrderMessage)){if(this.Language!="EN"){b=String.format('<i class="recent"></i>{0}有人预订了该Hotel',a.LatestOrderMessage);}else{b=String.format('<i class="recent"></i>Most recent booking for this hotel was {0}',a.LatestOrderMessage);}$("#spanLatestOrder").html(b);$("#spanLatestOrder").show();}},buildRoomHtml:function(a,l){var h=new StringBuilder();if(!Object.isNull(a.HotelRoomList)&&a.HotelRoomList.length>0){var c=this.isHaveRoomImage(a.HotelRoomList);var e=["(限量抢购)","(限时抢购)","（限时抢购）","（限量抢购）","(龙萃专享)","（龙萃专享）","（限量抢）","(限量抢)","（限时抢）","(限时抢)","龙萃专享","限量抢购","限时抢购","限量抢","限时抢"];for(var b=0;b<e.length;b++){for(var f=0;f<a.HotelRoomList.length;f++){a.HotelRoomList[f].RoomName=a.HotelRoomList[f].RoomName.replace(e[b],"");if(!Object.isNull(a.HotelRoomList[f].RatePlanList)){for(var g=0;g<a.HotelRoomList[f].RatePlanList.length;g++){a.HotelRoomList[f].RatePlanList[g].RatePlanName=a.HotelRoomList[f].RatePlanList[g].RatePlanName.replace(e[b],"");}}if(!Object.isNull(a.HotelRoomList[f].LongCuiRatePlanList)){for(var g=0;g<a.HotelRoomList[f].LongCuiRatePlanList.length;g++){a.HotelRoomList[f].LongCuiRatePlanList[g].RatePlanName=a.HotelRoomList[f].LongCuiRatePlanList[g].RatePlanName.replace(e[b],"");}}}}h.append($.tmpl("roomTemp",{Rooms:a.HotelRoomList,LongcuiRooms:(this.AjaxInfo.RequestInfo.MemberLevel=="Dragon"||this.AjaxInfo.RequestInfo.MemberLevel=="DragonForever")?a.HotelRoomList:null,hotelId:this.AjaxInfo.HotelId,hasRoomImg:c,controller:this,cityNameEn:HotelDetailNewController.AjaxPropertys.CityNameEn,showPriceImage:l}));}else{h.append(String.format(this.NoRoomHtml,this.AjaxInfo.WebTel));}return h.toString();},isHaveRoomImage:function(e){var a=false;for(var b=0;e!=null&&e.length>0&&b<e.length;b++){var c=e[b];if(!Object.isNull(c.RoomImageList)&&c.RoomImageList.length>0){a=true;break;}}return a;},buildRoomImagesHtml:function(b){var g=new StringBuilder();if(!Object.isNull(b.RoomImageList)&&b.RoomImageList.length>0){var c=0;for(var e=0;e<b.RoomImageList.length;e++){var f=b.RoomImageList[e];if(f.SpecificationId==3){c++;if(c>6){break;}var j=f.ImageUrl;var a=this.getBigImage(f,b.RoomImageList);var h=f.IsPanorama?String.format("<li class='img360'><span class='icon' bigImageUrl='{1}' isPanorama='{2}' method='ShowImage'></span><span class='imgTxt' bigImageUrl='{1}' isPanorama='{2}' method='ShowImage'>360度全景图</span><img src2='{0}' width='90' height='90' bigImageUrl='{1}' isPanorama='{2}' alt='{3}'  method='ShowImage'/></li>",j,a,(f.IsPanorama?"true":"false"),(this.Language=="CN"?f.ImageNameCn:f.ImageNameEn)):String.format("<li><img src2='{0}' onerror=\"this.src='http://www.elongstatic.com/hotels/pic/no_pics_CN.gif'\" width='90' height='90' bigImageUrl='{1}' isPanorama='{2}' alt='{3}' method='ShowImage'/></li>",j,a,(f.IsPanorama?"true":"false"),(this.Language=="CN"?f.ImageNameCn:f.ImageNameEn));g.append(h);}}}return g.toString();},getFirstRoomImage:function(b){var f=new StringBuilder();if(!Object.isNull(b.RoomImageList)&&b.RoomImageList.length>0){for(var c=0;c<b.RoomImageList.length;c++){var e=b.RoomImageList[c];if(e.SpecificationId==2){var h=e.ImageUrl;var a=this.getBigImage(e,b.RoomImageList);var g=String.format("<img src2='{0}' onerror=\"this.src='http://www.elongstatic.com/hotels/pic/no_pics_CN.gif'\" width='70' height='50' bigImageUrl='{1}' isPanorama='{2}' alt='{3}' method='RoomDetail'/>",h,a,(e.IsPanorama?"true":"false"),(this.Language=="CN"?e.ImageNameCn:e.ImageNameEn));f.append(g);break;}}}if(String.isNullOrEmpty(f.toString())){f.append(String.format("<img src2='http://www.elongstatic.com/hotels/pic/room_no.png' onerror=\"this.src='http://www.elongstatic.com/hotels/pic/no_pics_CN.gif'\" width='70' height='50' alt='{0}' method='RoomDetail'/>",b.RoomName));}return f.toString();},buildRoomTaxAndServiceHtml:function(){$("#divRoomTaxAndServiceTip").remove();if(this.Language=="EN"&&this.AjaxInfo.RequestInfo.CityId!="1401"&&this.AjaxInfo.RequestInfo.CityId!="2201"){return'<div id="divRoomTaxAndServiceTip" class="pb5 tr"><span class="orange">Prices here are inclusive of room tax and service fees.</span></div>';}return"";},buildTopRightPrice:function(j,e){var n=$("#divHotelPrice");var f=$("#imgPopupPrice");var m=$("#tabPrice");n.empty();f.empty();m.empty();$("#tabButton").hide();$("span[weifang]").unbind("mouseover");n.html("");if(Object.isNull(j)||j.LowestPrice<=0){return;}var g=this.getLowestPriceInfo(j.LowestPriceRoomid,j.LowestRPId);if(!Object.isNull(g)){var l=g.Room;var k=g.RatePlan;if(k.SupplierRemainRoomNum>0&&k.Status==0){$("#tabButton").attr("roomid",l.RoomId).attr("sroomid",k.SRoomTypeId).attr("rpid",k.RatePlanId).attr("shotelid",k.ShotelId).attr("productType",k.ProductType).show();}if(k.ProductType==64){var c=String.format("http://hotel.elong.com/GroupTempDetail.html?shotelId={0}&roomId={1}&rpId={2}&cityNameEn={3}",k.ShotelId,l.RoomId,k.RatePlanId,HotelDetailNewController.AjaxPropertys.CityNameEn);this.tabButton.unbind("click");$("#orderDes").attr("target","_blank").attr("href",c);$("#orderDes").text("去 Group Purchase");}}var o="";if(e){o="<span weifang='true' class=\"iconLastMinute\"></span>";}var h="",i="";if(this.Language=="CN"&&!String.isNullOrEmpty(j.PromotionAmount)){if(j.PromotionType==1||j.PromotionType==6){h='<span class="iconFan" method="coupon">'+j.PromotionAmount+"元</span><span class='none'>"+j.PromotionDesc+"</span>";i='<li><span class="iconFan" method="coupon" >'+j.PromotionAmount+"元</span><span class='none'>"+j.PromotionDesc+"</span></li>";}}var b=String.format('<li class="high"><span class="price"><span class="fh">{0}</span>{1}<span class="fb">起</span></span></li>',j.MoneySymbol,j.LowestPrice);var a=String.format('<span class="price"><span class="fh">{0}</span>{1}<span class="fb">起</span></span>',j.MoneySymbol,j.LowestPrice);n.append(h+a+o+'<a method="GoLowestPriceRoom" href="#room"><span class="btn">Book Now</span></a>');f.append('<a method="GoLowestPriceRoom" href="#room"><span class="btn">Book Now</span></a>'+b+i);m.append(String.format('<dfn>{0}</dfn>{1}<span class="f12">起</span>',j.MoneySymbol,j.LowestPrice));$("a[method='GoLowestPriceRoom']").attr("lowRoomid",j.LowestPriceRoomid).attr("lowRPid",j.LowestRPId);$("span[weifang]").bind("mouseover",this.onNameBoxMouseOver.bindAsEventListener(this));},OnClickTabButton:function(evt){var element=Event.element(evt);var roomId=element.parent().attr("sroomid");var rpid=element.parent().attr("rpid");var roomListElement=$("#divRoomList").find("li[sroomid="+roomId+"][rpid="+rpid+"]:last");var hotelId=(roomListElement.attr("isshadow")=="false")?this.AjaxInfo.HotelId:this.AjaxInfo.ShadowHotelId;var isPrePay=roomListElement.attr("isPrePay")=="1"?true:false;if(this.DetailQuickOrder==1&&this.Language=="CN"&&HotelDetailNewController.WebCategory=="Elong"&&!isPrePay&&HotelDetailNewController.AjaxPropertys.PageType=="hotel"){var fastbookingDiv=$("#fastbooking");if(fastbookingDiv.length>0){fastbookingDiv.remove();}var isHaveImg=$("#divRoomList").find("li[sroomid="+roomId+"]:first").find("p.rw1").length>0?true:false;var htmlString='<div class="fillorder'+(isHaveImg?"":" fillorder_wide")+'" id="fastbooking"><span class="arrow"></span><div id="loading" class="poploading"><span></span><br><br>正在努力为您加载</div><iframe name="fbWindow" id="fbWindow" src="about:blank" width="'+(isHaveImg?656:734)+'" height="450" frameborder="0" scrolling="no"></iframe></div>';var iframeSrc=this.HotelDetailFastBooking.eval({hotelid:hotelId,roomtypeid:roomId,rateplanid:rpid});iframeSrc+=(iframeSrc.indexOf("?")==-1?"?":"&")+"fb=fastbooking";roomListElement.append(htmlString);$("#fbWindow").attr("src",iframeSrc);$("html, body").animate({scrollTop:roomListElement.offset().top-100},100);}else{this.fillOrder(this.AjaxInfo.HotelId,roomId,rpid);}evt.preventDefault();},buildRecommendHotelHtml:function(a){if(Object.isNull(a)||a.length==0){return"";}var b=$.tmpl("recommendRoomTemp",{hotels:a,controller:this});},onDetailRegionClick:function(evt){var evtElement=Event.element(evt);var method=evtElement.attr("method");if(String.isNullOrEmpty(method)){method=evtElement.parents("[method]").attr("method");evtElement=evtElement.parents("[method]");}switch(method){case"RoomDetail":var table=evtElement.parents("div")[0];var divRoomItem=$(table).find("div[roomid][mark='d']");divRoomItem.hasClass("none")?divRoomItem.removeClass("none"):divRoomItem.addClass("none");evt.preventDefault();break;case"RoomDetailClos":var divRoomItem=evtElement.parent("div");divRoomItem.hasClass("none")?divRoomItem.removeClass("none"):divRoomItem.addClass("none");evt.preventDefault();break;case"moreRP":this.divRoomList.find("li[isshow='0']").show();$("#rpOpen").hide();break;case"HideRoomDetail":var divRoomItem=evtElement.parents("div[roomid][mark='d']");divRoomItem.addClass("none");evt.preventDefault();break;case"GoLowestPriceRoom":if(HotelDetailNewController.AjaxPropertys.PageType=="photo"){window.location.href="http://hotel.elong.com/"+this.AjaxInfo.CityNameEn+"/"+this.AjaxInfo.HotelId+"#room";}else{this.showSelectRoomDetailAndRatePlan(evtElement.attr("lowRoomid")+"_"+evtElement.attr("lowRPid"));this.roomTypes.show();this.roomType.addClass("action");this.commentDiv.show();this.comment.removeClass();this.commentDiv.find("h2").show();}break;case"Order":var divRoomItem=$(evtElement.parents("div[rpid][sroomid]")[0]);if(evtElement.hasClass("nobut")){break;}var hotelId=(divRoomItem.attr("isshadow")=="false")?this.AjaxInfo.HotelId:this.AjaxInfo.ShadowHotelId;var roomId=divRoomItem.attr("sroomid");var rpid=divRoomItem.attr("rpid");var isPrePay=divRoomItem.attr("isPrePay")=="1"?true:false;if(this.DetailQuickOrder==1&&this.Language=="CN"&&HotelDetailNewController.WebCategory=="Elong"&&!isPrePay){var fastbookingDiv=$("#fastbooking");if(fastbookingDiv.length>0){fastbookingDiv.remove();}var isHaveImg=$("#divRoomList").find("li[sroomid="+roomId+"]:first").find("p.rw1").length>0?true:false;var htmlString='<div class="fillorder'+(isHaveImg?"":" fillorder_wide")+'" id="fastbooking"><span class="arrow"></span><div id="loading" class="poploading"><span></span><br><br>正在努力为您加载</div><iframe name="fbWindow" id="fbWindow" src="about:blank" width="'+(isHaveImg?656:734)+'" height="200" frameborder="0" scrolling="no"></iframe></div>';this.createOverLayer();var iframeSrc=this.HotelDetailFastBooking.eval({hotelid:hotelId,roomtypeid:roomId,rateplanid:rpid});iframeSrc+=(iframeSrc.indexOf("?")==-1?"?":"&")+"fb=fastbooking";evtElement.parent().after(htmlString);$("#fbWindow").attr("src",iframeSrc);$("html, body").animate({scrollTop:evtElement.offset().top-100},100);}else{this.fillOrder(hotelId,roomId,rpid);evt.preventDefault();var triggerClient=new TriggerClient();triggerClient.HotelDetailTrigger(hotelId,1,roomId,rpid,this.AjaxInfo.RequestInfo.CardNo,this.AjaxInfo.RequestInfo.CheckInDate,this.AjaxInfo.RequestInfo.CheckOutDate,this.AjaxInfo.RequestInfo.OrderFromId,this.AjaxInfo.RequestInfo.RankType);}break;case"checkInDateApply":this.onCheckInDateClick(evt);break;case"checkOutDateApply":this.onCheckOutDateClick(evt);break;case"modify":this.onModifyClick(evt);break;case"submit":this.onSubmit(evt);break;}},createOverLayer:function(){var a=$("#privateLayer");if(a.length==0){$("body").append("<div id='privateLayer'><div></div></div>");}new OverLay($("#privateLayer"),{});a.hide();},onDetailRegionMouseOver:function(f){var g=Event.element(f);var k=g.attr("method");if(String.isNullOrEmpty(k)){k=g.parents("[method]").attr("method");}switch(k){case"AvgPrice":this.showAvgPriceTable(g);f.preventDefault();break;case"cashback":case"coupon":case"reduce":case"cancel":case"promotion":this.showIconTips(g);f.preventDefault();break;case"danbao":this.openTipDialog(g,this.DanbaoHtml,360);f.preventDefault();break;case"ShowImage":var h=g.attr("bigImageUrl");var i=g.attr("isPanorama")=="true";this.playRoomImage(h,i,g);f.preventDefault();break;case"HotelAcitvity":this.openTipDialog(g,$("#hotelAcitvity").html(),400);f.preventDefault();break;case"Promotion":if(!Object.isNull(this.PromotionSummaryInfo)&&!String.isNullOrEmpty(this.PromotionSummaryInfo.PromotionDesc)){this.openTipDialog(g,this.PromotionSummaryInfo.PromotionDesc,400,"leftTop");}f.preventDefault();break;case"moreTips":this.openTipDialog(g,g.prev().html(),400);f.preventDefault();break;case"tejia":var c=this.Language.toLowerCase()=="cn"?"该Room type“今日特价”，预订即可享受超低价！":'"Last Minute Deal" is a great deal applicable for this room. Please get details through the room type and rate section.';this.openTipDialog(g,c,270);f.preventDefault();break;case"gift":var e=g.parents("div[rpid][roomid]");var j=e.attr("isshadow")=="true";var l=e.attr("roomid");var m=e.attr("rpid");var n=e.attr("sroomid");var b=this.getRatePlan(j,l,n,m);if(!String.isNullOrEmpty(b.SupplierActivityList)){var a="<dl class='morePromotion'><dt>"+(this.Language!="EN"?"Hotel礼物信息：":"Enjoy a gift if you book through elong!")+"</dt><dd>"+b.SupplierActivityList+"</dd></dl>";this.openTipDialog(g,a,400);}f.preventDefault();break;}},getQueryString:function(a){var c=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i");var e=window.location.href;var b=window.location.search.substr(1).match(c);if(b!=null){return b[2];}return null;},BuildRandomKey:function(){var a=(new Date()).getTime().toString()+Math.round((Math.random()*(99999-10000)+10000));return a;},fillOrder:function(hotelId,roomId,rateId){var url=this.OrderUrlTemplate.eval({language:this.Language.toLowerCase(),hotelid:hotelId,roomtypeid:roomId,rateplanid:rateId});if(url.indexOf("?")>-1){url+="&OrderCacheKey="+this.BuildRandomKey();}else{url+="?OrderCacheKey="+this.BuildRandomKey();}if(this.getQueryString("elqfr")!=null){url+="&elqfr="+this.getQueryString("elqfr");}Globals.cookie("Elong.Hotel.Channel.HotelCookie","",{From:"HotelDetails"});if(Globals.cookie("ssoPop")=="1"&&this.AjaxInfo.NeedLogin){var nexturl=escape(url)+escape(url.indexOf("?")>0?"&tenpay=1":"?tenpay=1");var qqrul=String.format("http://my.elong.com/ssologin_cn.html?page=wallet&Key={0}&name=&nexturl={1}",Globals.cookie("BDkey"),nexturl);var contentHtml='<iframe id="iframeQQ" frameborder="0"  src="'+qqrul+'" width="510px" height="420px"></iframe>';var wind=new Dialog({title:"Activate提示",htmlContent:contentHtml,width:540,initEvent:function(windowElement){}.bind(this)});wind.show();return;}if((Globals.cookie("SsoPopup")=="1"||HotelDetailNewController.IsNeedOpenAPIBind)&&this.AjaxInfo.NeedLogin){var nexturl=HotelDetailNewController.CurrentPageUrl;var qqurl=String.format("http://openapi.elong.com/bindmember.html?NextUrl={0}",nexturl);var contentHtml='<iframe id="iframeQQ" frameborder="0"  src="'+qqurl+'" width="560px" height="420px"></iframe>';var wind=new Dialog({title:"Activate提示",htmlContent:contentHtml,width:585,initEvent:function(windowElement){}.bind(this)});wind.show();return;}var orderUrl=url+(String.isNullOrEmpty(this.AjaxInfo.OrderId)?"":(url.indexOf("?")!=-1?"&":"?")+"uocachekey="+this.AjaxInfo.OrderId);this.linkToUrl(orderUrl);},linkToUrl:function(b){if($.browser.msie){var a=document.createElement("a");a.href=b;document.body.appendChild(a);a.click();}else{window.location=b;}},showAvgPriceTable:function(evtElement){var divRoomItem=evtElement.parents("div[roomid]");var isShadow=divRoomItem.attr("isshadow")=="true";var roomId=divRoomItem.attr("roomid");var rpId=divRoomItem.attr("rpid");var sroomid=divRoomItem.attr("sroomid");var curRatePlan=this.getRatePlan(isShadow,roomId,sroomid,rpId);var dayPrice=curRatePlan.DayPriceList;var sbTitle=new StringBuilder();var sbList=new StringBuilder();for(var i=0;i<dayPrice.length;i++){if(i<7){sbTitle.append(String.format("<th>{0}</th>",dayPrice[i].Week));}if(i%7==0){sbList.append(String.format("<tr><td nowrap='' class='blk'>"+this.Resources.Js_Week+"</td>",1+i/7));}var money="#&yen;";var spriceStr=dayPrice[i].SPrice.length>0?String.format("<p><del class='l_black'>{0}</del></p>",dayPrice[i].SPrice):"";sbList.append(String.format("<td>{2}{0}<div class='blk'>{1}</div></td>",dayPrice[i].Price,this.Language=="CN"?dayPrice[i].BreakFast:"",spriceStr));if(i%7==6||i==dayPrice.length-1){sbList.append("</tr>");}}var col=dayPrice.length>=7?7:dayPrice.length;var tips=dayPrice.length>1?this.DayPriceTemplate.eval({Title:sbTitle.toString(),List:sbList.toString()}):"";tips=tips+this.ruleTemplate.eval({hr:dayPrice.length>1?"<hr/>":"",Rule:curRatePlan.RuleDesc});var width="auto";this.openTipDialog(evtElement,tips,width);},showIconTips:function(f){var e=f.parents("div[rpid][roomid]");var h=e.attr("isshadow")=="true";var k=e.attr("roomid");var l=e.attr("rpid");var m=e.attr("sroomid");var b=this.getRatePlan(h,k,m,l);var c=400;var g="";var j=b.PromotionDesc;if(!String.isNullOrEmpty(j)){j='<div class="sf_voucher"><span class="icon_sale_text mt5" style="cursor:auto; vertical-align:top"></span><span class="sw330">'+j+"</span></div>";}var i=f.attr("method");switch(i){case"cashback":g=b.CashBackDesc;g+=j;break;case"coupon":g=b.CouponDesc;g+=j;break;case"reduce":g=b.ReducePromotionDesc;g+=j;break;case"promotion":g=j;break;case"cancel":c=240;var a=f.attr("cancelType");if(a=="0"){g=this.CannelHtml;}else{if(a=="1"){if(b.IsPrepay){g="<p class=\"popBoxtitle mb5\"><span class='icon02'></span>限时取消</p><p>"+b.PrepayCancelRule+"</p>";}else{g="<p class=\"popBoxtitle mb5\"><span class='icon02'></span>限时取消</p><p>"+b.VouchCancelRule+"</p>";}}else{if(a=="2"){if(b.IsPrepay){g="<p class=\"popBoxtitle mb5\"><span class='icon03 gray'></span>不可取消</p><p>"+b.PrepayCancelRule+"</p>";}else{g="<p class=\"popBoxtitle mb5\"><span class='icon03 gray'></span>不可取消</p><p>"+b.VouchCancelRule+"</p>";}}}}break;}this.openTipDialog(f,g,c);},playRoomImage:function(c,e,a){var b="";var f=null;if(e){b=String.format("<embed height='300px' width='450px' base='.' menu='false' flashvars='fileName={0}?{1}' wmode='transparent' allowscriptaccess='sameDomain' quality='High' bgcolor='#FFFFFF' name='VT360' id='VT360' pluginspage='http://www.macromedia.com/go/getflashplayer' src='http://resource.elong.com/cn/hotels/images/vtourlite.swf?{1}' type='application/x-shockwave-flash'/>",c,Math.random());f={htmlContent:b,eventElement:a,defer:true,width:470,height:345};}else{b=String.format("<img src='{0}' border='0' />",c);f={htmlContent:b,eventElement:a,defer:true};}if(!String.isNullOrEmpty(b)){if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow(f);}},openTipDialog:function(a,c,e,b){if(!Object.isNull(this.tipWindow)){this.tipWindow.close();}if(e!="auto"){this.tipWindow=new TipWindow({htmlContent:c,eventElement:a,defer:true,width:e,floatType:b});}else{this.tipWindow=new TipWindow({htmlContent:c,eventElement:a,defer:true,floatType:b});}},getRoom:function(b,c){if(Object.isNull(this.HotelRoomList)||this.HotelRoomList.length==0){return null;}for(var a=0;a<this.HotelRoomList.length;a++){if(this.HotelRoomList[a].RoomId==c&&this.HotelRoomList[a].IsShadow==b){return this.HotelRoomList[a];}}return null;},getRatePlan:function(a,e,g,f){var c=this.getRoom(a,e);if(Object.isNull(c)){return;}if(!Object.isNull(c.RatePlanList)&&c.RatePlanList.length>0){for(var b=0;b<c.RatePlanList.length;b++){if(c.RatePlanList[b].RatePlanId==f&&c.RatePlanList[b].SRoomTypeId==g){return c.RatePlanList[b];}}}if(!Object.isNull(c.LongCuiRatePlanList)&&c.LongCuiRatePlanList.length>0){for(var b=0;b<c.LongCuiRatePlanList.length;b++){if(c.LongCuiRatePlanList[b].RatePlanId==f&&c.LongCuiRatePlanList[b].SRoomTypeId==g){return c.LongCuiRatePlanList[b];}}}return null;},hasLongCuiRatePlan:function(a){if(Object.isNull(a)||Object.isNull(a.HotelRoomList)||a.HotelRoomList.length==0){return false;}for(var b=0;b<a.HotelRoomList.length;b++){var c=a.HotelRoomList[b];if(!Object.isNull(c.LongCuiRatePlanList)&&c.LongCuiRatePlanList.length>0){return true;}}return false;},hasRatePlan:function(a){if(Object.isNull(a)||Object.isNull(a.HotelRoomList)||a.HotelRoomList.length==0){return false;}for(var b=0;b<a.HotelRoomList.length;b++){var c=a.HotelRoomList[b];if(!Object.isNull(c.RatePlanList)&&c.RatePlanList.length>0){return true;}}return false;},getLowestPriceInfo:function(c,e){var f=null;var h=null;if(Object.isNull(this.HotelRoomList)){return null;}for(var a=0;a<this.HotelRoomList.length;a++){var g=this.HotelRoomList[a];if(!Object.isNull(g.RatePlanList)&&g.RatePlanList.length>0&&g.RoomId==c){for(var b=0;b<g.RatePlanList.length;b++){if(g.RatePlanList[b].RatePlanId==e){f=g.RatePlanList[b];h=g;break;}}}if(!Object.isNull(g.LongCuiRatePlanList)&&g.LongCuiRatePlanList.length>0&&g.RoomId==c){for(var b=0;b<g.LongCuiRatePlanList.length;b++){if(g.LongCuiRatePlanList[b].RatePlanId==e){f=g.LongCuiRatePlanList[b];h=g;break;}}}}if(f!=null){return{Room:h,RatePlan:f};}else{return null;}},hasHighspeed:function(b){if(Object.isNull(b)||b.length==0){return false;}for(var a=0;a<b.length;a++){if(b[a].IsHighspeed){return true;}}return false;},showInternetIcon:function(){this.NetIcon=$("#NetIcon");this.NetIcon.show();},onModifyClick:function(b){var a=Event.element(b);a.attr("method","submit");a.val("Confirm Change");this.inDateBlur($("#checkInDateApply"));},inDateBlur:function(a){a.addClass("action");$("#checkOutDateApply").addClass("action");var c=String.isNullOrEmpty(a.val())?this.serverTime:this.getDate(a.val());var b=validator.reFormatDateString(this.serverTime);if(this.CalendarShowYesterday==true){var e=validator.convertDate(this.serverTime);e.setDate(e.getDate()-1);b=validator.reFormatDateString(e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate());}new CalendarWindow({eventElement:a,enabledFrom:b,selectedDate:c,language:this.Language,onSelected:function(f){a.val(f);var h=validator.reFormatDateString(f);var g=validator.reFormatDateString(this.getDate($("#checkOutDateApply").val()));if(h>=g){var i=validator.convertDate(f);i=new Date(i.setHours(24));if(this.Language=="CN"){i=validator.reFormatDateString(i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate());}else{i=validator.reFormatDateStringEn(i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate());}$("#checkOutDateApply").val(i);}}.bind(this)});},onCheckInDateClick:function(b){var a=Event.element(b);$("#Revise").attr("method","submit").val("Confirm Change");this.inDateBlur(a);},onCheckOutDateClick:function(c){var b=Event.element(c);$("#Revise").attr("method","submit").val("Confirm Change");b.addClass("action");$("#checkInDateApply").addClass("action");var a=validator.convertDate(this.getDate($("#checkInDateApply").val()));a=new Date(a.setHours(24));a=validator.reFormatDateString(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate());new CalendarWindow({eventElement:b,selectedDate:this.getDate(b.val()),language:this.Language,enabledFrom:validator.reFormatDateString(a),onSelected:function(e){var f=this.getDate($("#checkInDateApply").val());b.val(e);}.bind(this)});},onSubmit:function(b){var a=this.checkDate();if(!a){return;}this.AjaxInfo.RequestInfo.CheckInDate=a.InDate;this.AjaxInfo.RequestInfo.CheckOutDate=a.OutDate;this.divRoomList.empty();$("#promotionHtml").empty();$("#divRoomLoading").show();this.getHotelRoomSet(this.AjaxInfo.HotelId,this.AjaxInfo.ShadowHotelId,this.AjaxInfo.RequestInfo,true,false);},checkDate:function(){var e=$("#checkInDateApply");var g=$("#checkOutDateApply");var b=this.getDate(e.val());var f=this.getDate(g.val());var k=this.Language=="CN"?"notEmpty & date":"notEmpty & dateEn";if(!validator.valid(b,k)){$error(e,this.Resources.script_CheckInDate_error,"left");return false;}if(!validator.valid(f,k)){$error(g,this.Resources.script_CheckOutDate_error,"left");return false;}var m=validator.reFormatDateString(this.serverTime);var l=validator.reFormatDateString(b);var j=validator.reFormatDateString(f);if(l<m&&this.CalendarShowYesterday==false){$error(e,this.Resources.script_CheckInDate_validator,"right");return false;}if(j<m){$error(g,this.Resources.script_CheckOutDate_validator,"left");return false;}if(j<l){$error(e,this.Resources.script_CheckOutDate_validator2,"right");return false;}var i=validator.convertDate(l);i=new Date(i.setHours(24));if(!validator.valid(f,"notEmpty & dateRange",validator.getDateString(i),null)){$error(g,this.Resources.script_CheckOutDate_validator2,"left");return false;}var a=this.daysBetween(l,validator.reFormatDateString(this.serverTime));if(a>this.AjaxInfo.AfterDays){$error(e,this.Resources.script_if_head+l+String.format(this.Resources.script_if_end,this.AjaxInfo.WebTel),"right");return false;}var c=this.daysBetween(l,j);if(c>this.AjaxInfo.InDays){$error(g,this.Resources.script_need_head+this.AjaxInfo.InDays+String.format(this.Resources.script_need_end,this.AjaxInfo.WebTel),"right");return false;}var h={CityId:this.AjaxInfo.CityId,CityNameCn:this.AjaxInfo.CityNameCn,CityNameEn:this.AjaxInfo.CityNameEn};this.saveSearchCookie(h,b,f);return{InDate:b,OutDate:f};},getBigImage:function(c,b){if(Object.isNull(b)||Object.isNull(c)){return"";}for(var a=0;a<b.length;a++){if(b[a].ImageId==c.ImageId&&b[a].SpecificationId==1){return b[a].ImageUrl;}}return"";},saveSearchCookie:function(c,a,b){if(!Object.isNull(c)){Globals.cookie("ShHotel","",{InDate:validator.reFormatDateString(a),OutDate:validator.reFormatDateString(b),CityNameCN:c.CityNameCn,CityNameEN:c.CityNameEn,CityID:c.CityId},{expires:11,path:"/",secure:false});}else{Globals.cookie("ShHotel","",{InDate:validator.reFormatDateString(a),OutDate:validator.reFormatDateString(b),CityNameCN:Globals.cookie("ShHotel","CityNameCN"),CityNameEN:Globals.cookie("ShHotel","CityNameEN"),CityID:Globals.cookie("ShHotel","CityID")},{expires:11,path:"/",secure:false});}},trim:function(b,a){if(String.isNullOrEmpty(b)){return"";}return b.length<=a?b:(b.substring(0,a)+"...");},getDate:function(a){return a.split(" ")[0];},formatDateString:function(f,c){var f=f.replace(/-/g,"/");var a=new Date(f);var g=a.getFullYear();var e=a.getMonth()+1;var b=a.getDate();return c?String.format("{0}年{1}月{2}日",g,e,b):String.format("{0}/{1}/{2}",e,b,g);},formatDate:function(f,c){var f=f.replace(/-/g,"/");var a=new Date(f);var g=a.getFullYear();var e=a.getMonth()+1;var b=a.getDate();return c?String.format("{0}-{1}-{2}",g,(e<10?"0":"")+e,(b<10?"0":"")+b):String.format("{0}/{1}/{2}",(e<10?"0":"")+e,(b<10?"0":"")+b,g);},daysBetween:function(b,c){var f=b.substring(5,b.lastIndexOf("-"));var e=b.substring(b.length,b.lastIndexOf("-")+1);var g=b.substring(0,b.indexOf("-"));var i=c.substring(5,c.lastIndexOf("-"));var h=c.substring(c.length,c.lastIndexOf("-")+1);var j=c.substring(0,c.indexOf("-"));var a=((Date.parse(f+"/"+e+"/"+g)-Date.parse(i+"/"+h+"/"+j))/86400000);return Math.abs(a);},getWeek:function(c,a,b){var e=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday");var f=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday");var g=new Array("Sun.","Mon.","Tus.","Wed.","Thur.","Fri.","Sat.");d=new Date(c.replace(/-/g,"/"));day=d.getDay();if(!b){return(a?e[day]:f[day]);}else{return(a?e[day]:g[day]);}}});var HotelDetailReviewsControllerClient=Elong.Page.HotelDetailReviewsControllerClient;HotelDetailReviewsControllerClient=Class.create();Object.extend(HotelDetailReviewsControllerClient.prototype,{name:"HotelDetailReviewsControllerClient",initialize:function(){this.initializeServerData();this.initializeClientData();this.initializeDOM();this.initializeEvent();this.render();},initializeServerData:function(){this.hotelId=HotelDetailNewController.AjaxPropertys.HotelId;this.language=HotelDetailNewController.Language.toLowerCase();this.CampaignId=HotelDetailNewController.CampaignId;this.CardNo=HotelDetailNewController.CardNo;this.pageUrl=HotelDetailNewController.pageUrl;},initializeClientData:function(){this.daodaoTemp=new Template("<dl><dt class='bold'><span class='tripadvisor T#{UserLevel}'></span>#{Title}</dt><dd>#{CreateTime} #{MemberName}</dd><dd>#{Content}</dd></dl>");this.taTemp=new Template("<dl><dt class='l_black'>Post on #{CreateTime}</dt><dd><span class='mr15'><span class='tripadvisor T#{UserLevel}'></span>#{UserRating}</span><b>#{Title}</b></dd><dd class='matb'>#{Content}</dd></dl><hr>");this.pageTemp=new Template("<span><a class='#{prevCss}' title='Previous' href='#' mth='#{prevCss}'><span mth='#{prevCss}'></span></a>#{Link}<a class='#{nextCss}' title='Next' href='#' mth='#{nextCss}'>#{nextText}<span mth='#{nextCss}'></span></a></span>");this.keyWordsTemp=new Template('<ul class="clx"><li class="title">Key words筛选：</li><li class="wrap"><span class="btn btn_on" typeId="-1">No limits</span>#{typeData}</li></ul>');},initializeDOM:function(){this.commentType=2;this.pageIndex=1;this.isClickKeyWordsDiv=false;this.keyWordsCommentCount=0;this.startDomTag=encodeURIComponent('<span class="highlight">');this.endDomTag=encodeURIComponent("</span>");this.isClickPager=false;this.tab=$("#tab");this.loading=$("#loading");this.list=$("#list");this.ulTemp=$("#ulTemp");this.daodao=$("#daodao");this.pager=$("#pagerDown");this.puserLevel=$("#puserLevel");this.btnAddComment=$("#btnAddComment");this.moreSP=$("#moreSP");this.reserveSP=$("#reserveSP");this.rankingsSpan=$("#rankingsSpanId");this.rankSortP=$("#rankSortP");this.divDianpingCoupon=$("#divDianpingCoupon");this.keywordsDiv=$("#keywordsDiv");this.commentDiv=$("#commentDiv");},destroyDOM:function(){this.hotelId=null;this.language=null;this.CampaignId=null;this.daodaoTemp=null;this.taTemp=null;this.pageTemp=null;this.pageUpTemp=null;this.commentType=null;this.pageIndex=null;this.tab=null;this.loading=null;this.list=null;this.ulTemp=null;this.daodao=null;this.pager=null;this.puserLevel=null;this.btnAddComment=null;this.moreSP=null;this.reserveSP=null;this.rankingsSpan=null;this.keywordsDiv=null;this.commentDiv=null;},initializeEvent:function(){this.tab.bind("click",this.ClickTab.bindAsEventListener(this));this.list.bind("click",this.ClickListArea.bindAsEventListener(this));this.pager.bind("click",this.ClickPager.bindAsEventListener(this));this.puserLevel.bind("mouseover",this.OnMouseoverpuserLevel.bindAsEventListener(this));this.btnAddComment.bind("click",this.OnClickbtnAddComment.bindAsEventListener(this));this.divDianpingCoupon.bind("click",this.onDianpingCouponClick.bindAsEventListener(this));this.keywordsDiv.bind("click",this.onKeyWordsDivClick.bindAsEventListener(this));this.commentDiv.bind("click",this.onCommentDivClick.bindAsEventListener(this));$(window).bind("unload",this.dispose.bindAsEventListener(this));},destroyEvent:function(){this.tab.unbind("click");this.list.unbind("click");this.pager.unbind("click");this.btnAddComment.unbind("click");this.puserLevel.unbind("mouseover");this.divDianpingCoupon.unbind("click");this.keywordsDiv.unbind("click");this.commentDiv.unbind("click");},dispose:function(){this.destroyEvent();this.destroyDOM();},onCommentDivClick:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"noComment":this.OnClickbtnAddComment();break;case"goDaoDao":window.open("http://www.daodao.com");break;}},onKeyWordsDivClick:function(c){c.preventDefault();var b=Event.element(c);if(!b.is("span")){return;}this.loading.attr("style","display:block");this.list.empty();this.ChangeKeyWordsCss(b);var a=b.attr("typeId");this.pageIndex=1;if(a!="-1"){this.isClickKeyWordsDiv=true;var e=b.html();this.keyWordsCommentCount=e.substring(e.indexOf("(")+1,e.indexOf(")"));this.isClickPager=true;}if(a==-1){HotelDetailNewController.GetHotelReviews(this.hotelId,this.pageIndex,10,this.commentType,this.GetHotelReviewsCallBack.bind(this),true,"GET");}else{HotelDetailNewController.GetCommentSummary(this.hotelId,this.pageIndex,10,a,this.commentType,this.startDomTag,this.endDomTag,this.GetHotelReviewsCallBack.bind(this),true,"GET");}},onDianpingCouponClick:function(b){var a=Event.element(b);if(a.attr("method")=="close"){Globals.cookie("She","",{CloseCouponIcon:"1"},{expires:30,path:"/",secure:false});this.divDianpingCoupon.hide();}},loadCommentData:function(){HotelDetailNewController.GetHotelReviews(this.hotelId,1,10,2,this.GetHotelReviewsCallBack.bind(this),true,"GET");},ClickTab:function(b){b.preventDefault();var a=Event.element(b);var c=a.attr("mth");this.isClickPager=false;if(String.isNullOrEmpty(c)){a=a.parent();c=a.attr("mth");}switch(c){case"all":this.loading.attr("style","display:block");this.list.empty();this.ChangeTabCss("all");this.commentType=2;this.pageIndex=1;HotelDetailNewController.GetHotelReviews(this.hotelId,1,10,2,this.GetHotelReviewsCallBack.bind(this),true,"GET");break;case"daodao":this.loading.attr("style","display:block");this.list.empty();this.keywordsDiv.hide();this.ChangeTabCss("daodao");this.commentType=-2;this.pageIndex=1;this.pager.empty();HotelDetailNewController.GetHotelTAReviews(this.hotelId,this.GetDaodaoReviewsCallBack.bind(this));break;case"good":this.loading.attr("style","display:block");this.list.empty();this.ChangeTabCss("good");this.commentType=1;this.pageIndex=1;HotelDetailNewController.GetHotelReviews(this.hotelId,1,10,1,this.GetHotelReviewsCallBack.bind(this),true,"GET");break;case"bad":this.loading.attr("style","display:block");this.list.empty();this.ChangeTabCss("bad");this.commentType=-1;this.pageIndex=1;HotelDetailNewController.GetHotelReviews(this.hotelId,1,10,-1,this.GetHotelReviewsCallBack.bind(this));break;default:break;}},ChangeKeyWordsData:function(data){var tempStr="";for(var i=0;i<data.length;i++){tempStr+=String.format('<span class="btn" typeid="{0}">{1}({2})</span>\n',data[i].TypeId,data[i].TypeName,data[i].CommentNum);}var html=this.keyWordsTemp.eval({typeData:tempStr});this.keywordsDiv.html(html);},ClickListArea:function(c){var b=Event.element(c);var f=b.attr("method");if(String.isNullOrEmpty(f)){b=b.parent();f=b.attr("method");}switch(f){case"showReply":var h=this.list.find("div[forCid='"+b.attr("commentId")+"']");if(h.attr("s")=="none"){h.show();h.attr("s","");}else{h.hide();h.attr("s","none");}break;case"useFul":var e=b.attr("hotelId");var a=b.attr("commentId");var i=new Date().getTime()+Math.round(Math.random()*100);if(b.attr("class")=="like"){var g=b.parent().find("span.counts").html();g=g.substring(1,g.indexOf(")"));g=isNaN(g)?0:parseInt(g);b.find("i[method=showAdd]").fadeIn(500);b.parent().find("span.counts").html("("+(g+1)+")");b.parent().find("span.counts").attr("style","display:inline");b.find("i[method=showAdd]").fadeOut(500);b.addClass("liked");HotelDetailNewController.UseFulComment(e,i,a,function(j){}.bind(this),false,"POST");}break;}},ClickPager:function(c){c.preventDefault();var b=Event.element(c);var e=b.attr("mth");if(this.commentType!=-2){this.isClickPager=true;}var a=this.keywordsDiv.find("[class='btn btn_on']").attr("typeid");if(String.isNullOrEmpty(a)){a="-1";}switch(e){case"pageIndex":this.pageIndex=parseInt(b.html());if(this.commentType!=-2){if(this.tab){$("html, body").animate({scrollTop:this.tab.offset().top},100);}this.list.empty();if(a!="-1"){HotelDetailNewController.GetCommentSummary(this.hotelId,this.pageIndex,10,a,this.commentType,this.startDomTag,this.endDomTag,this.GetHotelReviewsCallBack.bind(this),true,"GET");}else{HotelDetailNewController.GetHotelReviews(this.hotelId,this.pageIndex,10,this.commentType,this.GetHotelReviewsCallBack.bind(this));}}break;case"prev":if(this.pageIndex>1&&this.commentType!=-2){if(this.tab){$("html, body").animate({scrollTop:this.tab.offset().top},100);}this.pageIndex=this.pageIndex-1;this.list.empty();if(a!="-1"){HotelDetailNewController.GetCommentSummary(this.hotelId,this.pageIndex,10,a,this.commentType,this.startDomTag,this.endDomTag,this.GetHotelReviewsCallBack.bind(this),true,"GET");}else{HotelDetailNewController.GetHotelReviews(this.hotelId,this.pageIndex,10,this.commentType,this.GetHotelReviewsCallBack.bind(this));}}break;case"next":if(this.commentType!=-2){if(this.tab){$("html, body").animate({scrollTop:this.tab.offset().top},100);}this.pageIndex=this.pageIndex+1;this.list.empty();if(a!="-1"){HotelDetailNewController.GetCommentSummary(this.hotelId,this.pageIndex,10,a,this.commentType,this.startDomTag,this.endDomTag,this.GetHotelReviewsCallBack.bind(this),true,"GET");}else{HotelDetailNewController.GetHotelReviews(this.hotelId,this.pageIndex,10,this.commentType,this.GetHotelReviewsCallBack.bind(this));}}break;}},OnMouseoverpuserLevel:function(b){var a=Event.element(b);if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:"<div>艺龙用户评级，是以艺龙用户对Hotel的评价为基础，综合考虑了其它多方面的因素，对合作Hotel进行的评级。这些因素主要包括：国家旅游局评定的星级，Hotel的设施设备、配套情况、服务水平、社会美誉度、品牌知名度以及对客户的诚信等等。</div>",eventElement:a,defer:true,width:400});},OnClickbtnAddComment:function(a){if(this.language=="cn"){window.location.href="http://dianping.elong.com/PostComment_"+this.hotelId+".html"+(this.CampaignId!=""?"?campaign_id="+this.CampaignId+"":"");}},BuildPagerHtml:function(res){var totalComment=0;var currPageIndex=this.pageIndex;var pageSize=10;var startCommentIndex=(currPageIndex-1)*pageSize+1;var endCommentIndex=startCommentIndex+res.CommentList.length-1;switch(this.commentType){case -1:totalComment=res.BadComment;break;case 1:totalComment=res.GoodComment;break;case 2:totalComment=res.TotalComment;break;}var commentTypeId=this.keywordsDiv.find("[class='btn btn_on']").attr("typeid");if(!String.isNullOrEmpty(commentTypeId)&&commentTypeId!="-1"){totalComment=this.keyWordsCommentCount;this.isClickKeyWordsDiv=false;}var pageCount=totalComment%pageSize==0?totalComment/pageSize:Math.floor(totalComment/pageSize)+1;if(pageCount<=currPageIndex&&this.commentType==2&&commentTypeId=="-1"){HotelDetailNewController.GetHotelTAReviews(this.hotelId,this.GetDaodaoReviewsCallBack.bind(this));}var prevCss="";var nextCss="";if(currPageIndex>1){prevCss="prev";}else{prevCss="prev no";}if(currPageIndex<pageCount){nextCss="next";}else{nextCss="next no";}var str="";if(pageCount<6){for(var i=1;i<=pageCount;i++){if(i==currPageIndex){str=str+"<span class='cur'>"+i+"</span>";}else{str=str+"<a href='#' mth='pageIndex'>"+i+"</a>";}}}else{if(currPageIndex<4){for(var i=1;i<=5;i++){if(i==currPageIndex){str=str+"<span class='cur'>"+i+"</span>";}else{str=str+"<a href='#' mth='pageIndex'>"+i+"</a>";}}str=str+"<span class='more'>...</span>";str=str+"<a href='#' mth='pageIndex'>"+pageCount+"</a>";}else{if(currPageIndex>pageCount-3){str=str+"<a href='#' mth='pageIndex'>1</a>";str=str+"<span class='more'>...</span>";for(var i=pageCount-4;i<=pageCount;i++){if(i==currPageIndex){str=str+"<span class='cur'>"+i+"</span>";}else{str=str+"<a href='#' mth='pageIndex'>"+i+"</a>";}}}else{str=str+"<a href='#' mth='pageIndex'>1</a>";if(currPageIndex>4){str=str+"<span class='more'>...</span>";}for(var i=currPageIndex-2;i<=currPageIndex+2;i++){if(i==currPageIndex){str=str+"<span class='cur'>"+i+"</span>";}else{str=str+"<a href='#' mth='pageIndex'>"+i+"</a>";}}if(currPageIndex<pageCount-3){str=str+"<span class='more'>...</span>";}str=str+"<a href='#' mth='pageIndex'>"+pageCount+"</a>";}}}var html=this.pageTemp.eval({startCommentIndex:startCommentIndex,endCommentIndex:endCommentIndex,totalComment:totalComment,prevCss:prevCss,nextCss:nextCss,Link:str});this.pager.html(html);},ChangeTabCss:function(c){this.tab.html(this.ulTemp.html());var b=this.tab.find("li[mth='"+c+"']");b.addClass("on");var a=b.children(0).html();if(c!="daodao"){this.tab.find("li[mth='"+c+"']").html(a+"<i></i>");}},ChangeKeyWordsCss:function(a){a.parent().find("span").each(function(){if($(this).attr("class")=="btn btn_on"){$(this).removeClass("btn_on");}});a.addClass("btn_on");},GetHotelReviewsCallBack:function(b){this.loading.attr("style","display:none");if(this.commentType!=-2&&!this.isClickPager){this.keywordsDiv.show();}if(b!=null&&b.CommentList!=null){if(b.CommentTypes!=null&&!this.isClickPager){this.ChangeKeyWordsData(b.CommentTypes);}var a=$.tmpl("reviewPopListTemp",b);this.list.append(a);this.BuildPagerHtml(b);}else{if(this.commentType==2){HotelDetailNewController.GetHotelTAReviews(this.hotelId,this.GetDaodaoReviewsCallBack.bind(this));}}},GetDaodaoReviewsCallBack:function(res){this.loading.attr("style","display:none");if(res!=null&&res.CommentItemList!=null&&res.CommentItemList.length>0){var commentListHtml="<div class='daodao' id='daodao'><h4>以下点评来自于全球最大旅行社区<a href='http://www.daodao.com/' method='goDaoDao' target='_blank'>到到网</a>的独立点评<span><img src=\"http://www.daodao.com/img/cdsi/img2-daodao/branding/daodao100x30-11075-1.gif\" width=\"100\" height=\"30\" alt=\"daodao\" /></span></h4>";for(var i=0;i<res.CommentItemList.length;i++){var comment=res.CommentItemList[i];var commentHtml=this.daodaoTemp.eval({UserLevel:comment.UserRating*10,Title:comment.Title,CreateTime:comment.PostTime,MemberName:comment.Author,Content:comment.Content});commentListHtml=commentListHtml+commentHtml;}commentListHtml=commentListHtml+"</div>";this.list.append(commentListHtml);}},GetDaodaoFirstPageReviewsCallBack:function(res){if(res!=null&&res.CommentItemList!=null&&res.CommentItemList.length>0){var commentListHtml='<h4>以下点评来自于全球最大旅行社区<a href=\'http://www.daodao.com/\'>到到网</a>的独立点评<span><img src="http://www.daodao.com/img/cdsi/img2-daodao/branding/daodao100x30-11075-1.gif" width="100" height="30" alt="daodao" /></span></h4>';for(var i=0;i<res.CommentItemList.length;i++){var comment=res.CommentItemList[i];var commentHtml=this.daodaoTemp.eval({UserLevel:comment.UserRating*10,Title:comment.Title,CreateTime:comment.PostTime,MemberName:comment.Author,Content:comment.Content});commentListHtml=commentListHtml+commentHtml;}this.daodao.html(commentListHtml);}},Rankings:function(){var f=this.rankingsSpan.attr("hotelId");var c=this.rankingsSpan.attr("cityid");var a=this.rankingsSpan.attr("areaid");var b=this.rankingsSpan.attr("areatype");var g=this.rankingsSpan.attr("star");var e=this.rankingsSpan.attr("goodrate");if(a!=""&&!Object.isNull(a)){this.rankSortP.attr("style","display:block");HotelDetailNewController.GetRecomRankings(f,c,a,b,g,e,function(h){if(h.success&&!Object.isNull(h.value)&&!String.isNullOrEmpty(h.value)){this.rankingsSpan.html(h.value);$("#rankTitle").show();}else{$("#rankTitle").hide();}}.bind(this));}else{this.rankSortP.attr("style","display:none");}},GetTAReviewsCallBack:function(res){this.loading.attr("style","display:none");if(res!=null&&res.CommentItemList!=null&&res.CommentItemList.length>0){var commentListHtml="";for(var i=0;i<res.CommentItemList.length;i++){var comment=res.CommentItemList[i];if(i==0&&$("#firstCommentInfoArea")!=null){$("#firstCommentInfoArea").text(comment.Content.substr(0,128));}var commentHtml=this.taTemp.eval({UserLevel:comment.UserRating*10,UserRating:comment.UserRating,Title:comment.Title,CreateTime:comment.PostTime,Content:comment.Content});commentListHtml=commentListHtml+commentHtml;}commentListHtml=commentListHtml+"<div class='tr' style='width: 677px; float: left;'><span style='float: left;'><a href='http://www.tripadvisor.com/'>TripAdvisor LLC.</a> All rights reserved. </span><span class='right'><a href='"+res.ReadCommentUrl+"'>Read more reviews</a><br><a href='"+res.WriteCommentUrl+"'>Write a review</a></span></div>  ";this.list.html(commentListHtml);}},render:function(){if(this.language=="en"){this.loading.attr("style","display:block");this.list.empty();HotelDetailNewController.GetHotelTAReviews(this.hotelId,this.GetTAReviewsCallBack.bind(this));}else{var a=Globals.cookie("She","CloseCouponIcon");if(String.isNullOrEmpty(a)||a!="1"){this.divDianpingCoupon.show();}else{this.divDianpingCoupon.hide();}}}});var HotelDetailClient=Elong.Page.HotelDetailClient;HotelDetailClient=Class.create();Object.extend(HotelDetailClient.prototype,{name:"HotelDetailClient",AjaxInfo:HotelDetailNewController.AjaxPropertys,HotelUrlTemplate:new Template(HotelDetailNewController.UrlConfig.HotelDynamicDetail),initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.controllerData=HotelDetailNewController;this.WebRequestInfo=this.controllerData.AjaxPropertys.RequestInfo;this.HotelId=HotelDetailNewController.AjaxPropertys.HotelId;this.Lat=HotelDetailNewController.AjaxPropertys.Lat;this.Lng=HotelDetailNewController.AjaxPropertys.Lng;this.CitynameEn=this.controllerData.AjaxPropertys.CityNameEn!=null?this.controllerData.AjaxPropertys.CityNameEn:"";this.hadReviewloaded=false;this.HotelDetailUrlTemplate=new Template(this.controllerData.UrlConfig.HotelDetailViewUrl);this.lowestPriceTemplate=new Template("<span>#{from}#{price}#{tail}</span>");this.distanceDescTmplCn=new Template("直线距离约#{miles}公里");this.distanceDescTmplEn=new Template("Straight-line distance of #{miles} km");this.nearByPriceTmpl=new Template("#{from}<span class='price'>#{price}</span>#{tail}");this.tmpHotelDetailHeadClient=new HotelDetailHeadClient();this.serviceIndex=new Template('<span class="fuicon"></span>服务指数：<span class="sz">#{index}</span><span class="zs">/5分</span>#{average}');this.ServiceTip=new Template('    <span class="farrow"></span>    <ul class="fuwuzishu">	    <li>及时Confirm 率：<strong>#{c1}</strong>%</li>        <li class="hy"><span class="#{c2}"></span>#{c3}</li>        <li>预订成功率：<strong>#{s1}</strong>%</li>        <li class="hy"><span class="#{s2}"></span>#{s3}</li>        <li> 用户投诉率：<strong>#{u1}</strong>%</li>        <li class="hy"><span class="#{u2}"></span>#{u3}</li>    </ul>');this.initializeDOM();this.initializeEvent();this.render();},initializeDOM:function(){this.IntroduceMore=$("#IntroduceMore");this.PackUp=$("#PackUp");this.historyBrowseHotelDiv=$("#historyBrowseHotelDiv");this.nearHotelsDiv=$("#nearHotelsDiv");this.mapShow=$("#mapDetial");this.SimilarHotel=$("#SimilarHotel");this.SimilarHotels=$("#SimilarHotels");this.Partner=$("#Partner");this.Partners=$("#Partners");this.detailTab=$("#detailTab");this.bookbut=$("#bookbut");this.tabHig=this.detailTab.offset().top;this.commentDiv=$("#commentDiv");this.roomTypes=$("#roomTypes");this.roomType=$("#roomType");this.comment=$("#comment");this.photo=$("#photo");this.backToTopEle=$("#back-to-top");this.serviceDiv=$("#serviceIndex");this.item_fk=$("#item_fk");this.txtFeedBackContent=$("#txtFeedBackContent");this.rdType=$("input[name='rdType']");this.txtFeedBackEmail=$("#txtFeedBackEmail");this.btnSubmit=$("#btnSubmit");this.spanFeedBack=$("#closeFeedBack");this.spanBackGround=$("#spanBackGround");this.isShowContent=true;this.isShowEmail=true;this.isShow=false;this.isShowFbCode=true;this.closeSuceeFb=$("#closeSuceeFb");this.item_fk_success=$("#item_fk_success");this.item_fk_fail=$("#item_fk_fail");this.closeFailFb=$("#closeFailFb");this.feedBackKey="";this.imgFeedBack=$("#imgFeedBack");this.txtFeedBackCode=$("#txtFeedBackCode");},initializeEvent:function(){$(window).bind("scroll",this.windowOnScroll.bindAsEventListener(this));this.IntroduceMore.bind("click",this.IntroduceMoreOnClick.bindAsEventListener(this));this.PackUp.bind("click",this.PackUpOnClick.bindAsEventListener(this));this.historyBrowseHotelDiv.bind("click",this.OnClickViewedHotel.bindAsEventListener(this));this.mapShow.bind("click",this.OnClickBtnMapShow.bindAsEventListener(this));this.SimilarHotel.bind("click",this.OnClickSimilarHotel.bindAsEventListener(this));this.Partner.bind("click",this.OnClickPartner.bindAsEventListener(this));this.roomType.bind("click",this.OnClickRoomType.bindAsEventListener(this));this.comment.bind("click",this.OnClickComment.bindAsEventListener(this));this.photo.bind("click",this.OnClickPhoto.bindAsEventListener(this));this.backToTopEle.bind("click",this.backTopClick.bindAsEventListener(this));this.btnSubmit.bind("click",this.submitFeedBack.bindAsEventListener(this));this.txtFeedBackContent.bind("focus",this.txtContentFocus.bindAsEventListener(this));this.txtFeedBackEmail.bind("focus",this.txtEmailFocus.bindAsEventListener(this));this.txtFeedBackCode.bind("focus",this.txtFeedBackCodeFocus.bindAsEventListener(this));this.txtFeedBackContent.bind("blur",this.txtContentBlur.bindAsEventListener(this));this.txtFeedBackEmail.bind("blur",this.txtEmailBlur.bindAsEventListener(this));this.txtFeedBackCode.bind("blur",this.txtFeedBackCodeBlur.bindAsEventListener(this));this.spanFeedBack.bind("click",this.closeFeedBack.bindAsEventListener(this));this.item_fk_success.bind("click",this.closeFbSuccess.bindAsEventListener(this));this.closeSuceeFb.bind("click",this.closeFeedBack.bindAsEventListener(this));this.item_fk_fail.bind("click",this.closeFbFail.bindAsEventListener(this));this.closeFailFb.bind("click",this.closeFeedBack.bindAsEventListener(this));this.imgFeedBack.bind("click",this.refreshFbCode.bindAsEventListener(this));},destroyDOM:function(){},render:function(){var checkInInput=$("#checkInDateApply");var checkOutInput=$("#checkOutDateApply");var checkInDate=this.getDate(checkInInput.val());var checkOutDate=this.getDate(checkOutInput.val());var city={CityId:this.AjaxInfo.CityId,CityNameCn:this.AjaxInfo.CityNameCn,CityNameEn:this.AjaxInfo.CityNameEn};this.saveSearchCookie(city,checkInDate,checkOutDate);this.imgLazyLoad();this.roomClient=new HotelRoomClient();this.roomClient.render();if(this.serviceDiv.length>0){if(!Object.isNull(this.AjaxInfo.HotelServiceIndex)&&!Object.isNull(this.AjaxInfo.CityServiceIndex)){var hotelserviceIndex=this.AjaxInfo.HotelServiceIndex.ServiceIndex;var cityserviceIndex=this.AjaxInfo.CityServiceIndex.ServiceIndex;var average="";if(cityserviceIndex>0){var diffIndex=parseInt(((hotelserviceIndex-cityserviceIndex)/cityserviceIndex)*100);var h1=this.getRateCss(diffIndex);var h2=this.getRateDesc(diffIndex);average='<span class="{0} ml15"></span>{1}';average=String.format(average,h1,h2);}this.serviceDiv.html(this.serviceIndex.eval({index:hotelserviceIndex.toFixed(1),average:average}));this.serviceDiv.bind("mouseover",this.OnMouseOverServiceIndex.bindAsEventListener(this));}}this.initFeedBackContent();this.initFeedBackEmail();if(window.location.href.toLowerCase().indexOf("review")!=-1){if(!this.hadReviewloaded){this.scrollLoadReview();}}},getRateDesc:function(b){var a=["于同城{0}","持平"];var c=b==0?1:0;a=a[c];rate=b==0?"":(b>0?b:-b)+"%";return String.format(a,rate);},getRateCss:function(b){var a=["d","p","g"];var c=b;c=b>0?2:(b==0?1:0);return a[c];},OnMouseOverServiceIndex:function(evt){var element=Event.element(evt);var c2,s2,u2,c3,s3,u3;var diffConfirm=this.AjaxInfo.HotelServiceIndex.ConfirmRate-this.AjaxInfo.CityServiceIndex.ConfirmRate;var diffSuccess=this.AjaxInfo.HotelServiceIndex.SuccessRate-this.AjaxInfo.CityServiceIndex.SuccessRate;var diffComplain=this.AjaxInfo.HotelServiceIndex.ComplaintsRate-this.AjaxInfo.CityServiceIndex.ComplaintsRate;c2=this.getRateCss(diffConfirm);s2=this.getRateCss(diffSuccess);u2=this.getRateCss(diffComplain);c3=this.getRateDesc(diffConfirm);s3=this.getRateDesc(diffSuccess);u3=this.getRateDesc(diffComplain);var serviceTip=this.ServiceTip.eval({c1:this.AjaxInfo.HotelServiceIndex.ConfirmRate,c2:c2,c3:c3,s1:this.AjaxInfo.HotelServiceIndex.SuccessRate,s2:s2,s3:s3,u1:this.AjaxInfo.HotelServiceIndex.ComplaintsRate,u2:u2,u3:u3});if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:serviceTip,eventElement:this.serviceDiv.find("span[class='fuicon']"),defer:true,width:250});},backTopClick:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"goTop":$("html, body").animate({scrollTop:0},100);break;case"feedBack":if(this.isShow==false){this.item_fk.show(300);this.isShow=true;this.spanBackGround.addClass("choose");this.refreshFbCode();}else{this.item_fk.hide(300);this.isShow=false;this.spanBackGround.removeClass("choose");}break;case"service":window.open("http://www.elong.com/chat.html?g=31878","","height=460,width=690,left=200,top=100,resizable=yes");break;}},closeFeedBack:function(){this.item_fk.hide(300);this.isShow=false;this.spanBackGround.removeClass("choose");},closeFbSuccess:function(){this.item_fk_success.hide(300);this.isShow=false;this.spanBackGround.removeClass("choose");},closeFbFail:function(){this.item_fk_fail.hide(300);this.isShow=false;this.spanBackGround.removeClass("choose");},BuildRandomKey:function(){var a=(new Date()).getTime().toString()+Math.round((Math.random()*(99999-10000)+10000));return a;},submitFeedBack:function(){if(this.isShowContent==true){this.txtFeedBackContent.addClass("com_ErrorBox");return;}else{this.txtFeedBackContent.removeClass("com_ErrorBox");}if(this.isShowEmail==false&&!validator.valid(this.txtFeedBackEmail.val(),"email")){this.txtFeedBackEmail.addClass("com_ErrorBox");return;}else{this.txtFeedBackEmail.removeClass("com_ErrorBox");}var a="";for(var b=0;b<this.rdType.length;b++){var e=$("#rdType"+(b+1).toString());if(e.attr("checked")==true){a=e.val();}}var c={FeedBackContent:this.txtFeedBackContent.val(),FeedBackType:a,FeedBackEmail:this.isShowEmail?"":this.txtFeedBackEmail.val(),FeedBackKey:this.feedBackKey,FeedBackCode:this.txtFeedBackCode.val()};elongAjax.callBack("/FeedBack/AddFeedBack",c,function(f){if(f.result=="VcNull"){this.txtFeedBackCode.addClass("com_ErrorBox");return;}else{this.txtFeedBackCode.removeClass("com_ErrorBox");}if(f.result=="VcWrong"){this.txtFeedBackCode.addClass("com_ErrorBox");return;}else{this.txtFeedBackCode.removeClass("com_ErrorBox");}this.item_fk.hide();this.isShow=false;this.initFeedBackContent();this.initFeedBackEmail();this.initFeedBackCode();this.initFeedBackType();this.isShowContent=true;this.isShowEmail=true;this.isShowFbCode=true;if(f.result=="success"){this.feedBackKey="";this.item_fk_success.show();setTimeout("$('#item_fk_success').hide(300);$('#spanBackGround').removeClass('choose');",1000);}else{this.item_fk_fail.show();}}.bind(this),false,"POST",null,"json");},refreshFbCode:function(){if(this.feedBackKey==""){this.feedBackKey=this.BuildRandomKey();}this.imgFeedBack.attr("src","/validateFbCode/post/"+this.feedBackKey+"?rnd="+Math.random());},txtContentFocus:function(){if(this.isShowContent==true){this.txtFeedBackContent.val("");this.txtFeedBackContent.css("color","#131313");}},txtEmailFocus:function(){if(this.isShowEmail==true){this.txtFeedBackEmail.val("");this.txtFeedBackEmail.css("color","#131313");}},txtFeedBackCodeFocus:function(){if(this.isShowFbCode==true){this.txtFeedBackCode.val("");this.txtFeedBackCode.css("color","#131313");}},txtContentBlur:function(){if(this.txtFeedBackContent.val()==""){this.isShowContent=true;this.initFeedBackContent();this.txtFeedBackContent.css("color","");}else{this.txtFeedBackContent.css("color","#131313");this.isShowContent=false;}},txtEmailBlur:function(){if(this.txtFeedBackEmail.val()==""){this.isShowEmail=true;this.initFeedBackEmail();this.txtFeedBackEmail.css("color","");}else{this.txtFeedBackEmail.css("color","#131313");this.isShowEmail=false;}},txtFeedBackCodeBlur:function(){if(this.txtFeedBackCode.val()==""){this.isShowFbCode=true;this.initFeedBackCode();this.txtFeedBackCode.css("color","");}else{this.txtFeedBackCode.css("color","#131313");this.isShowFbCode=false;}},initFeedBackContent:function(){this.txtFeedBackContent.val("如果您对我们的产品有什么建议和问题，请告诉我们：）");this.txtFeedBackContent.css("color","");},initFeedBackEmail:function(){this.txtFeedBackEmail.val("留下您的Email，方便我们联系您：）");this.txtFeedBackEmail.css("color","");},initFeedBackCode:function(){this.txtFeedBackCode.val("验证码");this.txtFeedBackCode.css("color","");},initFeedBackType:function(){for(var a=0;a<this.rdType.length;a++){var b=$("#rdType"+(a+1).toString());b.attr("checked",false);}},getDate:function(a){return a.split(" ")[0];},windowOnScroll:function(){this.imgLazyLoad();if(this.commentDiv.offset().top<=(this.pageTop()+100)&&!this.hadReviewloaded){this.scrollLoadReview();}var a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(a>=(this.tabHig+2)){this.detailTab.attr("class","detailTab detailFix");this.bookbut.attr("class","fixPrice");}else{this.detailTab.attr("class","detailTab");this.bookbut.attr("class","fixPrice none");}($(document).scrollTop()>0)?this.backToTopEle.fadeIn(1000):this.backToTopEle.hide();},saveSearchCookie:function(c,a,b){if(!Object.isNull(c)){Globals.cookie("ShHotel","",{InDate:validator.reFormatDateString(a),OutDate:validator.reFormatDateString(b),CityNameCN:c.CityNameCn,CityNameEN:c.CityNameEn,CityID:c.CityId},{expires:11,path:"/",secure:false});}else{Globals.cookie("ShHotel","",{InDate:validator.reFormatDateString(a),OutDate:validator.reFormatDateString(b),CityNameCN:Globals.cookie("ShHotel","CityNameCN"),CityNameEN:Globals.cookie("ShHotel","CityNameEN"),CityID:Globals.cookie("ShHotel","CityID")},{expires:11,path:"/",secure:false});}},pageTop:function(){var a=document,b=(navigator.userAgent.toLowerCase().match(/iPad/i)=="ipad")?window.pageYOffset:Math.max(a.documentElement.scrollTop,a.body.scrollTop);return a.documentElement.clientHeight+b;},imgLazyLoad:function(){var b=$(document).find("img[src2]");if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){if($(b[a]).offset().top<=(this.pageTop()+50)){var c=$(b[a]).attr("src2");if(c){$(b[a]).attr("src",c).removeAttr("src2");}}}}},scrollLoadReview:function(){this.hadReviewloaded=true;var a=new HotelDetailReviewsControllerClient();FunctionExt.defer(function(){a.loadCommentData();},200);FunctionExt.defer(function(){a.Rankings();},500);},GetSeenHotelRank:function(){var e=HotelDetailNewController.AjaxPropertys.Lng;var a=HotelDetailNewController.AjaxPropertys.Lat;var b=HotelDetailNewController.AjaxPropertys.CityId;var c=HotelDetailNewController.AjaxPropertys.HotelName;HotelDetailNewController.GetSeenHotel(this.HotelId,e,a,b,c,function(f){if(f.success&&!Object.isNull(f.value)){var g=$("#SeenHotelHtml").tmpl(f.value);if(!String.isNullOrEmpty(g)){$("#SeenHotelList").append(g);}this.imgLazyLoad();}}.bind(this));},dispose:function(){this.destroyEvent();this.destroyDOM();},OnClickRoomType:function(b){var a=Event.element(b);this.roomTypes.show();this.roomType.addClass("action");this.commentDiv.show();this.comment.removeClass();this.commentDiv.find("h2").show();$("html, body").animate({scrollTop:this.tabHig},100);},OnClickComment:function(b){var a=Event.element(b);this.roomTypes.hide();this.roomType.removeClass();if(!this.hadReviewloaded){this.scrollLoadReview();}this.commentDiv.show();this.comment.addClass("action");this.commentDiv.find("h2").hide();$("html, body").animate({scrollTop:this.tabHig},100);},OnClickPhoto:function(b){var a=Event.element(b);var c=a.attr("url");window.location.href=c;},IntroduceMoreOnClick:function(a){this.IntroduceMore.hide();$("#Introduce").hide();$("#IntroduceAll").show();this.PackUp.show();},PackUpOnClick:function(a){this.PackUp.hide();this.IntroduceMore.show();$("#Introduce").show();$("#IntroduceAll").hide();},OnClickBtnMapShow:function(a){if(this.tmpHotelDetailHeadClient){this.tmpHotelDetailHeadClient.OnClickImageMapShow(a);}},LoadHistoryBrowseHotels:function(){this.LoadNearByHotel();var a=this.GetHistoryHotelIds();if(a!=""){this.controllerData.GetHistoryBrowseHotels(this.WebRequestInfo,a,function(c){if(c.success&&c.value!=null){var b=c.value.BrowerHotelList;this.showHistoryBrowseHotels(c.value.BrowerHotelList);}}.bind(this),false,"post",true,5000);}},GetHistoryHotelIds:function(){var a="";a=Globals.cookie("SHBrowseHotel",this.Language.toLowerCase());var c="";var b="";if(String.isNullOrEmpty(a)==false){var g=a.split(";");if(a!=null&&a!=""){for(var f=0;f<g.length;f++){var e=g[f].split(",");if(e.length<1){continue;}var b=e[0];if(c==""){c+=b;}else{c+=","+b;}}}}return c;},LoadNearByHotel:function(){var a=$("#lowerPrice").html();var b=Object.clone(this.WebRequestInfo);b.StarLevel=-1;b.AreaId="";b.StartLat=this.Lat;b.StartLng=this.Lng;if(b.StartLat>0&&b.StartLng>0){this.controllerData.GetNearByHotel(b,this.HotelId,a,function(c){if(c.success&&c.value!=null&&c.value.length>0){this.showNearByHotel(c.value);}}.bind(this),false,"get");}},showHistoryBrowseHotels:function(historyHotelInfoList){var historyBrowseHotelHtml="";if(historyHotelInfoList!=null&&historyHotelInfoList!=""&&historyHotelInfoList!=undefined&&historyHotelInfoList.length>0){historyBrowseHotelHtml='<h3><i class="ls"></i>'+(this.Language.toLowerCase()=="en"?"Hotels reviewed":"浏览过的Hotel")+"</h3>";historyBrowseHotelHtml+='<ul class="hotelUl clx">';for(var i=0;i<historyHotelInfoList.length;i++){var hotelId=historyHotelInfoList[i].HotelId;var hotelName="";var subHotelName="";var hotelStar=parseInt(historyHotelInfoList[i].HotelStar);var hotelImageUrl=historyHotelInfoList[i].SeventySpecImage;if(String.isNullOrEmpty(hotelImageUrl)){hotelImageUrl="http://www.elongstatic.com/hotels/pic/no_pics_CN.gif";}var currency=historyHotelInfoList[i].MoneySymbol;var hotelPrice=parseFloat(historyHotelInfoList[i].LowestPrice)>0?currency+historyHotelInfoList[i].LowestPrice:"";var fromDesc="";var tailDesc="";var hotelNameEnForUrl=historyHotelInfoList[i].HotelNameEn;if(this.Language.toLowerCase()=="en"){hotelName=String.isNullOrEmpty(historyHotelInfoList[i].HotelNameRealEn)?"":historyHotelInfoList[i].HotelNameRealEn;subHotelName=hotelName;if(hotelName.length>22){subHotelName=hotelName.substring(0,22)+"...";}if(!String.isNullOrEmpty(hotelPrice)){fromDesc="from";tailDesc="";}}else{hotelName=String.isNullOrEmpty(historyHotelInfoList[i].HotelName)?"":historyHotelInfoList[i].HotelName;subHotelName=hotelName;if(hotelName.length>10){subHotelName=hotelName.substring(0,10)+"...";}if(!String.isNullOrEmpty(hotelPrice)){fromDesc="";tailDesc="起";}}var lowestPriceDesc=this.lowestPriceTemplate.eval({from:fromDesc,price:hotelPrice});var CityNameEn=FilterPinyinForUrl(this.CitynameEn);var hotelDetailUrl=this.HotelDetailUrlTemplate.eval({cityNameEn:CityNameEn,hotelId:hotelId});hotelDetailUrl=String.format("{0}{1}fr=elrc_dt_vw_{2}_{3}",hotelDetailUrl,hotelDetailUrl.indexOf("?")!=-1?"&":"?",i+1,hotelId);if(i==historyHotelInfoList.length-1){historyBrowseHotelHtml+='<li class="last"><span hotelid="'+hotelId+'"title="删除此条记录" method="delSeenHotel" class="del"></span>';}else{historyBrowseHotelHtml+='<li><span hotelid="'+hotelId+'"title="删除此条记录" method="delSeenHotel" class="del"></span>';}historyBrowseHotelHtml+='<span class="h_price">'+lowestPriceDesc+'</span><a href="'+hotelDetailUrl+'" target="_blank" title="'+hotelName+'">'+subHotelName+"</a>";historyBrowseHotelHtml+="</li>";}historyBrowseHotelHtml+="</ul>";this.historyBrowseHotelDiv.html(historyBrowseHotelHtml);this.historyBrowseHotelDiv.show();}else{this.historyBrowseHotelDiv.hide();}},showNearByHotel:function(recommendHotels){var nearByHotelsHtml="";if(recommendHotels!=null&&recommendHotels!=""&&recommendHotels!=undefined&&recommendHotels.length>0){nearByHotelsHtml='<h3><i class="tj"></i>'+(this.Language.toLowerCase()=="en"?"Similar hotels nearby":"周边Hotel推荐")+"</h3>";nearByHotelsHtml+='<ul class="hotelUl">';for(var i=0;i<recommendHotels.length;i++){var hotelId=recommendHotels[i].HotelId;var distanceMiles=recommendHotels[i].Distance;var IsElongStar=recommendHotels[i].IsElongStar;var HotelStar=recommendHotels[i].HotelStar;var MoneySymbo=recommendHotels[i].MoneySymbol;var LowestPrice=parseFloat(recommendHotels[i].LowestPrice)>0?recommendHotels[i].LowestPrice:"";var HotelName="";var subHotelName="";var HotelNameEn=recommendHotels[i].HotelNameRealEn;var HotelNameCn=recommendHotels[i].HotelName;var SeventySpecImage=recommendHotels[i].SeventySpecImage;var HotelNameEnForUrl=recommendHotels[i].HotelNameEn;if(String.isNullOrEmpty(SeventySpecImage)){SeventySpecImage="http://www.elongstatic.com/hotels/pic/detailaround_no.png";}var fromDesc="";var tailDesc="";if(this.Language=="en"){HotelName=HotelNameEn;fromDesc="from";tailDesc="";}else{HotelName=HotelNameCn;subHotelName=HotelName;if(HotelName.length>10){subHotelName=HotelName.substring(0,10)+"...";}fromDesc="";tailDesc="元起";}var lowestPriceDesc=this.nearByPriceTmpl.eval({from:fromDesc,price:LowestPrice});var CityNameEn=FilterPinyinForUrl(this.CitynameEn);var hotelDetailUrl=this.HotelDetailUrlTemplate.eval({cityNameEn:CityNameEn,hotelId:hotelId});hotelDetailUrl=String.format("{0}{1}fr=elrc_dt_nb_{2}_{3}",hotelDetailUrl,hotelDetailUrl.indexOf("?")!=-1?"&":"?",i+1,hotelId);if(i==recommendHotels.length-1){nearByHotelsHtml+='<li class="last clx">';}else{nearByHotelsHtml+='<li class="clx">';}nearByHotelsHtml+='<a target="_blank" title="'+HotelName+'" href="'+hotelDetailUrl+'"><img class="img" src="'+SeventySpecImage+'" onerror="this.src=\'http://www.elongstatic.com/hotels/pic/detailaround_no.png\'" with="60" height="60"></a>';nearByHotelsHtml+="<dl>";nearByHotelsHtml+='<dt><a target="_blank" title="'+HotelName+'" href="'+hotelDetailUrl+'">'+subHotelName+"</a></dt>";nearByHotelsHtml+='<dd class="jl">'+(this.Language=="en"?this.distanceDescTmplEn.eval({miles:distanceMiles}):this.distanceDescTmplCn.eval({miles:distanceMiles}))+"</dd>";nearByHotelsHtml+='<dd> <span class="price">'+lowestPriceDesc+"</span>元起</dd>";nearByHotelsHtml+="</dl>";nearByHotelsHtml+="</li>";}nearByHotelsHtml+="</ul>";this.nearHotelsDiv.html(nearByHotelsHtml);this.nearHotelsDiv.show();}else{this.nearHotelsDiv.hide();}},OnClickViewedHotel:function(e){var c=Event.element(e);var f=c.attr("method");switch(f){case"delSeenHotel":var b=c.attr("hotelid");b=String.format("{0},{1},{2},{3},{4},{5},{6};",b,"","","","","","");var a="";a=Globals.cookie("SHBrowseHotel",this.Language.toLowerCase());a=a.replace(b,"");Globals.cookie("SHBrowseHotel",this.Language.toLowerCase(),a,{expires:30,path:"/",secure:false});c.parent().remove();if(a==null||a==""){this.historyBrowseHotelDiv.remove();}break;}},OnClickSimilarHotel:function(b){var a=Event.element(b);this.Partners.hide();this.Partner.removeClass();this.SimilarHotels.show();this.SimilarHotel.addClass("on");},OnClickPartner:function(b){var a=Event.element(b);this.SimilarHotels.hide();this.SimilarHotel.removeClass();this.Partners.show();this.Partner.addClass("on");},GetBrowseData:function(){HotelDetailNewController.GetBrowseData(this.AjaxInfo.HotelId,function(b){if(b.success){if(b.value>0){var c="";if(this.Language!="EN"){c=String.format('<div class="viewsPor"><span class="clos"></span><div class="conBox">有<span class="di">{0}</span>位用户在浏览该Hotel</div></div>',b.value);}else{c=String.format('There {0} <span class="bold orange">{1}</span> {2} looking at this hotel right now!',b.value>1?"are":"is",b.value,b.value>1?"users":"user");}$("#RealTimeBrowserDataContainer").append(c);$("#RealTimeBrowserDataContainer").addClass("com_hotresults com_realtime viebornoe");var a=new MsnTip();}}}.bind(this),true,"POST");}});var Client=null;$ready(function(){var a={Language:HotelDetailNewController.Language};Client=new HotelDetailClient(a);});var MsnTip=Elong.Page.MsnTip;MsnTip=Class.create();Object.extend(MsnTip.prototype,{name:"msnTip",html:"",options:{},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.initializeDOM();this.initializeEvent();this.render();},initializeDOM:function(){this.windowElement=$("#RealTimeBrowserDataContainer");},destroyDOM:function(){},initializeEvent:function(){this.windowElement.bind("click",this.onWindowElementClick.bindAsEventListener(this));},onWindowElementClick:function(a){$("#RealTimeBrowserDataContainer").fadeOut(1000);},destroyEvent:function(){},render:function(){var f=Globals.browserDimensions();var c=f.width-this.windowElement.width()-10;var e=Globals.getScrollPosition();var a=$(document).height();var b=f.height+e.y-10;this.ie6FilterIFrame=Globals.addIE6Filter(this.windowElement.width(),this.windowElement.height(),c,top);this.windowElement.show();this.showTimer=FunctionExt.defer(function(){$("#RealTimeBrowserDataContainer").fadeOut(1000);clearTimeout(this.showTimer);this.showTimer=null;},5000,this);},dispose:function(){this.destroyEvent();}});