var AiOBox=Elong.Control.AiOBox;AiOBox=Class.create();Object.extend(AiOBox.prototype,{name:"AiOBox",windowElement:null,timeout:null,errtimeout:null,resultData:null,selectItem:null,currentCity:null,hotCacheList:null,dataCacheList:null,KeyCode:{Left:37,Up:38,Right:39,Down:40,Del:46,Tab:9,Return:13,Esc:27,Command:188,PageUp:33,PageDown:34,BackSpace:8,Tab:9},m_Hot:new Template('<div style="width:#{HotWidth}px;" class="com_hotresults"><div style="width:100%;"><div class="hotel_near">#{HotData}</div></div><div class="clear"></div><div class="com_cbox_b com_cbox_lt"></div><div class="com_cbox_b com_cbox_rt"></div><div class="com_cbox_b com_cbox_lb"></div><div class="com_cbox_b com_cbox_rb"></div><div class="clear"></div></div>'),m_Result:new Template('<div style="width:#{DataWidth}px;position:relative;" class="com_results"><div style="width: 100%;">#{Default}<ul method="ulData">#{Data}</ul></div><div class="clear"></div><div class="com_cbox_b com_cbox_lt"></div><div class="com_cbox_b com_cbox_rt"></div><div class="com_cbox_b com_cbox_lb"></div><div class="com_cbox_b com_cbox_rb"></div><div class="clear"></div></div>'),options:{eventElement:null,lang:"cn",cityId:"0101",onSelect:null,onClose:null,hotWidth:300,hotHeight:138,searchWidth:260,hotData:null,cityData:null,colLen:4,maxLen:10,enableSearch:true,delay:200,isJsonp:0,resultNextId:"",searchUrl:"http://hotel.elong.com/keywordssuggest.html",hotUrl:"http://hotel.elong.com/hotsuggest.html",aioType:0},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.hotCacheList=new Array();this.eventElement.attr("datacheck","");this.eventElement.attr("selectIndex",-1);this.eventElement.unbind("click");this.eventElement.unbind("keyup");this.eventElement.bind("click",this.onInputClick.bindAsEventListener(this));this.eventElement.bind("keyup",this.onInputKeyUp.bindAsEventListener(this));this.setHotSuggest(this.cityId);},getSelect:function(){return this.selectCity;},setHotSuggest:function(a){if(!String.isNullOrEmpty(a)){if(this.eventElement!=null){var c=false;for(var b=0;b<this.hotCacheList.length;b++){if(this.hotCacheList[b].CityId==this.cityId){this.currentCity=this.hotCacheList[b];c=true;break;}}if(!c){simpleAjax.callBack(this.hotUrl,"cityId="+this.cityId+"&language="+this.lang,function(e){var d={CityId:this.cityId,Data:e};this.hotCacheList.push(d);this.currentCity=d;}.bind(this),true,"get",(this.isJsonp=="1")?"jsonp":"json");}}}},destroyDOM:function(){this.windowElement=null;this.contentEndRegion=null;this.options=null;},initializeEvent:function(){if(this.windowElement){this.windowElement.bind("click",this.onClickRegion.bindAsEventListener(this));this.windowElement.bind("mouseout",this.onMouseOutRegion.bindAsEventListener(this));this.windowElement.bind("mouseover",this.onMouseOverRegion.bindAsEventListener(this));FunctionExt.defer(this.onOutClick.bindAsEventListener(this),100);}},destroyEvent:function(){this.windowElement.unbind("click");this.windowElement.unbind("mouseout");this.windowElement.unbind("mouseover");},buildHtml:function(keyword){var temp=encodeURIComponent(keyword.toLowerCase());var url=this.searchUrl;if(this.isJsonp==0){var appPath="";var host=window.location.host;if(host.toLowerCase().indexOf("travel.elong")>-1){var path=window.location.pathname;var pathtemp=path.split("/");if(pathtemp.length>1){appPath="/"+pathtemp[1];}}url=appPath+"hotsuggest.html";}if(this.windowElement){this.windowElement.remove();}this.contentEndRegion=$("#m_contentend");this.windowElement=$('<div  style="display:none; position: absolute; z-index: 2000;"></div>').appendTo(this.contentEndRegion);var defaultHtml="<div class='tuijian'><p method='fromArea' keyword='"+keyword+"'><tt class='poi'></tt>地点在<strong> "+keyword+"</strong> 附近的Hotel</p><p method='fromName' keyword='"+keyword+"'><tt class='name'></tt>Title含 <strong>"+keyword+"</strong> 的Hotel</p></div>";this.windowElement.html(this.m_Result.eval({DataWidth:this.searchWidth,Default:defaultHtml,Data:""}));this.initializeEvent();this.render();var queryString="q="+temp+"&limit="+this.maxLen+"&cityid="+this.cityId+"&language="+this.lang;if(this.aioType==2){queryString+="&type=5,9";}else{if(this.aioType==1){queryString+="&type=1,2,3,6,99";}}simpleAjax.callBack(url,queryString,function(data){this.eventElement[0]["Data"]=null;if(data!=null&&data.length>0){this.eventElement.attr("TypeId","");this.eventElement.removeAttr("firstSType");this.resultData=data||[];this.selectItem=this.resultData[0];this.eventElement[0]["Data"]=this.resultData[0];this.eventElement.attr("firstSType",this.resultData[0].Type);this.eventElement.attr("firstSPId",this.resultData[0].PropertiesId);if(!String.isNullOrEmpty(this.resultData[0].Lat)&&!String.isNullOrEmpty(this.resultData[0].Lng)){this.eventElement.attr("firstSLat",this.resultData[0].Lat);this.eventElement.attr("firstSLng",this.resultData[0].Lng);}if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}var dataSb=new StringBuilder();for(var i=0;i<this.resultData.length;i++){var termArr=new Array();termArr=keyword.split(" ");var hightResult=this.resultData[i].Name;for(var j=0;j<termArr.length;j++){if($.trim(termArr[j]).length>0){hightResult=this.highlight(hightResult,$.trim(termArr[j]));}}var highName=hightResult;dataSb.append(' <li method="liData" data="'+i+'" class="ac_odd"><span method="spanData" data="'+i+'" typeid="'+this.resultData[i].Type+'">'+highName+"</span></li>");}this.windowElement.html(this.m_Result.eval({DataWidth:this.searchWidth,Default:defaultHtml,Data:dataSb.toString()}));this.windowElement.attr("winstyle","data");}else{this.eventElement.removeAttr("firstSType");this.eventElement.removeAttr("firstSPId");this.eventElement.removeAttr("firstSLat");this.eventElement.removeAttr("firstSLng");}}.bind(this),true,"GET",(this.isJsonp=="1")?"jsonp":"json");},buildHotHtml:function(){this.reloadData();if(this.windowElement){this.windowElement.remove();}this.contentEndRegion=$("#m_contentend");this.windowElement=$('<div style="display:none; position: absolute; z-index: 2000;"></div>').appendTo(this.contentEndRegion);var hotNameSb=new StringBuilder();var hotDataSb=new StringBuilder();if(this.currentCity!=null&&!Object.isNull(this.currentCity.Data)&&this.currentCity.Data.length>0){for(var i=0;i<this.currentCity.Data.length;i++){var t=this.currentCity.Data[i].Type;if(this.aioType==1&&(t==1||t==2||t==3)){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}else{if(this.aioType==2&&t==5){if(this.currentCity.Data[i].TypeNameList.length>0){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}else{this.windowElement.remove();return false;}}}if(this.aioType==0){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}}if(String.isNullOrEmpty(hotDataSb.toString())){this.windowElement.remove();return false;}this.windowElement.html(this.m_Hot.eval({HotData:hotDataSb.toString(),HotWidth:this.hotWidth}));}this.windowElement.attr("winstyle","hot");},highlight:function(b,a){return b.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+a.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>");},reloadData:function(){if(this.windowElement){this.windowElement.remove();if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}}},onInputClick:function(a){if(!Object.isNull(this.currentCity)&&this.windowElement==null){this.buildHotHtml();this.initializeEvent();this.render();this.eventElement.select();}},onInputKeyUp:function(b){if(!this.enableSearch){return;}var a=Event.element(b);if(this.windowElement&&this.windowElement.attr("winstyle")=="data"){var d=this.windowElement.find("ul[method='ulData']");var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");switch(b.keyCode){case this.KeyCode.Up:c.removeClass("ac_over");if(c.prev("li").length>0){c.prev("li").addClass("ac_over");}else{this.windowElement.find("ul[method='ulData'] li:last").addClass("ac_over");}d.scrollTop((c.offset().top-d.offset().top)<d.height()-30&&(c.offset().top-d.offset().top)>0?(c.offset().top-d.offset().top):c.offset().top);var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;case this.KeyCode.Down:c.removeClass("ac_over");if(c.next("li").length>0){c.next("li").addClass("ac_over");}else{this.windowElement.find("ul[method='ulData'] li:first").addClass("ac_over");}d.scrollTop((c.offset().top-d.offset().top)>d.height()-30?0:(c.offset().top-d.offset().top));var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;case this.KeyCode.Return:var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;default:clearTimeout(this.timeout);this.timeout=setTimeout(function(){this.reBuildData(a);}.bind(this),this.delay);}}else{switch(b.keyCode){case this.KeyCode.Up:case this.KeyCode.Down:case this.KeyCode.Left:case this.KeyCode.Right:case this.KeyCode.Return:break;default:clearTimeout(this.timeout);this.timeout=setTimeout(function(){this.reBuildData(a);}.bind(this),this.delay);}}b.stopPropagation();},reBuildData:function(b){var a=b;if(!String.isNullOrEmpty(this.cityId)){if(String.isNullOrEmpty(a.val())){this.eventElement.removeAttr("firstSType");this.eventElement.removeAttr("firstSPId");this.eventElement.removeAttr("firstSLat");this.eventElement.removeAttr("firstSLng");this.buildHotHtml();this.initializeEvent();this.render();}else{this.buildHtml(a.val());}}},onOutClick:function(){$(document).bind("click",function(b){var a=Event.element(b);if(this.windowElement!=null&&this.windowElement.find("*").index(a)==-1&&this.eventElement[0]!=a[0]){this.dispose();}}.bindAsEventListener(this));},selectData:function(a){if(!String.isNullOrEmpty(a.attr("data"))){var d;if(this.windowElement.attr("winstyle")=="hot"){var c=a.attr("data").split("|");var b=decodeURIComponent(this.currentCity.Data[c[0]].TypeNameList[c[1]].Name);this.eventElement.val(b);this.eventElement.attr("datacheck",a.attr("data"));d=this.currentCity.Data[c[0]].TypeNameList[c[1]];d.Accept=true;}else{var c=a.attr("data");var b=this.resultData[c].Name;this.eventElement.val(b);this.eventElement.attr("datacheck",c);this.eventElement.attr("selectIndex",c);d=this.resultData[c];d.Accept=true;}this.selectItem=d;this.eventElement[0]["Data"]=d;this.eventElement.attr("TypeId",d.Type);if(this.onSelect){this.onSelect(this.eventElement,d);}this.eventElement.focus();if(!String.isNullOrEmpty(this.resultNextId)){}}},onClickRegion:function(b){var a=Event.element(b);var c=a.attr("method");if(c==null||c==""){a=a.parent();c=a.attr("method");}switch(c){case"hotData":this.selectData(a);this.directSearch(this.selectItem);return;case"liData":case"spanData":this.selectData((c=="liData")?a:a.parent());this.directSearch(this.selectItem);return;case"fromArea":if(this.directSearch){this.eventElement.attr("selectIndex","-5");this.directSearch({Name:a.attr("keyword"),Type:99,PropertiesId:0,Lat:0,Lng:0,Accept:true});}return;case"fromName":if(this.directSearch){this.eventElement.attr("selectIndex","-6");this.directSearch({Name:a.attr("keyword"),Type:9,PropertiesId:0,Lat:0,Lng:0,Accept:true});}return;case"close":this.dispose();return;default:this.dispose();return;}},onMouseOverRegion:function(b){var a=Event.element(b);if(this.outTimer!=null){clearTimeout(this.outTimer);this.outTimer=null;}this.removeAllClass(a);if(a.is("li")||a.parent().is("li")){var c=a.is("li")?a:a.parent();c.addClass("ac_over");}},removeAllClass:function(a){if(a.is("li")||a.parent().is("li")){var b=a.is("li")?a:a.parent();b.removeClass("ac_over");b.siblings("li[class*=ac_over]").removeClass("ac_over");}},onMouseOutRegion:function(a){},render:function(){if(this.windowElement){var d=this.eventElement.offset().top+this.eventElement.height()+6;var b=this.eventElement.offset().left;var c=Globals.getScrollPosition();var a=Globals.browserDimensions();if(a.width-(this.eventElement.offset().left-c.x)>this.windowElement.width()){this.windowElement[0].style.top=d+"px";this.windowElement[0].style.left=b+"px";}else{this.windowElement[0].style.top=d+"px";b=b-this.windowElement.width()+this.eventElement.width();this.windowElement[0].style.left=b+"px";}this.ie6FilterIFrame=Globals.addIE6Filter(this.windowElement.width(),this.windowElement.height(),b,d,1999);this.windowElement.show();}},dispose:function(){if(this.windowElement){this.windowElement.hide();FunctionExt.defer(function(){if(this.windowElement){Globals.closeIE6Fliter(this.ie6FilterIFrame);if(this.windowElement.attr("winstyle")=="data"){if(this.onClose!=null){this.onClose(this.eventElement,this.windowElement);}}this.windowElement.remove();this.destroyEvent();this.destroyDOM();}}.bind(this),500);}}});var AiOWindow=Elong.Control.AiOWindow;AiOWindow=Class.create();Object.extend(AiOWindow.prototype,{name:"AiOWindow",aioSearch:null,options:{eventElement:null,lang:"cn",resultNextId:"",cityId:"0101",onSelect:null,directSearch:null,onClose:null,hotWidth:300,hotHeight:138,searchWidth:260,delay:200,maxLen:10,enableSearch:true,isJsonp:0,searchUrl:"http://hotel.elong.com/keywordssuggest.html",hotUrl:"http://hotel.elong.com/hotsuggest.html",aioType:0},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.aioSearch=new AiOBox(a);},getSelect:function(){return this.aioSearch.getSelect();},setHotSuggest:function(a){this.aioSearch.setHotSuggest();}});function Hashtable(){this._hash={};this._count=0;this._keys=new Array();this.add=function(a,b){if(this._hash.hasOwnProperty(a)){return false;}else{this._hash[a]=b;this._keys.push(a);this._count++;return true;}};this.remove=function(a){delete this._hash[a];this._keys.remove(a);this._count--;};this.count=function(){return this._count;};this.items=function(a){if(this.contains(a)){return this._hash[a];}};this.values=function(){var d=new Array();for(var a=0;a<this._keys.length;a++){var b=this.items(this._keys[a]);var c={I:this._keys[a],X:b.lng,Y:b.lat};d.push(c);}return d;};this.keys=function(){return this._keys;};this.contains=function(a){return this._hash.hasOwnProperty(a);};this.clear=function(){this._hash={};this._count=0;this._keys=new Array();};}function checkHover(a,b){if(getEvent(a).type=="mouseover"){return !contains(b,getEvent(a).relatedTarget||getEvent(a).fromElement)&&!((getEvent(a).relatedTarget||getEvent(a).fromElement)===b);}else{return !contains(b,getEvent(a).relatedTarget||getEvent(a).toElement)&&!((getEvent(a).relatedTarget||getEvent(a).toElement)===b);}}function contains(b,a){if(b.contains){return b!=a&&b.contains(a);}else{return !!(b.compareDocumentPosition(a)&16);}}function getEvent(a){return a||window.event;}var ListRightMapClient=Elong.Page.ListRightMapClient;ListRightMapClient=Class.create();Object.extend(ListRightMapClient.prototype,{name:"ListRightMapClient",SearchRequestInfo:ListController.AjaxInfo.SearchRequestInfo,hashHotel:new Hashtable(),HotelsMapData:null,PoiMapData:null,SidebarMap:$("#sidebarMap"),MapTop:$("#sidebarMap").offset().top,ZoomOrMoveChange:false,fixMap:false,MoveNum:0,initialize:function(b){Object.extend(Object.extend(this,this.options),b);this.hotelListMapData=new Array();var a=!String.isNullOrEmpty(this.SearchRequestInfo.NationalCityName)?this.SearchRequestInfo.NationalCityName:this.SearchRequestInfo.CityName;if(String.isNullOrEmpty(a)){a="北京";}this.mapSource=new BMap.Map(document.getElementById("rightMap"),{enableMapClick:false});this.mapSource.centerAndZoom(a,10);this.mapSource.disableDoubleClickZoom();this.mapSource.disableScrollWheelZoom();this.mapSource.addControl(new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_ZOOM}));this.reloadMapData();this.RemarkPoiOnMap();this.RemarkHotelsOnMap(this.getShowMapHotels());this.mouseEvent();$(window).bind("scroll",function(){var c=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(c>=this.MapTop&&c<($("#seohotpoi").offset().top-this.SidebarMap.outerHeight()+220)){this.SidebarMap.attr("class","sidebarMap detailFix");}else{this.SidebarMap.attr("class","sidebarMap");}this.ScorllAndRedrawMap();}.bindAsEventListener(this));FunctionExt.defer(function(){$("div.anchorBL").hide();$("span[_cid='1']").hide();},800);this.mapSource.addEventListener("zoomend",this.ChangeZoomOrBound.bind(this));this.mapSource.addEventListener("moveend",function(){if(this.MoveNum>2){this.mapSource.enableScrollWheelZoom();}this.MoveNum=this.MoveNum+1;}.bind(this));this.mapSource.addEventListener("mouseout",function(){this.mapSource.disableScrollWheelZoom();}.bind(this));},mouseEvent:function(){var a=this;$("#hotelList").children().bind("mouseover",function(c){if(checkHover(c,this)){var b=a.getOverLayerById($(this).attr("id").replace("hotel",""));if(b==null){return;}b.setZIndex(100);$("#label_"+b.id).attr("class","mapIconHotel5");b.setOffset(new BMap.Size(-10,-29));}});$("#hotelList").children().bind("mouseout",function(c){if(checkHover(c,this)){var b=a.getOverLayerById($(this).attr("id").replace("hotel",""));if(b==null){return;}b.setZIndex(10);$("#label_"+b.id).attr("class","mapIconHotel6");b.setOffset(new BMap.Size(-10,-29));}});},getOverLayerById:function(c){var a=this.mapSource.getOverlays();if(a!=null&&a.length>0){for(var b=0;b<a.length;b++){if(a[b].id==c){return a[b];break;}}}return null;},ChangeZoomOrBound:function(){this.ZoomOrMoveChange=true;},RemoveAllOverlays:function(){this.mapSource.clearOverlays();},Reload:function(){this.hashHotel.clear();this.RemoveAllOverlays();this.reloadMapData();this.RemarkPoiOnMap();this.RemarkHotelsOnMap(this.getShowMapHotels());this.mouseEvent();},ScorllAndRedrawMap:function(){this.RemarkHotelsOnMap(this.getShowMapHotels());},RemarkHotelsOnMap:function(c){if(c==null||c.length==0){return;}if(this.hashHotel.count()>0){for(var b=0;b<this.hashHotel.count();b++){$("#label_"+this.hashHotel.keys()[b]).parent().hide();}}for(var a=0;a<c.length;a++){if(Object.isNull(c[a])){continue;}if(!this.hashHotel.contains(c[a].I)){this.hashHotel.add(c[a].I,{lng:c[a].X,lat:c[a].Y});this.addLabel(c[a]);}else{$("#label_"+c[a].I).parent().show();}}},RemarkPoiOnMap:function(){if(this.PoiMapData==null||this.PoiMapData.X==0||this.PoiMapData.Y==0){return;}var d=new BMap.Point(this.PoiMapData.X,this.PoiMapData.Y);var c={position:d,offset:new BMap.Size(-10,-29)};var a="<div id='label_poi_"+this.PoiMapData.I+"' class='mapIconHotel3'><div class='xinxi' title='"+this.PoiMapData.N+"'>"+this.PoiMapData.N+"<span class='s1'></span></div></div>";var b=new BMap.Label(a,c);b.id=this.PoiMapData.I;b.setStyle({background:"none",border:"0"});b.setZIndex(50);this.mapSource.addOverlay(b);this.mapSource.setCenter(d);},addLabel:function(hotelData){var point=new BMap.Point(hotelData.X,hotelData.Y);var opts={position:point,offset:new BMap.Size(-10,-29)};var content="<div id='label_"+hotelData.I+"' class='mapIconHotel6'><div class='xinxi' title='"+hotelData.N+"'>"+hotelData.N+"<span class='s1'></span></div></div>";var that=this;var label=new BMap.Label(content,opts);label.id=hotelData.I;label.setStyle({background:"none",border:"0"});label.addEventListener("mouseover",function(){this.setZIndex(100);$("#label_"+this.id).attr("class","mapIconHotel5");this.setOffset(new BMap.Size(-10,-29));});label.addEventListener("mouseout",function(){this.setZIndex(10);$("#label_"+this.id).attr("class","mapIconHotel6");this.setOffset(new BMap.Size(-10,-29));});label.addEventListener("click",function(){var hotelUrl=new Template(ListController.UrlConfig.Hotel_DetailDynamic).eval({hotelId:this.id,pageType:"hotel"});if(this.id.length>8){hotelUrl=new Template(ListController.UrlConfig.HotelUnsignedDetailUrl).eval({hotelId:this.id});}window.open(hotelUrl);});this.mapSource.addOverlay(label);},convertFromSystem:function(d,c){if(c){var a=0.0065;var b=0.006;if(d){d.lat+=b;d.lng+=a;}}return d;},reloadMapData:function(){var i=function(k){var l=(k.indexOf(".")>0&&k.indexOf("."))||(k.indexOf("-")>0&&k.indexOf("-"))||(k.indexOf("(")>0&&k.indexOf("("))||(k.indexOf("（")>0&&k.indexOf("（"))||k.length;return k.substring(0,l);};var b=new Array();var j=new Array();var a=this.SearchRequestInfo.CityName;$("#hotelList").find("a[method = 'showMap']").each(function(k){var l=$(this).attr("title").replace("Map","");l=i(l);if(l.length>5){l=l.replace(a,"");}if(l.length>5){var m=/大Hotel|Hotel式公寓|商务Hotel|度假Hotel|高档公寓|Hotel|宾馆|大厦|大饭店|饭店|公寓|客栈|会所|旅店|生活馆/g;l=l.replace(m,"");}l=i(l);b.push({I:$(this).attr("hotelid"),N:l,X:$(this).attr("lng"),Y:$(this).attr("lat"),T:($("#hotel"+$(this).attr("hotelid")).offset().top),H:$("#hotel"+$(this).attr("hotelid")).outerHeight()});j.push({lat:$(this).attr("lat"),lng:$(this).attr("lng")});});this.HotelsMapData=b;var c=this.SearchRequestInfo.StartLat;var d=this.SearchRequestInfo.StartLng;var e=this.SearchRequestInfo.PoiId;var f="";if(((this.SearchRequestInfo.ReturnKeywordsType=="PoiType")&&(!String.isNullOrEmpty(this.SearchRequestInfo.ReturnKeywords)))&&this.SearchRequestInfo.StartLat>0&&this.SearchRequestInfo.StartLng>0){f=this.SearchRequestInfo.ReturnKeywords;}else{if((!String.isNullOrEmpty(this.SearchRequestInfo.PoiName))&&this.SearchRequestInfo.StartLat>0&&this.SearchRequestInfo.StartLng>0){f=this.SearchRequestInfo.PoiName;}}var g=this.convertFromSystem({lat:parseFloat(c),lng:parseFloat(d)},true);this.PoiMapData={I:e,N:f,X:g.lng,Y:g.lat};if(c!=0&&d!=0){j.push({lat:g.lat,lng:g.lng});}if(j.length>0){FunctionExt.defer(function(){this.mapSource.setViewport(j);}.bind(this),500);}},getShowMapHotels:function(){var b=new Array();var c=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;var d=document.documentElement.clientHeight;if(this.HotelsMapData!=null&&this.HotelsMapData.length>0){for(var a=0;a<this.HotelsMapData.length;a++){if((this.HotelsMapData[a].T>c&&(this.HotelsMapData[a].T+this.HotelsMapData[a].H)<(c+d))||(this.HotelsMapData[a].T<c&&(this.HotelsMapData[a].T+this.HotelsMapData[a].H-20)>c)||((this.HotelsMapData[a].T+this.HotelsMapData[a].H)>(c+d)&&(this.HotelsMapData[a].T+20)<(c+d))){b.push(this.HotelsMapData[a]);}}}return b;}});var HotSuggestAllWindow=Elong.Control.HotSuggestAllWindow;HotSuggestAllWindow=Class.create();Object.extend(HotSuggestAllWindow.prototype,{name:"HotSuggestAllWindow",timeout:null,errtimeout:null,cacheHotSuggestAllData:null,hotSuggestAllData:null,searchInput_cn:'<a class="com_close right" href="#?" onfocus="this.blur()" method="close" title="Close"></a>',searchInput_en:'<a class="com_close right" href="#?" onfocus="this.blur()" method="close" title="close"></a>',hotSuggestDataTemplate:new Template('<ul class="caty pt10 clx">#{TypeListData}</ul><div class="box2"><div class="group"><ul class="clx">#{TagListData}<div class="clear"></div></ul></div><div class="p10 links_box">#{childsData}</div>'),hotSuggestDataTemplate3:new Template('<ul class="caty pt10 clx">#{TypeListData}</ul><div class="box2"><div class="group groupno"><ul class="clx">#{TagListData}<div class="clear"></div></ul></div><div class="p10 links_box">#{childsData}</div>'),hotSuggestDataTemplate2:new Template('<ul class="caty pt10 clx">#{TypeListData}</ul><div class="box2"><div class="p10 links_box">#{childsData}</div>'),containerTemplate:new Template('<div class="poi-popup"><div class="cnt"><div class="p10"><p>#{SearchInput}</p><div id="HotSuggestContainer">#{HotSuggestData}</div></div><div class="clear"/></div></div>'),HotSuggestAllUrl:"http://hotel.elong.com/hotsuggestall.html",HotSuggestAllUrlEn:"http://hotel.elong.net/hotsuggestall.html",options:{eventElement:null,lang:"CN",cityId:"0101",onClose:null,url:"",onSubmit:null,winType:-1},paramData:{Type:"",Name:"",PropertiesId:"",Lat:"",Lng:""},allInOneCtrl:null,initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.initializeDOM();this.getAllHotSuggestData();this.initializeEvent();},initializeDOM:function(){this.contentRegion=$("#m_contentedHotSugstAll");},destroyDOM:function(){this.windowElement=null;this.contentRegion=null;this.HotSuggestContainer=null;},initializeEvent:function(){if(this.windowElement){this.windowElement.unbind("click");this.windowElement.bind("click",this.onClickRegion.bindAsEventListener(this));FunctionExt.defer(this.onOutClick.bindAsEventListener(this),100);}},destroyEvent:function(){},render:function(){if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}if(this.windowElement){var d=this.eventElement.offset().top+this.eventElement.height()+6;var b=this.eventElement.offset().left;var c=Globals.getScrollPosition();var a=Globals.browserDimensions();if(a.width-(this.eventElement.offset().left-c.x)>this.windowElement.width()){this.windowElement[0].style.top=d+"px";this.windowElement[0].style.left=b+"px";}else{this.windowElement[0].style.top=d+"px";b=b-this.windowElement.width()+this.eventElement.width();this.windowElement[0].style.left=b+"px";}this.ie6FilterIFrame=Globals.addIE6Filter(this.windowElement.width(),this.windowElement.height(),b,d,1998);this.windowElement.show();}},onClickRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"close":this.hideWin();return;case"typeData":this.windowElement.find("ul[method='typeData'] li").removeClass("on");a.addClass("on");this.buildHtml(a.attr("index"),0);return false;case"tagData":this.windowElement.find("ul[method='tagData'] li").removeClass("on");a.addClass("on");this.buildHtml(a.attr("typeIndex"),a.attr("index"));return false;case"leafData":this.paramData.Type=parseInt(a.attr("typeId"));this.paramData.Name=a.html();this.paramData.PropertiesId=a.attr("proptiesId");this.paramData.Lat=a.attr("lat");this.paramData.Lng=a.attr("lng");if(this.onSubmit){this.onSubmit(this.paramData);this.hideWin();}return;case"submit":if(this.onSubmit){this.onSubmit(this.paramData);this.hideWin();}return;}},onOutClick:function(){$(document).bind("click",function(c){var a=$("#m_contentend");var b=Event.element(c);if(this.windowElement!=null&&this.windowElement.find("*").index(b)==-1&&this.eventElement[0]!=b[0]&&a.find("*").index(b)==-1){this.hideWin();}}.bindAsEventListener(this));},initContainer:function(){this.contentRegion.html("");this.windowElement=$('<div style="display:none; position: absolute; z-index: 1999;"></div>').appendTo(this.contentRegion);var lineBox='<ul class="caty pt10 clx"></ul><div class="box2"><div class="group"><ul class="clx">Loading...<div class="clear"></div></ul></div><div class="p10 links_box">Loading...</div>';if(this.lang=="CN"){this.windowElement.html(this.containerTemplate.eval({SearchInput:this.searchInput_cn,HotSuggestData:lineBox}));}else{this.windowElement.html(this.containerTemplate.eval({SearchInput:this.searchInput_en,HotSuggestData:lineBox}));}this.HotSuggestContainer=this.windowElement.find("#HotSuggestContainer");},buildHtml:function(typeIndex,tagIndex){var typeListDataHtml="";var tagListDataHtml="";var leafDataHtml="No Data";if(this.hotSuggestAllData!=null&&this.hotSuggestAllData.length>0){switch(this.winType){case 1:var sbLeafDataHtml=new StringBuilder();if(this.hotSuggestAllData[0].SuggestTagDataNodes!=null&&this.hotSuggestAllData[0].SuggestTagDataNodes.length>0){for(var i=0;i<this.hotSuggestAllData[0].SuggestTagDataNodes.length;i++){if(this.hotSuggestAllData[0].SuggestTagDataNodes[i].SuggestDatas!=null&&this.hotSuggestAllData[0].SuggestTagDataNodes[i].SuggestDatas.length>0){sbLeafDataHtml.append('<div class="Htitle">'+this.hotSuggestAllData[0].SuggestTagDataNodes[i].TagName+'</div><div class="box2"><div class="p10 links_box">');var leafDataNodes=this.hotSuggestAllData[0].SuggestTagDataNodes[i].SuggestDatas;for(var k=0;k<leafDataNodes.length;k++){sbLeafDataHtml.append('<a href="#?" typeId="'+this.hotSuggestAllData[0].TypeId+'" lat="'+leafDataNodes[k].GoogleLat+'" lng="'+leafDataNodes[k].GoogleLng+'" proptiesId="'+leafDataNodes[k].PropertiesId+'" method="leafData">'+leafDataNodes[k].DataName+"</a>");}sbLeafDataHtml.append('<div class="clear"/></div></div>');}}sbLeafDataHtml.append('<div class="clear"/>');}this.HotSuggestContainer.html(sbLeafDataHtml.toString());break;case -1:case 0:case 2:case 3:case 4:case 5:typeListDataHtml=this.buildTypeDataHtml(typeIndex);tagListDataHtml=this.buildTagDataHtml(typeIndex,tagIndex);leafDataHtml=this.buildLeafDataHtml(typeIndex,tagIndex);if(this.HotSuggestContainer){if(this.hotSuggestAllData[typeIndex].SuggestTagDataNodes.length==1){this.HotSuggestContainer.html(this.hotSuggestDataTemplate2.eval({TypeListData:typeListDataHtml,TagListData:tagListDataHtml,childsData:leafDataHtml}));}else{this.HotSuggestContainer.html(this.hotSuggestDataTemplate.eval({TypeListData:typeListDataHtml,TagListData:tagListDataHtml,childsData:leafDataHtml}));}}break;}}else{if(this.HotSuggestContainer){this.HotSuggestContainer.html(leafDataHtml);}}},buildTypeDataHtml:function(c){var b=new StringBuilder();for(var a=0;a<this.hotSuggestAllData.length;a++){if(a!=0){b.append('<li class="line">|</li>');}if(a==c){b.append('<li class="on"><a href="#?" index="'+a+'" method="typeData">'+this.hotSuggestAllData[a].TypeName+"</a><span></span></li>");}else{b.append('<li><a href="#?" index="'+a+'" method="typeData">'+this.hotSuggestAllData[a].TypeName+"</a></li>");}}return b.toString();},buildTagDataHtml:function(e,d){var b=new StringBuilder();if(this.hotSuggestAllData==null||this.hotSuggestAllData.length==0||d>this.hotSuggestAllData[e].SuggestTagDataNodes.length){return"";}var c=this.hotSuggestAllData[e].SuggestTagDataNodes;for(var a=0;a<c.length;a++){if(a==d){b.append('<li class="on" typeIndex="'+e+'" index="'+a+'" method="tagData">'+c[a].TagName+"</li>");}else{b.append('<li typeIndex="'+e+'" index="'+a+'" method="tagData">'+c[a].TagName+"</li>");}}return b.toString();},buildLeafDataHtml:function(g,e){var c=new StringBuilder();var f=this.hotSuggestAllData[g].TypeId;var d=this.hotSuggestAllData[g].SuggestTagDataNodes;if(d==null||e>d.length-1){return"";}var b=d[e].SuggestDatas;for(var a=0;a<b.length;a++){c.append('<a href="#?" typeId="'+f+'" lat="'+b[a].GoogleLat+'" lng="'+b[a].GoogleLng+'" proptiesId="'+b[a].PropertiesId+'" method="leafData">'+b[a].DataName+"</a>");}c.append('<div class="clear"/>');return c.toString();},buildLeafDataHtml2:function(g){var d=new StringBuilder();var f=this.hotSuggestAllData[g].TypeId;var e=this.hotSuggestAllData[g].SuggestTagDataNodes;for(var b=0;b<e.length;b++){var c=e[b].SuggestDatas;for(var a=0;a<c.length;a++){d.append('<a href="#?" typeId="'+f+'" lat="'+c[a].GoogleLat+'" lng="'+c[a].GoogleLng+'" proptiesId="'+c[a].PropertiesId+'" method="leafData">'+c[a].DataName+"</a>");}}return d.toString();},dispose:function(){},hideWin:function(){if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}this.windowElement.hide();return false;},showWin:function(){if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}if(this.winType!=3){this.hotSuggestAllData=this.screenDataFromCache(this.cacheHotSuggestAllData,this.winType);}this.buildHtml(0,0);this.initializeEvent();this.render();},screenDataFromCache:function(a,c){var d=null;if(a!=null&&a.length>0){d=new Array();for(var b=0;b<a.length;b++){switch(c){case 0:if(a[b].TypeId==3||a[b].TypeId==6){d.push(a[b]);}break;case 1:if(a[b].TypeId==1){d.push(a[b]);}break;case 2:if(a[b].TypeId==2){d.push(a[b]);}break;case 4:if(a[b].TypeId==77){d.push(a[b]);}break;case 5:if(a[b].TypeId==79){d.push(a[b]);}break;case 3:break;default:d=a;break;}}}return d;},resetOptionsData:function(b,c,a){this.eventElement=b;this.winType=c;if(!Object.isNull(a)){this.hotSuggestAllData=a;}},getAllHotSuggestData:function(){if(this.cacheHotSuggestAllData==null||this.cacheHotSuggestAllData.length<=0){this.initContainer();this.render();this.initializeEvent();var a="http://"+window.location.host+this.url;simpleAjax.callBack(a,"cityid="+this.cityId+"&language="+this.lang,function(b){if(b!=null&&b.length>0){this.cacheHotSuggestAllData=b||[];this.showWin();}}.bind(this),true,"GET","jsonp");}}});var RoomPlayer=Elong.Control.RoomPlayer;RoomPlayer=Class.create();Object.extend(RoomPlayer.prototype,{name:"RoomPlayer",HotelInfoList:new Array(),CannelHtml:'<p class="popBoxtitle mb5"><span class=icon01></span>免费取消</p><p>订单提交后可随时免费取消/变更。</p>',DanbaoHtml:ListController.Language.toUpperCase()!="EN"?'<p class="mb10">Room type太抢手了！Hotel需要您提供信用卡担保预订。</p><p class="l_black">什么叫“信用卡担保”？</p><p class="l_black">我们会预先冻结相应担保金，实际Check in后，担保金会在您离店后3-5个工作日内解冻。</p>':'<p class="mb10">This room is in great demand! The hotel requires your payment details to secure your reservation.</p><p class="l_black">What is credit card guarantee?</p><p class="l_black">You will not be charged for your room until you check out. To guarantee your booking we need to temporarily freeze an amount (usually 1 night room charge) from your credit card that will be released within 3 business days after you check out. Please kindly note that the hotel may require an additional deposit during check-in.</p>',options:{Language:"CN"},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.initializeDOM();this.initializeEvent();},initializeDOM:function(){this.priceTemplate=new Template("<table cellspacing='0' cellpadding='0' border='0' class='sf_average'><thead><tr> <th>&nbsp;</th>#{Title}</tr></thead><tbody><tr>#{List}</tr></tbody></table>#{Reduce}");this.ruleTemplate=new Template("<div class='sf_voucher'>#{hr}#{Rule}</div>");this.ServiceTip=new Template('    <span class="farrow"></span>    <ul class="fuwuzishu">	    <li>及时Confirm 率：<strong>#{c1}</strong>%</li>        <li class="hy"><span class="#{c2}"></span>#{c3}</li>        <li>预订成功率：<strong>#{s1}</strong>%</li>        <li class="hy"><span class="#{s2}"></span>#{s3}</li>        <li> 用户投诉率：<strong>#{u1}</strong>%</li>        <li class="hy"><span class="#{u2}"></span>#{u3}</li>    </ul>');},destroyDOM:function(){},initializeEvent:function(){},destroyEvent:function(){},OnMouseoverHotelDiv:function(evt){var element=Event.element(evt);if($(element).parent().attr("method")=="longcuiPrice"){$(element).parent().mouseover();return;}var method=element.attr("method");if(String.isNullOrEmpty(method)){method=element.parents("[method]").attr("method");}switch(method){case"avgPrice":case"longcuiPrice":var tr=element.parents("li[roomid][rpid]");var hotelId=tr.attr("roomhotelid");var roomid=tr.attr("roomid");var rpid=tr.attr("rpid");var sroomid=tr.attr("sroomid");var ratePlan=this.getRatePlan(hotelId,roomid,sroomid,rpid,method=="longcuiPrice");if(!Object.isNull(ratePlan)){var dayPrice=ratePlan.DayPriceList;var sbTitle=new StringBuilder();var sbList=new StringBuilder();var isReduce=ratePlan.IsReducePromotion&&ratePlan.ReduceAmount>0;var strReduce="";var week=this.Language=="CN"?"第{0}周":"{0} week";for(var i=0;i<dayPrice.length;i++){if(i<7){sbTitle.append(String.format("<th>{0}</th>",dayPrice[i].Week));}if(i%7==0){sbList.append(String.format("<tr><td nowrap='' class='blk'>"+week+"</td>",1+i/7));}var money="#&yen;";var spriceStr=dayPrice[i].SPrice.length>0?String.format("<p><del class='l_black'>{0}</del></p>",dayPrice[i].SPrice):"";sbList.append(String.format("<td>{2}{0}<div class='blk'>{1}</div></td>",dayPrice[i].Price,this.Language=="CN"?dayPrice[i].BreakFast:"",spriceStr));if(i%7==6||i==dayPrice.length-1){sbList.append("</tr>");}}var priceDesc=dayPrice.length>1?this.priceTemplate.eval({Title:sbTitle.toString(),List:sbList.toString(),Reduce:strReduce}):"";var ruleDesc=this.ruleTemplate.eval({hr:dayPrice.length>1?"<hr/>":"",Rule:ratePlan.RuleDesc});var col=dayPrice.length>=7?7:dayPrice.length;if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:priceDesc+ruleDesc,eventElement:element,defer:true});}break;case"coupon":case"cashback":case"reduce":case"promotion":case"cancel":case"danbao":this.showIconTips(element);break;case"moreTips":if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:element.prev().html(),eventElement:element,defer:true});break;case"gift":var divRoomItem=element.parents("li[rpid][roomid]");var hotelId=divRoomItem.attr("roomhotelid");var roomId=divRoomItem.attr("roomid");var rpId=divRoomItem.attr("rpid");var islongcui=divRoomItem.attr("islongcui")=="1";var sroomid=divRoomItem.attr("sroomid");var curRatePlan=this.getRatePlan(hotelId,roomId,sroomid,rpId,islongcui);if(curRatePlan!=null&&!String.isNullOrEmpty(curRatePlan.SupplierActivityList)){var activityHtml="<dl class='morePromotion'><dt>"+(this.Language!="EN"?"Hotel礼物信息：":"Enjoy a gift if you book through elong!")+"</dt><dd>"+curRatePlan.SupplierActivityList+"</dd></dl>";if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:activityHtml,eventElement:element,defer:true,width:400});}evt.preventDefault();break;case"serviceindex":var hotelid=element.attr("hotelid");var hotelData=this.getHotelData(hotelid);if(Object.isNull(hotelData)){return null;}var CityServiceIndex=ListController.AjaxInfo.CityServiceIndex;if(Object.isNull(CityServiceIndex)){return;}var c2,s2,u2,c3,s3,u3;var diffConfirm=hotelData.ServiceIndex.ConfirmRate-CityServiceIndex.ConfirmRate;var diffSuccess=hotelData.ServiceIndex.SuccessRate-CityServiceIndex.SuccessRate;var diffComplain=hotelData.ServiceIndex.ComplaintsRate-CityServiceIndex.ComplaintsRate;c2=this.getRateCss(diffConfirm);s2=this.getRateCss(diffSuccess);u2=this.getRateCss(diffComplain);c3=this.getRateDesc(diffConfirm);s3=this.getRateDesc(diffSuccess);u3=this.getRateDesc(diffComplain);var serviceTip=this.ServiceTip.eval({c1:hotelData.ServiceIndex.ConfirmRate,c2:c2,c3:c3,s1:hotelData.ServiceIndex.SuccessRate,s2:s2,s3:s3,u1:hotelData.ServiceIndex.ComplaintsRate,u2:u2,u3:u3});if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:serviceTip,eventElement:element.find("span[class='sz']"),width:250});break;}},getRateDesc:function(b){var a=["于同城{0}","持平"];var c=b==0?1:0;a=a[c];rate=b==0?"":(b>0?b:-b)+"%";return String.format(a,rate);},getRateCss:function(b){var a=["d","p","g"];var c=b;c=b>0?2:(b==0?1:0);return a[c];},showIconTips:function(d){var n=d.parents("li[rpid][roomid]");var e=n.attr("roomhotelid");var k=n.attr("roomid");var l=n.attr("rpid");var g=d.attr("islongcui")=="1";var m=n.attr("sroomid");var b=this.getRatePlan(e,k,m,l,g);var c=400;if(!Object.isNull(b)){var f="";var j=b.PromotionDesc;if(!String.isNullOrEmpty(j)){j='<div class="sf_voucher"><span class="icon_sale_text mt5" style="cursor:auto; vertical-align:top"></span><span class="sw330">'+j+"</span></div>";}var i=d.attr("method");switch(i){case"cashback":f=b.CashBackDesc;f+=j;break;case"coupon":f=b.CouponDesc;f+=j;break;case"reduce":f=b.ReducePromotionDesc;f+=j;break;case"promotion":f=j;break;case"danbao":f=this.DanbaoHtml;break;case"cancel":c=240;var a=d.attr("cancelType");if(a=="0"){f=this.CannelHtml;}else{if(a=="1"){if(b.IsPrepay){f="<p class=\"popBoxtitle mb5\"><span class='icon02'></span>限时取消</p><p>"+b.PrepayCancelRule+"</p>";}else{f="<p class=\"popBoxtitle mb5\"><span class='icon02'></span>限时取消</p><p>"+b.VouchCancelRule+"</p>";}}else{if(a=="2"){if(b.IsPrepay){f="<p class=\"popBoxtitle mb5\"><span class='icon03 gray'></span>不可取消</p><p>"+b.PrepayCancelRule+"</p>";}else{f="<p class=\"popBoxtitle mb5\"><span class='icon03 gray'></span>不可取消</p><p>"+b.VouchCancelRule+"</p>";}}}}break;}if(!String.isNullOrEmpty(f)){if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:f,eventElement:d,defer:true,width:c});}}},OnClickHotelDiv:function(evt){var element=Event.element(evt);if(element.is("div[class='t4 new_price']")||element.parent("div[class='t4 new_price']").find("span[rpid][roomid]").length>0){element=element.parent("div").find("span[rpid][roomid]");}var method=element.attr("method");switch(method){case"roomUrl":var tr=element.parents("li[rpid][roomid]");var hotelId=tr.attr("roomhotelid");var hotelUrl=new Template(ListController.UrlConfig.Hotel_DetailDynamic).eval({hotelId:hotelId,pageType:"hotel"});var room_url=hotelUrl+(hotelUrl.indexOf("?")==-1?"?":"&")+"roomid="+tr.attr("roomid")+"_"+tr.attr("rpid")+"#iTop";window.open(room_url);break;case"priceUrl":var tr=element;var hotelId=tr.attr("roomhotelid");var hotelUrl=new Template(ListController.UrlConfig.Hotel_DetailDynamic).eval({hotelId:hotelId,pageType:"hotel"});var room_url=hotelUrl+(hotelUrl.indexOf("?")==-1?"?":"&")+"roomid="+tr.attr("roomid")+"_"+tr.attr("rpid")+"#iTop";window.open(room_url);break;case"OpenOrClose":var table=element.parents("li[mark]");if(table.attr("mark")=="close"){table.hide();table.next().show();}else{if(table.attr("mark")=="open"){table.hide();table.prev().show();}}break;}},buildRoomHtml:function(f,g,a,c,p,l){var b=$("#hotelList").children("div[id="+c+"]:last");b.find("#"+c.replace("hotel","load_")).hide();if(a==null){b.append(p);return;}this.addHotelData(a);if(a.HasGroupon){$("#groupOn_"+a.HotelId).show();}var m=["(限量抢购)","(限时抢购)","（限时抢购）","（限量抢购）","(龙萃专享)","（龙萃专享）","（限量抢）","(限量抢)","（限时抢）","(限时抢)","龙萃专享","限量抢购","限时抢购","限量抢","限时抢"];for(var e=0;e<m.length;e++){for(var n=0;n<a.HotelRoomSimpleList.length;n++){a.HotelRoomSimpleList[n].RoomName=a.HotelRoomSimpleList[n].RoomName.replace(m[e],"");if(!Object.isNull(a.HotelRoomSimpleList[n].RatePlanList)){for(var o=0;o<a.HotelRoomSimpleList[n].RatePlanList.length;o++){a.HotelRoomSimpleList[n].RatePlanList[o].RatePlanName=a.HotelRoomSimpleList[n].RatePlanList[o].RatePlanName.replace(m[e],"");}}if(!Object.isNull(a.HotelRoomSimpleList[n].LongCuiRatePlanList)){for(var o=0;o<a.HotelRoomSimpleList[n].LongCuiRatePlanList.length;o++){a.HotelRoomSimpleList[n].LongCuiRatePlanList[o].RatePlanName=a.HotelRoomSimpleList[n].LongCuiRatePlanList[o].RatePlanName.replace(m[e],"");}}}}var d=$.tmpl("roomTemp",{Data:a,Client:this,islogin:f,isLongCui:g,showAllRoom:l,cityNameEn:ListController.AjaxInfo.City.CityNameEn,showPriceImage:ListController.AjaxInfo.IsShowPriceImage});b.append(d);},setHelpTipsHtml:function(d){if(d.WarmTips!=null&&d.WarmTips.length>0){var e=d.WarmTips[0].HelpfullTips;var c="";if(d.WarmTips.length>1){c+="<div style='display:none'><dl class='morePromotion'><dt>"+(this.Language=="CN"?"您可享受更多优惠：":"You can enjoy more promotions:")+"</dt>";for(var b=0;b<d.WarmTips.length;b++){c+="<dd>"+d.WarmTips[b].HelpfullTips+"</dd>";}c+="</dl></div>";c+="<a class=\"more-text\" method='moreTips' href='javascript:;' rel='nofollow'>"+(this.Language=="CN"?"更多":"more")+"</a>";}var a='<span class="hide-text hide-textmvt2" title="'+e+'"><span class="iconCuxiao"></span>'+e+c+"</span>";$("#cuLabel_"+d.HotelId).attr("title",e).show();}},addHotelData:function(a){if(this.HotelInfoList!=null&&this.HotelInfoList.length>0){for(var b=0;b<this.HotelInfoList.length;b++){if(this.HotelInfoList[b].HotelId==a.HotelId){this.HotelInfoList.remove(this.HotelInfoList[b]);}}}this.HotelInfoList.push(a);},getHotelData:function(a){for(var b=0;b<this.HotelInfoList.length;b++){if(this.HotelInfoList[b].HotelId==a){return this.HotelInfoList[b];}}return null;},hasHighspeed:function(a){for(var b=0;b<this.HotelInfoList.length;b++){if(this.HotelInfoList[b].HotelId==a){if(!Object.isNull(this.HotelInfoList[b].HotelRoomSimpleList)){for(var c=0;c<this.HotelInfoList[b].HotelRoomSimpleList.length;c++){if(this.HotelInfoList[b].HotelRoomSimpleList[c].IsHighspeed){return true;}}}}}return false;},clearHotelData:function(){this.HotelInfoList=new Array();},getRatePlan:function(b,k,m,f,d){var a=this.getHotelData(b);if(Object.isNull(a)){return null;}var l=a.HotelRoomSimpleList;if(!Object.isNull(l)){for(var c=0;c<l.length;c++){var g=l[c];if(g.RoomId==k){if(d){for(var e=0;e<g.LongCuiRatePlanList.length;e++){if(g.LongCuiRatePlanList[e].RatePlanId.toString()==f&&g.LongCuiRatePlanList[e].SRoomTypeId==m){return g.LongCuiRatePlanList[e];}}}else{for(var e=0;e<g.RatePlanList.length;e++){if(g.RatePlanList[e].RatePlanId.toString()==f&&g.RatePlanList[e].SRoomTypeId==m){return g.RatePlanList[e];}}}}}}return null;},getOtherHotels:function(c){var f="";for(var d=0;d<this.HotelInfoList.length;d++){var b=this.getHotelData(c);if(b!=null&&c==b.HotelId){break;}}var g=d-7<=0?0:d-7;var a=d+7>=this.HotelInfoList.length?this.HotelInfoList.length-1:d+7;if(a>g){for(var e=g;e<a;e++){if(c==this.HotelInfoList[e].HotelId){continue;}f+=(String.isNullOrEmpty(f)?"":",")+this.HotelInfoList[e].HotelId;}}return f;}});Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a;}}return -1;};Array.prototype.remove=function(b){var a=this.indexOf(b);if(a>-1){this.splice(a,1);}};var JsElapsedTime=Elong.Page.JsElapsedTime;JsElapsedTime=Class.create();Object.extend(JsElapsedTime.prototype,{name:"jsElapsedTime",options:{Language:"CN"},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.startTime=null;this.endTime=null;},start:function(){this.startTime=new Date();},end:function(b){this.endTime=new Date();if(this.startTime==null||this.endTime==null){return 0;}var a=this.endTime.getTime()-this.startTime.getTime();if(typeof(console)=="undefined"){return false;}if(!String.isNullOrEmpty(b)){console.log(b+a+"毫秒");return b+a+"毫秒";}else{console.log(a+"毫秒");return a+"毫秒";}}});var Timer=null;var MapJson=null;var HotelListClient=Elong.Page.HotelListClient;HotelListClient=Class.create();Object.extend(HotelListClient.prototype,{name:"HotelListClient",isChangePage:false,initialize:function(){this.IsLogin=ListController.AjaxInfo.IsLoin;this.IsLongCui=ListController.AjaxInfo.MemberLevel==3||ListController.AjaxInfo.MemberLevel==4;this.SearchRequestInfo=ListController.AjaxInfo.SearchRequestInfo;this.taiwanCityids=ListController.GoogelMapCityIds;this.res=ListController.Resources;this.Language=ListController.Language;this.CampaignId=ListController.CampaignId;this.serverTime=ListController.ServerTime.substring(0,10);this.roomPlayer=new RoomPlayer({Language:ListController.Language});this.OneInfo=this.GetOneInfoByRequest(this.SearchRequestInfo);this.PageInfo=this.GetPageInfoByRequest(this.SearchRequestInfo);this.OneHotelInfo=($("#oneHotelInfo")!=null&&!String.isNullOrEmpty($("#oneHotelInfo").text()))?eval("("+$("#oneHotelInfo").text()+")"):null;this.mapHotelIds=$("#mapHotelIdsbox").text().trim().split("|")[0];this.roomHotelIds=$("#mapHotelIdsbox").text().trim().split("|")[1];this.initializeDOM();this.initializeEvent();this.aioWind=null;this.aioNameWind=null;this.GlobalData={Type:"",Name:"",PropertiesId:0,Lat:0,Lng:0,Accept:false};this.tempCityId=this.SearchRequestInfo.CityId;this.GlobalHotelNameData={Type:"",Name:"",PropertiesId:0,Lat:0,Lng:0,Accept:false};this.starIds=null;this.brandIds=null;this.HotSuggestAllWindowClient=null;this.backToTopIsShow=false;this.distanceOffset=233*5;this.screenIndex=1;this.isScreening=false;this.isDataLoading=false;this.clickOneLineOrNot=false;this.searchByName="";this.oneLineClickAreaId="";this.delAllOrNot=false;this.priceTemplate=new Template("<table cellspacing='0' cellpadding='0' border='0' class='sf_average'><thead><tr> <th>&nbsp;</th>#{Title}</tr></thead><tbody><tr>#{List}</tr></tbody></table>");this.ruleTemplate=new Template("<div class='sf_voucher'>#{Rule}</div>");var ht="tt";this.HotelListUrl=new Template(ListController.UrlConfig.HotelListUrl);this.popupMapNewUrl=new Template(ListController.UrlConfig.PopupMapNewUrl);this.viewMapNewUrl=new Template(ListController.UrlConfig.Hotel_List_ViewMapNew);this.detailCommentUrl=new Template(ListController.UrlConfig.Hotel_DetailComment);this.detailNewUrl=new Template(ListController.UrlConfig.Hotel_DetailDynamic);this.detailNewStaticUrl=new Template(ListController.UrlConfig.Hotel_DetailNew);this.HotelMapSearchUrl=new Template(ListController.UrlConfig.HotelMapSearch);this.HotelDetailUrl=new Template(ListController.UrlConfig.HotelDetailUrl);this.HotelUnsignedUrl=new Template(ListController.UrlConfig.HotelUnsignedDetailUrl);this.HotelDetailReviewUrl=new Template(ListController.UrlConfig.HotelDetailReviewUrl);this.lowestPriceTemplate=new Template("#{from} <span class='price'>#{price}</span>#{tail}");DanbaoHtml:ListController.Language.toUpperCase()!="EN"?'<p class="mb10">Room type太抢手了！Hotel需要您提供信用卡担保预订。</p><p class="l_black">什么叫“信用卡担保”？</p><p class="l_black">我们会预先冻结相应担保金，实际Check in后，担保金会在您离店后3-5个工作日内解冻。</p>':'<p class="mb10">This room is in great demand! The hotel requires your payment details to secure your reservation.</p><p class="l_black">What is credit card guarantee?</p><p class="l_black">You will not be charged for your room until you check out of the hotel. However, we need to pre-authorize a deposit to guarantee your booking.  The deposit will return to your credit card within 3-5 business days after you check out.</p>',this.render();},GetOneInfoByRequest:function(a){var b={areaType:-1,hType:-1,areaName:"",hName:"",areaId:"",hId:"",lat:0,lng:0,isAreaAccept:false,isNameAccept:false};if(!Object.isNull(a)){b.areaType=(a.AreaType==1&&3)||(a.AreaType==2&&6)||(!String.isNullOrEmpty(a.PoiName)&&99)||-1;b.hType=(!!a.BrandId&&5)||(a.HotelName!=""&&9)||-1;if(b.areaType==3||b.areaType==6){b.areaName=a.AreaName;b.areaId=a.AreaId;}if(b.areaType==99){b.areaName=a.PoiName;b.areaId=a.PoiId;b.lat=a.StartLat;b.lng=a.StartLng;}b.hName=b.hType==5?a.BrandName:a.HotelName;b.hId=b.hType==5?a.BrandId:"";b.isAreaAccept=a.IsNotAcceptRecommend;}return b;},GetPageInfoByRequest:function(b){var a={pageIndex:1,pageSize:15,pageCount:0,rowTotal:0,bate:1};if(!Object.isNull(b)){if(b.ShowPageSize>b.PageSize){a.bate=b.ShowPageSize/b.PageSize;a.pageSize=b.ShowPageSize;a.rowTotal=b.HotelCount;a.pageCount=Math.ceil(a.rowTotal/a.pageSize);a.pageIndex=b.PageIndex<a.bate?1:Math.ceil(b.PageIndex/a.bate);}else{a.pageIndex=b.PageIndex;a.pageSize=b.PageSize;a.pageCount=Math.ceil(b.HotelCount/b.PageSize);a.rowTotal=b.HotelCount;}}return a;},SetHotelFacilityIcons:function(g){if(Object.isNull($("#Fac_"+g))||$("#Fac_"+g).length==0){return;}var i=this.Language.toLowerCase()=="cn";var a="_s";if(Object.isNull(this.facIcon)){var p="<span class='facility_icon"+a+" fi_wifi"+a+"' title='"+(i?"公共区域免费WiFi":"Wi-Fi(free)")+"'></span>";var l="<span class='facility_icon"+a+" fi_park"+a+"' title='"+(i?"免费停车场":"parking lot (free)")+"'></span>";var f="<span class='facility_icon"+a+" fi_gym"+a+"' title='"+(i?"健身房":"fitness facilities")+"'></span>";var c="<span class='facility_icon"+a+" fi_conference"+a+"' title='"+(i?"会议室":"conference room")+"'></span>";var o="<span class='facility_icon"+a+" fi_restaurant"+a+"' title='"+(i?"餐厅":"restaurant")+"'></span>";var m="<span class='facility_icon"+a+" fi_pickup"+a+"' title='"+(i?"免费接机服务":"airport pickup service(free)")+"'></span>";var n="<span class='facility_icon"+a+" fi_pool"+a+"' title='"+(i?"游泳池":"Indoor Swimming Pool")+"'></span>";var j="<span class='facility_icon"+a+" fi_broadband"+a+"' title='"+(i?"宽带上网":"Internet access")+"'></span>";var b="<span class='facility_icon"+a+" fi_businessCenter"+a+"' title='"+(i?"商务中心":"business center")+"'></span>";this.facIcon={"1":p,"0":j,"5":l,"11":f,"7":m,"9":n,"14":o,"13":c,"12":b};}var d="";var k=0;var e=$("#Fac_"+g).attr("fids").split(",");if(e.indexOf("1")>-1){d+=this.facIcon["1"];k++;}if(this.roomPlayer.hasHighspeed(g)){d+=this.facIcon["0"];k++;}if(e.indexOf("5")>-1){d+=this.facIcon["5"];k++;}if(e.indexOf("11")>-1){d+=this.facIcon["11"];k++;}if(e.indexOf("7")>-1){d+=this.facIcon["7"];k++;}if(e.indexOf("9")>-1&&k<5){d+=this.facIcon["9"];k++;}if(e.indexOf("14")>-1&&k<5){d+=this.facIcon["14"];k++;}if(e.indexOf("13")>-1&&k<5){d+=this.facIcon["13"];k++;}if(e.indexOf("12")>-1&&k<5){d+=this.facIcon["12"];k++;}if(!Object.isNull($("#Fac_"+g))&&$("#Fac_"+g).length>0){$("#Fac_"+g).append(d);}},initializeDOM:function(){this.backToTopEle=$("#back-to-top");this.allInOne=$("#allInOne");this.allInOneName=$("#allInOneName");this.m_city=$("#m_city");this.searchBox=$("#searchBox");this.m_endDate=$("#m_endDate");this.m_preDate=$("#m_preDate");this.m_search=$("#m_search");this.allInOneData={Keywords:"",KeywordsType:"None",AreaId:"",AreaType:"0",BrandId:"0",StartLat:"0",StartLng:"0",PoiId:"0",Param:"",Accept:"-1"};this.filterDiv=$("#filterDiv");this.filterDivLeft=$("#filterDivLeft");this.filterConditionHandler=$("#filterConditionHandler");this.hotelNumC=$("#hotelNumC");this.hrefMore=$("#hrefMore");this.MoreBrandEle=$("#moreBrandT");this.oneLine=$("#oneLine");this.oneLineMore=$("#oneLineMore");this.sort_Area=$("#sort_Area");this.orderUl=$("#order_ul");this.priceBox=$("#priceBox");this.lowPrice=$("#lowPrice");this.highPrice=$("#highPrice");this.surePrice=$("#surePrice");this.divListView=$("#divListView");this.pageDivDown=$("#pageDivDown");this.advancedFilterDiv=$("#advancedFilterDiv");this.hotelList=$("#hotelList");this.CityName;this.CityNameCn;this.CityNameEn;this.hotelTemp=new Template($("#hotel").html());this.starLevelTemp=new Template("<span class='dx dx#{StarLevel} title_cx' title='#{StarLevelTips}'>");this.elongStarLevelTemp=new Template("<span title='#{StarLevelTips}' class='medal me-#{StarLevel} title_cx'>");this.divSearch=$("#divSearch");this.isSelect=false;this.isNameSelect=false;this.IsShowThemeAndFacility=false;this.li_pageDown=$("#li_pagedown");this.screenListDiv=$("#screenList");this.RecentOrdersOfCityContainer=$("#RecentOrdersOfCityContainer");this.HistoryBrowseHotelContainer=$("#HistoryBrowseHotelContainer");this.searchElement=this.getFormElement(this.searchBox);this.divSuggest=$("#divSuggest");this.lastbread=$("#lastbread");this.daodaoTempDiv=$("#daodaoTempDiv");this.daodaoSpan=$(".daodaoLogo");this.HistoryBrowseHotelContainer=$("#HistoryBrowseHotelContainer");this.listMapDiv=$("#listMapDiv");this.bigAreaRegion=$("#bigAreaRegion");this.windowElement=$("#RealTimeBrowserDataContainer");this.seodetail=$("#showseodetail");this.BookRatingTemp=new Template('<div id="divFigure" class="figure per0" max="#{Rate}" val="0"><p><strong>#{Rate}</strong>%</p><p>已订完</p></div><div class="text">#{Text}</div><span class="close" method="close">Close</span>');this.divBookRating=$("#divBookRating");this.item_fk=$("#item_fk");this.txtFeedBackContent=$("#txtFeedBackContent");this.rdType=$("input[name='rdType']");this.txtFeedBackEmail=$("#txtFeedBackEmail");this.btnSubmit=$("#btnSubmit");this.spanFeedBack=$("#closeFeedBack");this.spanBackGround=$("#spanBackGround");this.isShowContent=true;this.isShowEmail=true;this.isShow=false;this.isShowFbCode=true;this.closeSuceeFb=$("#closeSuceeFb");this.item_fk_success=$("#item_fk_success");this.item_fk_fail=$("#item_fk_fail");this.closeFailFb=$("#closeFailFb");this.feedBackKey="";this.imgFeedBack=$("#imgFeedBack");this.txtFeedBackCode=$("#txtFeedBackCode");this.hdIsGoogle=$("#hdIsGoogle");},initializeEvent:function(){$("body").bind("click",this.onBodyClick.bindAsEventListener(this));$(window).bind("scroll",this.imgLazyLoad.bindAsEventListener(this));this.backToTopEle.bind("click",this.backTopClick.bindAsEventListener(this));$(window).bind("scroll",this.ScreenLoadList.bindAsEventListener(this));this.sort_Area.bind("click",this.OnClickSortArea.bindAsEventListener(this));this.MoreBrandEle.bind("click",this.OnClickMoreBrand.bindAsEventListener(this));$("#MoreFacility").bind("click",this.OnClickMoreBrand.bindAsEventListener(this));$("#MoreTheme").bind("click",this.OnClickMoreBrand.bindAsEventListener(this));this.oneLineMore.bind("click",this.OnClickOneLineMore.bindAsEventListener(this));this.oneLine.bind("click",this.OnClickOneLine.bindAsEventListener(this));$("#filterArea").bind("click",this.OnClickNewFilterDiv.bindAsEventListener(this));this.hotelList.bind("mouseover",this.OnMouseoverhotelList.bindAsEventListener(this));this.hotelList.find("img[method='bigpic']").bind("mouseout",this.OnMouseouthotelListImg.bindAsEventListener(this));this.hotelList.bind("click",this.OnClickhotelList.bindAsEventListener(this));this.pageDivDown.bind("click",this.OnClickPageDivDown.bindAsEventListener(this));this.lowPrice.bind("keydown",this.OnOnlyNumber.bindAsEventListener(this));this.highPrice.bind("keydown",this.OnOnlyNumber.bindAsEventListener(this));this.HistoryBrowseHotelContainer.bind("click",this.OnClickDelSeenHtDel.bindAsEventListener(this));this.listMapDiv.bind("click",this.OnClickListMapDiv.bindAsEventListener(this));$("#listMapA").bind("click",this.OnClickListMapDiv.bindAsEventListener(this));this.bigAreaRegion.bind("click",this.OnClickBigAreaRegionRegion.bindAsEventListener(this));$("#CouponCMS").bind("click",this.OnClickCouponCMSRegion.bindAsEventListener(this));this.windowElement.bind("click",this.onWindowElementClick.bindAsEventListener(this));$("#divRankResearch").bind("click",this.onRankResearchClick.bindAsEventListener(this));this.seodetail.bind("click",this.onShowSeoClick.bindAsEventListener(this));this.divBookRating.bind("click",this.onBookRatingClick.bindAsEventListener(this));FunctionExt.defer(this.onOutClick.bindAsEventListener(this),100);this.btnSubmit.bind("click",this.submitFeedBack.bindAsEventListener(this));this.txtFeedBackContent.bind("focus",this.txtContentFocus.bindAsEventListener(this));this.txtFeedBackEmail.bind("focus",this.txtEmailFocus.bindAsEventListener(this));this.txtFeedBackCode.bind("focus",this.txtFeedBackCodeFocus.bindAsEventListener(this));this.txtFeedBackContent.bind("blur",this.txtContentBlur.bindAsEventListener(this));this.txtFeedBackEmail.bind("blur",this.txtEmailBlur.bindAsEventListener(this));this.txtFeedBackCode.bind("blur",this.txtFeedBackCodeBlur.bindAsEventListener(this));this.spanFeedBack.bind("click",this.closeFeedBack.bindAsEventListener(this));this.item_fk_success.bind("click",this.closeFbSuccess.bindAsEventListener(this));this.closeSuceeFb.bind("click",this.closeFeedBack.bindAsEventListener(this));this.item_fk_fail.bind("click",this.closeFbFail.bindAsEventListener(this));this.closeFailFb.bind("click",this.closeFeedBack.bindAsEventListener(this));this.imgFeedBack.bind("click",this.refreshFbCode.bindAsEventListener(this));},initializeDomStatus:function(){this.filterDiv.find("input").each(function(){$(this).attr("checked",false);});this.advancedFilterDiv.find("input").each(function(){$(this).attr("checked",false);});$("#locationTab").find("li").each(function(){$(this).attr("class","");});},destroyDOM:function(){this.allInOne=null;this.allInOneName=null;this.searchBox=null;this.filterDiv=null;this.m_city=null;this.m_endDate=null;this.lastbread=null;this.m_preDate=null;this.filterDivLeft=null;this.RecentOrdersOfCityContainer=null;this.HistoryBrowseHotelContainer=null;this.hotelList=null;this.daodaoSpan=null;this.daodaoTempDiv=null;this.backToTopEle=null;this.bigAreaRegion=null;this.seodetail=null;},onBookRatingClick:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"close":this.divBookRating.hide();break;}},showBookRating:function(rate){if(Timer!=null){Timer=window.clearInterval(Timer);}if(rate<=60){var bookedRate=100-rate;var text=String.format("该Check in内，符合您条件的{0}%的Hotel已被订完，请抓紧预订>_<",bookedRate);if(bookedRate>=100){text="该Check in内，符合您条件的全部Hotel已被订完，建议您更换日期 >_<";}var html=this.BookRatingTemp.eval({Rate:bookedRate,Text:text});this.divBookRating.html(html);this.divBookRating.show();Timer=window.setInterval(this.showBookRatingProcess,20);}else{this.divBookRating.hide();}},showBookRatingProcess:function(){var a=$("#divFigure");var c=parseInt(a.attr("max"));var d=parseInt(a.attr("val"));if(d<c){d=d+5;var b=(d/5).toFixed(0);a.attr("val",d);a.removeClass().addClass("figure per"+b);}else{window.clearInterval(Timer);Timer=null;}},backTopClick:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"goTop":$("html, body").animate({scrollTop:0},100);break;case"feedBack":if(this.isShow==false){this.item_fk.show(300);this.isShow=true;this.spanBackGround.addClass("choose");this.refreshFbCode();}else{this.item_fk.hide(300);this.isShow=false;this.spanBackGround.removeClass("choose");}break;case"service":window.open("http://www.elong.com/chat.html?g=31878","","height=460,width=690,left=200,top=100,resizable=yes");break;}},closeFeedBack:function(){this.item_fk.hide(300);this.isShow=false;this.spanBackGround.removeClass("choose");},closeFbSuccess:function(){this.item_fk_success.hide(300);this.isShow=false;this.spanBackGround.removeClass("choose");},closeFbFail:function(){this.item_fk_fail.hide(300);this.isShow=false;this.spanBackGround.removeClass("choose");},BuildRandomKey:function(){var a=(new Date()).getTime().toString()+Math.round((Math.random()*(99999-10000)+10000));return a;},submitFeedBack:function(){if(this.isShowContent==true){this.txtFeedBackContent.addClass("com_ErrorBox");return;}else{this.txtFeedBackContent.removeClass("com_ErrorBox");}if(this.isShowEmail==false&&!validator.valid(this.txtFeedBackEmail.val(),"email")){this.txtFeedBackEmail.addClass("com_ErrorBox");return;}else{this.txtFeedBackEmail.removeClass("com_ErrorBox");}var a="";for(var b=0;b<this.rdType.length;b++){var d=$("#rdType"+(b+1).toString());if(d.attr("checked")==true){a=d.val();}}var c={FeedBackContent:this.txtFeedBackContent.val(),FeedBackType:a,FeedBackEmail:this.isShowEmail?"":this.txtFeedBackEmail.val(),FeedBackKey:this.feedBackKey,FeedBackCode:this.txtFeedBackCode.val()};elongAjax.callBack("/FeedBack/AddFeedBack",c,function(e){if(e.result=="VcNull"){this.txtFeedBackCode.addClass("com_ErrorBox");return;}else{this.txtFeedBackCode.removeClass("com_ErrorBox");}if(e.result=="VcWrong"){this.txtFeedBackCode.addClass("com_ErrorBox");return;}else{this.txtFeedBackCode.removeClass("com_ErrorBox");}this.item_fk.hide();this.isShow=false;this.initFeedBackContent();this.initFeedBackEmail();this.initFeedBackCode();this.initFeedBackType();this.isShowContent=true;this.isShowEmail=true;this.isShowFbCode=true;if(e.result=="success"){this.feedBackKey="";this.item_fk_success.show();setTimeout("$('#item_fk_success').hide(300);$('#spanBackGround').removeClass('choose');",1000);}else{this.item_fk_fail.show();}}.bind(this),false,"POST",null,"json");},refreshFbCode:function(){if(this.feedBackKey==""){this.feedBackKey=this.BuildRandomKey();}this.imgFeedBack.attr("src","/validateFbCode/post/"+this.feedBackKey+"?rnd="+Math.random());},txtContentFocus:function(){if(this.isShowContent==true){this.txtFeedBackContent.val("");this.txtFeedBackContent.css("color","#131313");}},txtEmailFocus:function(){if(this.isShowEmail==true){this.txtFeedBackEmail.val("");this.txtFeedBackEmail.css("color","#131313");}},txtFeedBackCodeFocus:function(){if(this.isShowFbCode==true){this.txtFeedBackCode.val("");this.txtFeedBackCode.css("color","#131313");}},txtContentBlur:function(){if(this.txtFeedBackContent.val()==""){this.isShowContent=true;this.initFeedBackContent();this.txtFeedBackContent.css("color","");}else{this.txtFeedBackContent.css("color","#131313");this.isShowContent=false;}},txtEmailBlur:function(){if(this.txtFeedBackEmail.val()==""){this.isShowEmail=true;this.initFeedBackEmail();this.txtFeedBackEmail.css("color","");}else{this.txtFeedBackEmail.css("color","#131313");this.isShowEmail=false;}},txtFeedBackCodeBlur:function(){if(this.txtFeedBackCode.val()==""){this.isShowFbCode=true;this.initFeedBackCode();this.txtFeedBackCode.css("color","");}else{this.txtFeedBackCode.css("color","#131313");this.isShowFbCode=false;}},initFeedBackContent:function(){this.txtFeedBackContent.val("如果您对我们的产品有什么建议和问题，请告诉我们：）");this.txtFeedBackContent.css("color","");},initFeedBackEmail:function(){this.txtFeedBackEmail.val("留下您的Email，方便我们联系您：）");this.txtFeedBackEmail.css("color","");},initFeedBackCode:function(){this.txtFeedBackCode.val("验证码");this.txtFeedBackCode.css("color","");},initFeedBackType:function(){for(var a=0;a<this.rdType.length;a++){var b=$("#rdType"+(a+1).toString());b.attr("checked",false);}},onWindowElementClick:function(a){$("#RealTimeBrowserDataContainer").fadeOut(1000);},OnClickCouponCMSRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"showCouponCMS":var d=new Dialog({title:"返现如何使用",htmlContent:"<div id='couponPop' style='width:700px; height: 395px;'><iframe name='couponWindow' id='mapWindow' frameborder='0' scrolling='no' src='http://hotel.elong.com/CMSLoading.html?CMSName=couponintro&CMSId=CouponCMS' style='margin:0;padding:0;width: 700px; height: 395px;'></iframe></div>",width:724,height:440,initEvent:function(e){}.bind(this)});d.show();break;case"closeCouponCMS":$("#CouponCMS").css("display","none");this.writeCouponCMSCookie();break;}},writeCouponCMSCookie:function(){var a=Globals.cookie("closeCouponCMSCount");if(!String.isNullOrEmpty(a)){Globals.cookie("closeCouponCMSCount","",++a,{expires:0,path:"/",secure:false,domain:"hotel.elong.com"});}else{Globals.cookie("closeCouponCMSCount","",1,{expires:0,path:"/",secure:false,domain:"hotel.elong.com"});}},onShowSeoClick:function(){if(this.seodetail.attr("class")=="listSEO_expand"){this.seodetail.removeClass("listSEO_expand").addClass("listSEO_collapse");$("#SeoData").show();}else{this.seodetail.removeClass("listSEO_collapse").addClass("listSEO_expand");$("#SeoData").hide();}},onBodyClick:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"userLogin":if(!this.IsLogin){$loginDialog(this.Language,false,true,"","",function(d){if(d==1){window.location.reload();}});}break;}},HotSuggestCacheData:null,HengStyleFilterDom:$("#filterArea"),TiaoJianDom:$("#tiaojian"),OnClickOneLine:function(){$("#locationTab").find("li[method='l_3']").attr("class","activexz");},ResetFilterUIByRequestNew:function(m){if(Object.isNull(m)){return;}$("#filterArea").find("div[tt]").hide();if(this.delAllOrNot==false){$("#oneLine").find("label").each(function(){if($(this).attr("class")=="ao"){$("#locationTab").find("a[method='l_3']").parent().attr("class","activexz");}});}this.ShowAreaTabVal=-1;this.TiaoJianDom.empty();$("#delAll").hide();$("a[ method]").addClass("cur");this.HengStyleFilterDom.find("li").removeClass("ao");this.HengStyleFilterDom.find("label").removeClass("ao");$("#oneLine").find("label").removeClass("ao");this.HengStyleFilterDom.find("input:checked").attr("checked",false);this.advancedFilterDiv.find("input:checked").attr("checked",false);var a,k,d,b,g,i,j,c,e,l=false,f=false;if(m.ReturnKeywordsType=="BigArea"){this.bigAreaRegion.show();}else{this.bigAreaRegion.hide();}if(!String.isNullOrEmpty(m.TagId)){k=true;this.SetFilterUINew("tag",m.TagName,m.TagId);}if(!String.isNullOrEmpty(m.HotelIds)){d=true;this.SetFilterUINew("hotelId",$("#hotel"+m.HotelIds.split(",")[0]).find("dl.t2 a").attr("title"),m.HotelIds.split(",")[0]);m.HotelIds="";}if(!String.isNullOrEmpty(m.StarLevels)){j=true;$("a[ method='s_no']").removeClass("cur");this.SetFilterUINew("star",m.StarLevels,m.StarLevels);}if(m.HighPrice!=0||m.LowPrice!=0){i=true;$("a[ method='p_no']").removeClass("cur");this.SetFilterUINew("price",m.LowPrice.toString()+","+m.HighPrice.toString(),m.LowPrice.toString()+"_"+m.HighPrice.toString());}if(m.PoiId!=0||!String.isNullOrEmpty(m.PoiName)){g=true;$("a[ method='l_no']").removeClass("cur");this.SetFilterUINew("location",m.PoiName||m.Keywords,m.PoiId);}if(m.AreaId!=0&&!String.isNullOrEmpty(m.AreaName)){a=true;$("a[ method='l_no']").removeClass("cur");this.SetFilterUINew("location",m.AreaName,m.AreaId);}if(m.IsBigBed){this.SetFilterUINew("facility",this.Language=="CN"?"大床":"King Bed","bigBed");}if(m.IsDoubleBed){this.SetFilterUINew("facility",this.Language=="CN"?"双床":"Twin Bed","doubleBed");}if(m.IsFreeNet){this.SetFilterUINew("facility",this.Language=="CN"?"免费宽带":"Free wired internet","net");}if(!String.isNullOrEmpty(m.BrandIds)){b=true;$("a[ method='b_no']").removeClass("cur");this.SetFilterUINew("brand",m.BrandName,m.BrandIds);}else{if(!String.isNullOrEmpty(m.HotelName)){b=true;this.SetFilterUINew("hotelNmae",m.HotelName,"");}}if(m.PersonNumOfRoom!=0){f=true;$("a[method='pnum_no']").removeClass("cur");this.SetFilterUINew("peopleNum","",m.PersonNumOfRoom);}if(!String.isNullOrEmpty(m.FacilityIds)){c=true;$("a[ method='f_no']").removeClass("cur");this.SetFilterUINew("facility",null,m.FacilityIds);}if(!String.isNullOrEmpty(m.ThemeIds)){l=true;$("a[ method='t_no']").removeClass("cur");this.SetFilterUINew("theme",null,m.ThemeIds);}if(!String.isNullOrEmpty(m.Keywords)&&m.KeywordsType=="IntelligentSearch"){e=true;this.SetFilterUINew("keyword",m.Keywords,999);}if(m.IsCoupon&&this.Language=="CN"){this.SetFilterUINew("facility",this.Language=="CN"?"返现":"","coupon");}if(m.IsNoGuarantee){this.SetFilterUINew("facility",this.Language=="CN"?"免担保":"No Credit Card Guarantee Required","noGuarantee");}if(m.IsPrePay&&this.Language=="CN"){this.SetFilterUINew("facility",this.Language=="CN"?"Pay in advance更优惠":"No Credit Card Guarantee Required","prePay");}if(m.IsLimitTime&&this.Language=="CN"){this.SetFilterUINew("facility",this.Language=="CN"?"限时抢购":"No Credit Card Guarantee Required","flashSale");}if(a||k||d||b||g||i||j||c||e||l||m.IsBigBed||m.IsDoubleBed||m.IsFreeNet||m.IsCoupon||m.IsNoGuarantee||m.IsPrePay||m.IsLimitTime||f){$("#delAll").show();}},SetFilterUINew:function(r,o,g){switch(r){case"tag":this.TiaoJianDom.append('<li tagid="'+g+'" method="tagLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');break;case"location":this.TiaoJianDom.append('<li areaid="'+g+'" method="locationLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find('input[areaid="'+g+'"]').attr("checked",true).parent().attr("class","ao");this.oneLine.find('input[areaid="'+g+'"]').attr("checked",true).parent().attr("class","ao");break;case"keyword":this.TiaoJianDom.append('<li method="keywordLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');break;case"hotelNmae":this.TiaoJianDom.append('<li method="hotelNameLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');break;case"hotelId":this.TiaoJianDom.append('<li method="hotelNameLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');break;case"brand":var a=g.split(",");if(a.length>0){for(var f=0;f<a.length;f++){var b=this.HengStyleFilterDom.find("input[brandid='"+a[f]+"']").attr("dataname");if(String.isNullOrEmpty(b)){b=this.MoreBrandEle.find("input[brandid='"+a[f]+"']").attr("dataname")||o;}this.TiaoJianDom.append('<li forEle="br'+g+'" brandId="'+a[f]+'" method="brandLabel">'+(o||b)+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find("input[brandid='"+a[f]+"']").attr("checked",true).parent().attr("class","ao");}}break;case"peopleNum":var l=this.HengStyleFilterDom.find('input[id="num0'+g+'"]');if(l.length>0){var k=l.attr("dataName");l.attr("checked",true).parent().attr("class","ao");this.TiaoJianDom.append('<li forEle="" method="peopleNumLabel">'+k+'<span title="'+k+'" method="del"></span></li>');}break;case"price":var j=parseInt(o.split(",")[0]);var e=parseInt(o.split(",")[1]);if(j==600&&e==0){this.TiaoJianDom.append('<li forEle="pr4" priceid="'+g+'" method="priceLabel">'+this.HengStyleFilterDom.find('input[id="pr4"]').attr("dataname")+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find('input[id="pr4"]').attr("checked",true).parent().attr("class","ao");}else{if(j!=600&&e==0){this.TiaoJianDom.append('<li forEle="" priceid="'+g+'" method="priceLabel">'+j+'元以上<span title="'+this.res.DelThis+'" method="del"></span></li>');this.lowPrice.val(j);this.highPrice.val();}else{if(j==300&&e==600){this.TiaoJianDom.append('<li forEle="pr3" priceid="'+g+'" method="priceLabel">'+this.HengStyleFilterDom.find('input[id="pr3"]').attr("dataname")+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find('input[id="pr3"]').attr("checked",true).parent().attr("class","ao");}else{if(j==150&&e==300){this.TiaoJianDom.append('<li forEle="pr2" priceid="'+g+'" method="priceLabel">'+this.HengStyleFilterDom.find('input[id="pr2"]').attr("dataname")+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find('input[id="pr2"]').attr("checked",true).parent().attr("class","ao");}else{if(j==0&&e==150){this.TiaoJianDom.append('<li forEle="pr1" priceid="'+g+'" method="priceLabel">'+this.HengStyleFilterDom.find('input[id="pr1"]').attr("dataname")+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find('input[id="pr1"]').attr("checked",true).parent().attr("class","ao");}else{if(j==0&&e!=150){this.TiaoJianDom.append('<li forEle="" priceid="'+g+'" method="priceLabel">'+e+'元以下<span title="'+this.res.DelThis+'" method="del"></span></li>');this.lowPrice.val();this.highPrice.val(e);}else{this.TiaoJianDom.append('<li forEle="" priceid="'+g+'" method="priceLabel">'+j+"-"+e+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.lowPrice.val(j);this.highPrice.val(e);}}}}}}break;case"star":var n=g.split(",");if(n.length>0){for(var f=0;f<n.length;f++){var m=this.HengStyleFilterDom.find('input[id="star'+n[f]+'"]').attr("dataname");this.TiaoJianDom.append('<li forEle="star'+n[f]+'" starid="'+n[f]+'" method="starLabel">'+m+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find('input[id="star'+n[f]+'"]').attr("checked",true).parent().attr("class","ao");}}break;case"facility":$("a[ method='f_no']").removeClass("cur");if(g=="bigBed"){this.TiaoJianDom.append('<li forEle="big_bed" method="bigbedLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');$("#MoreFacility").find('input[mark="bigbed"]').attr("checked",true);}if(g=="doubleBed"){this.TiaoJianDom.append('<li forEle="double_bed" method="doublebedLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');$("#MoreFacility").find('input[mark="doublebed"]').attr("checked",true);}if(g=="net"){this.TiaoJianDom.append('<li forEle="net_net" method="netLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find('input[fid="0"]').attr("checked",true).parent().attr("class","ao");}if(g=="coupon"){this.TiaoJianDom.append('<li forEle="cbCoupon" method="couponLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.advancedFilterDiv.find('input[id="cbCoupon"]').attr("checked",true);}if(g=="noGuarantee"){this.TiaoJianDom.append('<li forEle="cbNoguarantee" method="noguaranteeLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.advancedFilterDiv.find('input[id="cbNoguarantee"]').attr("checked",true);}if(g=="prePay"){this.TiaoJianDom.append('<li forEle="cbPrepay" method="prepayLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.advancedFilterDiv.find('input[id="cbPrepay"]').attr("checked",true);}if(g=="flashSale"){this.TiaoJianDom.append('<li forEle="cbFlashSale" method="flashSaleLabel">'+o+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.advancedFilterDiv.find('input[id="cbFlashSale"]').attr("checked",true);}if(g.indexOf(",")>0||!isNaN(g)){var c=g.split(",");if(c.length>0){for(var f=0;f<c.length;f++){var d=$("input[fid='"+c[f]+"']:first").attr("dataname");if(String.isNullOrEmpty(d)){continue;}this.TiaoJianDom.append('<li fid="'+c[f]+'" method="facilityLabel">'+(o||d)+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find("input[fid='"+c[f]+"']").attr("checked",true).parent().attr("class","ao");}}}break;case"theme":$("a[ method='t_no']").removeClass("cur");var p=g.split(",");if(p.length>0){for(var f=0;f<p.length;f++){var q=this.HengStyleFilterDom.find("input[tid='"+p[f]+"']").attr("dataname");this.TiaoJianDom.append('<li tid="'+p[f]+'" method="themeLabel">'+q+'<span title="'+this.res.DelThis+'" method="del"></span></li>');this.HengStyleFilterDom.find("input[tid='"+p[f]+"']").attr("checked",true).parent().attr("class","ao");}}break;}},OnClickOneLineMore:function(){this.selectLocationTab(3,$("#locationTab").find("a[method='l_3']"),$("div[tt='3']"));},OnClickNewFilterDiv:function(c){var b=Event.element(c);var e=b.attr("method");if(String.isNullOrEmpty(e)){return;}if(e=="PopClose"){$("#filterArea").find("div[tt]").hide();$("#locationTab").find("li").removeClass("active");this.ShowAreaTabVal=-1;return;}if(e=="showAllFilter"){b=b.is("a")||b.is("span")?b.parent():b;if(this.IsShowThemeAndFacility){$("#wbox_t").hide();$("#wbox_f").hide();$("#wbox_PNum").addClass("nobor");b.html('<a href="javascript:void(0);" method="showAllFilter">'+(this.Language=="CN"?"展开设施和主题":"show all")+'</a><span class="xlicon" method="showAllFilter"></span>');this.IsShowThemeAndFacility=false;}else{$("#wbox_t").show();$("#wbox_f").show();$("#wbox_PNum").removeClass("nobor");b.html('<a href="javascript:void(0);" method="showAllFilter">'+(this.Language=="CN"?"收起设施和主题":"hide the filters")+'</a><span class="xliconz" method="showAllFilter"></span>');this.IsShowThemeAndFacility=true;}}var a=e.split("_");var f=$("#filterArea").attr("tab");switch(a.length){case 2:this.InvokeClick(a[0],a[1],b,f);break;case 3:this.InvokeNextClick(a,b,f);break;case 4:this.InvokeFourthClick(a,b);break;default:if(b.is("li")&&e.indexOf("Label")>-1){var d=b.attr("method").replace("Label","");this.setDel(d,b);this.getHotelList();}if(e=="del"){var d=b.parent().attr("method").replace("Label","");this.setDel(d,b.parent());this.getHotelList();}if(e=="delAll"){this.delAllOrNot=true;this.delAll();this.getHotelList();this.delAllOrNot=false;}return;}},InvokeClick:function(b,e,a,c){switch(b){case"l":a.parents("ul").children().removeClass("active");$("#filterArea").find("div[tt]").hide();this.ClickLocationTab(e,a,c);break;case"p":switch(e){case"opt":this.clickSurePrice();break;case"no":this.SearchRequestInfo.LowPrice="0";this.SearchRequestInfo.HighPrice="0";this.getHotelList();break;default:this.SearchRequestInfo.PageIndex=1;this.lowPrice.attr("value","");this.highPrice.attr("value","");this.setPrice(a);this.getHotelList();break;}break;case"s":if(e!="no"){this.SearchRequestInfo.PageIndex=1;this.setStar(a.attr("mark"));}else{this.SearchRequestInfo.StarLevels="";this.SearchRequestInfo.StarLevel="";}var d=this.SearchRequestInfo.StarLevels;if(!String.isNullOrEmpty(d)&&d.indexOf("11")>-1){$("#HotApartment").show();}else{$("#HotApartment").hide();}this.getHotelList();break;case"b":switch(e){case"more":this.showMoreBrandAndFacWin(a);break;case"no":this.SearchRequestInfo.BrandIds="";this.SearchRequestInfo.BrandId="";this.SearchRequestInfo.BrandName="";this.getHotelList();break;default:this.SearchRequestInfo.PageIndex=1;this.SearchRequestInfo.HotelName="";if((this.SearchRequestInfo.KeywordsType=="IntelligentSearch"&&this.SearchRequestInfo.ReturnKeywordsType!="PoiType"&&this.SearchRequestInfo.ReturnKeywordsType!="BigArea")||this.SearchRequestInfo.KeywordsType=="HotelName"){this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.KeywordsType=0;}this.setBrand(a);this.getHotelList();break;}break;case"f":switch(e){case"more":this.showMoreBrandAndFacWin(a);break;case"no":this.SearchRequestInfo.FacilityIds="";this.SearchRequestInfo.IsFreeNet=false;this.SearchRequestInfo.IsDoubleBed=false;this.SearchRequestInfo.IsBigBed=false;this.getHotelList();break;default:this.setFacility(a);this.SearchRequestInfo.PageIndex=1;this.getHotelList();break;}break;case"t":switch(e){case"more":this.showMoreBrandAndFacWin(a);break;case"no":this.SearchRequestInfo.ThemeIds="";this.getHotelList();break;default:this.setTheme(a);this.SearchRequestInfo.PageIndex=1;this.getHotelList();break;}break;case"pnum":switch(e){case"more":break;case"no":this.SearchRequestInfo.PersonNumOfRoom=0;this.getHotelList();break;default:this.setPeoplemNum(a);this.SearchRequestInfo.PageIndex=1;this.getHotelList();break;}break;}},InvokeNextClick:function(a,b,d){if(a[0]=="l"){if(a[2]=="col"){$("div[tt='"+a[1]+"']").hide();$("#locationTab").children(".active").removeClass("active");this.ShowAreaTabVal="";}else{var e=a[1];var c=a[2];this.getTabHtmlDetail(e,c,a,d);}}},InvokeFourthClick:function(a,b){if(a[0]=="l"){switch(a[1]){case"6":case"3":this.SearchRequestInfo.HotelSort="1";this.SearchRequestInfo.PoiId="0";this.SearchRequestInfo.PoiName="";this.SearchRequestInfo.IsNotAcceptRecommend="true";this.SearchRequestInfo.StartLat=0;this.SearchRequestInfo.StartLng=0;this.SearchRequestInfo.AreaId=b.attr("areaid");this.oneLineClickAreaId=b.attr("areaid");this.SearchRequestInfo.AreaName=b.attr("dataname");if(a[1]=="6"){this.SearchRequestInfo.AreaType="2";}else{this.SearchRequestInfo.AreaType="1";}if(this.SearchRequestInfo.ReturnKeywordsType=="PoiType"||this.SearchRequestInfo.ReturnKeywordsType=="BigArea"){this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.KeywordsType="0";this.SearchRequestInfo.ReturnKeywordsType="0";}break;case"1":case"2":case"77":case"79":this.oneLineClickAreaId="";this.SearchRequestInfo.AreaId="";this.SearchRequestInfo.AreaName="";this.SearchRequestInfo.AreaType="";if(this.SearchRequestInfo.ReturnKeywordsType=="PoiType"||this.SearchRequestInfo.ReturnKeywordsType=="BigArea"){this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.KeywordsType="0";this.SearchRequestInfo.ReturnKeywordsType="0";}this.SearchRequestInfo.PoiId=b.attr("areaid");this.SearchRequestInfo.PoiName=b.attr("dataName");this.SearchRequestInfo.HotelSort=6;this.SearchRequestInfo.StartLat=b.attr("lat");this.SearchRequestInfo.StartLng=b.attr("lng");break;}this.getHotelList();var c=a[0]+"_"+a[1];$("#locationTab").find("li[class='activexz']").attr("class","");$("#locationTab").find("a[method='"+c+"']").parent().attr("class","activexz");if($(b).parent().parent().parent().parent().attr("id")=="oneLine"){$("#locationTab").find("a[method='l_3']").parent().attr("class","activexz");}}},ClickLocationTab:function(d,b,c){switch(d){case"no":this.SearchRequestInfo.HotelSort=1;b.parent().next().children().removeClass("active");$("#locationTab").find("li[class='activexz']").attr("class","");this.setDel("location",b);this.getHotelList();break;case"6":if(c=="noPop"){this.selectLocationTab(d,b,$("div[tt='"+d+"']"));}else{if(c=="pop"){this.selectLocationTab(d,b,$("#areaListPop"),c);}}break;case"3":if(c=="noPop"){this.selectLocationTab(d,b,$("div[tt='"+d+"']"));}else{if(c=="pop"){this.selectLocationTab(d,b,$("#commercialListPop"),c);}}break;case"1":case"2":case"77":case"79":var a=this.getTabContain(d,b,c);this.selectLocationTab(d,b,a,c);break;}},selectLocationTab:function(g,b,e,d){this.oneLine.hide();if(this.oneLineClickAreaId!=""&&$("#wbox_l").find("a[method='l_no']").attr("class")!="cur"){this.HengStyleFilterDom.find('input[areaid="'+this.oneLineClickAreaId+'"]').attr("checked",true).parent().attr("class","ao");}if(this.ShowAreaTabVal!=g){b.parent("li").addClass("active");this.ShowAreaTabVal=g;if(d=="pop"&&e!=null&&e.length>0&&e.is(":hidden")){if($.browser.msie&&($.browser.version=="6.0")&&!$.support.style&&(g=="1"||g=="2")){var c=b.parent().offset().left;var a=$("#filterArea");a.css({"z-index":"999"});e.css({"z-index":"999"});e[0].style.left=(c-a.offset().left-125+b.width()/2)+"px";}else{var f=b.parent().height()+6;var c=b.parent().offset().left;var a=$("#filterArea");e[0].style.position="absolute";a.css({"z-index":"999"});e.css({"z-index":"999"});e[0].style.top=f+"px";e[0].style.left=(c-a.offset().left-125+b.width()/2)+"px";}}e&&e.show();}else{this.ShowAreaTabVal="";e&&e.hide();}},getTabContain:function(g,b,d){var a=$("div[tt='"+g+"']");if(a.length>0&&this.divPopShowed){return a;}if(this.HotSuggestCacheData==null||this.HotSuggestCacheData.length<=0){var f="http://"+window.location.host+ListController.UrlConfig.HotSuggestAllUrl;simpleAjax.callBack(f,"cityid="+this.SearchRequestInfo.CityId+"&language="+this.Language,function(i){if(i!=null&&i.length>0){this.HotSuggestCacheData=i||[];var m=this.getHotDataByType(this.HotSuggestCacheData,g);var k=$.tmpl("locationTabTemp",{data:m[0],index:0});if(!this.divPopShowed&&a.length==0){this.divPopShowed=true;$("#filterArea>.boxcolor>.wBox>.rBox").eq(0).after(k);}a=$("div[tt='"+g+"']");if(d=="pop"){if($.browser.msie&&($.browser.version=="6.0")&&!$.support.style&&(g=="1"||g=="2")){var l=b.parent().offset().left;var j=$("#filterArea");j.css({"z-index":"999"});a.css({"z-index":"999"});a[0].style.left=(l-j.offset().left-125+b.width()/2)+"px";}else{var n=b.parent().height()+6;var l=b.parent().offset().left;var j=$("#filterArea");if(d=="pop"){a[0].style.position="absolute";j.css({"z-index":"999"});a.css({"z-index":"999"});}a[0].style.top=n+"px";a[0].style.left=(l-j.offset().left-125+b.width()/2)+"px";}}a.show();}}.bind(this),true,"GET","jsonp");}else{var e=this.getHotDataByType(this.HotSuggestCacheData,g);var c=$.tmpl("locationTabTemp",{data:e[0],index:0});if(a.length==0){$("#filterArea>.boxcolor>.wBox>.rBox").eq(0).after(c);}a=$("div[tt='"+g+"']");return a;}},getTabHtmlDetail:function(k,e,a,g){var i=this.getHotDataByType(this.HotSuggestCacheData,k);var d=$.tmpl("locationTabTemp",{data:i[0],index:e});$("div[tt='"+k+"']").replaceWith(d);if(g=="pop"){if($.browser.msie&&($.browser.version=="6.0")&&!$.support.style&&(k=="1"||k=="2")){var f=c.parent().offset().left;var b=$("#filterArea");b.css({"z-index":"999"});$("div[tt='"+k+"']").css({"z-index":"999"});$("div[tt='"+k+"']")[0].style.left=(f-b.offset().left-125+c.width()/2)+"px";}else{var c=$("#locationTab").find("a[method='"+a[0]+"_"+a[1]+"']");var j=c.parent().height()+6;var f=c.parent().offset().left;var b=$("#filterArea");$("div[tt='"+k+"']")[0].style.position="absolute";b.css({"z-index":"999"});$("div[tt='"+k+"']").css({"z-index":"999"});$("div[tt='"+k+"']")[0].style.top=j+"px";$("div[tt='"+k+"']")[0].style.left=(f-b.offset().left-125+c.width()/2)+"px";}}$("div[tt='"+k+"']").show();},getHotDataByType:function(a,d){var c=new Array();for(var b=0;b<a.length;b++){if(a[b].TypeId==parseInt(d)){c.push(a[b]);break;}}return c;},clickSurePrice:function(){this.priceBox.removeClass("pricebox");var a=this.checkMoney(this.lowPrice.val(),this.highPrice.val());if(a){if(validator.valid(this.lowPrice.val(),"notEmpty")&&validator.valid(this.highPrice.val(),"notEmpty")){this.SearchRequestInfo.LowPrice=this.lowPrice.val();this.SearchRequestInfo.HighPrice=this.highPrice.val();}else{if(!validator.valid(this.lowPrice.val(),"notEmpty")&&validator.valid(this.highPrice.val(),"notEmpty")){this.SearchRequestInfo.LowPrice="0";this.SearchRequestInfo.HighPrice=this.highPrice.val();}else{if(validator.valid(this.lowPrice.val(),"notEmpty")&&!validator.valid(this.highPrice.val(),"notEmpty")){this.SearchRequestInfo.LowPrice=this.lowPrice.val();this.SearchRequestInfo.HighPrice="0";}}}this.SearchRequestInfo.PageIndex=1;this.getHotelList();}},showMoreBrandAndFacWin:function(b){if(this.popupElement!=null){this.popupElement.removeAttr("position");this.popupElement.hide();this.popupElement=null;}if(b.attr("mark")=="b"){this.popupElement=$("#moreBrandT");}else{if(b.attr("mark")=="f"){this.popupElement=$("#MoreFacility");}else{if(b.attr("mark")=="t"){this.popupElement=$("#MoreTheme");}}}if(this.popupElement!=null&&this.popupElement.length>0&&this.popupElement.is(":hidden")){var e=b.parent().offset().top-$("#filterArea").offset().top+b.parent().height()-14;var c=b.offset().left;this.popupElement[0].style.position="absolute";var d=Globals.getScrollPosition();var a=Globals.browserDimensions();if(a.width-(b.offset().left-d.x)>this.popupElement.width()){this.popupElement[0].style.top=e+"px";this.popupElement[0].style.left=c+"px";}else{this.popupElement[0].style.top=e+"px";c=c-this.popupElement.width()+b.width();this.popupElement[0].style.left=c+"px";}$("#filterArea").css({"z-index":"999"});this.popupElement.css({"z-index":"999"});this.popupElement.show();}},setPrice:function(a){if(!Object.isNull(a.attr("mark"))){switch(a.attr("mark")){case"150":this.SearchRequestInfo.LowPrice="0";this.SearchRequestInfo.HighPrice="150";break;case"150-300":this.SearchRequestInfo.LowPrice="150";this.SearchRequestInfo.HighPrice="300";break;case"300-600":this.SearchRequestInfo.LowPrice="300";this.SearchRequestInfo.HighPrice="600";break;case"600":this.SearchRequestInfo.LowPrice="600";this.SearchRequestInfo.HighPrice="0";break;}}},setStar:function(a){if(String.isNullOrEmpty(this.SearchRequestInfo.StarLevels)){this.SearchRequestInfo.StarLevels=a;}else{var b=this.SearchRequestInfo.StarLevels.split(",");if(b!=null&&b.length>0&&b.indexOf(a)>-1){b.remove(a);this.SearchRequestInfo.StarLevels=b.join(",");}else{this.SearchRequestInfo.StarLevels+=","+a;}}this.SearchRequestInfo.StarLevel="";},setBrand:function(b){var a=b.attr("brandid");if(String.isNullOrEmpty(this.SearchRequestInfo.BrandIds)){this.SearchRequestInfo.BrandIds=a;}else{var c=this.SearchRequestInfo.BrandIds.split(",");if(c!=null&&c.length>0&&c.indexOf(a)>-1){c.remove(a);this.SearchRequestInfo.BrandIds=c.join(",");}else{this.SearchRequestInfo.BrandIds+=","+a;}}this.SearchRequestInfo.BrandId="";this.SearchRequestInfo.BrandName="";},setFacility:function(b){var a=b.attr("fid");if(a=="0"){this.SearchRequestInfo.IsFreeNet=b.attr("checked");}else{if(String.isNullOrEmpty(this.SearchRequestInfo.FacilityIds)){this.SearchRequestInfo.FacilityIds=a;}else{var c=this.SearchRequestInfo.FacilityIds.split(",");if(c!=null&&c.length>0&&c.indexOf(a)>-1){c.remove(a);this.SearchRequestInfo.FacilityIds=c.join(",");}else{this.SearchRequestInfo.FacilityIds+=","+a;}}}},setTheme:function(a){var c=a.attr("tid");if(String.isNullOrEmpty(this.SearchRequestInfo.ThemeIds)){this.SearchRequestInfo.ThemeIds=c;}else{var b=this.SearchRequestInfo.ThemeIds.split(",");if(b!=null&&b.length>0&&b.indexOf(c)>-1){b.remove(c);this.SearchRequestInfo.ThemeIds=b.join(",");}else{this.SearchRequestInfo.ThemeIds+=","+c;}}},setPeoplemNum:function(a){var b=a.attr("value");if(!Object.isNull(b)&&!String.isNullOrEmpty(b)){this.SearchRequestInfo.PersonNumOfRoom=b;}},OnClickMoreBrand:function(c){c&&c.stopPropagation?c.stopPropagation():window.event.cancelBubble=true;var b=Event.element(c);var f=b.attr("mtd");if(String.isNullOrEmpty(f)){if(b.attr("forele")){$("#"+b.attr("forele")).trigger("click");}return false;}switch(f){case"close":if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}this.MoreBrandEle.hide();$("#MoreFacility").hide();$("#MoreTheme").hide();break;case"brandMore":break;case"brandOk":var a="";var e=false;var g=this.MoreBrandEle.find("input[brandid]:checked");$("#brand_ul").find("input").attr("checked",false);if(this.allInOneName.attr("value")!=ListController.Resources.AllInOneHotelN){this.allInOneName.attr("value",ListController.Resources.AllInOneHotelN);this.allInOneName.css("color","#777777");}g.each(function(j){if(e){a+=",";}else{e=true;}a+=$(g[j]).attr("brandid");}.bind(this));this.SearchRequestInfo.BrandIds=a;this.SearchRequestInfo.BrandId="";this.SearchRequestInfo.HotelName="";this.SearchRequestInfo.BrandName="";this.getHotelList();this.MoreBrandEle.hide();break;case"facilityOk":var d="";var e=false;if($("#MoreFacility").find("input[mark='bigbed']:checked").length){this.SearchRequestInfo.IsBigBed=true;}else{this.SearchRequestInfo.IsBigBed=false;}if($("#MoreFacility").find("input[mark='doublebed']:checked").length){this.SearchRequestInfo.IsDoubleBed=true;}else{this.SearchRequestInfo.IsDoubleBed=false;}this.SearchRequestInfo.IsFreeNet=false;var g=$("#MoreFacility").find("input[fid]:checked");g.each(function(j){if($(g[j]).attr("fid")=="0"){this.SearchRequestInfo.IsFreeNet=$(g[j]).attr("checked");}else{if(e){d+=",";}else{e=true;}d+=$(g[j]).attr("fid");}}.bind(this));this.SearchRequestInfo.FacilityIds=d;this.getHotelList();$("#MoreFacility").hide();break;case"themeOk":var i="";var g=$("#MoreTheme").find("input[tid]:checked");g.each(function(j){i+=$(g[j]).attr("tid")+",";}.bind(this));if(i.indexOf(",")>-1){i=i.substr(0,i.length-1);}this.SearchRequestInfo.ThemeIds=i;this.getHotelList();$("#MoreTheme").hide();break;}},set1FSelectedStatus:function(a){$("input[id=lF][method=location]").attr("checked",a);},setDel:function(b,a){switch(b){case"tag":this.SearchRequestInfo.TagId="";this.SearchRequestInfo.TagName="";break;case"location":if(this.allInOne.attr("value")!=ListController.Resources.AllInOne){this.allInOne.attr("value",ListController.Resources.AllInOne);this.allInOne.css("color","#999999");}if(this.SearchRequestInfo.ReturnKeywordsType=="BigArea"){this.SearchRequestInfo.ReturnKeywordsType="None";}this.set1FSelectedStatus("checked");this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.KeywordsType=0;this.SearchRequestInfo.AreaType=0;this.SearchRequestInfo.AreaId="";this.SearchRequestInfo.AreaName="";this.SearchRequestInfo.PoiId="0";this.SearchRequestInfo.PoiName="";this.SearchRequestInfo.StartLat="0";this.SearchRequestInfo.StartLng="0";this.SearchRequestInfo.HotelSort=1;$("#oneLine").find("label").removeClass("ao");$("#locationTab").find("li").removeClass();break;case"keyword":if(this.allInOne.attr("value")!=ListController.Resources.AllInOne){this.allInOne.attr("value",ListController.Resources.AllInOne);this.allInOne.css("color","#999999");}if(this.SearchRequestInfo.ReturnKeywordsType=="BigArea"&&this.SearchRequestInfo.BigAreaInfo!=null){this.SearchRequestInfo.ReturnKeywordsType="None";}this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.KeywordsType=0;this.SearchRequestInfo.AreaType=0;this.SearchRequestInfo.AreaId="";this.SearchRequestInfo.AreaName="";this.SearchRequestInfo.PoiId="0";this.SearchRequestInfo.PoiName="";this.SearchRequestInfo.StartLat="0";this.SearchRequestInfo.StartLng="0";break;case"price":this.SearchRequestInfo.LowPrice="0";this.SearchRequestInfo.HighPrice="0";this.lowPrice.attr("value","");this.highPrice.attr("value","");break;case"star":this.setStar(a.attr("starid"));break;case"brand":case"hotelName":if(this.allInOne.attr("value")!=ListController.Resources.AllInOne){this.allInOne.attr("value",ListController.Resources.AllInOne);this.allInOne.css("color","#999999");}if(a!=null&&this.SearchRequestInfo.BrandIds.indexOf(a.attr("brandId"))>-1){if(this.SearchRequestInfo.BrandIds.indexOf(","+a.attr("brandId"))>-1){this.SearchRequestInfo.BrandIds=this.SearchRequestInfo.BrandIds.replace(","+a.attr("brandId"),"");}else{if(this.SearchRequestInfo.BrandIds.indexOf(a.attr("brandId")+",")>-1){this.SearchRequestInfo.BrandIds=this.SearchRequestInfo.BrandIds.replace(a.attr("brandId")+",","");}else{this.SearchRequestInfo.BrandIds=this.SearchRequestInfo.BrandIds.replace(a.attr("brandId"),"");}}}this.SearchRequestInfo.HotelIds="";this.SearchRequestInfo.BrandId="0";this.SearchRequestInfo.BrandName="";this.SearchRequestInfo.HotelName="";break;case"peopleNum":this.SearchRequestInfo.PersonNumOfRoom=0;break;case"bigbed":this.SearchRequestInfo.IsBigBed=false;break;case"doublebed":this.SearchRequestInfo.IsDoubleBed=false;break;case"net":this.SearchRequestInfo.IsFreeNet=false;break;case"facility":if(a!=null&&this.SearchRequestInfo.FacilityIds.indexOf(a.attr("fid"))>-1){if(this.SearchRequestInfo.FacilityIds.indexOf(","+a.attr("fid"))>-1){this.SearchRequestInfo.FacilityIds=this.SearchRequestInfo.FacilityIds.replace(","+a.attr("fid"),"");}else{if(this.SearchRequestInfo.FacilityIds.indexOf(a.attr("fid")+",")>-1){this.SearchRequestInfo.FacilityIds=this.SearchRequestInfo.FacilityIds.replace(a.attr("fid")+",","");}else{this.SearchRequestInfo.FacilityIds=this.SearchRequestInfo.FacilityIds.replace(a.attr("fid"),"");}}}break;case"coupon":this.advancedFilterDiv.find('input[mark="coupon"]').attr("checked",false);this.SearchRequestInfo.IsCoupon=false;break;case"cashback":this.SearchRequestInfo.IsCashback=false;break;case"noguarantee":this.advancedFilterDiv.find('input[mark="noguarantee"]').attr("checked",false);this.SearchRequestInfo.IsNoGuarantee=false;break;case"prepay":this.advancedFilterDiv.find('input[mark="prepay"]').attr("checked",false);this.SearchRequestInfo.IsPrePay=false;break;case"flashSale":this.advancedFilterDiv.find('input[mark="flashSale"]').attr("checked",false);this.SearchRequestInfo.IsLimitTime=false;break;case"poi":case"aioPoi":this.set1FSelectedStatus("checked");this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.KeywordsType=0;this.SearchRequestInfo.AreaType=0;this.SearchRequestInfo.AreaId="";this.SearchRequestInfo.AreaName="";this.SearchRequestInfo.PoiId="0";this.SearchRequestInfo.PoiName="";this.SearchRequestInfo.StartLat="0";this.SearchRequestInfo.StartLng="0";this.SearchRequestInfo.HotelSort=1;break;case"theme":if(a!=null&&this.SearchRequestInfo.ThemeIds.indexOf(a.attr("tid"))>-1){if(this.SearchRequestInfo.ThemeIds.indexOf(","+a.attr("tid"))>-1){this.SearchRequestInfo.ThemeIds=this.SearchRequestInfo.ThemeIds.replace(","+a.attr("tid"),"");}else{if(this.SearchRequestInfo.ThemeIds.indexOf(a.attr("tid")+",")>-1){this.SearchRequestInfo.ThemeIds=this.SearchRequestInfo.ThemeIds.replace(a.attr("tid")+",","");}else{this.SearchRequestInfo.ThemeIds=this.SearchRequestInfo.ThemeIds.replace(a.attr("tid"),"");}}}break;}},delAll:function(){this.initializeDomStatus();if(this.allInOne.attr("value")!=ListController.Resources.AllInOne){this.allInOne.attr("value",ListController.Resources.AllInOne);this.allInOne.css("color","#999999");}if(this.allInOneName.attr("value")!=ListController.Resources.AllInOneHotelN){this.allInOneName.attr("value",ListController.Resources.AllInOneHotelN);this.allInOneName.css("color","#777777");}this.SearchRequestInfo.ReturnKeywordsType="None";this.advancedFilterDiv.find(":checkbox").each(function(){$(this).attr("checked",false);});this.filterDivLeft.empty();this.filterDiv.find("#clearAllDiv").hide();this.filterConditionHandler.hide();this.SearchRequestInfo.TagId="";this.SearchRequestInfo.TagName="";this.lowPrice.attr("value","");this.highPrice.attr("value","");this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.KeywordsType="None";this.SearchRequestInfo.ReturnKeywordsType="None";this.SearchRequestInfo.AreaId="";this.SearchRequestInfo.AreaName="";this.SearchRequestInfo.AreaType="0";this.SearchRequestInfo.PoiId="0";this.SearchRequestInfo.PoiName="";this.SearchRequestInfo.LowPrice="0";this.SearchRequestInfo.HighPrice="0";this.SearchRequestInfo.StarLevel="None";this.SearchRequestInfo.StarLevels="";this.SearchRequestInfo.BrandId="0";this.SearchRequestInfo.BrandIds="";this.SearchRequestInfo.FacilityIds="";this.SearchRequestInfo.ThemeIds="";this.SearchRequestInfo.BrandName="";this.SearchRequestInfo.StartLat="0";this.SearchRequestInfo.StartLng="0";this.SearchRequestInfo.EndLat="0";this.SearchRequestInfo.EndLng="0";this.SearchRequestInfo.IsBigBed=false;this.SearchRequestInfo.IsDoubleBed=false;this.SearchRequestInfo.IsFreeNet=false;this.SearchRequestInfo.IsCoupon=false;this.SearchRequestInfo.IsCashback=false;this.SearchRequestInfo.IsNoGuarantee=false;this.SearchRequestInfo.IsPrePay=false;this.SearchRequestInfo.IsLimitTime=false;this.SearchRequestInfo.HotelName="";this.SearchRequestInfo.HotelIds="";this.SearchRequestInfo.PersonNumOfRoom=0;this.SearchRequestInfo.HotelSort=1;this.set1FSelectedStatus("checked");return false;},setAdvancedFilter:function(a){var b=a.attr("checked")==true?true:false;if(!Object.isNull(a.attr("mark"))){switch(a.attr("mark")){case"coupon":this.SearchRequestInfo.IsCoupon=b;break;case"noguarantee":this.SearchRequestInfo.IsNoGuarantee=b;break;case"prepay":this.SearchRequestInfo.IsPrePay=b;break;case"flashSale":this.SearchRequestInfo.IsLimitTime=b;break;}}},OnClickSortArea:function(b){var a=Event.element(b);var c=a.attr("method");if(a.is("label")){a=this.advancedFilterDiv.find("#"+a.attr("forEle"));if(a.length>0){a.trigger("click");}b.preventDefault();return;}switch(c){case"order":if(a.attr("mark")=="distinct"){if(this.SearchRequestInfo.StartLat==0&&this.SearchRequestInfo.StartLng==0){return;}}this.setHotelSort(a);this.getHotelList();break;case"noguarantee":this.setAdvancedFilter(a);this.SearchRequestInfo.PageIndex=1;this.getHotelList();break;case"prepay":this.setAdvancedFilter(a);this.SearchRequestInfo.PageIndex=1;this.getHotelList();break;case"coupon":this.setAdvancedFilter(a);this.SearchRequestInfo.PageIndex=1;this.getHotelList();break;case"flashSale":this.setAdvancedFilter(a);this.SearchRequestInfo.PageIndex=1;this.getHotelList();break;}},setSortButtonStyle:function(b){if(!String.isNullOrEmpty(b)){this.orderUl.children().each(function(){$(this).removeClass("def");$(this).children().removeClass();});var d=this.orderUl.find("[mark='popu']");d.addClass("down");var e=this.orderUl.find("[mark='lowprice']");e.addClass("up");var a=this.orderUl.find("[mark='distinct']");if(this.SearchRequestInfo.PoiId!=0||!String.isNullOrEmpty(this.SearchRequestInfo.PoiName)){a.addClass("up");}else{a.addClass("up c");}var c=null;switch(b){case"elong":c=this.orderUl.find("[mark='elong']").parent();break;case"popu":c=d.parent();d.removeClass();d.addClass("downl");break;case"priceAsc":c=e.parent();e.removeClass();e.addClass("upl");e.attr("sort","asc");break;case"priceDesc":c=e.parent();e.removeClass();e.addClass("downl");e.attr("sort","desc");break;case"distinct":c=a.parent();a.removeClass();a.addClass("upl");break;}if(!Object.isNull(c)){c.addClass("def");}}},setHotelSort:function(a){if(!Object.isNull(a.attr("mark"))){switch(a.attr("mark")){case"elong":this.SearchRequestInfo.HotelSort=1;this.SearchRequestInfo.PageIndex=1;break;case"popu":this.SearchRequestInfo.HotelSort=5;this.SearchRequestInfo.PageIndex=1;break;case"lowprice":if(String.isNullOrEmpty(a.attr("sort"))||a.attr("sort")=="desc"){this.SearchRequestInfo.HotelSort=2;}else{if(a.attr("sort")=="asc"){this.SearchRequestInfo.HotelSort=3;}}this.SearchRequestInfo.PageIndex=1;break;case"distinct":this.SearchRequestInfo.HotelSort=6;this.SearchRequestInfo.PageIndex=1;break;}}},pageTop:function(){var a=document,b=(navigator.userAgent.toLowerCase().match(/iPad/i)=="ipad")?window.pageYOffset:Math.max(a.documentElement.scrollTop,a.body.scrollTop);return a.documentElement.clientHeight+b;},imgLazyLoad:function(){var b=this.hotelList.find("img[src2]");if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){if($(b[a]).offset().top<=(this.pageTop()+300)){var c=$(b[a]).attr("src2");if(c){$(b[a]).attr("src",c).removeAttr("src2");}}}}},ScreenLoadList:function(){if(!(navigator.appName=="Microsoft Internet Explorer"&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE9.0")){if($(document).scrollTop()>0){if(!this.backToTopIsShow){this.backToTopEle.show();this.backToTopIsShow=true;}}else{if(this.backToTopIsShow){this.backToTopEle.hide();this.backToTopIsShow=false;}}}var a=(!this.NoHotelNoScreen&&(this.hotelList.offset().top+this.hotelList.outerHeight()-this.distanceOffset)<=this.pageTop()&&this.pageTop()>2000)&&(!this.isScreening)&&(!this.isDataLoading)&&(this.screenIndex<this.PageInfo.bate)&&(this.PageInfo.rowTotal>this.SearchRequestInfo.PageIndex*this.SearchRequestInfo.PageSize);if(a){this.isScreening=true;this.screenListDiv.show();this.SearchRequestInfo.PageIndex=this.SearchRequestInfo.PageIndex+1;try{ListController.Search(this.SearchRequestInfo,false,function(d){if(!d.success||Object.isNull(d.value)||Object.isNull(d.value.ListStaticInfos)){this.SearchRequestInfo.PageIndex=this.SearchRequestInfo.PageIndex-1;this.isScreening=false;return false;}try{this.BuildHotelListHtml(d.value.ListStaticInfos,1,"");this.ResetListEvent();if(this.SearchRequestInfo.ListType=="Common"){this.LoadHotelRoomData(false);}else{if(this.SearchRequestInfo.ListType=="Simple"){this.LoadPriceForSimpleList();}}this.renderMapData();FunctionExt.defer(this.LoadHotelListRecentOrder.bind(this),1200);this.screenIndex++;this.screenListDiv.attr("index",this.screenIndex);this.screenListDiv.hide();this.HotelSearchTrigger(this.SearchRequestInfo);}catch(c){}this.isScreening=false;}.bind(this));}catch(b){this.screenListDiv.hide();this.SearchRequestInfo.PageIndex=this.SearchRequestInfo.PageIndex-1;this.isScreening=false;}}},OnMouseoverhotelList:function(d){var c=Event.element(d);var f=c.attr("method");switch(f){case"bigpic":var a=c.parent().parent().find('div[mark="big_'+c.attr("mark")+'"]');if(a!=null&&a.length>0){a.show();}else{var i=c.attr("bigpic");if(!String.isNullOrEmpty(i)){var g=new Image();if(g.src!=i){g.src=i;}var e='<div class="com_bigpic" mark="big_'+c.attr("mark")+'"> <div class="box"> <div class="cnt_dom"><img width="'+g.width+'" height="'+g.height+'" alt="'+c.attr("hotelname")+'" src="'+c.attr("bigpic")+'" /></div> </div> </div>';this.bigImgBox=$(e);if(c.attr("src").indexOf("no_pics_CN.gif")==-1){c.parent().parent().append(this.bigImgBox);c.parent().parent().find('div[mark="big_'+c.attr("mark")+'"]').show();}}}break;case"weifang":var b=this.Language.toLowerCase()=="cn"?"惊喜！请关注Hotel介绍页里包含“今日特价”字样的Room type，享受超低价高品质的Hotel服务！":'"Last Minute Deal" is a great deal applicable for some rooms. Please get details through the room type and rate section.';if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:b,eventElement:c,defer:true,width:400});break;case"showLongCuiTag":var b="";if(this.IsLogin){if(this.IsLongCui){b=this.Language.toLowerCase()=="cn"?"您是龙萃用户，可以预定 <b>龙萃专享</b> 字样的特惠Room type！":"Hello elite! You can book the promotional rooms with “for Elites Only”";}else{b=this.Language.toLowerCase()=="cn"?"该Hotel是龙萃Hotel。":"This hotel is for elite members.";}}else{b=this.Language.toLowerCase()=="cn"?"该Hotel包含龙萃会员特惠Room type，龙萃等级的用户<a method='userLogin'>登录</a>可以看到更多优惠Room type。":"This hotel offers special rates on certain room types to elites. Elite members can see more after <a method='userLogin'>log-on</a>.";}if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:b,eventElement:c,defer:true,width:400});break;}this.roomPlayer.OnMouseoverHotelDiv(d);},OnMouseouthotelListImg:function(b){var a=Event.element(b);var d=a.attr("method");switch(d){case"bigpic":var c=a.parent().parent().find('div[mark="big_'+a.attr("mark")+'"]');if(c!=null&&c.length>0){c.hide();}break;}},onOutClick:function(){$(document).bind("click",function(b){var a=Event.element(b);if(this.priceBox!=null&&this.priceBox.find("*").index(a)==-1){this.priceBox.removeClass("pricebox");}var c=false;c=$('li[method = "b_more"]').parent().find("*").index(a)==-1;if(c&&this.MoreBrandEle!=null&&this.MoreBrandEle.find("*").index(a)==-1){this.MoreBrandEle.hide();}var d=false;d=$('li[method = "f_more"]').parent().find("*").index(a)==-1;if(d&&$("#MoreFacility")!=null&&$("#MoreFacility").find("*").index(a)==-1){$("#MoreFacility").hide();}var e=false;e=$('li[method = "t_more"]').parent().find("*").index(a)==-1;if(e&&$("#MoreTheme")!=null&&$("#MoreTheme").find("*").index(a)==-1){$("#MoreTheme").hide();}return;}.bindAsEventListener(this));},OnClickBigAreaRegionRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"leafData":$("li.actve").removeClass("actve");a.parent().addClass("actve");this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.HotelSort=6;this.SearchRequestInfo.PageIndex=1;this.SearchRequestInfo.PoiName=a.html();this.SearchRequestInfo.PoiId=a.attr("proptiesId");this.SearchRequestInfo.StartLat=a.attr("lat");this.SearchRequestInfo.StartLng=a.attr("lng");this.getHotelList();this.bigAreaRegion.show();break;}},LoadHotelListRecentOrder:function(){var a=this.mapHotelIds;if(a==null||a==""){return;}ListController.GetHotelListNewOrderInfo(a,this.Language,function(b){if(b&&b.length>0){this.ShowHotelListRecentOrder(b);}}.bind(this),true,"GET");},ShowHotelListRecentOrder:function(b){for(var a=0;a<b.length;a++){$("#new_order"+b[a].HotelId).append(b[a].OrderDescForIndex);}},OnClickhotelList:function(evt){var element=Event.element(evt);var method=element.attr("method");var isgoogle=element.attr("isgoogle");switch(method){case"showMap":if(isgoogle==undefined||isgoogle!="True"){var loadingStr='<div style="position: absolute; top: 50%; left: 50%; margin-top: -50px; z-index: 100; margin-left: -215px; width: 430px; display: block;" id="loading" class="com_dialog com_widget com_widget-content com_corner-all com_draggable"> <div> </div> <div class="com_dialog-content com_widget-content"><dl class="fly_loading clx"><dt class="loading"><img src="http://www.elongstatic.com/hotels/pic/loading3.gif?t=201306231525" alt="loading"></dt><dd class="bold">正在为您努力加载中...</dd><dd>现在Register，就能获得800元代金券。</dd></dl> </div></div>';var wind=new Dialog({title:"Map",htmlContent:"<div id='t_map' style='width: 1004px; height: 484px;'>"+loadingStr+"<iframe name='mapWindow' id='mapWindow' frameborder='0' scrolling='no' src='about:blank' style='margin:0;padding:0;width: 1000px; height: 480px;'></iframe></div>",width:1000,height:513,initEvent:function(windowElement){}.bind(this)});var lat=this.SearchRequestInfo.StartLat;var lng=this.SearchRequestInfo.StartLng;var poiName="";var hotelId=element.attr("hotelid");if(((this.SearchRequestInfo.ReturnKeywordsType=="PoiType")&&(!String.isNullOrEmpty(this.SearchRequestInfo.ReturnKeywords)))&&this.SearchRequestInfo.StartLat>0&&this.SearchRequestInfo.StartLng>0){poiName=this.SearchRequestInfo.ReturnKeywords;}else{if((!String.isNullOrEmpty(this.SearchRequestInfo.PoiName))&&this.SearchRequestInfo.StartLat>0&&this.SearchRequestInfo.StartLng>0){poiName=this.SearchRequestInfo.PoiName;}}wind.show();$("#t_map").parent().css("padding","2px 0 0 0");var iframeSrc=this.viewMapNewUrl.eval();if(iframeSrc.toLowerCase().indexOf("campaign_id")!=-1&&!String.isNullOrEmpty(this.CampaignId)){iframeSrc+=(iframeSrc.indexOf("?")!=-1?"&":"?")+String.format("cityId={0}&hotelId={1}&poiName={2}&poiLat={3}&poiLng={4}",this.SearchRequestInfo.CityId,hotelId,encodeURIComponent(poiName),lat,lng);}else{iframeSrc=iframeSrc+String.format("?cityId={0}&hotelId={1}&poiName={2}&poiLat={3}&poiLng={4}",this.SearchRequestInfo.CityId,hotelId,encodeURIComponent(poiName),lat,lng);}$("#mapWindow").attr("src",iframeSrc);}else{if(isgoogle=="True"){var x=element.attr("x");var y=element.attr("y");var loadingStr='<div style="position: absolute; top: 50%; left: 50%; margin-top: -50px; z-index: 100; margin-left: -215px; width: 430px; display: block;" id="loading" class="com_dialog com_widget com_widget-content com_corner-all com_draggable"> <div> </div> <div class="com_dialog-content com_widget-content"><dl class="fly_loading clx"><dt class="loading"><img src="http://www.elongstatic.com/hotels/pic/loading3.gif?t=201306231525" alt="loading"></dt><dd class="bold">正在为您努力加载中...</dd><dd>现在Register，就能获得800元代金券。</dd></dl> </div></div>';var htmlContent="<div id='t_map' style='width: 970px; height: 440px;'>"+loadingStr+"</div>";var wind=new Dialog({title:"Map",htmlContent:htmlContent,width:1004,height:484,initEvent:function(windowElement){FunctionExt.defer(function(){var map=new MapControl({containId:"t_map",showTools:true});map.addLabeledMarker("test",x,y,"",{url:"http://www.elongstatic.com/hotels/pic/baidu_landmarks.png",width:21,height:25});}.bind(this),1000);}.bind(this)});wind.show();}}break;case"showSosoMap":var sosoId="";var heading=0;var pitch=0;var room=0;var poiJson=null;var hotelid=element.attr("hotelid");var tab=element.attr("tab");if(tab=="soso"){sosoId=element.attr("sosoid");heading=element.attr("heading");pitch=element.attr("pitch");room=element.attr("room");}if((!String.isNullOrEmpty(this.SearchRequestInfo.PoiName)||this.SearchRequestInfo.ReturnKeywordsType=="PoiType")&&this.SearchRequestInfo.StartLat>0&&this.SearchRequestInfo.StartLng>0){poiJson={PoiId:this.SearchRequestInfo.PoiId,PoiName:!String.isNullOrEmpty(this.SearchRequestInfo.PoiName)?this.SearchRequestInfo.PoiName:this.SearchRequestInfo.Keywords,Lat:this.SearchRequestInfo.StartLat,Lng:this.SearchRequestInfo.StartLng};}else{if(this.SearchRequestInfo.ReturnKeywordsType=="BigArea"&&this.SearchRequestInfo.BigAreaInfo!=null){var bigAreaParameters="id"+hotelid;poiJson={PoiId:$("#"+bigAreaParameters).attr("subAreaid"),PoiName:$("#"+bigAreaParameters).attr("subareaName"),Lat:$("#"+bigAreaParameters).attr("lat"),Lng:$("#"+bigAreaParameters).attr("lng")};}}this.showMap(hotelid,this.mapHotelIds,poiJson,ListController.AjaxInfo.City.CityName,ListController.Language,tab=="map"?"map":"soso",sosoId,heading,pitch,room);break;case"clearAll":$("#clearAllDiv a").trigger("click");evt.preventDefault();return false;break;case"ShowAll":var currHotelId=element.parent().attr("hotelid");var hotelDiv=$("#hotelList").children("div[id=hotel"+currHotelId+"]:last");if(hotelDiv.children("div[stu='all']").length==0){ListController.GetHotelRoomSet(this.SearchRequestInfo,currHotelId,false,function(res){if(res!=null&&res.value!=null){this.roomPlayer.addHotelData(res.value[0]);var item=["(限量抢购)","(限时抢购)","（限时抢购）","（限量抢购）","(龙萃专享)","（龙萃专享）","（限量抢）","(限量抢)","（限时抢）","(限时抢)","龙萃专享","限量抢购","限时抢购","限量抢","限时抢"];for(var i=0;i<item.length;i++){for(var j=0;j<res.value[0].HotelRoomSimpleList.length;j++){res.value[0].HotelRoomSimpleList[j].RoomName=res.value[0].HotelRoomSimpleList[j].RoomName.replace(item[i],"");if(!Object.isNull(res.value[0].HotelRoomSimpleList[j].RatePlanList)){for(var k=0;k<res.value[0].HotelRoomSimpleList[j].RatePlanList.length;k++){res.value[0].HotelRoomSimpleList[j].RatePlanList[k].RatePlanName=res.value[0].HotelRoomSimpleList[j].RatePlanList[k].RatePlanName.replace(item[i],"");}}if(!Object.isNull(res.value[0].HotelRoomSimpleList[j].LongCuiRatePlanList)){for(var k=0;k<res.value[0].HotelRoomSimpleList[j].LongCuiRatePlanList.length;k++){res.value[0].HotelRoomSimpleList[j].LongCuiRatePlanList[k].RatePlanName=res.value[0].HotelRoomSimpleList[j].LongCuiRatePlanList[k].RatePlanName.replace(item[i],"");}}}}var html=$.tmpl("roomTemp",{Data:res.value[0],Client:this,islogin:this.IsLogin,isLongCui:this.IsLongCui,showAllRoom:true,cityNameEn:ListController.AjaxInfo.City.CityNameEn,showPriceImage:ListController.AjaxInfo.IsShowPriceImage});hotelDiv.children("div[stu='two']").hide();hotelDiv.children("div[stu='show']").hide();hotelDiv.append(html);var ul=hotelDiv.children("div[stu='all']");var lis=ul.find("li[mark]").show();var closeLis=ul.find("li[mark='close']").hide();}if(this.ListRightMap!=null){this.ListRightMap.reloadMapData();}}.bind(this),false,"POST");}else{hotelDiv.children("div[stu='two']").hide();hotelDiv.children("div[stu='show']").hide();hotelDiv.children("div[stu='all']").show();hotelDiv.children("div[stu='hide']").show();if(this.ListRightMap!=null){this.ListRightMap.reloadMapData();}}break;case"ShowTwo":var currHotelId=element.parent().attr("hotelid");var hotelDiv=$("#hotelList").children("div[id=hotel"+currHotelId+"]:last");hotelDiv.children("div[stu='two']").show();hotelDiv.children("div[stu='show']").show();hotelDiv.children("div[stu='all']").hide();hotelDiv.children("div[stu='hide']").hide();break;}this.roomPlayer.OnClickHotelDiv(evt);},showMap:function(hotelId,otherHotelIds,poiJson,cityName,language,tab,sosoId,heading,pitch,room){var hotelName=$("#hotel"+hotelId).find("dl.t2").find("a").attr("title");var hotelData=this.roomPlayer.getHotelData(hotelId);var a=$("a.bh[hotelid='"+hotelId+"']");if((tab=="map")&&(a.length==0||a.attr("lat")<=0||a.attr("lng")<=0)){return;}if(tab=="soso"&&a.length==0){return;}var hotelJson={HotelId:hotelId,HotelName:hotelName,Lat:a.attr("lat"),Lng:a.attr("lng"),MoneySymb:Object.isNull(hotelData)?"":hotelData.MoneySymbol,LowestPrice:Object.isNull(hotelData)?"":hotelData.LowestPrice};var otherOtherList=new Array();if(!Object.isNull(otherHotelIds)){var otherHotelIdList=otherHotelIds.split(",");for(var i=0;i<otherHotelIdList.length;i++){var hotelid=otherHotelIdList[i];if(hotelid==hotelId){continue;}var hotelname=$("#hotel"+hotelid).find("dl.info dt").find("a").attr("title");var hoteldata=this.roomPlayer.getHotelData(hotelid);a=$("a.map[hotelid='"+hotelid+"']");if(a.length==0||a.attr("lat")<=0||a.attr("lng")<=0){continue;}var json={HotelId:hotelid,HotelName:hotelname,Lat:a.attr("lat"),Lng:a.attr("lng"),MoneySymb:Object.isNull(hoteldata)?"":hoteldata.MoneySymbol,LowestPrice:Object.isNull(hoteldata)?"":hoteldata.LowestPrice};otherOtherList.push(json);}}MapJson={CurrentHotelMapInfo:hotelJson,OtherHotelMapInfo:otherOtherList,Poi:poiJson,CityName:cityName,Language:language};var wind=new Dialog({title:this.Language.toLowerCase()=="cn"?(tab=="soso"?"街景":"Map"):"Map",htmlContent:"<div id='t_map' style='width: 630px; height: 465px;'><iframe name='mapWindow' id='mapWindow' frameborder='0' scrolling='no' src='about:blank' style='margin:0;padding:0;width: 625px; height: 460px;'></iframe></div>",width:650,height:500,initEvent:function(windowElement){}.bind(this)});wind.show();var linkParam="";if(ListController.CampaignId==""){linkParam="?tab="+tab+(sosoId==null?"":("&sosoId="+sosoId));}else{linkParam="&tab="+tab+(sosoId==null?"":("&sosoId="+sosoId));}var iframeSrc=this.popupMapNewUrl.eval({language:ListController.Language.toLowerCase()})+linkParam+"&heading="+heading+"&pitch="+pitch+"&room="+room;$("#mapWindow").attr("src",iframeSrc);},writeHotelCookie:function(){Globals.cookie("ShHotel","",{InDate:this.m_preDate.val(),OutDate:this.m_endDate.val(),CityID:this.SearchRequestInfo.CityId},{expires:11,path:"/",secure:false});if(this.Language=="CN"&&!Object.isNull(this.SearchRequestInfo.CityName)){Globals.cookie("ShHotel","",{CityNameCN:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});Globals.cookie("ShHotel","",{CityName:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});if(!String.isNullOrEmpty(this.CityNameEn)){Globals.cookie("ShHotel","",{CityNameEN:this.CityNameEn},{expires:11,path:"/",secure:false});}}if(this.Language=="EN"&&!String.isNullOrEmpty(this.CityNameEn)){Globals.cookie("ShHotel","",{CityNameEN:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});}},OnClickPageDivDown:function(b){b.preventDefault();var a=Event.element(b);this.isChangePage=true;var c=a.parent().attr("method");switch(c){case"prev":if(this.PageInfo.pageIndex>1){this.SearchRequestInfo.PageIndex=(this.PageInfo.pageIndex-2)*this.PageInfo.bate+1;this.getHotelList();this.changePageCss();this.screenIndex=1;}break;case"next":if(this.PageInfo.pageIndex<this.PageInfo.pageCount){this.SearchRequestInfo.PageIndex=this.PageInfo.pageIndex*this.PageInfo.bate+1;this.getHotelList();this.changePageCss();this.screenIndex=1;}break;case"unWorkPage":this.SearchRequestInfo.PageIndex=(parseInt(a.text())-1)*this.PageInfo.bate+1;this.getHotelList();this.changePageCss();this.screenIndex=1;break;case"first":if(this.PageInfo.pageIndex>1){this.SearchRequestInfo.PageIndex=1;this.getHotelList();this.changePageCss();this.screenIndex=1;}break;case"lastP":if(this.PageInfo.pageIndex<this.PageInfo.pageCount){this.SearchRequestInfo.PageIndex=(this.PageInfo.pageCount-1)*this.PageInfo.bate+1;this.getHotelList();this.changePageCss();this.screenIndex=1;}break;}},changePageCss:function(){var c=this.PageInfo;var d=this.pageDivDown.find("ul");var b=d.children();for(var a=0;a<b.length-4;a++){d.children(":last").prev().remove();}if(this.PageInfo.rowTotal<=1){this.pageDivDown.attr("style","display:none");}else{this.pageDivDown.attr("style","display:");if(this.PageInfo.pageCount<8){for(var a=1;a<=this.PageInfo.pageCount;a++){if(a==this.PageInfo.pageIndex){d.children(":last").before('<li class="page_on">'+a+"</li>");}else{d.children(":last").before('<li method="unWorkPage"><a href="#top">'+a+"</a></li>");}}}else{if(this.PageInfo.pageIndex<6){for(var a=1;a<=7;a++){if(a==this.PageInfo.pageIndex){d.children(":last").before('<li class="page_on">'+a+"</li>");}else{d.children(":last").before('<li method="unWorkPage"><a href="#top">'+a+"</a></li>");}}d.children(":last").before('<li method="lastP"><a href="#top">...'+this.PageInfo.pageCount+"</a></li>");}else{if(this.PageInfo.pageIndex>=this.PageInfo.pageCount-3){d.children(":last").before('<li method="first"><a href="#top">1...</a></li>');for(var a=this.PageInfo.pageCount-6;a<=this.PageInfo.pageCount;a++){if(a==this.PageInfo.pageIndex){d.children(":last").before('<li class="page_on">'+a+"</li>");}else{d.children(":last").before('<li method="unWorkPage"><a href="#top">'+a+"</a></li>");}}}else{d.children(":last").before('<li method="first"><a href="#top">1...</a></li>');for(var a=this.PageInfo.pageIndex-3;a<=this.PageInfo.pageIndex+2;a++){if(a==this.PageInfo.pageIndex){d.children(":last").before('<li class="page_on">'+a+"</li>");}else{d.children(":last").before('<li method="unWorkPage"><a href="#top">'+a+"</a></li>");}}d.children(":last").before('<li method="lastP"><a href="#top">...'+this.PageInfo.pageCount+"</a></li>");}}}if(this.PageInfo.pageIndex<=1||this.PageInfo.pageCount==1){d.find("li:nth-child(2)").attr("class","page_btn grey");d.find("li:nth-child(3)").attr("class","page_btn grey");}else{d.find("li:nth-child(2)").attr("class","page_btn");d.find("li:nth-child(3)").attr("class","page_btn");}if(this.PageInfo.pageIndex==this.PageInfo.pageCount){d.children(":last").attr("class","page_btn grey");}else{d.children(":last").attr("class","page_btn");}this.li_pageDown.html(String.format(ListController.Resources.PageCount,this.PageInfo.pageCount));}},OnOnlyNumber:function(a){if(a.keyCode==13){this.surePrice.trigger("click");return true;}if(a.keyCode==37||a.keyCode==39||a.keyCode==46){return true;}if((a.keyCode<48&&a.keyCode>=32)||(a.keyCode>57&&a.keyCode<96)||a.keyCode>105){return false;}},getHotelList:function(c){this.divSuggest.hide();var d=this.showLoading();var b=(typeof(c)!="undefined"&&c)?true:false;this.isDataLoading=true;this.divBookRating.html("");this.divBookRating.hide();ListController.Search(b?this.NoHotelResultRInfo:this.SearchRequestInfo,false,function(e){if(!Object.isNull(d)){d.close();d=null;}if(!e.success||Object.isNull(e.value)){return false;}if(!Object.isNull(e.value)&&!Object.isNull(e.value.RequestInfo)){this.SearchRequestInfo.HotelCount=e.value.RequestInfo.HotelCount;if(Object.isNull(c)&&c!=true){this.SearchRequestInfo.BookingenableRate=e.value.RequestInfo.BookingenableRate;this.showBookRating(e.value.RequestInfo.BookingenableRate);}this.PageInfo=this.GetPageInfoByRequest(this.SearchRequestInfo);}this.screenIndex=1;this.DrawHotelListPage(e,0,"",b,b);var f={"1":"elong","2":"priceAsc","3":"priceDesc","5":"popu","6":"distinct"}[this.SearchRequestInfo.HotelSort]||"elong";this.setSortButtonStyle(f);this.ResetListEvent();this.HotelSearchTrigger(this.SearchRequestInfo);this.isDataLoading=false;}.bind(this),false,"POST");this.ResetFilterUIByRequestNew(this.SearchRequestInfo);var a=200;a=$("#searchBox").offset().top;$("html, body").animate({scrollTop:a},400);},setStarHtml:function(hotelInfo){if(Object.isNull(hotelInfo)||typeof(hotelInfo.Star)=="undefined"){return"";}var starLevel_html="";var star=hotelInfo.Star;var starTips="";var starhotel1=ListController.WebCategory=="Elong"?this.res.StarHotel1:this.res.StarHotel1.replace("eLong","").replace("艺龙","");if(star>=25){switch(star){case 25:case 30:starTips=starhotel1.replace("{0}",this.res.ElongStar3);break;case 35:case 40:starTips=starhotel1.replace("{0}",this.res.ElongStar4);break;case 45:case 50:starTips=starhotel1.replace("{0}",this.res.ElongStar5);break;}starLevel_html=this.elongStarLevelTemp.eval({StarLevel:star,StarLevelTips:starTips});}else{if(star>2){starTips=this.res.StarHotel.replace("{0}",star);starLevel_html=this.starLevelTemp.eval({StarLevel:star,StarLevelTips:starTips});}else{starLevel_html=this.starLevelTemp.eval({StarLevel:0,StarLevelTips:""});}}return starLevel_html;},DrawHotelListPage:function(i,c,b,f){$("#noHotelResultCommend").hide();if(f){var d=this.GetSearchStr(this.NoHotelResultRInfo);var g=this.GetRandomNum();if(!String.isNullOrEmpty(d)){if(this.Language=="CN"){var e='我们为您找到了<span class="bold">'+d+"</span>相关的Hotel：";}else{var e='We\'ve found hotels related to <span class="bold">'+d+"</span>for you.";}}else{if(this.Language=="CN"){var e='<img src="http://www.elongstatic.com/hotels/pic/lkjlkjl551jlkj14hlkh.jpg?cache='+g+'" />您可能对以下Hotel感兴趣：';}else{var e='<img src="http://www.elongstatic.com/hotels/pic/lkjlkjl551jlkj14hlkh.jpg?cache='+g+'" />You may also interested in：';}}if(!Object.isNull(i)&&i.success&&!Object.isNull(i.value)&&!Object.isNull(i.value.ListStaticInfos)){$("#noHotelResultCommend").html(e).show();this.BuildHotelListHtml(i.value.ListStaticInfos,c,b);$("#screenList").attr("index",this.screenIndex);if(this.SearchRequestInfo.ListType=="Common"){this.LoadHotelRoomData(false);}else{if(this.SearchRequestInfo.ListType=="Simple"){this.LoadPriceForSimpleList();}}this.renderMapData();}else{this.GetRecommendHotel();}}else{$("#NoHotels").hide();if(!Object.isNull(i)&&i.success&&!Object.isNull(i.value)&&!Object.isNull(i.value.H1)){document.title=i.value.H1;this.lastbread.html(i.value.H1);}if(!Object.isNull(i)&&i.success&&!Object.isNull(i.value)&&!Object.isNull(i.value.Title)){document.title=i.value.Title;}if(!Object.isNull(i.value.PageInfo)){this.hotelNumC.html(i.value.PageInfo.TotalRow);$("#HotelCountN").html(i.value.PageInfo.TotalRow);}if(!Object.isNull(i)&&i.success&&!Object.isNull(i.value)&&!Object.isNull(i.value.PageInfo)){ListController.PageInfo=i.value.PageInfo;this.changePageCss();}if(!Object.isNull(i)&&i.success&&!Object.isNull(i.value.ListStaticInfos)){this.BuildHotelListHtml(i.value.ListStaticInfos,c,b);$("#screenList").attr("index",this.screenIndex);if(this.SearchRequestInfo.ListType=="Common"){this.LoadHotelRoomData(false);}else{if(this.SearchRequestInfo.ListType=="Simple"){this.LoadPriceForSimpleList();}}this.NoHotelNoScreen=false;}else{if(c==0){$("#hotelList").empty();var j="";this.condition=$("#tiaojian");this.condition.find("li").each(function(){j+="【"+$(this).text()+"】,";});if(j.length>0){j=j.substr(0,j.length-1);}var a="<dt></dt>";var g=this.GetRandomNum();if(this.Language=="CN"){a+=' <dd class="t14 bold">很抱歉，没有找到符合您要求的Hotel。</dd><dd>建议您适当减少已选择的：'+j.trim()+"<a href=\"javascript:;\" rel='nofollow' method='delAll'>清空筛选条件</a><img src=\"http://www.elongstatic.com/hotels/pic/sgsdfgsdg564.jpg?cache="+g+'" /></dd>';}else{a+='<dd class="t14 bold">Sorry,there are no hotels available that match all of your search criteria. </dd><dd>You can try again with less criteria: '+j.trim()+"<a href=\"javascript:;\" rel='nofollow' method='delAll'>clear criteria</a></dd>";}$("#NoHotels").html(a).show();this.NoHotelResultRInfo=Object.clone(this.SearchRequestInfo);this.NoHotelNoScreen=true;this.GetCommendForNoHotels(this.NoHotelResultRInfo);$("#NoHotels").bind("click",this.OnClickNewFilterDiv.bindAsEventListener(this));}else{this.NoHotelNoScreen=false;}}this.renderMapData();}FunctionExt.defer(this.LoadHotelListRecentOrder.bind(this),200);this.SearchDataCollect("hotellistasyn");},GetRandomNum:function(){var b="";for(var a=0;a<10;a++){b+=Math.floor(Math.random()*10);}return b;},GetCommendForNoHotels:function(b){var a=true;if(!String.isNullOrEmpty(b.FacilityIds)){this.NoHotelResultRInfo.FacilityIds="";this.getHotelList(a);}else{if(!String.isNullOrEmpty(b.StarLevels)){this.NoHotelResultRInfo.StarLevels="";this.getHotelList(a);}else{if(b.HighPrice!=0||b.LowPrice!=0){this.NoHotelResultRInfo.HighPrice=0;this.NoHotelResultRInfo.LowPrice=0;this.getHotelList(a);}else{if(!String.isNullOrEmpty(b.BrandIds)||!String.isNullOrEmpty(b.HotelName)){this.NoHotelResultRInfo.BrandIds="";this.NoHotelResultRInfo.HotelName="";this.getHotelList(a);}else{if(b.PoiId!=0||!String.isNullOrEmpty(b.PoiName)||(b.AreaId!=0&&!String.isNullOrEmpty(b.AreaName))){this.NoHotelResultRInfo.PoiId=0;this.NoHotelResultRInfo.PoiName="";this.NoHotelResultRInfo.AreaId=0;this.NoHotelResultRInfo.AreaName="";this.getHotelList(a);}}}}}},GetSearchStr:function(a){var b="";this.condition=$("#filterDivLeft");if(!String.isNullOrEmpty(a.FacilityIds)){this.condition.find("li[method=facilityLabel]").each(function(){b+='"'+$(this).text()+'",';});}if(!String.isNullOrEmpty(a.StarLevels)){this.condition.find("li[method=starLabel]").each(function(){b+='"'+$(this).text()+'",';});}if(a.HighPrice!=0||a.LowPrice!=0){this.condition.find("li[method=priceLabel]").each(function(){b+='"'+$(this).text()+'",';});}if(!String.isNullOrEmpty(a.BrandIds)||!String.isNullOrEmpty(a.HotelName)){this.condition.find("li[method=brandLabel]").each(function(){b+='"'+$(this).text()+'",';});}if(a.PoiId!=0||!String.isNullOrEmpty(a.PoiName)||(a.AreaId!=0&&!String.isNullOrEmpty(a.AreaName))){this.condition.find("li[method=locationLabel]").each(function(){b+='"'+$(this).text()+'",';});}if(b.length>0){b=b.substr(0,b.length-1);}return b;},GetLatLng:function(a){if(this.Language=="CN"){if(this.hdIsGoogle.val()=="0"){return{Lat:a.Lat_Baidu,Lng:a.Lng_Baidu};}else{return{Lat:a.Lat_Google,Lng:a.Lng_Google};}}else{return{Lat:a.Lat_Google,Lng:a.Lng_Google};}},BuildHotelListHtml:function(resList,commendtype,commendhtml){var ListType=this.SearchRequestInfo.ListType;var hotel_html="";var unsignedNum=0;var MapHotelIds=new Array();var RoomHotelIds=new Array();var cityNameEn=FilterPinyinForUrl(this.CityNameEn);for(var i=0;i<resList.length;i++){var hotelinfo=resList[i];if(!hotelinfo.IsUnsigned){MapHotelIds.push(hotelinfo.HotelId);RoomHotelIds.push(hotelinfo.HotelId+(String.isNullOrEmpty(hotelinfo.ShadowHotelId)?"":"-"+hotelinfo.ShadowHotelId));}else{unsignedNum+=1;}var subhName=this.Language=="CN"?(hotelinfo.HotelNameCn.length>16?hotelinfo.HotelNameCn.substr(0,15)+"...":hotelinfo.HotelNameCn):(hotelinfo.HotelNameEn.length>36?hotelinfo.HotelNameEn.substr(0,35)+"...":hotelinfo.HotelNameEn);var hName=this.Language=="CN"?hotelinfo.HotelNameCn:hotelinfo.HotelNameEn;var ptDisplay="<ul>";var starLevel_html=this.setStarHtml(hotelinfo);var reviewUrl=this.HotelDetailReviewUrl.eval({cityNameEn:cityNameEn,hotelId:hotelinfo.HotelId});if(hotelinfo.IsUnsigned){reviewUrl=this.HotelUnsignedUrl.eval({hotelId:hotelinfo.HotelId});}var totalComment='<a target="_blank" href="'+reviewUrl+'"></a>';var goodComment="暂无点评";if(!String.isNullOrEmpty(hotelinfo.CommentGoodRate)){totalComment='<a target="_blank" href="'+reviewUrl+'">'+(this.Language=="CN"?(hotelinfo.TotalComment==0?"发点评得消费券":"来自"+hotelinfo.TotalComment+"条点评"):(hotelinfo.TotalComment==0?"Reviews coming soon":hotelinfo.TotalComment+" reviews"))+"</a>";goodComment=this.Language=="EN"?'<img width="31" height="18" alt="daodao" src="http://www.tripadvisor.com/img/cdsi/img2-daodao/branding/daodao31x18-11075-1.png" complete="complete"/><span title="TripAdvisor Traveller Reviews" class=\'tripadvisorLOGO TL'+hotelinfo.GradeComment+"'></span>":String.isNullOrEmpty(hotelinfo.CommentGoodRate)?'<a target="_blank" href="'+reviewUrl+'" title="查看'+hName+'Comments">暂无点评</a>':'<font color="#555">Good Reviews率：</font><a target="_blank" href="'+reviewUrl+'" title="查看'+hName+'Comments"><span class="bfb">'+hotelinfo.CommentGoodRate+"</span></a>";}else{if(this.Language=="EN"){totalComment='<a target="_blank" href="'+this.HotelDetailReviewUrl.eval({cityNameEn:cityNameEn,hotelId:hotelinfo.HotelId})+'">'+(hotelinfo.TotalComment==0?"Reviews coming soon":hotelinfo.TotalComment+" reviews")+"</a>";goodComment='<img width="31" height="18" alt="daodao" src="http://www.tripadvisor.com/img/cdsi/img2-daodao/branding/daodao31x18-11075-1.png" complete="complete"/><span title="TripAdvisor Traveller Reviews" class=\'tripadvisorLOGO TL'+hotelinfo.GradeComment+"'></span>";}}var areaurl="javascript:;";if(hotelinfo.Commerical!=null&&hotelinfo.Commerical.HotelAreaName!=""&&!hotelinfo.IsUnsigned){areaurl=this.HotelListUrl.eval({language:this.Language.toLowerCase(),cityid:this.tempCityId});if(ListController.WebCategory!="Elong"){areaurl=areaurl+"&areaid="+hotelinfo.Commerical.HotelAreaId+"&listtype="+ListType;}else{areaurl=areaurl+"?areaid="+hotelinfo.Commerical.HotelAreaId+"&listtype="+ListType;}}var gradeClass="";if(hotelinfo.Grade==5){gradeClass="diamond";}else{if(hotelinfo.Grade==6){gradeClass="crown";}}var imgerror="http://www.elongstatic.com/hotels/pic/nophoto_"+this.Language+"_error160110.png";var imageTypeUrl=hotelinfo.ImageUrl_160x110;var smallImageForTwoPage=String.isNullOrEmpty(imageTypeUrl)?imgerror:imageTypeUrl;var bigImageForTwoPage=String.isNullOrEmpty(hotelinfo.ImageUrl_350)?imgerror:hotelinfo.ImageUrl_350;var weifang=hotelinfo.HasWeiFang==1?this.Language=="CN"?"今日特价":"Last Minute Deal":"";var latlng=this.GetLatLng(hotelinfo);var introduce="";var isHasPoi=this.SearchRequestInfo!=null&&(!String.isNullOrEmpty(this.SearchRequestInfo.PoiName)||this.SearchRequestInfo.ReturnKeywordsType=="PoiType"||this.SearchRequestInfo.ReturnKeywordsType=="BigArea")&&hotelinfo.Distance!="-1"&&hotelinfo.Distance!="0";var showMapContentA="";var showMapContentB="";var showSosoContent="";if(latlng.Lat>0&&latlng.Lng>0){if(this.hdIsGoogle.val()=="0"){showMapContentA='<a class="bh mr10"  href="#?" style=\''+(hotelinfo.IsUnsigned?"display:none":"")+'\' rel="nofollow" method="showMap" tab="map" hotelid="'+hotelinfo.HotelId+'" title="'+hName+""+(this.Language=="CN"?"Map":" Map")+"\" lat='"+latlng.Lat+"' lng='"+latlng.Lng+"'><span class='mapicon'></span>"+(this.Language=="CN"?"Map":"View Map")+"</a>";}else{showMapContentA='<a class="bh mr10"  href="#?" style=\''+(hotelinfo.IsUnsigned?"display:none":"")+'\' rel="nofollow" method="showMap" tab="map" hotelid="'+hotelinfo.HotelId+'" title="'+hName+""+(this.Language=="CN"?"Map":" Map")+"\" lat='"+latlng.Lat+"' lng='"+latlng.Lng+"' isgoogle='True' x='"+latlng.Lat+"' y='"+latlng.Lng+"'><span class='mapicon'></span>"+(this.Language=="CN"?"Map":"View Map")+"</a>";}}if(hotelinfo.SosoMapInfo!=null&&!String.isNullOrEmpty(hotelinfo.SosoMapInfo.SvId)&&this.Language=="CN"){showSosoContent='<a class="bh"  href="#?" rel="nofollow" method="showSosoMap" tab="soso" hotelid="'+hotelinfo.HotelId+'" title="'+hName+""+(this.Language=="CN"?"街景":" Soso")+"\" lat='"+latlng.Lat+"' lng='"+latlng.Lng+"' sosoid=\""+hotelinfo.SosoMapInfo.SvId+'" heading="'+hotelinfo.SosoMapInfo.Heading+'" pitch="'+hotelinfo.SosoMapInfo.Pitch+'" room="'+hotelinfo.SosoMapInfo.Zoom+"\"><span class='jjicon'></span>"+(this.Language=="CN"?"街景":"View Soso")+"</a>";}var distanceHtml="";var distanceMi=parseFloat(hotelinfo.Distance)*1000;if(isHasPoi){if(!String.isNullOrEmpty(this.SearchRequestInfo.PoiName)||!String.isNullOrEmpty(this.SearchRequestInfo.Keywords)){var disName="";if(this.SearchRequestInfo.ReturnKeywordsType=="BigArea"){var isEqualBigAreaName=!Object.isNull(this.SearchRequestInfo.BigAreaInfo)&&!String.isNullOrEmpty(hotelinfo.SubAreaName)&&this.SearchRequestInfo.BigAreaInfo.BigAreaName==hotelinfo.SubAreaName;disName=(!String.isNullOrEmpty(this.SearchRequestInfo.PoiName))?this.SearchRequestInfo.PoiName:((!Object.isNull(this.SearchRequestInfo.BigAreaInfo)?this.SearchRequestInfo.BigAreaInfo.BigAreaName:"")+(!String.isNullOrEmpty(hotelinfo.SubAreaName)?(isEqualBigAreaName?"":"："+hotelinfo.SubAreaName):""));}else{disName=(!String.isNullOrEmpty(this.SearchRequestInfo.PoiName)?this.SearchRequestInfo.PoiName:this.SearchRequestInfo.Keywords);}distanceHtml=String.format("{0} {1}",String.format((distanceMi>=100?this.res.distancefrom:this.res.distancefromMi),disName,(distanceMi>=100?hotelinfo.Distance:distanceMi)),showMapContentB);}}else{if(!String.isNullOrEmpty(this.searchByName)&&hotelinfo.Distance!="0"&&hotelinfo.Distance!="-1"){distanceHtml=String.format("{0} {1}",String.format((distanceMi>=100?this.res.distancefrom:this.res.distancefromMi),this.searchByName,(distanceMi>=100?hotelinfo.Distance:distanceMi)),showMapContentB);}}if(hotelinfo.HotelFacilityList!=null&&hotelinfo.HotelFacilityList.length>0){var mark=false;for(var v=0;v<hotelinfo.HotelFacilityList.length;v++){if(mark){introduce+=",";}else{mark=true;}introduce+=hotelinfo.HotelFacilityList[v].BitNumber;}}var areaName=(hotelinfo.Commerical!=null&&!String.isNullOrEmpty(hotelinfo.Commerical.HotelAreaName))?('<a class="link_gray" href="'+areaurl+'">['+hotelinfo.Commerical.HotelAreaName+"]</a>"):"";var address=!String.isNullOrEmpty(hotelinfo.Hotel Address)?('<span title="'+hotelinfo.Hotel Address+'" class="pl5">'+hotelinfo.Hotel Address+"</span>"):"";if(isHasPoi||(!String.isNullOrEmpty(this.searchByName)&&hotelinfo.Distance!="0"&&hotelinfo.Distance!="-1")){areaName="";address="";}var detailUrl=this.HotelDetailUrl.eval({cityNameEn:cityNameEn,hotelId:hotelinfo.HotelId});if(hotelinfo.IsUnsigned){detailUrl=this.HotelUnsignedUrl.eval({hotelId:hotelinfo.HotelId});}var facilityHtml="";if(hotelinfo.HotelFacilityList!=null&&hotelinfo.HotelFacilityList.length>0){for(var fitem=0;fitem<hotelinfo.HotelFacilityList.length;fitem++){if(hotelinfo.HotelFacilityList[fitem].FacilityId=="1"){facilityHtml+='<span class="new_wifi" title="WIFI"></span>';}else{if(hotelinfo.HotelFacilityList[fitem].FacilityId=="5"){facilityHtml+='<span class="new_parking" title="停车场"></span>';}else{if(hotelinfo.HotelFacilityList[fitem].FacilityId=="7"){facilityHtml+='<span class="new_flight" title="可接机"></span>';}}}}}hotel_html=hotel_html+this.hotelTemp.eval({hotelid:hotelinfo.HotelId,LongCuiTag:'<span class="t1_lc" id="longcuiIcon_'+hotelinfo.HotelId+'" style="display: none"></span>',HasWeiFang:hotelinfo.HasWeiFang==1?('<span class="t1_tj"></span>'):"",groupOn:'<span class="t1_tg" id="groupOn_'+hotelinfo.HotelId+'" style="display: none"></span>',detailUrl:'<a target="_blank" href="'+detailUrl+'">',ImgEle:'<img method="bigpic" mark=\'img_'+hotelinfo.HotelId+"' bigpic=\""+bigImageForTwoPage+'" hotelname="'+hName+'" src="'+smallImageForTwoPage+'" alt="'+hName+'"/>',aEnd:"</a>",Grade:"<tt class='"+gradeClass+"'></tt>",HotelName:'<a class="name" target="_blank" href="'+detailUrl+'" title="'+hName+'">'+hName+"</a>",StarLevel:starLevel_html,cuTabel:'<span id="cuLabel_'+hotelinfo.HotelId+'" style="display: none">促</span>',EndStarLevel:"</span>",area:areaName,Distance:distanceHtml,Address:address,HasMap:showMapContentA,hasSoso:showSosoContent,facility:facilityHtml,priceDiv:!hotelinfo.IsUnsigned?('<div class="t4 new_price" id="priceRegion_'+hotelinfo.HotelId+'"><span class="price" id="dynaLP_'+hotelinfo.HotelId+'"></span><br/></div>'):('<div class="t4 mvtprice">'+(hotelinfo.MinPrice>0?('<span class="t4ckj">参考价</span><span class="price pricemvt"><span class="fh">&yen;</span>'+hotelinfo.MinPrice+'<span class="fb">起</span><br/></span>'):'<span class="dhzx">需电话咨询</span>')+"</div>"),comment:goodComment,TotalComment:!String.isNullOrEmpty(hotelinfo.CommentGoodRate)?"来自"+hotelinfo.TotalComment+"条点评":"",RoomLoading:!hotelinfo.IsUnsigned?'<div class="clear loa" id="load_'+hotelinfo.HotelId+'"><span class="loading"></span></div>':""});}this.searchByName="";this.mapHotelIds=MapHotelIds.join(",");this.roomHotelIds=RoomHotelIds.join(",");if(unsignedNum==resList.length){this.mapHotelIds="00000000";this.roomHotelIds="00000000";}if(commendhtml!=""){hotel_html=commendhtml+hotel_html;}if(commendtype==0){$("#hotelList").empty();}$("#hotelList").append(hotel_html);hotel_html=null;},ResetListEvent:function(){this.hotelList.unbind("mouseover").bind("mouseover",this.OnMouseoverhotelList.bindAsEventListener(this));this.hotelList.find("img[method='bigpic']").unbind("mouseover").bind("mouseout",this.OnMouseouthotelListImg.bindAsEventListener(this));this.editDate=$("#hotelList").find("#editDate");if(this.editDate!=null){this.editDate.bind("click",this.OnClickeditDate.bindAsEventListener(this));}},commendHotel:function(g,c,b){if(Object.isNull(g.value)||g.value.length==0){return false;}var a='<div class="clear"></div>';if(c=="Empty"){if(this.OneInfo.areaType=="1"||this.OneInfo.areaType=="2"||this.OneInfo.areaType=="4"||this.OneInfo.areaType=="99"){a+='<p class="t14">'+(this.Language=="CN"?'对不起，在<span class="red">'+this.OneInfo.areaName+"</span> 附近"+this.SearchRequestInfo.Distance+"公里内未找到符合您搜索条件的Hotel。":"Sorry, there are no hotels available that match all of your search criteria.")+"</p>";}else{a+='<p class="t14">'+(this.Language=="CN"?"对不起，未找到符合您搜索条件的Hotel。":"Sorry, there are no hotels available that match all of your search criteria.")+"</p>";}if(this.Language=="CN"){a+="<p>不用着急，您可以：</p>";}if(this.OneInfo.areaType=="1"||this.OneInfo.areaType=="2"||this.OneInfo.areaType=="4"||this.OneInfo.areaType=="99"){if(this.SearchRequestInfo.Distance!="20"&&this.Language!="EN"){var i=window.location.href.indexOf("?")>-1?"&":"?";a+='<p style="display:'+(this.SearchRequestInfo.Distance=="10"?"none":"")+';"><a class="underline" href="'+window.location.href.replace("#top","")+i+'Distance=10">看看"'+this.OneInfo.areaName+'" 附近10公里内有没有Hotel；</a></p>';a+='<p style="display:'+(this.SearchRequestInfo.Distance=="20"?"none":"")+';"><a class="underline" href="'+window.location.href.replace("&Distance=10","").replace("#top","")+i+'Distance=20">看看"'+this.OneInfo.areaName+'" 附近20公里内有没有Hotel。</a></p>';}else{a+='<p><a id="editDate" method="update" class="underline" href="#update">'+(this.Language=="CN"?"重新设置条件进行搜索":"Update the results")+"</a></p>";}}else{a+='<p><a id="editDate" method="update" class="underline" href="#update">'+(this.Language=="CN"?"重新设置条件进行搜索":"Update the results")+"</a></p>";}if(!Object.isNull(g.value.ListStaticInfos)){a+=this.Language=="CN"?"以下是住客反馈比较好的"+this.SearchRequestInfo.CityName+"Hotel：":"Here are the recommended hotels with rooms available.";}}else{if(c==null||c=="Normal"){if(this.Language=="CN"){a+='<dl class="noResults clx"><dtstyle="display:none;"></dt><dd class="t14">以下是'+b+'<span class="t14 bold">周边有空余房间</span>的OtherHotel：</dd></dl>';}else{a+='<dl class="noResults clx"><dt></dt><dd class="t14">Here are the recommended hotels with rooms available.</dd></dl>';}}else{if(c=="IsNotBook"||c=="NoBook"){if(this.Language=="CN"){a+='<dl class="noResults clx"><dt></dt><dd class="t14"><span class="t14 bold">很抱歉，</span><span class="t14 bold">'+b+"</span>  在 "+this.SearchRequestInfo.CheckInDate.replace("0:00","")+" 至"+this.SearchRequestInfo.CheckOutDate.replace("0:00","")+' 期间部分日期暂时不能预订。</dd><dd class="t14">不用灰心，我们为您找到了附近有空房的Hotel：</dd></dl>';}else{a+='<dl class="noResults clx"><dt></dt><dd class="t14"><span class="t14 bold"> Sorry, </span>we find no room availability in <span class="t14 bold">'+b+"</span>   from "+this.SearchRequestInfo.CheckInDate.replace("12:00 AM","")+" to "+this.SearchRequestInfo.CheckOutDate.replace("12:00 AM","")+'.</dd><dd class="t14">Don\'t worry, we find available hotels nearby for you:</dd></dl>';}}else{if(c=="Full"){if(this.Language=="CN"){a+='<dl class="noResults clx"><dt></dt><dd class="t14"><span class="t14 bold">很抱歉，</span><span class="t14 bold">'+b+"</span>  在 "+this.SearchRequestInfo.CheckInDate.replace("0:00","")+" 至"+this.SearchRequestInfo.CheckOutDate.replace("0:00","")+' 期间部分日期没有空余房间。</dd><dd class="t14">不用灰心，我们为您找到了附近有空房的Hotel：</dd></dl>';}else{a+='<dl class="noResults clx"><dt></dt><dd class="t14"><span class="t14 bold"> Sorry, </span>we find no room availability in <span class="t14 bold">'+b+"</span>   from "+this.SearchRequestInfo.CheckInDate.replace("12:00 AM","")+" to "+this.SearchRequestInfo.CheckOutDate.replace("12:00 AM","")+'.</dd><dd class="t14">Don\'t worry, we find available hotels nearby for you:</dd></dl>';}}else{var f=this.GetRandomNum();if(this.Language=="CN"){var d='<div class="recommendation"><img src="http://www.elongstatic.com/hotels/pic/lkjlkjl551jlkj14hlkh.jpg?cache='+f+'" />您可能对以下Hotel感兴趣：</div>';}else{var d='<div class="recommendation"><img src="http://www.elongstatic.com/hotels/pic/lkjlkjl551jlkj14hlkh.jpg?cache='+f+'" />You may also interested in：</div>';}if($("#noResults").is(":visible")){$("#noResults").after(d);$("#noResults").bind("click",this.OnClickNewFilterDiv.bindAsEventListener(this));}else{if($("div#noResultDiv").is(":visible")){$("div.newHotelInfo.clx").after(d);}else{var e="";if(this.Language=="CN"){e+='<dt></dt><dd class="t14"><span class="t14 bold">很抱歉，</span>我们在您搜索的日期内没有找到符合条件的Hotel </dd><dd class="t14">不用灰心，我们为您推荐以下Hotel：</dd></dl>';}else{e+='<dt></dt><dd class="t14"><span class="t14 bold">Sorry, </span>we didn\'t find hotels matching your requests. </dd><dd class="t14">There are some hotels we recommend to you</dd></dl>';}$("#NoHotels").html(e).show();}}}}}}a+="";this.searchByName=b;this.BuildHotelListHtml(g.value,1,a);this.ResetListEvent();if(this.SearchRequestInfo.ListType=="Common"){this.LoadHotelRoomData(false);}else{if(this.SearchRequestInfo.ListType=="Simple"){this.LoadPriceForSimpleList();}}this.renderMapData();},OnClickeditDate:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"update":new CalendarWindow({eventElement:this.searchElement.m_preDate,selectedDate:this.searchElement.m_preDate.val(),language:this.Language,onSelected:function(d){this.searchElement.m_preDate.val(d);this.searchElement.m_preDate.click();}.bind(this)});break;}},showLoading:function(){strCC=this.divSearch.html();var a=new Dialog({title:"",htmlContent:strCC,width:480,initEvent:function(b){}.bind(this)});a.show();return a;},checkMoney:function(b,a){if(!validator.valid(b,"notEmpty")&&!validator.valid(a,"notEmpty")){return false;}if(validator.valid(b,"notEmpty")){if(!validator.valid(b,"money")){return false;}}if(validator.valid(a,"notEmpty")){if(!validator.valid(a,"money")){return false;}}if(validator.valid(b,"notEmpty")&&validator.valid(a,"notEmpty")){if(b.length>a.length){return false;}if(parseInt(b)>65535||parseInt(a)>65535){return false;}if(parseInt(b)>parseInt(a)){return false;}}return true;},getFormElement:function(a,b){var d=new Object();for(var c=0;c<arguments.length;c++){var e=arguments[c];e.find("input").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});e.find("select").each(function(){var f=$(this);if(!String.isNullOrEmpty(f.attr("method"))){d[f.attr("method")]=f;}});}return d;},destroyEvent:function(){$(window).unload(this.dispose.bind(this));},GetMergeAsycData:function(f){var c=this.SearchRequestInfo.CityId;var a=this.SearchRequestInfo.CheckInDate;var b=this.SearchRequestInfo.CheckOutDate;var e=ListController.Language;var d=this.mapHotelIds;if(f==4){if(d==null||d==""){return;}}ListController.GetMergeAsycData(f,c,d,a,b,e,function(g){if(g.success&&g.value!=null){if(!String.isNullOrEmpty(g.value.LatestOrderHotel)){this.RecentOrdersOfCityContainer.html(g.value.LatestOrderHotel);this.RecentOrdersOfCityContainer.slideDown(800);}if(ListController.CampaignId==""){if(g.value.OnlineGuest!=null&&g.value.OnlineGuest.TotalCount!=""){$("#RealTimeBrowserData").append(g.value.OnlineGuest.TotalCount);$("#RealTimeBrowserDataContainer").addClass("com_hotresults com_realtime viebornoe");$("#RealTimeBrowserDataContainer").show();this.showTimer=FunctionExt.defer(function(){$("#RealTimeBrowserDataContainer").fadeOut(1000);clearTimeout(this.showTimer);this.showTimer=null;},10000,this);$("#hrefRealTimeBrowserDataClose").click(function(){$("#RealTimeBrowserDataContainer").fadeOut(500);this.showTimer=null;});}}if(g.value.OrderList!=null&&g.value.OrderList.length>0){this.ShowHotelListRecentOrder(g.value.OrderList);}}}.bind(this),false,"GET");this.LoadHistoryBrowseHotelsInfo();},BrowserCityDataCollect:function(){try{var b="http://tj.elong.com/hotel/realTimeBrowserData/realTimeCity.gif?channel=hotel&cityID="+this.SearchRequestInfo.CityId+"&rn=";$("#realTimeCity").remove();$("<img id='realTimeCity' width='1' height='1'/>").appendTo($("#m_contentend"));$("#realTimeCity").attr("src",b);}catch(a){}},SearchDataCollect:function(c){try{var b;var g;var f;if(!Object.isNull(this.GlobalData)&&!String.isNullOrEmpty(this.GlobalData.Name)){g=encodeURIComponent(this.GlobalData.Name);}else{g="";}if(!String.isNullOrEmpty(this.SearchRequestInfo.Keywords)){f=encodeURIComponent(this.SearchRequestInfo.Keywords);}else{f="";}if(c=="hotellistsearchbutton"){Elong.sendTJ({DBItemName:"WebMSConnectionString",TableName:"searchKeyword ",channel:"hotel",query:g,sid:Globals.cookie("SessionGuid"),clientIp:"127.0.0.1",logTime:new Date().getDate(),cityId:this.SearchRequestInfo.CityId,inDate:Globals.cookie("ShHotel","InDate"),outDate:Globals.cookie("ShHotel","OutDate"),guid:Globals.cookie("SessionGuid"),app:"hotellistsearchbutton",hasSuggest:1,isSelect:1,sIndex:4});}else{Elong.sendTJ({DBItemName:"WebMSConnectionString",TableName:"GatherHotelSearchData",SessionGuid:Globals.cookie("SessionGuid"),QueryData:g,CityId:this.SearchRequestInfo.CityId,LowPrice:this.SearchRequestInfo.LowPrice,HighPrice:this.SearchRequestInfo.HighPrice,CheckInDate:this.SearchRequestInfo.CheckInDate,CheckOutDate:this.SearchRequestInfo.CheckOutDate,StarLevel:this.SearchRequestInfo.StarLevels,AreaID:this.SearchRequestInfo.AreaId,RegionID:"",CommercialID:"",SearchArea:"",HotelSort:1,BrandID:this.SearchRequestInfo.BrandId,BrandName:"",SearchResult:-1,SessionGuid:Globals.cookie("SessionGuid"),SuggestStatus:this.allInOneData.Accept,CardNo:this.SearchRequestInfo.CardNo});var d="channel=hotel&App="+c+"&QueryData="+f+"&CityId="+this.SearchRequestInfo.CityId+"&LowPrice="+this.SearchRequestInfo.LowPrice+"&HighPrice="+this.SearchRequestInfo.HighPrice+"&CheckInDate="+this.SearchRequestInfo.CheckInDate+"&CheckOutDate="+this.SearchRequestInfo.CheckOutDate+"&StarLevel="+this.SearchRequestInfo.StarLevel+"&AreaID="+this.SearchRequestInfo.AreaId+"&RegionID=&CommercialID=&SearchArea=&HotelSort=1&BrandID="+this.SearchRequestInfo.BrandId+"&BrandName=&SearchResult=-1&SessionGuid="+Globals.cookie("SessionGuid")+"&SuggestStatus="+this.allInOneData.Accept+"&CardNo="+this.SearchRequestInfo.CardNo+"&rn=";}}catch(a){}},CreateGuid:function(){var a="";for(var b=1;b<=32;b++){var c=Math.floor(Math.random()*16).toString(16);a+=c;if((b==8)||(b==12)||(b==16)||(b==20)){a+="-";}}return a;},CreateAndSaveSearchGuid:function(b){var a=b;if(Object.isNull(b)){a=this.CreateGuid();}Globals.cookie("TriggerSearchGUID","",a,{expires:1,path:"/",secure:false});},GetSearchGUID:function(){var a=this.isChangePage?Globals.cookie("TriggerSearchGUID"):null;if(Object.isNull(a)){a=this.CreateGuid();this.CreateAndSaveSearchGuid(a);}this.isChangePage=false;return a;},GetMachineGUID:function(){var a=Globals.cookie("CookieGuid");if(Object.isNull(a)||String.isNullOrEmpty(a)){a="00000000-0000-0000-0000-000000000000";}return a;},HotelSearchTrigger:function(x){try{var y=this.GetSearchGUID();var t=this.GetMachineGUID();var u=x.OrderFromId;var c=x.CardNo;var o=Object.isNull(x.HotelName)?x.Keywords:x.HotelName;var r=x.StarLevels;var n=x.Star=="TwoStar"?"1":"0";var m=x.Star=="Apartment"?"1":"0";var d=x.CheckInDate;var f=x.CheckOutDate;var w=x.LowPrice;var v=(x.HighPrice==0||x.HighPrice=="0")?9999:x.HighPrice;var g=x.CityId;var a=(Object.isNull(x.AreaId)||x.AreaId=="0")?"":x.AreaId;var b=a.length==0?"0":(a.length==4?"2":"1");var p=this.GetHotelNearNameTJ();var k=x.BrandIds;var q=x.StarLevels;var l="";var i=x.PageSize*(this.screenIndex-1);var s=0;this.hotelList.find(".hotelInfo").each(function(){if(s>=i){l+=($(this).attr("id")).replace("hotel","")+",";}s++;});if(l.length>0){l=l.substring(0,l.lastIndexOf(","));}Elong.sendTJ({TableName:"Trigger_HotelSearch",SearchGUID:y,OrderFromId:u,CardNo:c,HotelId:l,HotelName:encodeURIComponent(o),HotelStarString:r,HotelIsEconomic:n,HotelIsApartment:m,CheckInDate:d,CheckOutDate:f,PriceRangeLow:w,PriceRangeHigh:v,CityId:g,AreaId:a,AreaIdType:b,HotelNear:encodeURIComponent(p),HotelDistance:5000,GroupId:k,HotelStar:q,HotelSort:x.HotelSort,ListType:"Common",PageIndex:x.PageIndex,ApCardNo:x.ApCardNo,MachineGUID:t,HotelRankType:x.RankType,SessionGuid:Globals.cookie("SessionGuid")});}catch(j){}},GetHotelNearNameTJ:function(){var a="";if(!String.isNullOrEmpty(this.SearchRequestInfo.Keywords)){return this.SearchRequestInfo.Keywords;}else{if(!String.isNullOrEmpty(this.SearchRequestInfo.PoiName)){return this.SearchRequestInfo.PoiName;}else{if(!String.isNullOrEmpty(this.SearchRequestInfo.AreaName)){return this.SearchRequestInfo.AreaName;}else{if(!String.isNullOrEmpty(this.SearchRequestInfo.BrandName)){return this.SearchRequestInfo.BrandName;}else{if(!String.isNullOrEmpty(this.SearchRequestInfo.HotelName)){return this.SearchRequestInfo.HotelName;}}}}}return a;},HotelAjaxSearchMonitor:function(u){try{var v=this.GetSearchGUID();var p=this.GetMachineGUID();var q=u.OrderFromId;var c=u.CardNo;var m=Object.isNull(u.HotelName)?u.Keywords:u.HotelName;var o=u.StarLevel;var l=u.Star=="TwoStar"?"1":"0";var k=u.Star=="Apartment"?"1":"0";var d=u.CheckInDate;var f=u.CheckOutDate;var t=u.LowPrice;var s=(u.HighPrice==0||u.HighPrice=="0")?9999:u.HighPrice;var g=u.CityId;var a=(Object.isNull(u.AreaId)||u.AreaId=="0")?"":u.AreaId;var b=a.length==0?"0":(a.length==4?"2":"1");var n=this.GetHotelNearNameTJ();var j=u.BrandId;var r="&OrderFromId="+q+"&CardNo="+c+"&HotelName="+encodeURIComponent(m)+"&HotelStarString="+o+"&HotelIsEconomic="+l+"&HotelIsApartment="+k+"&CheckInDate="+d+"&CheckOutDate="+f+"&PriceRangeLow="+t+"&PriceRangeHigh="+s+"&CityId="+g+"&AreaId="+a+"&AreaIdType="+b+"&HotelNear="+encodeURIComponent(n)+"&Distance=5000&GroupId="+j+"&HotelSort="+u.HotelSort+"&ListType=Common&PageIndex="+u.PageIndex+"&ApCardNo="+u.ApCardNo+"&MachineGUID="+p+"&HotelRankType="+ListController.HotelRankType+"&rn="+Math.random();}catch(i){}},buildServiceIndex:function(a){if(!Object.isNull(a)&&a.ShowServiceIndex){var b=$("#hotel"+a.HotelId).find("div[class='t3 new_dp']");var c=String.format('<div class="t6 new_service" method="serviceindex" hotelid="{1}">服务指数：<span class="sz">{0}</span><span class="zs">/5分</span></div>',a.ServiceIndex.ServiceIndex.toFixed(1),a.HotelId);b.append(c);}},buildFromPrice:function(hotel){try{var hotelPrice=$("#dynaLP_"+hotel.HotelId);var price="";var PriceHtml="";if(!String.isNullOrEmpty(hotel.LowestPrice)){price=hotel.LowestPrice;PriceHtml=String.format(this.Language.toLowerCase()=="cn"?'<span class="fh">{0}</span>{1}<span class="fb">{2}</span>':'<span class="fb">{2}</span><span class="fh">{0}</span>{1}',hotel.MoneySymbol,price,this.Language.toLowerCase()=="cn"?"起":"From ");}else{var redictUrl=this.HotelDetailUrl.eval({cityNameEn:this.CityNameEn,hotelId:hotel.HotelId});$("#dynaLP_"+hotel.HotelId).removeClass("price");PriceHtml='您选择的日期无法预订<br><a target="_blank" href="'+redictUrl+'#iTop">更换日期查询</a>';}hotelPrice.html(PriceHtml);var Desc="";if(hotel.IsLongcui){Desc=this.res.LongcuiDesc;}else{if(hotel.IsXianshiqiang){Desc=this.res.XianshiqiangDesc;}}var huajiaHtml=(parseFloat(hotel.FavorablePrice)>0)?"<span class='huajia' title='"+Desc+"'>"+hotel.FavorableMoneySymbol+hotel.FavorablePrice+"</span>":"";$("#priceRegion_"+hotel.HotelId).append(huajiaHtml);var couponPrice="";if(hotel.CouponPrice>0){couponPrice='<span class="iconFan"  method="coupon">'+hotel.CouponPrice+"元</span>";}$("#priceRegion_"+hotel.HotelId).append(couponPrice);if(!String.isNullOrEmpty(hotel.PriceComparison)&&hotel.PriceComparison!=0){$("#priceRegion_"+hotel.HotelId).append('<div><span>比周边同类</span><span class="org2">低'+hotel.PriceComparison+"%</span></div>");}if(hotel.HotelRoomSimpleList!=undefined&&hotel.HotelRoomSimpleList.length>0){hotelPrice.attr("rpid",((hotel.HotelRoomSimpleList[0].RatePlanList!=null&&hotel.HotelRoomSimpleList[0].RatePlanList[0].RatePlanId)||(hotel.HotelRoomSimpleList[0].LongCuiRatePlanList!=null&&hotel.HotelRoomSimpleList[0].LongCuiRatePlanList[0].RatePlanId)));hotelPrice.attr("roomid",hotel.HotelRoomSimpleList[0].RoomId);}hotelPrice.attr("roomhotelid",hotel.HotelId);hotelPrice.attr("method","priceUrl");hotelPrice.addClass("cp");return price;}catch(e){return 0;}},render:function(){this.CityNameEn=ListController.AjaxInfo.City.CityNameEn;this.ResetFilterUIByRequestNew(this.SearchRequestInfo);this.imgLazyLoad();if(this.SearchRequestInfo.ListType=="Common"){this.LoadHotelRoomData(this.PageInfo.rowTotal==1,true);}else{if(this.SearchRequestInfo.ListType=="Simple"){this.LoadPriceForSimpleList();}}this.CreateAndSaveSearchGuid(null);this.HotelSearchTrigger(this.SearchRequestInfo);this.BrowserCityDataCollect();var a={ByDefault:"elong",ByPriceAsc:"priceAsc",ByPriceDesc:"priceDesc",ByReview:"popu",ByDistance:"distinct"}[this.SearchRequestInfo.HotelSort]||"elong";this.setSortButtonStyle(a);if(this.OneInfo!=null&&this.OneInfo.lat!=0&&this.OneInfo.lng!=0){this.setSortButtonStyle("distinct");}this.writeHotelCookie();this.showBookRating(ListController.AjaxInfo.SearchRequestInfo.BookingenableRate);$("#SeoData").hide();},renderMapData:function(){if(this.taiwanCityids.indexOf(this.tempCityId)>-1){var a=360;h=430;if($(window).width()<1200){a=300;h=360;}$("#rightMap").addClass("nocu");$("#rightMap").append("<img  rel=\"nofollow\" onerror=\"document.getElementById('imageMapDiv').className ='nomap';this.src = 'http://www.elongstatic.com/hotels/pic/detailmapno.png';\" src=\"http://maps.google.com/maps/api/staticmap?language=en-us&amp;center="+this.CityNameEn+"&amp;zoom=13&amp;size="+a+"x"+h+'&amp;sensor=false" id="imageMapShow">');$("#listMapDiv").hide();}else{$("#listMapDiv").show();if(this.ListRightMap==null){$.getScript("http://api.map.baidu.com/getscript?v=1.4&ak=&services=&t=20130906090653",function(){$.getScript(MAPSCRIPT_PATH,function(){this.ListRightMap=new ListRightMapClient();this.ListRightMap.reloadMapData();}.bind(this));}.bind(this));}else{this.ListRightMap.Reload();}}},LoadHotelRoomData:function(c,a){if(this.PageInfo.rowTotal!=0&&String.isNullOrEmpty(this.mapHotelIds)){return;}var b=this.mapHotelIds.split(",");if(b.length>0&&b[0]!==""){this.isDataLoading=true;this.jsElapsedTime=new JsElapsedTime();ListController.GetSimpleHotelRoomSet(this.SearchRequestInfo,this.roomHotelIds,false,function(l){this.jsElapsedTime.start();if(l.success&&!Object.isNull(l.value)){var j;if(c){var m="Normal";var g=0;if(l.value.length==1&&l.value[0]!=null&&!l.value[0].IsFullRoom&&l.value[0].HasRoomData){g=this.buildFromPrice(l.value[0]);this.roomPlayer.buildRoomHtml(this.IsLogin,this.IsLongCui,l.value[0],"hotel"+l.value[0].HotelId,null,false);}else{if(l.value.length==1&&l.value[0]!=null&&l.value[0].IsFullRoom){m="Full";g=this.buildFromPrice(l.value[0]);this.roomPlayer.buildRoomHtml(this.IsLogin,this.IsLongCui,l.value[0],"hotel"+l.value[0].HotelId,null,false);}else{m="NoBook";if(!Object.isNull(l.value[0])){this.buildFromPrice(l.value[0]);this.roomPlayer.buildRoomHtml(this.IsLogin,this.IsLongCui,null,"hotel"+l.value[0].HotelId,"",null,false);}}}if(!Object.isNull(l.value)&&l.value.length>0){if(ListController.WebCategory=="Elong"&&l.value[0].HasLongCuiPromotion){$("#longcuiIcon_"+l.value[0].HotelId).show();}this.buildServiceIndex(l.value[0]);}g=typeof(g)=="undefined"?0:g;if((this.PageInfo!=null&&this.PageInfo.rowTotal==1)&&this.SearchRequestInfo.ListType=="Common"){if(this.OneHotelInfo!=null){var f={CardNo:this.SearchRequestInfo.CardNo,ChannelCode:this.SearchRequestInfo.ChannelCode,CheckInDate:this.SearchRequestInfo.CheckInDate,CheckOutDate:this.SearchRequestInfo.CheckOutDate,CityId:this.SearchRequestInfo.CityId,CityName:this.SearchRequestInfo.CityName,Distance:20,StarLevel:this.OneHotelInfo.hotelStar>5?Math.ceil(this.OneHotelInfo.hotelStar/10):this.OneHotelInfo.hotelStar,HotelSort:6,StartLat:this.OneHotelInfo.lat,StartLng:this.OneHotelInfo.lng,PageIndex:this.SearchRequestInfo.PageIndex,OrderFromId:this.SearchRequestInfo.OrderFromId,ListType:this.SearchRequestInfo.ListType,Language:this.SearchRequestInfo.Language};if(this.roomHotelIds=="00000000"){this.OneHotelInfo.hotelId=this.roomHotelIds;g=this.OneHotelInfo.minPrice;}ListController.GetRecommendHotel(f,this.OneHotelInfo.hotelId,0,function(i){if(i.success){this.commendHotel(i,m,this.Language.toLowerCase()=="cn"?this.OneHotelInfo.hotelNameCn:this.OneHotelInfo.hotelNameEn);}}.bind(this),false,"POST");}}}else{for(var d=0;d<l.value.length;d++){if(!Object.isNull(l.value[d])){this.buildFromPrice(l.value[d]);}if(ListController.WebCategory=="Elong"&&!Object.isNull(l.value[d])&&l.value[d].HasLongCuiPromotion){$("#longcuiIcon_"+l.value[d].HotelId).show();}if(!Object.isNull(l.value[d])&&l.value[d].HasRoomData){this.roomPlayer.buildRoomHtml(this.IsLogin,this.IsLongCui,l.value[d],"hotel"+l.value[d].HotelId,null,false);}else{this.roomPlayer.buildRoomHtml(this.IsLogin,this.IsLongCui,null,"hotel"+l.value[d].HotelId,null,false);}this.buildServiceIndex(l.value[d]);b.remove(l.value[d].HotelId);}if(b.length>0){for(var e=0;e<b.length;e++){$("#dynaLP_"+b[e]).html("");this.roomPlayer.buildRoomHtml(this.IsLogin,this.IsLongCui,null,"hotel"+b[e],null,false);}}}}this.isDataLoading=false;this.jsElapsedTime.end("GetSimpleHotelRoomSet客户端处理耗时：");this.renderMapData();if(a){FunctionExt.defer(function(){this.GetMergeAsycData(7);}.bind(this),10);}}.bind(this),false,"POST");}else{if(a){this.GetRecommendHotel(a);}}},scriptsArray:new Array(),cachedScript:function(c,a){for(var b in this.scriptsArray){if(this.scriptsArray[b]==c){return{done:function(d){if(typeof d=="function"){d();}}};}}a=$.extend(a||{},{dataType:"script",url:c,cache:true});this.scriptsArray.push(c);return $.ajax(a);},GetRecommendHotel:function(a){var b={CardNo:this.SearchRequestInfo.CardNo,ChannelCode:this.SearchRequestInfo.ChannelCode,CheckInDate:this.SearchRequestInfo.CheckInDate,CheckOutDate:this.SearchRequestInfo.CheckOutDate,CityId:this.SearchRequestInfo.CityId,CityName:this.SearchRequestInfo.CityName,HotelSort:6,PageIndex:this.SearchRequestInfo.PageIndex,OrderFromId:this.SearchRequestInfo.OrderFromId,ListType:this.SearchRequestInfo.ListType,Language:this.SearchRequestInfo.Language};ListController.GetRecommendHotel(b,"",0,function(c){if(c.success){this.commendHotel(c,"","");}}.bind(this),false,"POST");},LoadPriceForSimpleList:function(){if(String.isNullOrEmpty(this.mapHotelIds)){return;}var a=this.mapHotelIds.split(",");if(a.length>0){ListController.GetSimpleHotelRoomSet(this.SearchRequestInfo,this.roomHotelIds,false,function(g){if(g.success&&!Object.isNull(g.value)){Array.prototype.indexOf=function(k){for(var j=0;j<this.length;j++){if(this[j]==k){return j;}}return -1;};Array.prototype.remove=function(j){var i=this.indexOf(j);if(i>-1){this.splice(i,1);}};for(var d=0;d<g.value.length;d++){this.roomPlayer.addHotelData(g.value[d]);if(!Object.isNull(g.value[d])){this.buildFromPrice(g.value[d]);var c="";if(!Object.isNull(g.value[d].LowestPromotion)&&g.value[d].LowestPromotion.Upperlimit>0){var f=g.value[d].LowestPromotion.PromotionType;var b=g.value[d].LowestPromotion.Upperlimit;if(f==5){c="<br/><span class=\"fanIcon\" method='cashback'  title='用艺龙消费券网上成功预订此Room type，Check in后可获得返现！'>"+b+"元</span>";}else{if(f==1){c="<br/><span class=\"fanIcon\" method='coupon'  title='用艺龙消费券网上成功预订此Room type，Check in后可获得返现！'>"+b+"元</span>";}}}else{if(!String.isNullOrEmpty(g.value[d].LowestPromotionDesc)){c="<br/><span class=\"icon_sale_text ml5\" method='promotion' ></span>";}}$("#dynaLP_"+g.value[d].HotelId).after(c);}else{$("#dynaLP_"+g.value[d].HotelId).html("");}this.buildServiceIndex(g.value[d]);a.remove(g.value[d].HotelId);}if(a.length>0){for(var e=0;e<a.length;e++){$("#dynaLP_"+a[e]).html("");}}}}.bind(this));}},showHistoryBrowseHotels:function(historyHotelInfoList){var historyBrowseHotelHtml="";var browseHotelValue="";if(historyHotelInfoList!=null&&historyHotelInfoList!=""&&historyHotelInfoList!=undefined&&historyHotelInfoList.length>0){this.HistoryBrowseHotelContainer.attr("seenedTag","1");historyBrowseHotelHtml+='<h2><tt class="reviewed"></tt>'+(this.Language.toLowerCase()=="en"?"My viewed hotels":"我浏览过的Hotel")+"</h2><div  >";for(var i=0;i<historyHotelInfoList.length;i++){var hotelId=historyHotelInfoList[i].HotelId;var hotelName="";var delDesc="";var priceDesc="";var hotelStar=parseInt(historyHotelInfoList[i].HotelStar);var currency=historyHotelInfoList[i].MoneySymbol;var hotelPrice=parseFloat(historyHotelInfoList[i].LowestPrice)>0?currency+historyHotelInfoList[i].LowestPrice:"";if(this.Language.toLowerCase()=="en"){hotelName=historyHotelInfoList[i].HotelNameRealEn;delDesc="Clear history";priceDesc="Best-value Price";}else{hotelName=historyHotelInfoList[i].HotelName;delDesc="删除该记录";priceDesc="超值低价";}var hotelDetailUrl=this.HotelDetailUrl.eval({cityNameEn:historyHotelInfoList[i].CityNameEn,hotelId:hotelId});hotelDetailUrl=String.format("{0}{1}fr=elrc_lt_vw_{2}_{3}",hotelDetailUrl,hotelDetailUrl.indexOf("?")!=-1?"&":"?",i+1,hotelId);historyBrowseHotelHtml+="<p class='seenHotel' hotelId=\""+hotelId+'"><span method="delSeenHotel"  hotelId="'+hotelId+'" class="delbtn" title="'+delDesc+'"></span>';historyBrowseHotelHtml+='<a title="'+hotelName+'"  target="_blank" href="'+hotelDetailUrl+'"  class="hotelname">'+hotelName+"</a>";historyBrowseHotelHtml+='<span class="price" title="'+priceDesc+'" >'+hotelPrice+"</span>";historyBrowseHotelHtml+="</p>";}historyBrowseHotelHtml+="</div>";this.HistoryBrowseHotelContainer.html(historyBrowseHotelHtml);this.HistoryBrowseHotelContainer.slideDown(800);}},GetHistoryHotelIds:function(){var a="";a=Globals.cookie("SHBrowseHotel",this.Language.toLowerCase());var c="";var b="";if(String.isNullOrEmpty(a)==false){var f=a.split(";");if(a!=null&&a!=""){for(var e=0;e<f.length;e++){var d=f[e].split(",");if(d.length<1){continue;}var b=d[0];if(c==""){c+=b;}else{c+=","+b;}}}}return c;},OnClickDelSeenHtDel:function(d){var c=Event.element(d);var e=c.attr("method");switch(e){case"delSeenHotel":var b=c.attr("hotelid");b=String.format("{0},{1},{2},{3},{4},{5},{6};",b,"","","","","","");var a="";a=Globals.cookie("SHBrowseHotel",this.Language.toLowerCase());a=a.replace(b,"");Globals.cookie("SHBrowseHotel",this.Language.toLowerCase(),a,{expires:30,path:"/",secure:false});c.parent().remove();if(a==null||a==""){this.viewed_divId.hide();this.HistoryBrowseHotelContainer.attr("seenedTag","0");this.iShowListRightInfo();}break;}},iShowListRightInfo:function(b){var c=this.HistoryBrowseHotelContainer.attr("seenedTag");var d=$("#sellHotelDIv").attr("sellTag");var e=$("#trainDiv").attr("trainTag");var a=$("#airDiv").attr("airTage");if(ListController.WebCategory=="Elong"){$("#listRightInfoDiv").show();}else{if(c=="1"||d=="1"||e=="1"||a=="1"){$("#listRightInfoDiv").show();}else{$("#listRightInfoDiv").hide();}}},OnClickListMapDiv:function(){var url=this.HotelMapSearchUrl.eval({language:ListController.Language.toLowerCase(),cityid:this.SearchRequestInfo.CityId});var queryString=this.getQueryString(this.SearchRequestInfo);if(!String.isNullOrEmpty(queryString)){url+=(url.indexOf("?")!=-1?"&":"?")+queryString;}if(url.toLowerCase().indexOf("campaign_id")==-1&&!String.isNullOrEmpty(this.CampaignId)){url+=(url.indexOf("?")!=-1?"&":"?")+"campaign_id="+this.CampaignId;}window.open(url,"maplist");},LoadHistoryBrowseHotelsInfo:function(){var a=this.GetHistoryHotelIds();ListController.GetHistoryBrowseHotels(this.SearchRequestInfo,a,function(c){if(c.success&&c.value!=null){var b=c.value.BrowerHotelList;this.showHistoryBrowseHotels(c.value.BrowerHotelList);this.iShowListRightInfo();}}.bind(this),false,"get");},getQueryString:function(b){var a="";if(!String.isNullOrEmpty(b.AreaId)){a+="&AreaId="+b.AreaId;}if(!String.isNullOrEmpty(b.StarLevels)){a+="&StarLevels="+b.StarLevels;}if(!String.isNullOrEmpty(b.BrandIds)){a+="&BrandIds="+b.BrandIds;}if(b.LowPrice>0){a+="&LowPrice="+b.LowPrice;}if(b.HighPrice>0){a+="&HighPrice="+b.HighPrice;}if(!String.isNullOrEmpty(b.FacilityIds)){a+="&FacilityIds="+b.FacilityIds;}if(b.PoiId>0){a+="&PoiId="+b.PoiId;}if(b.StartLat>0){a+="&StartLat="+b.StartLat;}if(b.StartLng>0){a+="&StartLng="+b.StartLng;}if(!String.isNullOrEmpty(b.PoiName)){a+="&PoiName="+encodeURIComponent(b.PoiName);}if(!String.isNullOrEmpty(b.HotelName)){a+="&HotelName="+encodeURIComponent(b.HotelName);}if(!String.isNullOrEmpty(b.Keywords)){a+="&Keywords="+encodeURIComponent(b.Keywords);a+="&KeywordsType="+b.KeywordsType;}if(b.IsBigBed){a+="&IsBigBed=true";}if(b.IsCashback){a+="&IsCashback=true";}if(b.IsCoupon){a+="&IsCoupon=true";}if(b.IsDoubleBed){a+="&IsDoubleBed=true";}if(b.IsPrePay){a+="&IsPrePay=true";}if(b.IsLimitTime){a+="&IsLimitTime =true";}if(b.IsFreeNet){a+="&IsFreeNet=true";}if(b.IsNoGuarantee){a+="&IsNoGuarantee=true";}if(!String.isNullOrEmpty(b.TagId)){a+="&TagId="+b.TagId;}return String.isNullOrEmpty(a)?a:a.substring(1);},writeRankResearchCookie:function(a){if(this.Language=="CN"){Globals.cookie("Rank","",a,{expires:365,path:"/",secure:false});}},deleteRankResearchCookie:function(){Globals.cookie("Rank","","",{expires:1,path:"/",secure:false});},submitResearch:function(){var d=$("input[name='radRankType']:checked");var e=d.val();if(String.isNullOrEmpty(e)){$error(d,"请设置版本！");return;}var f=$("#selRankType").val();if(String.isNullOrEmpty(f)){$error($("#selRankType"),"请选择您喜欢的版本！");return;}this.writeRankResearchCookie(e);var a=$("#txtRankAdvice").val().trim();var c=$("#txtRankEmail").val().trim();if(c=="请填写您的Email"){c="";}if(a=="请给我们提点建议和感想吧 ^_^"){a="";}var b=ListController.AjaxInfo.City.CityName;ListController.SubmitRankResearch(b,e,f,a,c,function(g){if(g.success){alert("提交成功，感谢你的宝贵建议！");}else{alert("提交失败，请再尝试一次吧！");}}.bind(this));},onRankResearchClick:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){case"CurrentRankType":var d=a.val();this.writeRankResearchCookie(d);window.location.reload();break;case"Email":if(a.val()=="请填写您的Email"){a.val("");}break;case"Advice":if(a.val()=="请给我们提点建议和感想吧 ^_^"){a.val("");}break;case"SubmitResearch":this.submitResearch();break;case"ExitResearch":if(confirm("您Confirm要退出测试吗？")){this.deleteRankResearchCookie();$("#divRankResearch").remove();}break;}},dispose:function(){this.destroyEvent();this.destroyDOM();}});var client=null;$ready(function(){client=new HotelListClient();});var HotelSearchBoxClient=Elong.Page.HotelSearchBoxClient;HotelSearchBoxClient=Class.create();Object.extend(HotelSearchBoxClient.prototype,{name:"HotelSearchBoxClient",hotelCity:null,options:{Language:"CN",serverTime:"",CalendarShowYesterday:"",SearchRequestInfo:null,allInOneText:"",Resources:null,HotelListUrl:"",CityList:"",CitySowntownList:"",CityRegionList:"",CityBrandList:"",CityPlaceList:"",CitySowntownBrandList:"",CityRegionBrandList:"",ClientIP:"127.0.0.1"},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.initializeDOM();this.initializeEvent();this.aioWind=null;this.tempCityId=this.SearchRequestInfo.CityId;this.allInOneData={Name:"",Type:"",PropertiesId:0,Lat:0,Lng:0,Accept:-1};this.selectName="";this.OneInfo=this.GetOneInfoByRequest(this.SearchRequestInfo);this.render();},initializeDOM:function(){this.m_city=$("#m_city");this.searchBox=$("#searchBox");this.m_endDate=$("#m_endDate");this.m_preDate=$("#m_preDate");this.allInOne=$("#allInOne");this.m_search=$("#m_search");this.divSearch=$("#divSearch");this.bigAreaRegion=$("#bigAreaRegion");},destroyDOM:function(){this.m_city=null;this.searchBox=null;this.m_endDate=null;this.m_preDate=null;this.m_search=null;this.divSearch=null;this.bigAreaRegion=null;},initializeEvent:function(){this.searchBox.bind("click",this.OnClickdvSearchBox.bindAsEventListener(this));this.searchBox.bind("keydown",this.checkSearch.bindAsEventListener(this));this.allInOne.bind("focus",this.onAllInOneFocus.bindAsEventListener(this));this.allInOne.bind("blur",this.onAllInOneBlur.bindAsEventListener(this));this.bigAreaRegion.bind("click",this.OnClickBigAreaRegion.bindAsEventListener(this));$(window).unload(this.dispose.bind(this));},destroyEvent:function(){this.searchBox.unbind("click");this.searchBox.unbind("keydown");this.allInOne.unbind("focus");this.allInOne.unbind("blur");this.bigAreaRegion.unbind("click");},GetOneInfoByRequest:function(a){var b={Type:-1,Name:"",Id:"",lat:0,lng:0,isAccept:false};if(!Object.isNull(a)){b.Type=(a.AreaType==1&&3)||(a.AreaType==2&&6)||(!!a.BrandId&&5)||(!String.isNullOrEmpty(a.HotelName)&&9)||(!String.isNullOrEmpty(a.PoiName)&&99)||(a.KeywordsType=="IntelligentSearch"&&999)||-1;if(b.Type==3||b.Type==6){b.Name=a.AreaName;b.Id=a.AreaId;}if(b.Type==5){b.Name=a.BrandName;b.Id=a.BrandId;}if(b.Type==9){b.Name=a.HotelName;b.Id="";}if(b.Type==99){b.Name=a.PoiName;b.Id=a.PoiId;b.lat=a.StartLat;b.lng=a.StartLng;}if(b.Type==999){b.Name=a.Keywords;b.lat=a.StartLat;b.lng=a.StartLng;}b.isAreaAccept=a.IsNotAcceptRecommend;}return b;},render:function(){this.CityNameEn=ListController.AjaxInfo.City.CityNameEn;if(this.Language.toLowerCase()=="cn"){this.m_city.val(this.SearchRequestInfo.CityNameCN);this.m_city.attr("cityid",this.SearchRequestInfo.CityId);this.m_city.attr("cityname",this.SearchRequestInfo.CityNameEN);}else{this.m_city.val(this.SearchRequestInfo.CityNameEN);this.m_city.attr("cityid",this.SearchRequestInfo.CityId);this.m_city.attr("cityname",this.SearchRequestInfo.CityNameEN);}new CityWindow({eventElement:this.m_city,cityType:"hotel",lang:this.Language,resultNextId:"m_preDate",isAutoSelect:true,onSelect:function(c,b){if(!Object.isNull(b.CityId)){this.CityName=this.Language.toLowerCase()=="cn"?b.CityNameCn:b.CityNameEn;this.CityNameCn=b.CityNameCn;this.CityNameEn=b.CityNameEn;this.tempCityId=b.CityId;if(b.Type!==undefined&&b.Type!=="city"){var a=b.CityNameCn.split("（");this.selectName=a[0];}else{this.selectName="";}this.createAllInOneBox(true);this.allInOne.attr("value",this.allInOneText);if(!this.searchValid()){return;}this.OnClickSearch();}}.bind(this)});if(this.OneInfo.Name!=""){this.allInOne.val(this.OneInfo.Name);this.allInOne.css("color","#000000");}},createAllInOneBox:function(b){var c=this.Language.toLowerCase()=="cn"?"http://hotel.elong.com/keywordssuggest.html?isNewB=true":"http://hotel.elong.net/keywordssuggest.html?isNewB=true";var a=this.Language.toLowerCase()=="cn"?"http://hotel.elong.com/hotsuggest.html":"http://hotel.elong.net/hotsuggest.html";if(this.selectName!==""){this.aioWind=new AiOWindow({cityId:null,resultNextId:"m_preDate",lang:this.Language.toLowerCase(),searchUrl:c,hotUrl:a,eventElement:this.allInOne});return false;}if((Object.isNull(this.aioWind)||b)){this.aioWind=new AiOWindow({cityId:this.tempCityId,resultNextId:"m_preDate",lang:this.Language.toLowerCase(),searchUrl:c,hotUrl:a,eventElement:this.allInOne,onSelect:function(e,d){if(!Object.isNull(d.Type)&&!Object.isNull(d.Name)){this.isSelect=true;this.allInOneData=d;}}.bind(this),directSearch:function(d){this.allInOne[0]["Data"]=d;this.m_search.trigger("click");}.bind(this),isJsonp:"1",hotWidth:298,searchWidth:292,aioType:0});}},OnClickBigAreaRegion:function(b){var a=Event.element(b);var c=a.attr("method");switch(c){}},OnClickdvSearchBox:function(d){var b=Event.element(d);var e=b.attr("method");switch(e){case"m_preDate":var c=validator.reFormatDateString(this.serverTime);if(this.CalendarShowYesterday==true){var f=validator.convertDate(this.serverTime);f.setDate(f.getDate()-1);c=validator.reFormatDateString(f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate());}new CalendarWindow({eventElement:b,enabledFrom:c,selectedDate:String.isNullOrEmpty(b.val())?this.serverTime:b.val(),language:this.Language,onSelected:function(g){b.val(g);var j=validator.reFormatDateString(g);var i=validator.reFormatDateString(this.m_endDate.val());if(j>=i){var k=validator.convertDate(g);k=new Date(k.setHours(24));if(this.Language.toLowerCase()=="cn"){k=validator.reFormatDateString(k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate());}else{k=validator.reFormatDateStringEn(k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate());}this.m_endDate.val(k);}}.bind(this)});break;case"m_endDate":var a=validator.convertDate(this.m_preDate.val());a=new Date(a.setHours(24));new CalendarWindow({eventElement:b,selectedDate:b.val(),enabledFrom:validator.getDateString(a),language:this.Language,onSelected:function(g){b.val(g);}.bind(this)});break;case"m_search":if(!this.searchValid()){break;}this.OnClickSearch();break;}},OnClickSearch:function(){this.bigAreaRegion.hide();this.writeHotelCookie();var a=jQuery.trim(this.allInOne.val());a=this.replaceCharCode(a);this.GlobalData={Name:"",Type:-1,PropertiesId:0,Lat:0,Lng:0,Accept:false};if(!Object.isNull(this.allInOne[0].Data)&&this.allInOne[0].Data.Accept==true){this.GlobalData=this.allInOne[0].Data;this.allInOneData=Object.clone(this.GlobalData);}else{if(a.trim()==this.Resources.AllInOne){this.GlobalData.Name=this.selectName;this.GlobalData.Type=this.selectName===""?-1:999;}else{if(this.OneInfo.isAreaAccept==true&&this.OneInfo.areaName==a.trim()){this.GlobalData.Name=this.OneInfo.Name;this.GlobalData.Type=this.OneInfo.Type;this.GlobalData.PropertiesId=this.OneInfo.Id;this.GlobalData.Lat=this.OneInfo.lat;this.GlobalData.Lng=this.OneInfo.lng;this.GlobalData.Accept=this.OneInfo.isAccept;}else{if(a.trim()!=""){this.GlobalData.Name=this.selectName+a.trim();this.GlobalData.Type=999;}}}}this.clearSearchRequest(this.SearchRequestInfo);this.searchDirect();},clearSearchRequest:function(a){a.AreaId="";a.AreaType=0;a.PoiId=0;a.BrandId=0;a.Keywords="";a.KeywordsType=0;a.HotelName="";},searchDirect:function(){if(!Object.isNull(this.allInOne[0].Data)){if(this.allInOne[0].Data.Name!=this.GlobalData.Name&&!this.allInOne[0].Data.Accept){this.allInOneData.Accept="2";this.allInOne.attr("selectIndex",-1);}else{this.allInOneData.Accept="1";}}else{this.allInOneData.Accept="0";this.allInOne.attr("selectIndex",-1);}var a=this.getSearchUrl();if(window.location.href==(window.location.protocol+"//"+window.location.host+a)&&!Object.isNull(client)&&a.indexOf("?")==-1){this.SearchRequestInfo.CheckInDate=this.m_preDate.val();this.SearchRequestInfo.CheckOutDate=this.m_endDate.val();client.getHotelList();}else{this.showLoading();window.location.href=a;}this.SearchDataCollect("hotelSearchButton");},getSearchUrl:function(){this.SearchRequestInfo.CityId=this.tempCityId;var url=this.HotelListUrl.eval({language:this.Language.toLowerCase(),cityid:this.tempCityId});var urlParams=this.SetSearchReqstInfo(this.SearchRequestInfo,this.GlobalData);var sindex=parseInt(this.allInOne.attr("selectIndex"));var aioVal=this.allInOne.val();if(this.allInOneData.Accept=="1"&&!String.isNullOrEmpty(this.allInOne.attr("selectIndex"))){sindex=parseInt(this.allInOne.attr("selectIndex"));}var seoUrl=this.getSeoUrlBySearchRequestInfo(this.SearchRequestInfo);if(seoUrl!=""){if(!String.isNullOrEmpty(this.SearchRequestInfo.TagId)){seoUrl+=(seoUrl.indexOf("?")!=-1?"&":"?")+"TagId="+this.SearchRequestInfo.TagId;}seoUrl+=(seoUrl.indexOf("?")!=-1?"&":"?")+"aioIndex="+sindex+"&aioVal="+encodeURIComponent(aioVal);return seoUrl;}if(urlParams!=""){url+=(url.indexOf("?")!=-1?"&":"?")+urlParams;}if(window.location.host=="big5.elong.com"){url="http://big5.elong.com/gate/big5/hotel.elong.com"+url;url+=url.indexOf("?")>0?"&isbig5=true":"?isbig5=true";}url+=(url.indexOf("?")!=-1?"&":"?")+"aioIndex="+sindex+"&aioVal="+encodeURIComponent(aioVal);return url;},getSeoUrlBySearchRequestInfo:function(searchRequestInfo){var cityId=searchRequestInfo.CityId;var cityNameEn=FilterPinyinForUrl(this.CityNameEn);var sowntownId="";var regionId="";var brandId="";var poiId="";var hasOtherParameter=false;if(!String.isNullOrEmpty(searchRequestInfo.AreaId)&&searchRequestInfo.AreaId.length==4){regionId=searchRequestInfo.AreaId;}if(!String.isNullOrEmpty(searchRequestInfo.AreaId)&&searchRequestInfo.AreaId.length==6){sowntownId=searchRequestInfo.AreaId;}if(searchRequestInfo.BrandId>0){brandId=""+searchRequestInfo.BrandId;}if(searchRequestInfo.PoiId>0){poiId=""+searchRequestInfo.PoiId;}hasOtherParameter=(!String.isNullOrEmpty(searchRequestInfo.Keywords)&&(searchRequestInfo.KeywordsType==9||searchRequestInfo.KeywordsType==999))||(poiId!=""&&brandId!="")||(poiId==""&&!String.isNullOrEmpty(searchRequestInfo.PoiName))||searchRequestInfo.HotelName!=""||ListController.WebCategory=="Online";if(hasOtherParameter||window.location.host=="big5.elong.com"){return"";}if(sowntownId!=""&&brandId!=""){return this.CitySowntownBrandList.eval({citynameen:cityNameEn,sowntownid:sowntownId,brandid:brandId});}if(regionId!=""&&brandId!=""){return this.CityRegionBrandList.eval({citynameen:cityNameEn,regionid:regionId,brandid:brandId});}if(sowntownId!=""){return this.CitySowntownList.eval({citynameen:cityNameEn,sowntownid:sowntownId});}if(regionId!=""){return this.CityRegionList.eval({citynameen:cityNameEn,regionid:regionId});}if(brandId!=""){return this.CityBrandList.eval({citynameen:cityNameEn,brandid:brandId});}if(poiId!=""){return this.CityPlaceList.eval({citynameen:cityNameEn,poiid:poiId});}return this.CityList.eval({citynameen:cityNameEn});},SetSearchReqstInfo:function(b,a){var c="";if(a.Name!=""){c+=(c==""?"":"&")+"IsNotAcceptRecommend="+a.Accept;}if(!String.isNullOrEmpty(b.TagId)){c+=(c==""?"":"&")+"TagId="+b.TagId;}c+=(c==""?"":"&")+this.setRequestInfoByTypeOne(b,a);return c;},setRequestInfoByTypeOne:function(b,a){var c="";switch(a.Type){case 1:case 2:case 4:case 77:case 99:this.resetRequestInfo(b,a);if(this.SearchRequestInfo.ReturnKeywordsType=="PoiType"){this.SearchRequestInfo.Keywords="";this.SearchRequestInfo.KeywordsType="0";this.SearchRequestInfo.ReturnKeywordsType="0";}b.PoiId=a.PropertiesId;b.PoiName=a.Name;this.SearchRequestInfo.HotelSort=6;if(!Object.isNull(b.PoiId)&&b.PoiId!="0"){c+=(c==""?"":"&")+"PoiId="+a.PropertiesId;}if(!String.isNullOrEmpty(b.PoiName)){c+=(c==""?"":"&")+"PoiName="+encodeURIComponent(b.PoiName);}if(a.Lat!=""&&a.Lng!=""){b.StartLat=a.Lat;b.StartLng=a.Lng;c+=(c==""?"":"&")+"StartLat="+a.Lat+"&StartLng="+a.Lng;}c+=(c==""?"":"&")+"hotelsort=6";break;case 3:b.StartLat=0;b.StartLng=0;this.resetRequestInfo(b,a);if(!String.isNullOrEmpty(a.Name)){c+=(c==""?"":"&")+"Keywords="+encodeURIComponent(a.Name)+"&KeywordsType=999";b.Keywords=encodeURIComponent(a.Name);b.KeywordsType=999;}break;case 6:this.resetRequestInfo(b,a);b.AreaId=a.PropertiesId;b.AreaName=a.Name;b.AreaType="2";c+=(c==""?"":"&")+"AreaId="+a.PropertiesId+"&AreaType=2";if(!String.isNullOrEmpty(a.Name)){c+=(c==""?"":"&")+"AreaName="+encodeURIComponent(a.Name);}break;case 5:this.resetRequestInfo(b,a);b.BrandId=a.PropertiesId;b.BrandName=a.Name;c+=(c==""?"":"&")+"BrandId="+a.PropertiesId+"&BrandName="+encodeURIComponent(a.Name);break;case 9:this.resetRequestInfo(b,a);b.HotelName=encodeURIComponent(a.Name);c+=(c==""?"":"&")+"HotelName="+encodeURIComponent(a.Name);break;default:if(!String.isNullOrEmpty(a.Name)){b.Keywords=encodeURIComponent(a.Name);b.KeywordsType=a.Type;c+=(c==""?"":"&")+"Keywords="+encodeURIComponent(a.Name)+"&KeywordsType="+a.Type;}break;}return c;},resetRequestInfo:function(b,a){this.SearchRequestInfo.PageIndex=1;switch(a.Type){case 1:case 2:case 4:case 99:case 3:case 6:b.HotelSort="1";b.PoiId="";b.PoiName="";b.AreaId="";b.AreaType="";break;case 5:case 9:b.HotelSort="1";b.BrandId="";b.HotelName="";break;}},showLoading:function(){strCC=this.divSearch.html();var a=new Dialog({title:"",htmlContent:strCC,width:480,initEvent:function(b){}.bind(this)});a.show();return a;},writeHotelCookie:function(){Globals.cookie("ShHotel","",{InDate:this.m_preDate.val(),OutDate:this.m_endDate.val(),CityID:this.SearchRequestInfo.CityId},{expires:11,path:"/",secure:false});if(this.Language=="CN"&&!Object.isNull(this.SearchRequestInfo.CityName)){Globals.cookie("ShHotel","",{CityNameCN:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});Globals.cookie("ShHotel","",{CityName:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});if(!String.isNullOrEmpty(this.CityNameEn)){Globals.cookie("ShHotel","",{CityNameEN:this.CityNameEn},{expires:11,path:"/",secure:false});}}if(this.Language=="EN"&&!String.isNullOrEmpty(this.CityNameEn)){Globals.cookie("ShHotel","",{CityNameEN:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});}},replaceCharCode:function(a){return a.replace(/(!)/g,"").replace(/(~)/g,"").replace(/(@)/g,"").replace(/(#)/g,"").replace(/($)/g,"").replace(/(%)/g,"").replace(/(^)/g,"").replace(/(&)/g,"").replace(/(\*)/g,"").replace(/(！)/g,"").replace(/(~)/g,"").replace(/(@)/g,"").replace(/(#)/g,"").replace(/(£)/g,"").replace(/(%)/g,"").replace(/(……)/g,"").replace(/(&)/g,"").replace(/(\*)/g,"");},searchValid:function(){if(!validator.valid(this.m_city.val(),"notEmpty & nonSpecialSign")){$error(this.m_city,this.Resources.InsertCity);return false;}if(!Object.isNull(this.m_city[0].City)){this.tempCityId=this.m_city[0].City.CityId;this.CityNameCn=this.m_city[0].City.CityNameCn;this.CityNameEn=this.m_city[0].City.CityNameEn;}else{$error(this.m_city,this.Resources.NotExistCity);return false;}if(this.Language=="EN"){if(!validator.valid(this.m_preDate.val(),"notEmpty & dateEn")){$error(this.m_preDate,this.Resources.NotPassInDate);return false;}if(!validator.valid(this.m_endDate.val(),"notEmpty & dateEn")){$error(this.m_endDate,this.Resources.NotPassOutDate);return false;}}else{if(!validator.valid(this.m_preDate.val(),"notEmpty & date")){$error(this.m_preDate,this.Resources.NotPassInDate);return false;}if(!validator.valid(this.m_endDate.val(),"notEmpty & date")){$error(this.m_endDate,this.Resources.NotPassOutDate);return false;}}var g=validator.reFormatDateString(this.serverTime);var i=this.m_preDate.val();var f=this.m_endDate.val();var e=validator.reFormatDateString(i);var d=validator.reFormatDateString(f);if(e<g&&this.CalendarShowYesterday==false){$error(this.m_preDate,this.Resources.InDateAfterNow);return false;}if(d<g){$error(this.m_endDate,this.Resources.OutDateAfterNow);return false;}var c=validator.convertDate(e);c=new Date(c.setHours(24));if(!validator.valid(this.m_endDate.val(),"notEmpty & dateRange",validator.getDateString(c),null)){$error(this.m_endDate,this.Resources.OutDateAfterInDate);return false;}var a=this.daysBetween(e,validator.reFormatDateString(this.serverTime));var j=ListController.AjaxInfo.Tel;if(a>"180"){$error(this.m_preDate,String.format(this.Resources.Date180Msg,e,j));return false;}var b=this.daysBetween(e,d);if(b>"20"){$error(this.m_endDate,String.format(this.Resources.Date20Msg,"20",j));return false;}return true;},daysBetween:function(b,c){var e=b.substring(5,b.lastIndexOf("-"));var d=b.substring(b.length,b.lastIndexOf("-")+1);var f=b.substring(0,b.indexOf("-"));var i=c.substring(5,c.lastIndexOf("-"));var g=c.substring(c.length,c.lastIndexOf("-")+1);var j=c.substring(0,c.indexOf("-"));var a=((Date.parse(e+"/"+d+"/"+f)-Date.parse(i+"/"+g+"/"+j))/86400000);return Math.abs(a);},checkSearch:function(b){var a=Event.element(b);var c=a.attr("method");if(b.keyCode==13){this.m_search.trigger("click");}},onAllInOneFocus:function(){this.createAllInOneBox(false);if(this.allInOne.attr("value")==this.allInOneText){this.allInOne.attr("value","");}this.allInOne.css("color","#000000");},onAllInOneBlur:function(){if(this.allInOne.attr("value")==""){this.allInOne.attr("value",this.allInOneText);}if(this.allInOne.attr("value")==this.allInOneText){this.allInOne.css("color","#999999");}else{this.allInOne.css("color","#000000");}},SearchDataCollect:function(c){try{var b;var d;var f=-1;if(!Object.isNull(this.GlobalData)&&!String.isNullOrEmpty(this.GlobalData.Name)){d=encodeURIComponent(this.GlobalData.Name);}else{d="";}if(this.allInOneData.Accept=="1"&&!String.isNullOrEmpty(this.allInOne.attr("selectIndex"))){f=parseInt(this.allInOne.attr("selectIndex"));}if(c=="hotelSearchButton"){Elong.sendTJ({DBItemName:"WebMSConnectionString",TableName:"searchKeyword ",channel:"hotel",query:d,sid:Globals.cookie("SessionGuid"),clientIp:this.ClientIP,logTime:(new Date()).toLocaleDateString(),cityId:this.tempCityId,inDate:Globals.cookie("ShHotel","InDate"),outDate:Globals.cookie("ShHotel","OutDate"),guid:Globals.cookie("CookieGuid"),app:"hotellistsearchbutton",hasSuggest:this.allInOneData.Accept=="0"?0:1,isSelect:this.allInOneData.Accept=="1"?1:0,sIndex:f});}}catch(a){}},dispose:function(){this.destroyEvent();this.destroyDOM();}});var hotelSearchBoxClient=null;$ready(function(){hotelSearchBoxClient=new HotelSearchBoxClient({Language:ListController.Language,serverTime:ListController.ServerTime.substring(0,10),CalendarShowYesterday:ListController.CalendarShowYesterday,SearchRequestInfo:ListController.AjaxInfo.SearchRequestInfo,allInOneText:"输入 位置 Hotel名 或品牌",Resources:ListController.Resources,HotelListUrl:new Template(ListController.UrlConfig.HotelListUrl),CityList:new Template(ListController.UrlConfig.CityList),CitySowntownList:new Template(ListController.UrlConfig.CitySowntownList),CityRegionList:new Template(ListController.UrlConfig.CityRegionList),CityBrandList:new Template(ListController.UrlConfig.CityBrandList),CityPlaceList:new Template(ListController.UrlConfig.CityPlaceList),CitySowntownBrandList:new Template(ListController.UrlConfig.CitySowntownBrandList),CityRegionBrandList:new Template(ListController.UrlConfig.CityRegionBrandList),ClientIP:ListController.AjaxInfo.ClientIP});});