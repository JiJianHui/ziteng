<!DOCTYPE HTML>
<html >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Car Sharing</title>
	
	<link rel="stylesheet" type="text/css" href="../public/css/bootstrap/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="../public/css/home.css" />
	<link rel="stylesheet" type="text/css" href="../css/global.css" />
	<link rel="stylesheet" type="text/css" href="../public/css/mdd_detail_v2.css"/>
	<link rel="stylesheet" type="text/css" href="../public/css/header.css"/>
	<link rel="stylesheet" type="text/css" href="../css/ziteng.css"/>
	
	<script src="../public/javascript/jquery.js"></script>
	<script src="../public/javascript/jquery.easing.1.3.js"></script>
	<script src="../public/javascript/bootstrap/bootstrap.js"></script>
	
	<script src="../js/public.js"></script>
	<script src="../js/login.js"></script>
	<script src="../js/register.js"></script>
	
</head>

<body>

<!--头部-->
	<div class="header">
	<div class="reo_header">
	    <div class="top">
	    <div class="c" id="statusBar"> <!-- 用于登录栏 -->
	    </div>
	  </div>
	  <div id="div_login" style="display:none" class="div_login">
	  	<ul class="blue_line">
		</ul>
		<form id="headLogin" onsubmit="return false">
			<ul class="unstyled" style="margin-top: 15px; margin-top: 20px;">
				<li style="line-height: 35px;">Account：<input id="login_account" type="text"
					name="head_account" data-check-sta='Y' data-check-type='isname'
					msgVal='Phone/Email/Username' style="width: 65%; color: #CCC" value="Phone/Email/Username" />
				</li>
				<li style="line-height: 35px;">Password：<input type="password"
					msgVal='Password' id="headpassword" name="head_password"
					style="width: 65%; margin-top: 0px; color: #000;" />
				</li>
			</ul>
			<ul class="inline"
				style="height: 30px; line-height: 30px; margin-top: 3px;">
				<li id="head-login-errormsg"
					style="width: 150px; text-align: left; margin-left: 0px; padding-left: 0px;"
					class="text-error"></li>
				<li style="width: 60px; text-align: right;"><a target="_blank"
					href="getpassword.html">Forgot Password</a></li>
			</ul>
			<ul style="margin-top: 5px;">
				<li><input type="submit" value="Login"
					style="width: 200px; height: 30px; margin: 0 0 0 40px;"
					id="head_login" class="btn btn-primary" /></li>
			</ul>
		</form>
	  </div>
	</div>
	
	<div id="nav_header">
	   <ul>
				<li class="titlewz">
					<ol olnum="0">
						<a href="../home.html">Homepage</a>
					</ol>
					<ol olnum="1">
						<a href="../gonglue.html">Travel Guide</a>
					</ol>
					<ol olnum="2">
						<a href="../activity.html">Activities</a>
					</ol>
					<ol olnum="3">
						<a   href="../rentcar.html">Itinerary</a>
					</ol>
					<ol olnum="4">
					<img src="../public/images/headLogo.png"
							style="margin-right: 3px; margin-bottom: 2px;" />
						<a style="color: #FC3;"  href="carsharing_list.html">Car Sharing</a>
					</ol>
					<ol olnum="5">
						<a href="../zthotel/home.html">Hotel Booking</a>
					</ol>
					<ol olnum="6">
						<a href="../bbs/bbs/index.php">BBS</a>
					</ol>
				</li>
			</ul>
			<ul>
				<span id="blueline" class="testline" style="margin-left: 557px" />
			</ul>
	</div>
	
	<div id="page_loading" style="display:none;background:#000;display:block;position:absolute;top:0;left:0;z-index:10000;opacity:0.1;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=10);"></div>
	<img src="../public/images/loading.gif?1" style="display:none;width:32px; height:32px; z-index:11000; position:absolute;border:0;" id="page_loadimg" />
</div>
<!--头部end --> 

<!-- comment start! -->
	<div class="container" style="margin-top: 30px;">
		<h2 id="travel_title">Title</h2>
	    <hr style="border:1px" />
	    	<h4>Comments</h4>
	    <div class="post-list">
	    		
		    <ul id="ul_travel_guide_list">
		    		<!-- 
		        <li class="post-item clearfix" >
		        		<div style="padding:10px;">
			           <div class="comment_cover" style="background-image:url('http://file20.mafengwo.net/M00/B0/EE/wKgB3FF-NSiAN7MgAAbqz3pBBTs12.groupinfo.w230.jpeg'); " ></div>
			           <div class="comment-author"><h7>flaskjfklsdfs&nbsp;&nbsp;<span>14-03-29 16:05</span></h7></div>
			           <div class="post-content">
			                不敢相信的蜂首！！！！！！！
			           </div>
		           	</div>
		      	 </li>
		      	  -->  
		      	 
		      	 <li id="add_comment" class="post-item clearfix">
		      	 	<div style="padding:10px;">
		      	 	<div class="row" style="margin-top:5px;">
			      	  	<div id="user_comment_cover" class="span2 comment_cover" style="background-image:url('/ziteng/page/public/images/default_user.png');" ></div>
			    			<div class="span9">
			    				<textarea id="txt_comment_content" rows="4" cols="100" maxlength="1000" placeholder="Comments内容" style="width:100%; margin-top:5px;"></textarea>
			    			</div>
		    			</div>
		    			<div class="row" style="margin-top:5px;">
		    				<div class="offset9">
		    					<button class="btn btn-primary" type="button" onclick="addComment();">Comments</button>
		    				</div>
		    			</div>
		    			</div>
	    			</li>
		    </ul>
		</div>
 	</div>
<!-- content end! -->

<!-- footer start-->
	<!-- footer start-->
	<div class="footer">
		<div class="nav_footer">
	  		<div>
	    		<ul class="inline">
	      		<li><a  href="/ziteng/page/home.html">Homepage</a></li>
	      		<li><a  href="#">Service Stores</a></li>
	      		<li><a  href="#">Help Centre</a></li>
	      		<li><a  href="#">About Us</a></li>
	        </ul>
	  		</div>
		</div>
		<div class="container">
	  		<div>
	    		<ul class="unstyled">
	      		<li>The website is owned by ToWorld Company</li>
	    		</ul>
	    		<ul class="unstyled">
	      		<li>Copyright @2014 www.ToWorld.com All Rights Reserved</li>
	    		</ul>
	  		</div>
		</div>
	</div>
	<!-- footer end -->

<script>
var userInfo;
var carsharingId;

$(document).ready(function() {
	var url = window.location.href;
	carsharingId = url.substring(url.lastIndexOf('=')+1, url.length);
	loadUserInfo();
	loadCarsharingMessages();
	loadComments();
});

//load travel info.
function loadCarsharingMessages(){
	var url = '/ziteng/carSharing/getCarSharingById.do';
	var params = {"carsharingId": carsharingId};
	$.post(url,params,function(data) {
			var json = eval('(' + data + ')');
			if (json.success) {
				var carSharing = json.datas.carSharing;
				$("#travel_title").html(carSharing.title);
			} else {
				alert(json.msg);
			}
		}
	);
}

//load all comments.
function loadComments(){
	var url = "/ziteng/carsharingMessage/queryCarSharingMessagesById.do";
	var param = {"carsharingId": carsharingId};
	
	$.post(url, param, function(data){
		var json = eval('(' + data + ')');
		if (json.success) {
			alert('dd');
			var comments = json.datas.carsharingMessages;
			for(var i = 0; i < comments.length; i++){
				var comment = comments[i];
				var userImgUrl = userInfo.avator;
				if(userImgUrl==null || userImgUrl==""){
					userImgUrl = '/ziteng/page/public/images/default_user.png';
				}
				var $comment = '<li class="post-item clearfix" >'+
							   '<div style="padding:10px;">' +
					           '<div class="comment_cover" style="background-image:url("'+userImgUrl+'"); " ></div>'+
					           '<div class="comment-author"><h7>'+ userInfo.userName +'&nbsp;&nbsp;<span>'+comment.msgTimeString+'</span></h7></div>'+
					           '<div class="post-content">'+ comment.content +'</div>'+
					      	 	'</li> ';
				$("#add_comment").before($comment);
			}
		} else {
//			alert(json.msg);
		}
//		alert(json.msg);
	});
}

//load user info.
function loadUserInfo(){
	var url = "/ziteng/user/getUserInfo.do";
	var params = {};
	
	$.post(url, params, function(data){
		var json = eval("(" + data +")");
		if(json.success){
			userInfo = json.datas.userInfo;
			$('#user_comment_cover').css("background-image", "url("+userInfo.avatar+")");  
//			alert("load user info success");
		}else{
			alert(json.msg);
		}
	});
}


//add comment.
function addComment(){
	var content = $("#txt_comment_content").val();
	var url = "/ziteng/carsharingMessage/makeCarsharingMessage.do";
	var params = {"carsharingId":carsharingId,"content":content};
	
	if(content==null || content == undefined || content == ""){alert("Please input the Comments content");return false;}
	
	$.post(url, params, function(data){
		var json = eval("(" + data +")");
		if(json.success){
			$("#txt_comment_content").val('');
			var comment =json.datas.carsharingMessage;
			var userImgUrl = userInfo.avator;
			if(userImgUrl==null || userImgUrl==""){
				userImgUrl = '/ziteng/page/public/images/default_user.png';
			}
			var $comment = '<li class="post-item clearfix" >'+
			   '<div style="padding:10px;">' +
	           '<div class="comment_cover" style="background-image:url("'+userImgUrl+'"); " ></div>'+
	           '<div class="comment-author"><h7>'+ userInfo.userName +'&nbsp;&nbsp;<span>'+comment.msgTime+'</span></h7></div>'+
	           '<div class="post-content">'+ comment.content +'</div>'+
	      	 	'</li> ';
			$("#add_comment").before($comment);
		}
		alert(json.msg);
	});
}

//join travel.
function travel_join(){
	alert("join comment");
}

</script>
	<!-- footer end -->
</body>
</html>