var K=this.K||{};K.Resource=K.Resource||{};K.error=function(b,a){a=a||Error;throw new a(b)};K.global=this;(function(m){var h=Array.prototype,w=Object.prototype,x=Function.prototype;var p=h.slice,s=h.unshift,r=w.toString,o=w.hasOwnProperty;var n=h.forEach,g=h.map,u=h.reduce,d=h.reduceRight,l=h.filter,a=h.every,t=h.some,q=h.indexOf,f=h.lastIndexOf,c=Array.isArray,v=Object.keys,k=Object.create,i=x.bind;m.log=function(){if("console" in window&&"log" in window.console){var y=arguments.length;if(y==1){window.console.log(arguments[0])}else{if(y==2){window.console.log(arguments[0],arguments[1])}}}else{if(window.opera&&window.opera.postError){window.opera.postError.apply(window.opera,arguments)}}};var b={};m.forEach=function(D,C,B){if(D==null){return}if(n&&D.forEach===n){D.forEach(C,B)}else{if(m.isNumber(D.length)){for(var A=0,y=D.length;A<y;A++){if(C.call(B,D[A],A,D)==b){return}}}else{for(var z in D){if(o.call(D,z)){if(C.call(B,D[z],z,D)===b){return}}}}}};m.map=function(B,A,z){var y=[];if(B==null){return y}if(g&&B.map===g){return B.map(A,z)}m.forEach(B,function(E,C,D){y[y.length]=A.call(z,E,C,D)});return y};m.reduce=function(C,B,y,A){var z=y!==void 0;if(C==null){C=[]}if(u&&C.reduce===u){if(A){B=m.bind(B,A)}return z?C.reduce(B,y):C.reduce(B)}m.forEach(C,function(F,D,E){if(!z&&D===0){y=F;z=true}else{y=B.call(A,y,F,D,E)}});if(!z){throw new TypeError("Reduce of empty array with no initial value")}return y};m.reduceRight=function(B,A,y,z){if(B==null){B=[]}if(d&&B.reduceRight===d){if(z){A=m.bind(A,z)}return y!==void 0?B.reduceRight(A,y):B.reduceRight(A)}var C=(m.isArray(B)?B.slice():m.toArray(B)).reverse();return m.reduce(C,A,y,z)};m.detect=function(B,A,z){var y;m.some(B,function(E,C,D){if(A.call(z,E,C,D)){y=E;return true}});return y};m.filter=function(B,A,z){var y=[];if(B==null){return y}if(l&&B.filter===l){return B.filter(A,z)}m.forEach(B,function(E,C,D){if(A.call(z,E,C,D)){y[y.length]=E}});return y};m.every=function(B,A,z){var y=true;if(B==null){return y}if(a&&B.every===a){return B.every(A,z)}m.forEach(B,function(E,C,D){if(!(y=y&&A.call(z,E,C,D))){return b}});return y};m.some=function(B,A,z){A||(A=m.identity);var y=false;if(B==null){return y}if(t&&B.some===t){return B.some(A,z)}m.forEach(B,function(E,C,D){if(A.call(z,E,C,D)){y=true;return b}});return y};m.contains=function(A,z){var y=false;if(A==null){return y}if(q&&A.indexOf===q){return A.indexOf(z)!=-1}m.some(A,function(B){if(y=B===z){return true}});return y};m.pluck=function(z,y){return m.map(z,function(A){return A[y]})};m.sortBy=function(A,z,y){return m.pluck(m.map(A,function(D,B,C){return{value:D,criteria:z.call(y,D,B,C)}}).sort(function(E,D){var C=E.criteria,B=D.criteria;return C<B?-1:C>B?1:0}),"value")};m.sortedIndex=function(D,C,A){A||(A=m.identity);var y=0,B=D.length;while(y<B){var z=(y+B)>>1;A(D[z])<A(C)?y=z+1:B=z}return y};m.toArray=function(y){if(!y){return[]}if(y.toArray){return y.toArray()}if(m.isArray(y)){return y}if(m.isArguments(y)){return p.call(y)}return m.values(y)};m.last=function(z){var y=z.length;return y>0?z[y-1]:undefined};m.compact=function(y){return m.filter(y,function(z){return !!z})};m.flatten=function(y){return m.reduce(y,function(z,A){if(m.isArray(A)){return z.concat(m.flatten(A))}z[z.length]=A;return z},[])};m.without=function(A,z){var y=p.call(arguments,1);return m.filter(A,function(B){return !m.contains(y,B)})};m.unique=function(z,y){return m.reduce(z,function(A,C,B){if(0==B||(y===true?m.last(A)!=C:!m.contains(A,C))){A[A.length]=C}return A},[])};m.intersect=function(z){var y=p.call(arguments,1);return m.filter(m.unique(z),function(A){return m.every(y,function(B){return m.indexOf(B,A)>=0})})};m.indexOf=function(C,A,B){if(C==null){return -1}var z,y;if(B){z=m.sortedIndex(C,A);return C[z]===A?z:-1}if(q&&C.indexOf===q){return C.indexOf(A)}for(z=0,y=C.length;z<y;z++){if(C[z]===A){return z}}return -1};m.lastIndexOf=function(A,z){if(A==null){return -1}if(f&&A.lastIndexOf===f){return A.lastIndexOf(z)}var y=A.length;while(y--){if(A[y]===z){return y}}return -1};m.bind=function(A,z){var y=Array.prototype.slice.call(arguments,2);return function(){z=z||(this==m.global?false:this);var B=y.concat(Array.prototype.slice.call(arguments));if(typeof(A)=="string"&&z[A]){z[A].apply(z,B)}else{if(m.isFunction(A)){return A.apply(z,B)}else{m.log("not function",A)}}}};m.methodize=function(z,y){if(y){return function(){return z.apply(null,[this[y]].concat([].slice.call(arguments)))}}return function(){return z.apply(null,[this].concat([].slice.call(arguments)))}};m.extend=function(y,B){var z=function(){};z.prototype=B.prototype;var A=y.prototype;y.prototype=new z();y.$super=B;m.mix(y.prototype,A,true);return y};m.create=k||function(A,y){var z=function(B){if(B){m.mix(this,B,true)}};z.prototype=A;return new z(y)};m.delay=function(z,A){var y=p.call(arguments,2);return setTimeout(function(){return z.apply(z,y)},A)};m.defer=function(y){return m.delay.apply(m,[y,1].concat(p.call(arguments,1)))};m.keys=v||function(A){if(A!==Object(A)){throw new TypeError("Invalid object")}var z=[];for(var y in A){if(o.call(A,y)){z[z.length]=y}}return z};m.values=function(y){return m.map(y,m.identity)};m.methods=function(y){return m.filter(m.keys(y),function(z){return m.isFunction(y[z])}).sort()};m.mix=function(y){m.forEach(p.call(arguments,1),function(z){for(var A in z){if(z[A]!==void 0){y[A]=z[A]}}});return y};m.clone=function(y){return m.isArray(y)?y.slice():m.mix({},y)};m.isEmpty=function(z){if(m.isArray(z)||m.isString(z)){return z.length===0}for(var y in z){if(o.call(z,y)){return false}}return true};m.isElement=function(y){return !!(y&&y.nodeType==1)};m.isArray=c||function(y){return r.call(y)==="[object Array]"};m.isFunction=function(y){return !!(y&&y.constructor&&y.call&&y.apply)};if(r.call(arguments)=="[object Arguments]"){m.isArguments=function(y){return r.call(y)=="[object Arguments]"}}else{m.isArguments=function(y){return !!(y&&o.call(y,"callee"))}}m.isString=function(y){return !!(y===""||(y&&y.charCodeAt&&y.substr))};m.isNumber=function(y){return !!(y===0||(y&&y.toExponential&&y.toFixed))};m.isNaN=function(y){return y!==y};m.isBoolean=function(y){return y===true||y===false};m.isDate=function(y){return !!(y&&y.getTimezoneOffset&&y.setUTCFullYear)};m.isRegExp=function(y){return !!(y&&y.test&&y.exec&&(y.ignoreCase||y.ignoreCase===false))};m.isNull=function(y){return y===null};m.isUndefined=function(y){return y===void 0};m.trim=function(y){return y.replace(/^[\s\xa0\u3000]+|[\u3000\xa0\s]+$/g,"")};m.byteLen=function(y){return y.replace(/[^\x00-\xff]/g,"--").length};m.subByte=function(A,y,z){if(m.byteLen(A)<=y){return A}z=z||"";y-=m.byteLen(z);return A.substr(0,y).replace(/([^\x00-\xff])/g,"$1 ").substr(0,y).replace(/[^\x00-\xff]$/,"").replace(/([^\x00-\xff]) /g,"$1")+z};m.encode4JS=function(y){return y.replace(/\\/g,"\\u005C").replace(/"/g,"\\u0022").replace(/'/g,"\\u0027").replace(/\//g,"\\u002F").replace(/\r/g,"\\u000A").replace(/\n/g,"\\u000D").replace(/\t/g,"\\u0009")};m.encode4HTTP=function(y){return y.replace(/[\u0000-\u0020\u0080-\u00ff\s"'#\/\|\\%<>\[\]\{\}\^~;\?\:@=&]/,function(z){return encodeURIComponent(z)})};m.encode4Html=function(y){return y.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};m.encode4HtmlValue=function(y){return m.encode4Html(y).replace(/"/g,"&quot;").replace(/'/g,"&#039;")};m.stripTags=function(y){return y.replace(/<[^>]*>/gi,"")};m.formatDate=function(C,A){A=A||"yyyy-MM-dd";var D=C.getFullYear();var B={M:C.getMonth()+1,d:C.getDate(),h:C.getHours(),m:C.getMinutes(),s:C.getSeconds()};A=A.replace(/(y+)/ig,function(F,E){var y=Math.min(4,E.length);return(D+"").substr(4-y)});for(var z in B){A=A.replace(new RegExp("("+z+"+)","g"),function(E,y){return(B[z]<10&&y.length>1)?"0"+B[z]:B[z]})}return A};m.identity=function(y){return y};var j=0;m.uniqueId=function(y){var z=j++;return y?y+z:z}})(K);(function(b,d){var a;var c=function(){var m=["touchstart","touchmove","touchend"],f=true;var n=document.createElement("div");for(var l=0,h=m.length;l<h;l++){var g="on"+m[l];var k=(g in n);if(!k){n.setAttribute(g,"return;");k=typeof n[g]=="function"}if(!k){f=false;break}}return f};b.isSupportTouch=function(){if(a===d){a=c()}return a}})(K);K.Browser=(function(){var a=window.navigator,c=a.userAgent.toLowerCase(),d=/(msie|webkit|gecko|presto|opera|safari|firefox|chrome|maxthon)[ \/]([\d.]+)/ig,f={platform:a.platform};c.replace(d,function(i,g,j){var h=g.toLowerCase();f[h]=j});if(f.opera){c.replace(/opera.*version\/([\d.]+)/,function(h,g){f.opera=g})}if(f.msie){f.ie=f.msie;var b=parseInt(f.msie,10);f["ie"+b]=true}if(f.safari&&f.chrome){f.safari=false}return f}());if(K.Browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}}function onDetectFocus(){K.windowFocused=true}function onDetectBlur(){K.windowFocused=false}K.windowFocused=true;if(K.Browser.ie){document.attachEvent("onfocusin",onDetectFocus);document.attachEvent("onfocusout",onDetectBlur)}else{window.addEventListener("focus",onDetectFocus,false);window.addEventListener("blur",onDetectBlur,false)}(function(a){var b=function(){this.__callbacks__={}};a.mix(b.prototype,{on:function(d,g,f){if(f){g=a.bind(g,f)}var c=this.__callbacks__[d];if(c&&c.fired===true){g.apply(f,c.args);return}this.__callbacks__[d]=this.__callbacks__[d]||[];this.__callbacks__[d].push(g);return[d,g]},un:function(f){var c=f[0];var g=f[1];if(c in this.__callbacks__){var d=this.__callbacks__[c];a.forEach(d,function(h,j){if(g==h){d[j]=null}})}},once:function(c,h,d){var f=this;var g=this.on(c,function(){h.apply(d,arguments);f.un(g)})},fire:function(d){if(d in this.__callbacks__){var f=this.__callbacks__[d];var c=Array.prototype.slice.call(arguments,1);a.forEach(f,function(h,g){if(typeof(h)!="function"){return null}return h.apply(null,c)})}},fireReady:function(d){var f=this.__callbacks__[d];if(!f){f=this.__callbacks__[d]=[]}var c=Array.prototype.slice.call(arguments,1);a.forEach(f,function(h,g){if(typeof(h)!="function"){return null}return h.apply(null,c)});f.fired=true;f.args=c}});a.Pubsub=b;a.mix(a,(new b()))})(K);(function(b,h,g){var a={};var f={};function d(l,k,j){if(b.indexOf(k,l)>=0){throw new Error("Module:"+l+" could't depends on itself!")}this.id=l;this.dependancy=k;this.factory=j}function i(l,k,j){if(arguments.length<2){throw new Error("module has invalid parameters")}if(!b.isString(l)){throw new Error("module must have a ID")}if(b.isFunction(k)){j=k;k=[]}else{if(!b.isArray(k)){var m=k;j=function(){return m};k=[]}}if(a[l]){b.fire("haibei:resource:conflict");return}var o=b.unique(k),n=d.getDependancy(o);d.wait(n,function(){var p=new d(l,k,j);a[l]=p;try{delete f[l]}catch(q){}b.fire("Module:"+l+":Ready")})}d.createRequire=function(l,k){function j(o,n){if(!n&&b.indexOf(l,o)==-1){throw new Error(o+" counld't be required in "+k+", as you not declared to depend it ")}var m=a[o];if(!m){return null}if(!m.exports){c(m)}return m.exports}j.async=function(n,q,o){n=b.isString(n)?[n]:n;var m=b.unique(n);var p=d.getDependancy(m);d.load(p);d.wait(p,function(){var t=[];for(var r=0,s=n.length;r<s;r++){t.push(j(n[r],true))}q.apply(o||g,t)})};return j};d.getDependancy=function(j){return h.getDependancy(j)};d.load=function(j){j=b.isString(j)?[j]:j;b.forEach(j,function(k){h.loadModule(k)})};d.defined=function(){return a};d.waiting=function(){return b.keys(f)};d.check=function(j,k){j=b.trim(j);if(j.length==0||a[j]){k&&k()}else{f[j]=true;b.on("Module:"+j+":Ready",k)}};d.wait=function(k,l){k=[].concat(k);if(k.length>0){var j=k.shift();d.check(j,function(){d.wait(k,l)})}else{l&&l()}};function c(l){var j=l.factory,k;if(b.isFunction(j)){l.exports={};k=j(d.createRequire(l.dependancy,l.id),l.exports,l);if(k){l.exports=k}}else{if(j!==undefined){l.exports=j}}}g.define=b.define=i;g.Module=b.Module=d})(K,K.Resource,this);(function(k,b){var i={};var r={};var m="http://js.mafengwo.net/";var p=/\.js$/i;var c={};var n={};var j=[];var o=[];var a;b.addResourceMap=function(t){k.mix(i,t)};b.getResourceMap=function(t){return i[t]};b.addResourceDepends=function(t){k.mix(r,t)};b.setBasePath=function(t){m=t};b.getDependancy=function(v,u){var t=[];v=k.isString(v)?[v]:v;u=u||[];k.forEach(v,function(w){w=w.replace(p,"");u=u.concat(t);if(k.indexOf(u,w)==-1){t.unshift(w)}var y=r[w+".js"];if(!y){return}var x=b.getDependancy(y,u);if(x.length){t.unshift.apply(t,x)}});return t};var l=/^\/+|\/+$/ig;b.loadModule=function(t){t=t.replace(l,"");if(!p.test(t)){t+=".js"}var u=i[t];if(u){b.loadJS(m+u)}};b.canonicalURI=function(t){if(/^\/\/\/?/.test(t)){t=location.protocol+t}return t};var g=function(){var v=document.getElementsByTagName("link"),u=v.length,t;while(u){t=v[--u];if((t.rel=="stylesheet"||t.type=="text/css")&&t.href){c[b.canonicalURI(t.href)]=true}}v=document.getElementsByTagName("script");u=v.length;while(u){t=v[--u];if((!t.type||t.type=="text/javascript")&&t.src){c[b.canonicalURI(t.src)]=true}}g=function(){}};var q=function(v){var w=j,u,t;delete n[v];c[v]=true;for(t=0;t<w.length;t++){u=w[t];delete u.resources[v];if(k.isEmpty(u.resources)){u.callback&&u.callback();w.splice(t--,1)}}};var f=function(){var A=document.styleSheets,x=A.length,u=o;while(x--){var z=A[x],y=false;if(!k.Browser.firefox){y=true}else{try{if(z.cssRules){y=true}}catch(w){if(w.name==="SecurityError"||w.name==="NS_ERROR_DOM_SECURITY_ERR"){y=true}}}if(y){var t=z.ownerNode||z.owningElement,v=u.length;if(t){while(v--){if(t==u[v]){q(u[v]["data-href"]);u.splice(v,1)}}}}}if(!u.length){clearInterval(a);a=null}};var d=function(u){var t=document.createElement("script");var v=function(){t.onload=t.onerror=t.onreadystatechange=null;q(u)};k.mix(t,{type:"text/javascript",src:u,async:true});t.onload=t.onerror=v;t.onreadystatechange=function(){var w=this.readyState;if(w=="complete"||w=="loaded"){v()}};document.getElementsByTagName("head")[0].appendChild(t)};var h=function(u){var t=document.createElement("link");k.mix(t,{type:"text/css",rel:"stylesheet",href:u,"data-href":u});document.getElementsByTagName("head")[0].appendChild(t);if(t.attachEvent){var v=function(){q(u)};t.onload=v}else{o.push(t);if(!a){a=setInterval(f,20)}}};var s=function(x,A){var t={},u,B,z,y;g();x=k.isArray(x)?x:[x];for(var w=0,v=x.length;w<v;w++){u=b.canonicalURI(x[w]);t[u]=true;if(c[u]){setTimeout(k.bind(q,null,u),0)}else{if(!n[u]){n[u]=true;if(u.indexOf(".css")>-1){h(u)}else{d(u)}}}}if(A){j.push({resources:t,callback:A})}};b.loadJS=function(t,u){s(t,u)};b.loadCSS=function(t,u){s(t,u)};b.loadIMG=function(u,v){var t=new Image();v=typeof v==="function"?v:function(){};t.onload=function(){t.onload=null;v.call(null,t)};if(t.readyState=="complete"){v.call(null,t)}t.src=u}})(K,K.Resource);(function(d){var f=false;var c=false;d.ready=function(j){if(f){j()}else{d.on("Onload:DomContentLoaded",j)}};d.load=function(j){if(c){j()}else{d.on("Onload:Loaded",j)}};var i=function(){if(!f){f=true;d.fire("Onload:DomContentLoaded")}};var h=function(){if(!c){c=true;d.fire("Onload:Loaded")}};var b;if(document.addEventListener){b=function(){document.removeEventListener("DOMContentLoaded",b,false);i()}}else{if(document.attachEvent){b=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",b);i()}}}}var a=function(){if(f){return}try{document.documentElement.doScroll("left")}catch(j){setTimeout(a,1);return}document.detachEvent("onreadystatechange",b);i()};var g=function(){var l=d.global,j=l.document,n=function(){if(!f){f=true;i()}h()};if(j.readyState=="complete"){setTimeout(i,0);return}if(j.addEventListener){j.addEventListener("DOMContentLoaded",b,false);l.addEventListener("load",n,false)}else{if(j.attachEvent){j.attachEvent("onreadystatechange",b);l.attachEvent("onload",n);var k=false;try{k=l.frameElement==null}catch(m){}if(j.documentElement.doScroll&&k){a()}}}};g()})(K);(function(k,h){var n="require getContainer".split(/\s+/ig);var f={};function b(q,o,p){if(f[q]){k.fire("haibei:resource:conflict");throw new Error("App:"+q+" has defined");return}f[q]=this;this.id=q;this.requiredModList=[].concat(o);this.execBeforeDomready=p}k.mix(b.prototype,{define:function(p){var o=k.unique(this.requiredModList),s=h.getDependancy(o),r=this,q=function(){k.fire("App:"+r.id+":Ready",r)};h.wait(s,function(){var u=h.createRequire(o,r.id);if(k.isFunction(p)){p=p.call({},u)}if(!p){return}var v,w,y;for(v=0,w=n.length;v<w;v++){y=n[v];if(p[y]){throw new Error(y+" is a reserve method or property")}}p.require=u;var x=p.require("core/jQuery");r.__jQuery__=x;if(p.container&&x(p.container).length==0){return}var t=a(p,x);if(p.events){g(p,x,t)}if(k.isFunction(p.main)){if(r.execBeforeDomready){p.main();q()}else{k.ready(function(){p.main();q()})}}else{q()}})}});function a(p,q){var o;if(!p.container){p.container=document.body}o=q(p.container);if(!o.length||o.length>1){o=q(document.body)}p.container=o;p.getContainer=function(){return o};return o}var i=/^([\w\.]+)(?:\s+(.*))?$/;function g(r,q,o){var p=r.events;k.map(p,function(v,t){var u=t.match(i),w=u[1],s=u[2],x=k.bind(r[v],r);if(!s){o.bind(w,x)}else{o.delegate(s,w,k.bind(r[v],r))}})}var m=0;function j(){return"__APP__"+(m++)}function d(o){var p=o[0];if(p&&k.isString(p)){if(k.last(p.split(/\//ig)).charAt(0)!="A"){throw new Error(p+" is a invalid name for a App")}}else{p=j()}return p}function c(o){return k.detect(o,function(p){return k.isArray(p)})||[]}function l(o){var p=k.last(o);return k.isBoolean(p)?p:false}k.App=function(q,p,o){return new b(d(arguments),c(arguments),l(arguments))};k.App.get=function(o){return f[o]||null}})(K,K.Module);(function(b){var d=b.mix,c=b.indexOf;var a=b.CustEvent=function(h,g,f){this.target=h;this.type=g;d(this,f||{})};d(a.prototype,{target:null,currentTarget:null,type:null,returnValue:undefined,preventDefault:function(){this.returnValue=false}});b.CustEventTargetH={on:function(h,i,g){var f=(h.__custListeners&&h.__custListeners[i])||b.error("unknown event type",TypeError);if(c(f,g)>-1){return false}f.push(g);return true},once:function(i,j,h){var f=(i.__custListeners&&i.__custListeners[j])||b.error("unknown event type",TypeError);var g=$.proxy(function(k){h.call(i,k);b.CustEventTargetH.un(i,j,g)},this);b.CustEventTargetH.on(i,j,g);return true},un:function(i,j,h){var g=(i.__custListeners&&i.__custListeners[j])||b.error("unknown event type",TypeError);if(h){var f=c(g,h);if(f<0){return false}g.splice(f,1)}else{g.length=0}return true},fire:function(m,n,g){if(n instanceof a){var f=d(n,g);n=n.type}else{f=new a(m,n,g)}var h=(m.__custListeners&&m.__custListeners[n])||b.error("unknown event type",TypeError);if(n!="*"){h=h.concat(m.__custListeners["*"]||[])}f.returnValue=undefined;f.currentTarget=m;var l=f.currentTarget;if(l&&l["on"+f.type]){var k=l["on"+f.type].call(l,f)}for(var j=0;j<h.length;j++){h[j].call(l,f)}return f.returnValue!==false||(k===false&&f.returnValue===undefined)},createEvents:function(j,g){g=g||[];if(typeof g=="string"){g=g.split(",")}var h=j.__custListeners;if(!h){h=j.__custListeners={}}for(var f=0;f<g.length;f++){h[g[f]]=h[g[f]]||[]}h["*"]=h["*"]||[];return j}}}(K));(function(b){var a=function(){};var c={methodize:function(h,d){var f=new a();for(var g in h){if(typeof h[g]=="function"&&!/^_/.test(g)){f[g]=b.methodize(h[g],d)}}return f}};b.Helper=c}(K));(function(a){var c=a.mix;var d=a.CustEventTarget=function(){this.__custListeners={}};var b=a.Helper.methodize(a.CustEventTargetH,null,{on:"operator",un:"operator"});c(d.prototype,b);a.CustEvent.createEvents=d.createEvents=function(g,f){a.CustEventTargetH.createEvents(g,f);return c(g,d.prototype)}}(K));(function(a){a.Env={}})(K);(function(a){a.onbeforeunload=function(c){if(!c){return}if(typeof window.onbeforeunload=="function"){var b=window.onbeforeunload;window.onbeforeunload=function(){var d=c.apply(null,arguments);var f=b.apply(null,arguments);return f?f:d}}else{window.onbeforeunload=c}}})(K);(function(a){a.Performance={timing:{}};var b=window.performance||window.msPerformance||window.webkitPerformance||window.mozPerformance;if(b&&b.timing){a.Performance.timing=b.timing}else{a.Performance.timing.responseStart=a.global.pageStart;a.ready(function(){a.Performance.timing.domContentLoadedEventStart=(new Date()).getTime()});a.load(function(){a.Performance.timing.loadEventStart=(new Date()).getTime()})}})(K);(function(f){var h=function(m,l){l=l.toUpperCase();while(m&&m.nodeName!=l){m=m.parentNode}return m};var d=function(m,l){if("hasAttribute" in m){return m.getAttribute(l)}else{if("getAttributeNode" in m){var n=m.getAttributeNode(l);if(n){return n.value}}}return undefined};var k=function(l){if(!("App" in f)||!f.App.get(l)){f.log(l,"not ready");return false}return true};var i=function(l){var m=d(l,"data-app");if(m&&m.length&&!k(m)){return m}return false};var j=function(l,n,q){var r=i(l),p,m,o;if(r){f.once("App:"+r+":Ready",function(s){s.__jQuery__(q||l)[n]()});return false}else{if(n=="click"){p=l.getAttribute("data-ajax");o=l.getAttribute("data-op-log");if(o&&o.length){Request.apiLog(l)}if(p&&p.length){m=l.getAttribute("data-ajax-url")||l.href;switch(p){case"request-post":case"request":Request.load(m,l);break;case"dialog-post":case"dialog":Request.loadDialog(m,l);break;default:return}return false}}}return};var a=function(m){var l=h(m,"FORM")||m;return j(l,"submit")};var g=function(m){var l=h(m,"A")||m;return j(l,"click",m)};var b=(function(){var m=document.createElement("div");var l=("onsubmit" in m);if(!l){m.setAttribute("onsubmit","return;");l=typeof m.onsubmit==="function"}return l})();var c=function(){var l=f.global.document,m=l.documentElement;var n=null;m.onclick=function(s){s=s||window.event;n=s.target||s.srcElement;if(!b){var r=n.type;if(r=="submit"||r=="image"){return a(n)}}var o=n.href;if(o&&!/#$/.test(o)){var q=(s.which&&s.which!=1),p=(s.altKey||s.ctrlKey||s.metaKey||s.shiftKey);if(q||p){return}}return g(n)};if(!b){m.onkeypress=function(p){p=p||window.event;n=p.target||p.srcElement;var o=n.type;if((o=="text"||o=="password")&&p.keyCode==13){return a(n)}return}}if(b){m.onsubmit=function(p){p=p||window.event;var o=p.target||p.srcElement;return a(o)}}};c()})(K);K.on("login:required",$.proxy(function(){show_login()},this));K.on("hb:incr",$.proxy(function(a){var b=parseInt(a.html(),10);a.UpNum("+1",function(){a.html(b+1)})},this));K.on("hb:decr",$.proxy(function(a){var b=parseInt(a.html(),10);a.UpNum("-1",function(){a.html(b-1)})},this));function showPrompt(a){$.prompt.close();var b={};var c={buttons:b};$.prompt(a,c);$("div.jqiclose").hide();$("div.jqifade").css("background-color","#000")}$(function(){$("body").delegate("._j_add_friend","click",function(a){a.preventDefault();var c=$(this);var b=parseInt(c.data("to_uid"),10);if(b==0){return false}$.post("/ajax/addfriend.php",{action:"addfriend",touid:b},function(f){if(f.ret=="1"){if(c.hasClass("_j_remove")){c.remove()}else{c.replaceWith(f.html)}}else{majaxerr(f)}},"json")}).delegate("._j_write_address","click",function(a){a.preventDefault();$.prompt.close();if(_IS_LOGIN_!=1){show_login();return false}K.Resource.loadCSS("http://css.mafengwo.net/css/msg_li.css");$.post("/ajax/ajax_user_ext_add.php",{action:"get_float_address"},function(b){if(b.ret==1){$.prompt(b.html,{buttons:{"提交":true},callback:function(d,c,h){if(d){var g={action:"address",true_name:$("#true_name",$(c)).val(),mobile:$("#mobile",$(c)).val(),zip_code:$("#zip_code",$(c)).val(),address:$("#address",$(c)).val()};$.post("/ajax/ajax_user_ext_add.php",g,function(f){if(f.ret==1){mTinyAlert("操作成功！")}else{majaxerr(f)}},"json")}}})}else{majaxerr(b)}},"json")})});var Cache={};var Request=function(a){if(a){this.setURI(a)}this._method="GET";this._dataType="json";this._data={};this._options={};this._xhr=null};K.mix(Request,{load:function(c,d){var a=$(d),f=a.attr("data-ajax")=="request-post"?"POST":"GET";var b=a.find("._j_loading_elem");if(!b.length){b=a}if(b.hasClass("loading")){return}new Request(c).setMethod(f).setRelativeTo(d).setLoadingElement(b).send()},loadDialog:function(c,d){var a=$(d),f=a.attr("data-ajax")=="dialog-post"?"POST":"GET";var b=a.find("._j_loading_elem");if(!b.length){b=a}if(b.hasClass("loading")){return}new Request(c).setMethod(f).setRelativeTo(d).setLoadingElement(b).send().setHandler(function(g){if(g.html.length>0){var h=g.params;h=$.parseJSON(h);$.prompt.close();$.prompt(g.html,h);$("._j_prompt_close").click(function(i){i.preventDefault();$.prompt.close()});K.fire("after:dialog:show",h)}})},apiLog:function(d){var b=$(d),f=b.attr("data-type"),a=b.attr("data-mk");var c="/ajax/ajax_op_log_api.php?type="+encodeURIComponent(f)+"&mk="+encodeURIComponent(a);new Request(c).setMethod("GET").send()},invalidate:function(a){return ResponseCache.invalidate(Request.normalizeURI(a))},normalizeURI:function(a,d){var b=new URI(a);var f={};var c=K.mix({},d,b.getQueryParams());K.forEach(c,function(h,g){if(!/^_/.test(g)){f[g]=h}});b.setQueryParams(f);return b.setProtocol(null).setDomain(null).setFragment(null).toString()}});K.mix(Request.prototype,{setMethod:function(a){this._method=a;return this},getMethod:function(){return this._method},setDataType:function(a){this._dataType=a;return this},getDataType:function(){return this._dataType},setData:function(a){this._data=a;return this},getData:function(){return this._data},setURI:function(a){this._uri=a;return this},getURI:function(){return this._uri},setHandler:function(a){if(K.isFunction(a)){this._handler=a}return this},getHandler:function(){return this._handler},setErrorHandler:function(a){this._errorHandler=a;return this},getErrorHandler:function(){return this._errorHandler},setRelativeTo:function(a){this._relativeTo=a;return this},setFinallyHandler:function(a){this._finallyHandler=a;return this},getFinallyHandler:function(){return this._finallyHandler},getRelativeTo:function(){return this._relativeTo},setLoadingElement:function(a){this._loadingElement=a;return this},getLoadingElement:function(a){return this._loadingElement},setOption:function(a,b){this._options[a]=b;return this},getOption:function(a){return this._options[a]},send:function(){if(this.getMethod()=="GET"){var a=ResponseCache.get(Request.normalizeURI(this.getURI(),this.getData()));if(a){this._invokeResponseHandler(a);return}}this._updateLoadingElement(true);var b=this;this._xhr=$.ajax({type:this._method,url:this._uri,data:this._data,dataType:this._dataType,success:function(d,c,f){if(f.status==204){b._invokeResponseHandler({})}else{if(!d.error){b._invokeResponseHandler(d)}else{b._invokeErrorHandler(d)}}},error:function(c){b._invokeErrorHandler({error:c})},complete:function(){b._updateLoadingElement(false)}});return this},abort:function(){this._xhr&&this._xhr.abort();return this}});K.mix(Request.prototype,{_updateLoadingElement:function(a){if(this._loadingElement){if(a){$(this._loadingElement).addClass("loading")}else{$(this._loadingElement).removeClass("loading")}}},_invokeResponseHandler:function(a){if("redirect" in a){window.location=a.redirect;return}if(this.getMethod()=="GET"&&a.cache){ResponseCache.set(Request.normalizeURI(this.getURI(),this.getData()),a,60000)}if(this.getOption("suppressEval")){this._loadResource(a.resource,function(){});return}if("resource" in a){this._loadResource(a.resource,K.bind(function(){this._dispatchResponse(a)},this))}else{this._dispatchResponse(a)}},_invokeErrorHandler:function(a){if(this.getOption("suppressEval")){return}if(a&&a.resource){this._loadResource(a.resource,K.bind(function(){this._dispatchErrorResponse(a)},this))}else{this._dispatchErrorResponse(a)}},_loadResource:function(c,d){var b=this;var a=function(){d();if("js" in c&&!K.isEmpty(c.js)){K.Resource.loadJS(c.js)}if("map" in c){if(c.map.depends){K.Resource.addResourceDepends(c.map.depends)}if(c.map.uris){K.Resource.addResourceMap(c.map.uris)}}if(!b.getOption("suppressEval")){if("onload" in c){K.forEach(c.onload,function(g){try{(new Function(g)).apply(b)}catch(f){K.log(g)}})}}};if("css" in c&&!K.isEmpty(c.css)){K.Resource.loadCSS(c.css,a)}else{a()}},_dispatchResponse:function(a){if(a.suppressHandler){return}if(this._handler){this._handler(a.payload,this)}if(this._finallyHandler){this._finallyHandler(this)}},_dispatchErrorResponse:function(a){if(a.suppressHandler){return}if(this._errorHandler){this._errorHandler(a.error,this)}if(this._finallyHandler){this._finallyHandler(this)}}});var now=function(){return new Date().getTime()};var ResponseCache={set:function(d,b,a){var c=this._getCacheKey(d);if(c){this._setCache(c,{uri:d,response:b,time:now(),expires:a});return true}return false},get:function(b){var a=this._getCacheKey(b);if(a){return this._getCache(a)}return false},invalidate:function(b){var a=this._getCacheKey(b);if(a){return delete this._cache[a]}return false},clear:function(){this._cache=[]},_getCacheKey:function(a){return a},_setCache:function(a,b){this._cache[a]=b},_getCache:function(a){if(a in this._cache){var b=this._cache[a];if(b.expires>0&&now()<=b.time+b.expires){return b.response}}return false},_cache:{}};var URI=function(c){this.setQueryParams({});if(c){var a=URI._uriPattern.exec(c);this.setProtocol(a[1]||undefined);this.setDomain(a[2]||undefined);this.setPort(a[3]||undefined);var g=a[4];var f=a[5];this.setFragment(a[6]||undefined);this.setPath(g.charAt(0)=="/"?g:"/"+g);if(f){var b={};var d;while((d=URI._queryPattern.exec(f))!=null){b[decodeURIComponent(d[1].replace(/\+/g," "))]=decodeURIComponent(d[2].replace(/\+/g," "))}this.setQueryParams(b)}}};K.mix(URI,{_uriPattern:/(?:([^:\/?#]+):)?(?:\/\/([^:\/?#]*)(?::(\d*))?)?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,_queryPattern:/(?:^|&)([^&=]*)=?([^&]*)/g,_defaultQuerySerializer:function(b){var a=[];K.forEach(b,function(d,c){if(d!=null){a.push(encodeURIComponent(c)+(d?"="+encodeURIComponent(d):""))}});return a.join("&")}});K.mix(URI.prototype,{getProtocol:function(){return this._protocol},setProtocol:function(a){this._protocol=a;return this},getDomain:function(){return this._domain},setDomain:function(a){this._domain=a;return this},getPort:function(){return this._port},setPort:function(a){this._port=a;return this},getPath:function(a){return this._path},setPath:function(a){this._path=a;return this},getQueryParams:function(){return this._queryParams},addQueryParams:function(a){K.mix(this.getQueryParams(),a);return this},setQueryParams:function(a){this._queryParams=a;return this},setQueryParam:function(a,b){var c={};c[a]=b;return this.addQueryParams(c)},getFragment:function(){return this._fragment},setFragment:function(a){this._fragment=a;return this},getQuerySerializer:function(){return this._querySerializer},setQuerySerializer:function(a){this._querySerializer=a},_getQueryString:function(){var a=(this.getQuerySerializer()||URI._defaultQuerySerializer)(this.getQueryParams());return a?"?"+a:""},go:function(){var a=this.toString();(a&&(window.location=a))||window.location.reload(true)}});URI.prototype.toString=function(){var a="";if(this.getProtocol()){a+=this.getProtocol()+"://"}a+=this.getDomain()||"";a+=this.getPath()||(a?"/":"");a+=this._getQueryString();if(this.getFragment()){a+="#"+this.getFragment()}return a};