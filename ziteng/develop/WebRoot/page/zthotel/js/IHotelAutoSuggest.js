(function(a){a.fn.extend({HotelSuggest:function(d,c){var b=typeof d=="string";c=a.extend({},a.HotelAutoCompleter.defaults,{url:b?d:null,data:b?null:d,delay:b?a.HotelAutoCompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(e){return e;};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.HotelAutoCompleter(this,c);});},result:function(b){return this.bind("result",b);},search:function(b){return this.trigger("search",[b]);},flushCache:function(){return this.trigger("flushCache");},setOptions:function(b){return this.trigger("setOptions",[b]);},unautocomplete:function(){return this.trigger("unautocomplete");}});a.HotelAutoCompleter=function(i,n){var j={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var b=a(i).attr("autocomplete","off").addClass(n.inputClass);var w;var p="";var d=a.HotelAutoCompleter.Cache(n);var q=a.HotelAutoCompleter.Progress;var f=0;var k;var e={mouseDownOnSelect:false};var t=a.HotelAutoCompleter.Select(n,i,u,e);var c;a.browser.opera&&a(i.form).bind("submit.autocomplete",function(){if(c){c=false;return false;}});b.bind((a.browser.opera?"keypress":"keydown")+".autocomplete",function(y){f=1;k=y.keyCode;switch(y.keyCode){case j.UP:y.preventDefault();if(t.visible()){t.prev();}else{m(0,true);}break;case j.DOWN:y.preventDefault();if(t.visible()){t.next();}else{m(0,true);}break;case j.PAGEUP:y.preventDefault();if(t.visible()){t.pageUp();}else{m(0,true);}break;case j.PAGEDOWN:y.preventDefault();if(t.visible()){t.pageDown();}else{m(0,true);}break;case n.multiple&&a.trim(n.multipleSeparator)==","&&j.COMMA:case j.TAB:case j.RETURN:if(u()){if(n.isSubmit){return true;}else{y.preventDefault();c=true;return false;}}else{t.hide();}break;case j.ESC:t.hide();break;default:clearTimeout(w);w=setTimeout(m,n.delay);break;}}).focus(function(){f++;}).blur(function(){f=0;if(!e.mouseDownOnSelect){g();}}).click(function(){if(f++>1&&!t.visible()){m(0,true);}}).bind("search",function(){var z=(arguments.length>1)?arguments[1]:null;function y(C,A){var D;if(A&&A.length){for(var B=0;B<A.length;B++){if(A[B].result.toLowerCase()==C.toLowerCase()){D=A[B];break;}}}if(typeof z=="function"){z(D);}else{b.trigger("result",D&&[D.data,D.value]);}}a.each(x(b.val()),function(A,B){s(B,y,y);});}).bind("flushCache",function(){d.flush();}).bind("input",function(){m(0,true);}).bind("setOptions",function(){a.extend(n,arguments[1]);if("data" in arguments[1]){d.populate();}}).bind("unautocomplete",function(){t.unbind();b.unbind();a(i.form).unbind(".autocomplete");});function u(){var B=t.selected();if(!B){return false;}var D=B;p=D;if(n.multiple){var F=x(b.val());if(F.length>1){var C=n.multipleSeparator.length;var y=a(i).selection().start;var E,A=0;a.each(F,function(G,H){A+=H.length;if(y<=A){E=G;return false;}A+=C;});F[E]=D;D=F.join(n.multipleSeparator);}D+=n.multipleSeparator;}b.focus();var z=a("<div>"+D+"</div>").text();b.val(z);h();b.trigger("result",[B.data,B.value]);return true;}function m(y,A){if(k==j.DEL){t.hide();return;}var z=b.val();if(!A&&z==p){return;}p=z;z=l(z);if(z.length>=n.minChars){b.addClass(n.loadingClass);if(!n.matchCase){z=z.toLowerCase();}s(z,r,h);}else{v();t.hide();}}function x(y){if(!y){return[""];}if(!n.multiple){return[a.trim(y)];}return a.map(y.split(n.multipleSeparator),function(z){return a.trim(y).length?a.trim(z):null;});}function l(z){if(!n.multiple){return z;}var A=x(z);if(A.length==1){return A[0];}var y=a(i).selection().start;if(y==z.length){A=x(z);}else{A=x(z.replace(z.substring(y),""));}return A[A.length-1];}function g(){clearTimeout(w);w=setTimeout(h,200);}function h(){var y=t.visible();t.hide();clearTimeout(w);v();if(n.mustMatch){b.search(function(z){if(!z){if(n.multiple){var A=x(b.val()).slice(0,-1);b.val(A.join(n.multipleSeparator)+(A.length?n.multipleSeparator:""));}else{b.val("");b.trigger("result",null);}}});}}function r(z,y){if(y&&y.length&&f){v();t.display(y,z);t.show();}else{h();}}function s(C,B,A){if(!n.matchCase){C=C.toLowerCase();}var y=n.data;if(y&&y.length){B(C,y);}else{if((typeof n.url=="string")&&(n.url.length>0)){var z={timestamp:+new Date()};a.each(n.extraParams,function(D,E){z[D]=typeof E=="function"?E():E;});if(q){q.abort();}q=a.ajax({mode:"abort",port:"autocomplete"+i.name,dataType:n.dataType,url:n.url,type:"GET",jsonp:"callback",data:a.extend({q:l(C),limit:n.max},z),success:function(D){d.add(C,D);B(C,D);q=null;}});}else{t.emptyList();A(C);}}}function o(y){var A=[];var C=y.split("\n");for(var z=0;z<C.length;z++){var B=a.trim(C[z]);if(B){B=B.split("|");A[A.length]={data:B,value:B[0],result:n.formatResult&&n.formatResult(B,B[0])||B[0]};}}return A;}function v(){}};a.HotelAutoCompleter.defaults={inputClass:"com_input",resultsClass:"ac_results com_results",minChars:1,delay:400,matchCase:false,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:false,formatItem:function(b){return b[0];},contentType:"application/json; charset=GB2312",formatMatch:null,width:230,isSubmit:false,multiple:false,multipleSeparator:", ",highlight:function(c,b){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");},scroll:true,scrollHeight:180};a.HotelAutoCompleter.Progress=null;a.HotelAutoCompleter.Cache=function(f){var c={};var e=0;function b(h,i){if(e>f.cacheLength){d();}if(!c[h]){e++;}c[h]=i;}function g(){if(!f.data){return false;}else{return f.data;}}setTimeout(g,25);function d(){c={};e=0;}return{flush:d,add:b,populate:g,load:function(h){if(!f.cacheLength||!e){return null;}return f.data;}};};a.HotelAutoCompleter.Select=function(p,i,q,d){var c={ACTIVE:"ac_over"};var l,b=-1,e,s="",o=true,f,k;function h(){if(!o){return;}f=a("<div/>").hide().addClass(p.resultsClass).css("position","absolute").appendTo(document.body);k=a("<ul/>").appendTo(f).mouseover(function(t){if(r(t).nodeName&&r(t).nodeName.toUpperCase()=="LI"){b=a("li",k).removeClass(c.ACTIVE).index(r(t));a(r(t)).addClass(c.ACTIVE);}}).click(function(t){a(r(t)).addClass(c.ACTIVE);q();i.focus();return false;}).mousedown(function(){d.mouseDownOnSelect=true;}).mouseup(function(){d.mouseDownOnSelect=false;});if(p.width>0){f.css("width",p.width);}o=false;}function r(u){var t=u.target;while(t&&t.tagName!="LI"){t=t.parentNode;}if(!t){return[];}return t;}function n(v){l.slice(b,b+1).removeClass(c.ACTIVE);m(v);var t=l.slice(b,b+1).addClass(c.ACTIVE);if(p.scroll){var u=0;l.slice(0,b).each(function(){u+=this.offsetHeight;});if((u+t[0].offsetHeight-k.scrollTop())>k[0].clientHeight){k.scrollTop(u+t[0].offsetHeight-k.innerHeight());}else{if(u<k.scrollTop()){k.scrollTop(u);}}}}function m(u){var t=q();b+=u;if(b<0){b=l.size()-1;}else{if(b>=l.size()){b=0;}}}function j(t){return p.max&&p.max<t?p.max:t;}function g(){k.empty();var v=j(e.length);for(var t=0;t<v;t++){if(!e[t]){continue;}var u=a("<li/>").html(e[t]).addClass(t%2==0?"ac_even":"ac_odd").appendTo(k)[0];a.data(u,"ac_data",e[t]);}l=k.find("li");if(p.selectFirst){l.slice(0,1).addClass(c.ACTIVE);b=0;}if(a.fn.bgiframe){k.bgiframe();}}return{display:function(t,u){h();e=t;s=u;g();},next:function(){n(1);},prev:function(){n(-1);},pageUp:function(){if(b!=0&&b-8<0){n(-b);}else{n(-8);}},pageDown:function(){if(b!=l.size()-1&&b+8>l.size()){n(l.size()-1-b);}else{n(8);}},hide:function(){f&&f.hide();l&&l.removeClass(c.ACTIVE);b=-1;},visible:function(){return f&&f.is(":visible");},current:function(){return this.visible()&&(l.filter("."+c.ACTIVE)[0]||p.selectFirst&&l[0]);},show:function(){var u=a(i).offset();f.css({width:typeof p.width=="string"||p.width>0?p.width:a(i).width(),top:u.top+i.offsetHeight,left:u.left}).show();if(p.scroll){k.scrollTop(0);k.css({maxHeight:p.scrollHeight,overflow:"auto"});if(a.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var t=0;l.each(function(){t+=this.offsetHeight;});var v=t>p.scrollHeight;k.css("height",v?p.scrollHeight:t);if(!v){l.width(k.width()-parseInt(l.css("padding-left"))-parseInt(l.css("padding-right")));}}}},selected:function(){var t=l&&l.filter("."+c.ACTIVE).removeClass(c.ACTIVE);return t&&t.length&&a.data(t[0],"ac_data");},emptyList:function(){k&&k.empty();},unbind:function(){f&&f.remove();}};};a.fn.selection=function(g,c){if(g!==undefined){return this.each(function(){if(this.createTextRange){var j=this.createTextRange();if(c===undefined||g==c){j.move("character",g);j.select();}else{j.collapse(true);j.moveStart("character",g);j.moveEnd("character",c);j.select();}}else{if(this.setSelectionRange){this.setSelectionRange(g,c);}else{if(this.selectionStart){this.selectionStart=g;this.selectionEnd=c;}}}});}var d=this[0];if(d.createTextRange){var f=document.selection.createRange(),e=d.value,h="<->",i=f.text.length;f.text=h;var b=d.value.indexOf(h);d.value=e;this.selection(b,b+i);return{start:b,end:b+i};}else{if(d.selectionStart!==undefined){return{start:d.selectionStart,end:d.selectionEnd};}}};})(jQuery);