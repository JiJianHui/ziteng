var AiOBox=Elong.Control.AiOBox;AiOBox=Class.create();Object.extend(AiOBox.prototype,{name:"AiOBox",windowElement:null,timeout:null,errtimeout:null,resultData:null,selectItem:null,currentCity:null,hotCacheList:null,dataCacheList:null,KeyCode:{Left:37,Up:38,Right:39,Down:40,Del:46,Tab:9,Return:13,Esc:27,Command:188,PageUp:33,PageDown:34,BackSpace:8,Tab:9},m_Hot:new Template('<div style="width:#{HotWidth}px;" class="com_hotresults"><div style="width:100%;"><div class="hotel_near">#{HotData}</div></div><div class="clear"></div><div class="com_cbox_b com_cbox_lt"></div><div class="com_cbox_b com_cbox_rt"></div><div class="com_cbox_b com_cbox_lb"></div><div class="com_cbox_b com_cbox_rb"></div><div class="clear"></div></div>'),m_Result:new Template('<div style="width:#{DataWidth}px;position:relative;" class="com_results"><div style="width: 100%;">#{Default}<ul method="ulData">#{Data}</ul></div><div class="clear"></div><div class="com_cbox_b com_cbox_lt"></div><div class="com_cbox_b com_cbox_rt"></div><div class="com_cbox_b com_cbox_lb"></div><div class="com_cbox_b com_cbox_rb"></div><div class="clear"></div></div>'),options:{eventElement:null,lang:"cn",cityId:"0101",onSelect:null,onClose:null,hotWidth:300,hotHeight:138,searchWidth:260,hotData:null,cityData:null,colLen:4,maxLen:10,enableSearch:true,delay:200,isJsonp:0,resultNextId:"",searchUrl:"http://hotel.elong.com/keywordssuggest.html",hotUrl:"http://hotel.elong.com/hotsuggest.html",aioType:0},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.hotCacheList=new Array();this.eventElement.attr("datacheck","");this.eventElement.attr("selectIndex",-1);this.eventElement.unbind("click");this.eventElement.unbind("keyup");this.eventElement.bind("click",this.onInputClick.bindAsEventListener(this));this.eventElement.bind("keyup",this.onInputKeyUp.bindAsEventListener(this));this.setHotSuggest(this.cityId);},getSelect:function(){return this.selectCity;},setHotSuggest:function(a){if(!String.isNullOrEmpty(a)){if(this.eventElement!=null){var c=false;for(var b=0;b<this.hotCacheList.length;b++){if(this.hotCacheList[b].CityId==this.cityId){this.currentCity=this.hotCacheList[b];c=true;break;}}if(!c){simpleAjax.callBack(this.hotUrl,"cityId="+this.cityId+"&language="+this.lang,function(e){var d={CityId:this.cityId,Data:e};this.hotCacheList.push(d);this.currentCity=d;}.bind(this),true,"get",(this.isJsonp=="1")?"jsonp":"json");}}}},destroyDOM:function(){this.windowElement=null;this.contentEndRegion=null;this.options=null;},initializeEvent:function(){if(this.windowElement){this.windowElement.bind("click",this.onClickRegion.bindAsEventListener(this));this.windowElement.bind("mouseout",this.onMouseOutRegion.bindAsEventListener(this));this.windowElement.bind("mouseover",this.onMouseOverRegion.bindAsEventListener(this));FunctionExt.defer(this.onOutClick.bindAsEventListener(this),100);}},destroyEvent:function(){this.windowElement.unbind("click");this.windowElement.unbind("mouseout");this.windowElement.unbind("mouseover");},buildHtml:function(keyword){var temp=encodeURIComponent(keyword.toLowerCase());var url=this.searchUrl;if(this.isJsonp==0){var appPath="";var host=window.location.host;if(host.toLowerCase().indexOf("travel.elong")>-1){var path=window.location.pathname;var pathtemp=path.split("/");if(pathtemp.length>1){appPath="/"+pathtemp[1];}}url=appPath+"hotsuggest.html";}if(this.windowElement){this.windowElement.remove();}this.contentEndRegion=$("#m_contentend");this.windowElement=$('<div  style="display:none; position: absolute; z-index: 2000;"></div>').appendTo(this.contentEndRegion);var defaultHtml="<div class='tuijian'><p method='fromArea' keyword='"+keyword+"'><tt class='poi'></tt>地点在<strong> "+keyword+"</strong> 附近的酒店</p><p method='fromName' keyword='"+keyword+"'><tt class='name'></tt>名称含 <strong>"+keyword+"</strong> 的酒店</p></div>";this.windowElement.html(this.m_Result.eval({DataWidth:this.searchWidth,Default:defaultHtml,Data:""}));this.initializeEvent();this.render();var queryString="q="+temp+"&limit="+this.maxLen+"&cityid="+this.cityId+"&language="+this.lang;if(this.aioType==2){queryString+="&type=5,9";}else{if(this.aioType==1){queryString+="&type=1,2,3,6,99";}}simpleAjax.callBack(url,queryString,function(data){this.eventElement[0]["Data"]=null;if(data!=null&&data.length>0){this.eventElement.attr("TypeId","");this.eventElement.removeAttr("firstSType");this.resultData=data||[];this.selectItem=this.resultData[0];this.eventElement[0]["Data"]=this.resultData[0];this.eventElement.attr("firstSType",this.resultData[0].Type);this.eventElement.attr("firstSPId",this.resultData[0].PropertiesId);if(!String.isNullOrEmpty(this.resultData[0].Lat)&&!String.isNullOrEmpty(this.resultData[0].Lng)){this.eventElement.attr("firstSLat",this.resultData[0].Lat);this.eventElement.attr("firstSLng",this.resultData[0].Lng);}if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}var dataSb=new StringBuilder();for(var i=0;i<this.resultData.length;i++){var termArr=new Array();termArr=keyword.split(" ");var hightResult=this.resultData[i].Name;for(var j=0;j<termArr.length;j++){if($.trim(termArr[j]).length>0){hightResult=this.highlight(hightResult,$.trim(termArr[j]));}}var highName=hightResult;dataSb.append(' <li method="liData" data="'+i+'" class="ac_odd"><span method="spanData" data="'+i+'" typeid="'+this.resultData[i].Type+'">'+highName+"</span></li>");}this.windowElement.html(this.m_Result.eval({DataWidth:this.searchWidth,Default:defaultHtml,Data:dataSb.toString()}));this.windowElement.attr("winstyle","data");}else{this.eventElement.removeAttr("firstSType");this.eventElement.removeAttr("firstSPId");this.eventElement.removeAttr("firstSLat");this.eventElement.removeAttr("firstSLng");}}.bind(this),true,"GET",(this.isJsonp=="1")?"jsonp":"json");},buildHotHtml:function(){this.reloadData();if(this.windowElement){this.windowElement.remove();}this.contentEndRegion=$("#m_contentend");this.windowElement=$('<div style="display:none; position: absolute; z-index: 2000;"></div>').appendTo(this.contentEndRegion);var hotNameSb=new StringBuilder();var hotDataSb=new StringBuilder();if(this.currentCity!=null&&!Object.isNull(this.currentCity.Data)&&this.currentCity.Data.length>0){for(var i=0;i<this.currentCity.Data.length;i++){var t=this.currentCity.Data[i].Type;if(this.aioType==1&&(t==1||t==2||t==3)){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}else{if(this.aioType==2&&t==5){if(this.currentCity.Data[i].TypeNameList.length>0){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}else{this.windowElement.remove();return false;}}}if(this.aioType==0){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}}if(String.isNullOrEmpty(hotDataSb.toString())){this.windowElement.remove();return false;}this.windowElement.html(this.m_Hot.eval({HotData:hotDataSb.toString(),HotWidth:this.hotWidth}));}this.windowElement.attr("winstyle","hot");},highlight:function(b,a){return b.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+a.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>");},reloadData:function(){if(this.windowElement){this.windowElement.remove();if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}}},onInputClick:function(a){if(!Object.isNull(this.currentCity)&&this.windowElement==null){this.buildHotHtml();this.initializeEvent();this.render();this.eventElement.select();}},onInputKeyUp:function(b){if(!this.enableSearch){return;}var a=Event.element(b);if(this.windowElement&&this.windowElement.attr("winstyle")=="data"){var d=this.windowElement.find("ul[method='ulData']");var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");switch(b.keyCode){case this.KeyCode.Up:c.removeClass("ac_over");if(c.prev("li").length>0){c.prev("li").addClass("ac_over");}else{this.windowElement.find("ul[method='ulData'] li:last").addClass("ac_over");}d.scrollTop((c.offset().top-d.offset().top)<d.height()-30&&(c.offset().top-d.offset().top)>0?(c.offset().top-d.offset().top):c.offset().top);var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;case this.KeyCode.Down:c.removeClass("ac_over");if(c.next("li").length>0){c.next("li").addClass("ac_over");}else{this.windowElement.find("ul[method='ulData'] li:first").addClass("ac_over");}d.scrollTop((c.offset().top-d.offset().top)>d.height()-30?0:(c.offset().top-d.offset().top));var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;case this.KeyCode.Return:var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;default:clearTimeout(this.timeout);this.timeout=setTimeout(function(){this.reBuildData(a);}.bind(this),this.delay);}}else{switch(b.keyCode){case this.KeyCode.Up:case this.KeyCode.Down:case this.KeyCode.Left:case this.KeyCode.Right:case this.KeyCode.Return:break;default:clearTimeout(this.timeout);this.timeout=setTimeout(function(){this.reBuildData(a);}.bind(this),this.delay);}}b.stopPropagation();},reBuildData:function(b){var a=b;if(!String.isNullOrEmpty(this.cityId)){if(String.isNullOrEmpty(a.val())){this.eventElement.removeAttr("firstSType");this.eventElement.removeAttr("firstSPId");this.eventElement.removeAttr("firstSLat");this.eventElement.removeAttr("firstSLng");this.buildHotHtml();this.initializeEvent();this.render();}else{this.buildHtml(a.val());}}},onOutClick:function(){$(document).bind("click",function(b){var a=Event.element(b);if(this.windowElement!=null&&this.windowElement.find("*").index(a)==-1&&this.eventElement[0]!=a[0]){this.dispose();}}.bindAsEventListener(this));},selectData:function(a){if(!String.isNullOrEmpty(a.attr("data"))){var d;if(this.windowElement.attr("winstyle")=="hot"){var c=a.attr("data").split("|");var b=decodeURIComponent(this.currentCity.Data[c[0]].TypeNameList[c[1]].Name);this.eventElement.val(b);this.eventElement.attr("datacheck",a.attr("data"));d=this.currentCity.Data[c[0]].TypeNameList[c[1]];d.Accept=true;}else{var c=a.attr("data");var b=this.resultData[c].Name;this.eventElement.val(b);this.eventElement.attr("datacheck",c);this.eventElement.attr("selectIndex",c);d=this.resultData[c];d.Accept=true;}this.selectItem=d;this.eventElement[0]["Data"]=d;this.eventElement.attr("TypeId",d.Type);if(this.onSelect){this.onSelect(this.eventElement,d);}this.eventElement.focus();if(!String.isNullOrEmpty(this.resultNextId)){}}},onClickRegion:function(b){var a=Event.element(b);var c=a.attr("method");if(c==null||c==""){a=a.parent();c=a.attr("method");}switch(c){case"hotData":this.selectData(a);this.directSearch(this.selectItem);return;case"liData":case"spanData":this.selectData((c=="liData")?a:a.parent());this.directSearch(this.selectItem);return;case"fromArea":if(this.directSearch){this.eventElement.attr("selectIndex","-5");this.directSearch({Name:a.attr("keyword"),Type:99,PropertiesId:0,Lat:0,Lng:0,Accept:true});}return;case"fromName":if(this.directSearch){this.eventElement.attr("selectIndex","-6");this.directSearch({Name:a.attr("keyword"),Type:9,PropertiesId:0,Lat:0,Lng:0,Accept:true});}return;case"close":this.dispose();return;default:this.dispose();return;}},onMouseOverRegion:function(b){var a=Event.element(b);if(this.outTimer!=null){clearTimeout(this.outTimer);this.outTimer=null;}this.removeAllClass(a);if(a.is("li")||a.parent().is("li")){var c=a.is("li")?a:a.parent();c.addClass("ac_over");}},removeAllClass:function(a){if(a.is("li")||a.parent().is("li")){var b=a.is("li")?a:a.parent();b.removeClass("ac_over");b.siblings("li[class*=ac_over]").removeClass("ac_over");}},onMouseOutRegion:function(a){},render:function(){if(this.windowElement){var d=this.eventElement.offset().top+this.eventElement.height()+6;var b=this.eventElement.offset().left;var c=Globals.getScrollPosition();var a=Globals.browserDimensions();if(a.width-(this.eventElement.offset().left-c.x)>this.windowElement.width()){this.windowElement[0].style.top=d+"px";this.windowElement[0].style.left=b+"px";}else{this.windowElement[0].style.top=d+"px";b=b-this.windowElement.width()+this.eventElement.width();this.windowElement[0].style.left=b+"px";}this.ie6FilterIFrame=Globals.addIE6Filter(this.windowElement.width(),this.windowElement.height(),b,d,1999);this.windowElement.show();}},dispose:function(){if(this.windowElement){this.windowElement.hide();FunctionExt.defer(function(){if(this.windowElement){Globals.closeIE6Fliter(this.ie6FilterIFrame);if(this.windowElement.attr("winstyle")=="data"){if(this.onClose!=null){this.onClose(this.eventElement,this.windowElement);}}this.windowElement.remove();this.destroyEvent();this.destroyDOM();}}.bind(this),500);}}});var AiOWindow=Elong.Control.AiOWindow;AiOWindow=Class.create();Object.extend(AiOWindow.prototype,{name:"AiOWindow",aioSearch:null,options:{eventElement:null,lang:"cn",resultNextId:"",cityId:"0101",onSelect:null,directSearch:null,onClose:null,hotWidth:300,hotHeight:138,searchWidth:260,delay:200,maxLen:10,enableSearch:true,isJsonp:0,searchUrl:"http://hotel.elong.com/keywordssuggest.html",hotUrl:"http://hotel.elong.com/hotsuggest.html",aioType:0},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.aioSearch=new AiOBox(a);},getSelect:function(){return this.aioSearch.getSelect();},setHotSuggest:function(a){this.aioSearch.setHotSuggest();}});