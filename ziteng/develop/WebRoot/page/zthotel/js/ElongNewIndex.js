var ElongSelect=Elong.Control.ElongSelect;ElongSelect=Class.create();Object.extend(ElongSelect.prototype,{name:"ElongSelect",KeyCode:{Up:38,Down:40,Return:13},options:{eventElement:null,Data:null,ItemClick:null},m_Options:new Template('  <li #{Check} method="option" optionvalue="#{Value}" data="#{Data}">#{Key}</li>'),initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.eventElement.bind("click",this.onInputClick.bindAsEventListener(this));this.eventElement.bind("keydown",this.onInputKeyDown.bindAsEventListener(this));if(this.Data.length>0){this.eventElement[0].Data=this.Data[0];}this.render();},initializeEvent:function(){if(this.windowElement){this.windowElement.bind("click",this.onClickRegion.bindAsEventListener(this));this.windowElement.find("li").bind("mouseout",this.onMouseOutRegion.bindAsEventListener(this));}},SetDefault:function(b){for(var a=0;a<this.Data.length;a++){if(this.Data[a].Value==b){this.eventElement[0].Data=this.Data[a];}}},SetName:function(b){for(var a=0;a<this.Data.length;a++){if(this.Data[a].Key==b){this.eventElement[0].Data=this.Data[a];}}},onInputClick:function(a){if(!Object.isNull(this.Data)&&this.windowElement==null){this.buildSelect();this.initializeEvent();this.render();this.eventElement.select();}FunctionExt.defer(this.onOutClick.bindAsEventListener(this),100);},onInputKeyDown:function(a){if(this.windowElement){switch(a.keyCode){case this.KeyCode.Down:break;case this.KeyCode.Up:break;case this.KeyCode.Return:return;default:break;}this.eventElement.focus();}a.stopPropagation();},onMouseOutRegion:function(b){var a=Event.element(b);a.removeClass("action");},buildSelect:function(){if(this.windowElement){this.windowElement.remove();}this.contentEndRegion=$("#m_contentend");this.windowElement=$('<ul style="display:none; position: absolute;  z-index: 2000;" class="menu"></ul>').appendTo(this.contentEndRegion);var optionSb=new StringBuilder();if(this.Data!=null){for(var i=0;i<this.Data.length;i++){var check="";if(i==0){check='class="action"';}optionSb.append(this.m_Options.eval({Check:check,Value:this.Data[i].Value,Key:this.Data[i].Key,Data:this.Data[i].Data}));}this.windowElement.html(optionSb.toString());}},render:function(){if(this.windowElement){var d=this.eventElement.offset().top+this.eventElement.height()+6;var b=this.eventElement.offset().left;var c=Globals.getScrollPosition();var a=Globals.browserDimensions();if(a.width-(this.eventElement.offset().left-c.x)>this.windowElement.width()){this.windowElement[0].style.top=d+"px";this.windowElement[0].style.left=b+"px";}else{this.windowElement[0].style.top=d+"px";b=b-this.windowElement.width()+this.eventElement.width();this.windowElement[0].style.left=b+"px";}this.ie6FilterIFrame=Globals.addIE6Filter(this.windowElement.width(),this.windowElement.height(),b,d,1999);this.windowElement.show();}},onOutClick:function(){$(document).one("click",function(b){var a=Event.element(b);if(this.windowElement!=null&&this.windowElement.find("*").index(a)==-1&&this.eventElement[0]!=a[0]){this.dispose();}}.bindAsEventListener(this));},onClickRegion:function(evt){var elem=Event.element(evt);var method=elem.attr("method");switch(method){case"option":var data={Key:elem.text(),Value:elem.attr("optionvalue"),Data:eval(elem.attr("data"))};if(!Object.isNull(this.ItemClick)){this.ItemClick(elem,data);}this.eventElement.val(data.Key);this.eventElement.attr("data",data.Value);this.eventElement[0].Data=data;this.dispose();break;default:break;}},destroyEvent:function(){this.windowElement.unbind("click");this.windowElement.unbind("mouseout");this.windowElement.unbind("mouseover");},destroyDOM:function(){this.windowElement=null;this.contentEndRegion=null;this.options=null;},dispose:function(){if(this.windowElement){this.windowElement.hide();FunctionExt.defer(function(){if(this.windowElement){Globals.closeIE6Fliter(this.ie6FilterIFrame);this.windowElement.remove();this.destroyEvent();this.destroyDOM();}}.bind(this),500);}}});var ElongSelect=Elong.Control.ElongSelect;ElongSelect=Class.create();Object.extend(ElongSelect.prototype,{name:"ElongSelect",KeyCode:{Up:38,Down:40,Return:13},options:{eventElement:null,Data:null,ItemClick:null},m_Options:new Template('  <li #{Check} method="option" optionvalue="#{Value}" data="#{Data}">#{Key}</li>'),initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.eventElement.bind("click",this.onInputClick.bindAsEventListener(this));this.eventElement.bind("keydown",this.onInputKeyDown.bindAsEventListener(this));if(this.Data.length>0){this.eventElement[0].Data=this.Data[0];}this.render();},initializeEvent:function(){if(this.windowElement){this.windowElement.bind("click",this.onClickRegion.bindAsEventListener(this));this.windowElement.find("li").bind("mouseout",this.onMouseOutRegion.bindAsEventListener(this));}},SetDefault:function(b){for(var a=0;a<this.Data.length;a++){if(this.Data[a].Value==b){this.eventElement[0].Data=this.Data[a];}}},SetName:function(b){for(var a=0;a<this.Data.length;a++){if(this.Data[a].Key==b){this.eventElement[0].Data=this.Data[a];}}},onInputClick:function(a){if(!Object.isNull(this.Data)&&this.windowElement==null){this.buildSelect();this.initializeEvent();this.render();this.eventElement.select();}FunctionExt.defer(this.onOutClick.bindAsEventListener(this),100);},onInputKeyDown:function(a){if(this.windowElement){switch(a.keyCode){case this.KeyCode.Down:break;case this.KeyCode.Up:break;case this.KeyCode.Return:return;default:break;}this.eventElement.focus();}a.stopPropagation();},onMouseOutRegion:function(b){var a=Event.element(b);a.removeClass("action");},buildSelect:function(){if(this.windowElement){this.windowElement.remove();}this.contentEndRegion=$("#m_contentend");this.windowElement=$('<ul style="display:none; position: absolute;  z-index: 2000;" class="menu"></ul>').appendTo(this.contentEndRegion);var optionSb=new StringBuilder();if(this.Data!=null){for(var i=0;i<this.Data.length;i++){var check="";if(i==0){check='class="action"';}optionSb.append(this.m_Options.eval({Check:check,Value:this.Data[i].Value,Key:this.Data[i].Key,Data:this.Data[i].Data}));}this.windowElement.html(optionSb.toString());}},render:function(){if(this.windowElement){var d=this.eventElement.offset().top+this.eventElement.height()+6;var b=this.eventElement.offset().left;var c=Globals.getScrollPosition();var a=Globals.browserDimensions();if(a.width-(this.eventElement.offset().left-c.x)>this.windowElement.width()){this.windowElement[0].style.top=d+"px";this.windowElement[0].style.left=b+"px";}else{this.windowElement[0].style.top=d+"px";b=b-this.windowElement.width()+this.eventElement.width();this.windowElement[0].style.left=b+"px";}this.ie6FilterIFrame=Globals.addIE6Filter(this.windowElement.width(),this.windowElement.height(),b,d,1999);this.windowElement.show();}},onOutClick:function(){$(document).one("click",function(b){var a=Event.element(b);if(this.windowElement!=null&&this.windowElement.find("*").index(a)==-1&&this.eventElement[0]!=a[0]){this.dispose();}}.bindAsEventListener(this));},onClickRegion:function(evt){var elem=Event.element(evt);var method=elem.attr("method");switch(method){case"option":var data={Key:elem.text(),Value:elem.attr("optionvalue"),Data:eval(elem.attr("data"))};if(!Object.isNull(this.ItemClick)){this.ItemClick(elem,data);}this.eventElement.val(data.Key);this.eventElement.attr("data",data.Value);this.eventElement[0].Data=data;this.dispose();break;default:break;}},destroyEvent:function(){this.windowElement.unbind("click");this.windowElement.unbind("mouseout");this.windowElement.unbind("mouseover");},destroyDOM:function(){this.windowElement=null;this.contentEndRegion=null;this.options=null;},dispose:function(){if(this.windowElement){this.windowElement.hide();FunctionExt.defer(function(){if(this.windowElement){Globals.closeIE6Fliter(this.ie6FilterIFrame);this.windowElement.remove();this.destroyEvent();this.destroyDOM();}}.bind(this),500);}}});var ElongNewIndexClient=Elong.Page.ElongNewIndexClient;ElongNewIndexClient=Class.create();Object.extend(ElongNewIndexClient.prototype,{name:"ElongNewIndexClient",FlightPromotion:[],PoiData:null,PoiConfig:null,PromotionTempldate:new Template('<li><span class="price">¥#{Price}</span><span>#{Date}</span><span class="w120">#{StartCity}-#{EndCity}</span><span>#{Discount}折</span><span><a href="#{Url}" target="_blank">查看>></a></span></li>'),initializeServerData:function(){this.afterDays=ElongNewIndexController.IndexConfig.AfterDays;this.inDays=ElongNewIndexController.IndexConfig.InDays;this.ihotelAfterDays=ElongNewIndexController.IndexConfig.iHotelAfterDays;this.ihotelInDays=ElongNewIndexController.IndexConfig.iHotelInDays;this.SiteTel=ElongNewIndexController.IndexConfig.SiteTel;this.serverDateStr=ElongNewIndexController.IndexConfig.serverDateStr;this.GlobalHotel_ListCity=new Template(ElongNewIndexController.UrlConfig.GlobalHotel_ListCity.replace(/{/g,"#{"));this.HotelMapUrl=new Template("http://hotel.elong.com/search/listmap_cn_#{CityCode}.html");this.HotelPlaceUrl=new Template("http://hotel.elong.com/#{CityNameEn}/place#{PlaceCode}/");this.HotelBrandUrl=new Template("http://hotel.elong.com/#{CityNameEn}/chain#{BrandCode}.html");this.FlightOneWayList=new Template("http://flight.elong.com/#{departcity}-#{arrivecity}/cn_day#{departdate}.html");this.FlightRoundGoList=new Template("http://flight.elong.com/#{departcity}-#{arrivecity}/round/cn_day#{departdate}_day#{backdate}.html");this.FlightBusinessOneWay=new Template("http://flight.elong.com/#{departcity}-#{arrivecity}/business/cn_day#{departdate}.html");this.FlightBusinessRound=new Template("http://flight.elong.com/#{departcity}-#{arrivecity}/round/business/cn_day#{departdate}_day#{backdate}.html");this.FlightEconomyOneWay=new Template("http://flight.elong.com/#{departcity}-#{arrivecity}/economy/cn_day#{departdate}.html");this.FlightEconomyRound=new Template("http://flight.elong.com/#{departcity}-#{arrivecity}/round/economy/cn_day#{departdate}_day#{backdate}.html");this.iFlightList=new Template(ElongNewIndexController.UrlConfig.IFlightList.replace(/{/g,"#{"));this.PoiConfig=ElongNewIndexController.IndexConfig.PoiConfig.ConfigList;},initialize:function(){this.initializeDOM();this.initializeEvent();this.initializeServerData();this.initializeData();this.render();},initializeDOM:function(){this.dvLeft=$("div[method='dvLeft']");this.dvPoi=$("div[method='dvPoi']");this.dvFlight=$("div[method='flightpromotion']");this.tabFlight=this.dvLeft.find("li[method='tabFlight']");this.tabHotel=this.dvLeft.find("li[method='tabHotel']");this.tabApp=this.dvLeft.find("li[method='tabApp']");this.navHotel=this.dvLeft.find("ul[method='navHotel']");this.navFlight=this.dvLeft.find("ul[method='navFlight']");this.panelHotel=this.dvLeft.find("[region='Hotel'] ");this.panelFlight=this.dvLeft.find("[region='Flight']");this.panelApp=this.dvLeft.find("[region='App']");this.tagHotel=this.dvLeft.find("li[method='tagHotel']");this.tagiHotel=this.dvLeft.find("li[method='tagiHotel']");this.tagFlight=this.dvLeft.find("li[method='tagFlight']");this.tagiFlight=this.dvLeft.find("li[method='tagiFlight']");this.dlHotel=this.dvLeft.find("dl[method='dlHotel']");this.dliHotel=this.dvLeft.find("dl[method='dliHotel']");this.dlFlight=this.dvLeft.find("dl[method='dlFlight']");this.dliFlight=this.dvLeft.find("dl[method='dliFlight']");this.hotelCheckInDate=this.dvLeft.find("#hotelCheckInDate");this.hotelCheckoutDate=this.dvLeft.find("#hotelCheckoutDate");this.hotelCityName=this.dvLeft.find("#hotelCity");this.hotelName=this.dvLeft.find("input[method='hotelName']");this.hotelPlace=this.dvLeft.find("input[method='place']");this.ihotelCityName=this.dvLeft.find("#ihotelCity");this.ihotelName=this.dvLeft.find("input[method='ihotelName']");this.ihotelCheckInDate=this.dvLeft.find("#ihotelCheckInDate");this.ihotelCheckoutDate=this.dvLeft.find("#ihotelCheckoutDate");this.FlightTypeLabel=this.dvLeft.find("label");this.FlightOneWay=this.dvLeft.find("input[method='oneway']");this.FlightRound=this.dvLeft.find("input[method='round']");this.iFlightOneWay=this.dvLeft.find("input[method='ioneway']");this.iFlightRound=this.dvLeft.find("input[method='iround']");this.FlightClass=this.dvLeft.find("input[method='flightclass']");this.FlightSrcCityName=this.dvLeft.find("input[method='flightsrcCity']");this.FlightDestCityName=this.dvLeft.find("input[method='flightdestCity']");this.iFlightSrcCityName=this.dvLeft.find("input[method='iflightsrcCity']");this.iFlightDestCityName=this.dvLeft.find("input[method='iflightdestCity']");this.iFlightClass=this.dvLeft.find("input[method='iflightclass']");this.FlightStartDate=this.dvLeft.find("input[method='txtFlightStartDate']");this.FlightEndDate=this.dvLeft.find("input[method='txtFlightEndDate']");this.iFlightStartDate=this.dvLeft.find("input[method='txtiFlightStartDate']");this.iFlightEndDate=this.dvLeft.find("input[method='txtiFlightEndDate']");this.PoiCity=this.dvPoi.find("input[method='poicity']");this.appMobile=this.dvLeft.find("input[method='appMobile']");this.liSubmit=this.dvLeft.find("li[method='liSubmit']");this.appSubmit=this.dvLeft.find("input[method='appSubmit']");this.smsSuccessHtml="<span class='cg'><span class='cgicon'></span>发送成功</span>";this.textWord=this.dvLeft.find("input[method='place']");},initializeData:function(){this.InitialSelect();this.NowDate=ElongNewIndexController.ServerTime.substring(0,10);this.CalendarShowYesterday=ElongNewIndexController.CalendarShowYesterday,this.ReadFlightCookie();this.ReadiFlightCookie();this.InitialCity();this.GlobalData={Type:"",Name:"",PropertiesId:0,Lat:0,Lng:0,Accept:false};this.GlobalHotelNameData={Type:"",Name:"",PropertiesId:0,Lat:0,Lng:0,Accept:false};this.HotelAioSearchUrl="http://hotel.elong.com/keywordssuggest.html";this.HotelAioHotUrl="http://hotel.elong.com/hotsuggest.html";var a=this.ReadHotelCookie();this.CreateAllInOneBox(a.CityId);setTimeout(function(){this.hotelCityName.val(a.CityName);}.bind(this),100);this.hotelCityName[0].City={CityId:a.CityId,CityNameCn:a.CityName,CityNameEn:a.CityNameEn};this.ihotelCityName[0].City={CityNameCn:"",CityId:"",CityCode:""};this.HotelPlaceDefaultName="输入 位置 酒店名 或品牌";this.HotelDefaultName="酒店名称/品牌";this.iHotelDefaultName="请输入酒店名称";this.iHotelCityDefaultName="中文/英文";setTimeout(function(){this.ihotelName.val(this.iHotelDefaultName);}.bind(this),1000);setTimeout(function(){this.ihotelCityName.val(this.iHotelCityDefaultName);}.bind(this),1000);var b=validator.convertDate(ElongNewIndexController.ServerTime.substring(0,10));this.NextDate=validator.reFormatDateString((b.getFullYear()+1)+"-"+(b.getMonth()+1)+"-"+b.getDate());},initializeEvent:function(){this.dvLeft.bind("click",this.OndvLeftClick.bindAsEventListener(this));this.dvLeft.bind("keydown",this.OnEnterKeyDowndvLeft.bindAsEventListener(this));this.hotelPlace.bind("blur",this.OnHotelPlaceBlur.bindAsEventListener(this));this.hotelPlace.bind("keydown",this.KeydownFunction.bindAsEventListener(this));this.hotelPlace.bind("focus",this.OnHotelPlaceFocus.bindAsEventListener(this));this.hotelName.bind("blur",this.OnHotelNameBlur.bindAsEventListener(this));this.hotelName.bind("keydown",this.KeydownFunction.bindAsEventListener(this));this.hotelName.bind("focus",this.OnHotelNameFocus.bindAsEventListener(this));this.ihotelName.bind("blur",this.OniHotelNameBlur.bindAsEventListener(this));this.ihotelName.bind("keydown",this.KeydownFunction.bindAsEventListener(this));this.ihotelName.bind("focus",this.OniHotelNameFocus.bindAsEventListener(this));this.ihotelCityName.bind("blur",this.OniHotelCityNameBlur.bindAsEventListener(this));this.ihotelCityName.bind("keydown",this.KeydownFunction.bindAsEventListener(this));this.ihotelCityName.bind("focus",this.OniHotelCityNameFocus.bindAsEventListener(this));this.hotelCheckInDate.bind("blur",this.OnDateBlur.bindAsEventListener(this));this.hotelCheckoutDate.bind("blur",this.OnDateBlur.bindAsEventListener(this));this.ihotelCheckInDate.bind("blur",this.OnDateBlur.bindAsEventListener(this));this.ihotelCheckoutDate.bind("blur",this.OnDateBlur.bindAsEventListener(this));this.FlightStartDate.bind("blur",this.OnDateBlur.bindAsEventListener(this));this.FlightEndDate.bind("blur",this.OnDateBlur.bindAsEventListener(this));this.iFlightStartDate.bind("blur",this.OnDateBlur.bindAsEventListener(this));this.iFlightEndDate.bind("blur",this.OnDateBlur.bindAsEventListener(this));this.dvFlight.bind("click",this.OndvFlightClick.bindAsEventListener(this));this.appMobile.bind("focus",this.onAppMobileFocus.bindAsEventListener(this));this.appMobile.bind("blur",this.onAppMobileBlur.bindAsEventListener(this));this.appMobile.bind("keydown",this.onAppMobileKeydown.bindAsEventListener(this));this.FlightTypeLabel.bind("mouseover",this.OnFlightTypeLabelMouseOver.bindAsEventListener(this));$("div[method='dvPoiType']").bind("click",this.OndvPoiTypeClick.bindAsEventListener(this));this.dvPoi.find("div[method='detail']").bind("click",this.OndvPoiDetailClick.bindAsEventListener(this));var a=this.getUrlPara(location.href,"first");if(a=="app"){this.tabApp.click();}$(window).unload(this.dispose.bind(this));},InitialSelect:function(){this.flightClass=new ElongSelect({eventElement:this.FlightClass,Data:[{Key:"经济舱",Value:"Y",Data:""},{Key:"超级/高端经济舱",Value:"S",Data:""},{Key:"商务舱/头等舱",Value:"M",Data:""}]});setTimeout(function(){this.FlightClass.val("经济舱");this.flightClass.SetDefault("Y");}.bind(this),1000);this.iflightClass=new ElongSelect({eventElement:this.iFlightClass,Data:[{Key:"经济舱",Value:"Y",Data:""},{Key:"商务舱",Value:"C",Data:""},{Key:"头等舱",Value:"F",Data:""}]});setTimeout(function(){this.iFlightClass.val("经济舱");this.iflightClass.SetDefault("Y");}.bind(this),1000);},InitialCity:function(){this.hotelCity=new CityWindow({eventElement:this.hotelCityName,cityType:"hotel",hotType:"hotel",lang:"cn",isJsonp:"1",isAutoSelect:true,resultNextId:"hotelCheckInDate",onSelect:function(b,a){if(a.CityId!=""){if(a.Type){if(a.Type!="city"){this.CreateAllInOneBox();this.GlobalData.Name=a.CityNameCn;if(a.CityNameCn&&a.CityNameCn.indexOf("（")>-1){this.GlobalData.Name=a.CityNameCn.substring(0,a.CityNameCn.indexOf("（"));}this.GlobalData.Type="999";}else{this.CreateAllInOneBox(a.CityId);}}else{this.CreateAllInOneBox(a.CityId);}}}.bind(this)});this.ihotelCity=new CityWindow({eventElement:this.ihotelCityName,cityType:"ihotel",hotType:"ihotel",lang:"cn",isJsonp:"1",isAutoSelect:true,resultNextId:"ihotelCheckInDate",onSelect:function(b,a){if(a.CityId!=""){this.ihotelCityName.attr("class","txT");}}.bind(this)});this.flightsrcCity=new CityWindow({eventElement:this.FlightSrcCityName,cityType:"flightsrc",isJsonp:"1",lang:"cn",resultNextId:"",onSelect:function(b,a){this.FlightDestCityName.focus();this.FlightDestCityName.click();}.bind(this)});this.flightdestCity=new CityWindow({eventElement:this.FlightDestCityName,cityType:"flightdest",isJsonp:"1",lang:"cn",onSelect:function(b,a){this.FlightStartDate.focus();this.FlightStartDate.click();}.bind(this)});this.iflightsrcCity=new CityWindow({eventElement:this.iFlightSrcCityName,hotType:"iflightsrc",cityType:"iflightall",isJsonp:"1",lang:"cn",resultNextId:"",onSelect:function(b,a){this.iFlightDestCityName.focus();this.iFlightDestCityName.click();}.bind(this)});this.iflightdestCity=new CityWindow({eventElement:this.iFlightDestCityName,hotType:"iflightdest",cityType:"iflightall",isJsonp:"1",lang:"cn",onSelect:function(b,a){this.iFlightStartDate.focus();this.iFlightStartDate.click();}.bind(this)});this.ihotelName.HotelSuggest("http://globalhotel.elong.com/namesuggest.html",{matchSubset:false,formatItem:function(a){return a;},scroll:true,scrollHeight:300,max:10,mouseDownOnSelect:true,dataType:"jsonp",delay:50,isSubmit:true,extraParams:{EnCode:"",CityId:function(){if(!Object.isNull(this.ihotelCityName[0].City)){return this.ihotelCityName[0].City.CityId;}return"";}.bind(this),countryCode:function(){if(!Object.isNull(this.ihotelCityName[0].City)){var a=this.ihotelCityName[0].City.CityCode;var b=a.split("_");if(b.length>=2){return b[1];}}return"";}.bind(this)}});this.poiCity=new CityWindow({eventElement:this.PoiCity,cityType:"hotel",hotType:"hotel",lang:"cn",isJsonp:"1",enableSearch:false,onSelect:function(b,a){if(a.CityId!=""){this.dvPoi.find("div[method='detail']").hide();this.dvPoi.find("div[method='dvPoiType']").hide();this.dvPoi.find("div[method='dvPoiTypeLoading']").show();ElongNewIndexController.GetPoiCity(a.CityId,a.CityNameEn,function(c){this.dvPoi.find("div[method='dvPoiType']").show();this.dvPoi.find("div[method='dvPoiTypeLoading']").hide();this.PoiData=c.value;this.RenderPoiType();}.bind(this));}}.bind(this)});},getUrlPara:function(f,d){var a="";f=f.toLowerCase();d=d.toLowerCase();if(f.indexOf(d)==-1){return a;}var g=f.split("?");if(g.length<=1){return a;}var c=g[1].split("&");for(var b in c){var e=c[b].split("=");if(e.length<=1){continue;}if(e[0]==d){return e[1];}}return a;},onAppMobileFocus:function(b){var a=Event.element(b);if(a.val()=="手机号码"){a.val("");}},onAppMobileBlur:function(b){var a=Event.element(b);if(a.val()==""){a.val("手机号码");}},onAppMobileKeydown:function(a){if(a.keyCode==13){this.appSubmit.click();}},OndvLeftClick:function(b){var a=Event.element(b);var c=a.attr("method");this.InitialCalender(a,c);this.SearchRegionAction(a,c);this.FlightSearchAction(a,c);this.Search(a,c);},SearchRegionAction:function(b,c){if(b.attr("class")=="type"||b.attr("class")=="ml10 type"){b=b.children("input");c=b.attr("method");b[0].checked=true;}switch(c){case"tabHotel":if(this.tabFlight.attr("class")=="flights_action"){this.panelFlight.hide();this.tabFlight.removeClass("flights_action").addClass("flights");}if(this.tabApp.attr("class")=="phone_action"){this.panelApp.hide();this.tabApp.removeClass("phone_action").addClass("phone");}b.addClass("hotels_action").removeClass("hotels");this.navHotel.show();this.navHotel.find("li[class='action']").click();break;case"tabFlight":if(this.tabHotel.attr("class")=="hotels_action"){this.panelHotel.hide();this.tabHotel.removeClass("hotels_action").addClass("hotels");}if(this.tabApp.attr("class")=="phone_action"){this.panelApp.hide();this.tabApp.removeClass("phone_action").addClass("phone");}b.addClass("flights_action").removeClass("flights");this.navFlight.show();this.navFlight.find("li[class='action']").click();break;case"tabApp":if(this.tabHotel.attr("class")=="hotels_action"){this.panelHotel.hide();this.tabHotel.removeClass("hotels_action").addClass("hotels");}if(this.tabFlight.attr("class")=="flights_action"){this.panelFlight.hide();this.tabFlight.removeClass("flights_action").addClass("flights");}b.addClass("phone_action").removeClass("phone");this.panelApp.show();break;case"tagHotel":b.addClass("action");this.tagiHotel.removeClass("action");this.dlHotel.show();this.dliHotel.hide();break;case"tagiHotel":b.addClass("action");this.tagHotel.removeClass("action");this.dlHotel.hide();this.dliHotel.show();break;case"tagFlight":b.addClass("action");this.tagiFlight.removeClass("action");this.dlFlight.show();this.dliFlight.hide();break;case"tagiFlight":b.addClass("action");this.tagFlight.removeClass("action");this.dlFlight.hide();this.dliFlight.show();this.iFlightRound.click();break;case"appSubmit":if(!this.checkAppMobile()){return false;}this.appSubmit.val("正在发送中...");this.appSubmit.addClass("zzfs");var d=this.appMobile.val().trim();ElongNewIndexController.SendAppSMS(d,function(e){if(e.success){this.liSubmit.html(this.smsSuccessHtml);}else{alert(e.value);this.appSubmit.val("发送下载地址");this.appSubmit.removeClass("zzfs");}}.bind(this));break;case"oneway":this.FlightEndDate.parent().prev("dt").css("color","#CCC");this.FlightEndDate.css("color","#CCC");this.FlightEndDate.val("yyyy-mm-dd");this.FlightEndDate.next("span").text(" ");break;case"round":this.FlightEndDate.parent().prev("dt").css("color","#BA8A49");this.FlightEndDate.css("color","black");if(!validator.valid(this.FlightEndDate.val(),"notEmpty & date")){var a=this.dateToString(this.dateAdd(this.stringToDate(ElongNewIndexController.ServerTime.substring(0,10)),6));if(this.FlightEndDate.val()=="yyyy-mm-dd"&&validator.valid(this.FlightStartDate.val(),"notEmpty & date")){var a=this.dateToString(this.dateAdd(this.stringToDate(this.FlightStartDate.val()),3));}this.FlightEndDate.val(a);this.FlightEndDate.next("span").text(this.GetWeekDay(a));}break;case"ioneway":this.iFlightEndDate.parent().prev("dt").css("color","#CCC");this.iFlightEndDate.css("color","#CCC");this.iFlightEndDate.val("yyyy-mm-dd");this.iFlightEndDate.next("span").text(" ");break;case"iround":this.iFlightEndDate.parent().prev("dt").css("color","#BA8A49");this.iFlightEndDate.css("color","black");if(!validator.valid(this.iFlightEndDate.val(),"notEmpty & date")){var a=this.dateToString(this.dateAdd(this.stringToDate(ElongNewIndexController.ServerTime.substring(0,10)),6));if(this.iFlightEndDate.val()=="yyyy-mm-dd"&&validator.valid(this.iFlightStartDate.val(),"notEmpty & date")){var a=this.dateToString(this.dateAdd(this.stringToDate(this.iFlightStartDate.val()),3));}this.iFlightEndDate.val(a);this.iFlightEndDate.next("span").text(this.GetWeekDay(a));}break;default:break;}},checkAppMobile:function(){var a=this.appMobile.val().trim();if(!validator.valid(a,"notEmpty")){$error(this.appMobile,"请输入手机号");return false;}if(!validator.valid(a,"mobile")){$error(this.appMobile,"请输入正确的手机号");return false;}return true;},InitialCalender:function(a,c){if(a.is("span")&&(a.prev("input").attr("class")=="txtDate"||a.prev("input").attr("class")=="txtDate l_black")){a=a.prev("input");c=a.attr("method");}switch(c){case"txtHotelCheckInDate":var b=validator.reFormatDateString(this.NowDate);if(this.CalendarShowYesterday==true){var d=validator.convertDate(this.NowDate);d.setDate(d.getDate()-1);b=validator.reFormatDateString(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate());}new CalendarWindow({eventElement:a,enabledFrom:b,selectedDate:String.isNullOrEmpty(a.val())?this.NowDate:a.val(),language:"cn",onSelected:function(e){a.val(e);var g=validator.reFormatDateString(e);var f=validator.reFormatDateString(this.dvLeft.find("#hotelCheckoutDate").val());if(g>=f){var h=this.nextDay(e);this.dvLeft.find("#hotelCheckoutDate").val(h);this.dvLeft.find("#hotelCheckoutDate").next("span").text(this.GetWeekDayVer2(h));}a.next("span").text(this.GetWeekDayVer2(e));}.bind(this)});break;case"txtHotelCheckoutDate":new CalendarWindow({eventElement:a,selectedDate:String.isNullOrEmpty(a.val())?this.NowDate:a.val(),enabledFrom:this.nextDay(this.hotelCheckInDate.val()),language:"cn",onSelected:function(e){a.val(e);a.focus();a.next("span").text(this.GetWeekDay(e));}.bind(this)});break;case"txtiHotelCheckInDate":new CalendarWindow({eventElement:a,enabledFrom:this.NowDate,selectedDate:String.isNullOrEmpty(a.val())?this.NowDate:a.val(),language:"cn",onSelected:function(e){a.val(e);var g=validator.reFormatDateString(e);var f=validator.reFormatDateString(this.dvLeft.find("#ihotelCheckoutDate").val());if(g>=f){var h=validator.convertDate(e);h=new Date(h.setHours(24));h=validator.reFormatDateString(h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate());this.dvLeft.find("#ihotelCheckoutDate").val(h);this.dvLeft.find("#ihotelCheckoutDate").next("span").text(this.GetWeekDay(h));}a.next("span").text(this.GetWeekDay(e));}.bind(this)});break;case"txtiHotelCheckoutDate":new CalendarWindow({eventElement:a,selectedDate:String.isNullOrEmpty(a.val())?this.NowDate:a.val(),enabledFrom:this.nextDay(this.ihotelCheckInDate.val()),language:"cn",onSelected:function(e){a.val(e);a.focus();a.next("span").text(this.GetWeekDay(e));}.bind(this)});break;case"txtFlightStartDate":new CalendarWindow({eventElement:a,selectedDate:String.isNullOrEmpty(a.val())?this.NowDate:a.val(),enabledFrom:this.NowDate,language:"cn",onSelected:function(e){a.val(e);var g=validator.reFormatDateString(e);var f=validator.reFormatDateString(this.FlightEndDate.val());if(g>f){var h=validator.convertDate(e);h=new Date(h.setHours(72));h=validator.reFormatDateString(h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate());this.FlightEndDate.val(h);this.FlightEndDate.next("span").text(this.GetWeekDay(h));}a.next("span").text(this.GetWeekDay(e));if(this.FlightRound[0].checked){this.FlightEndDate.focus();this.FlightEndDate.click();}}.bind(this)});break;case"txtFlightEndDate":if(a.val()=="yyyy-mm-dd"){a.val("");}new CalendarWindow({eventElement:a,selectedDate:String.isNullOrEmpty(a.val())?this.NowDate:a.val(),enabledFrom:this.NowDate,language:"cn",onSelected:function(e){a.val(e);a.focus();a.next("span").text(this.GetWeekDay(e));if(this.FlightOneWay[0].checked){this.FlightRound.click();}}.bind(this)});break;case"txtiFlightStartDate":new CalendarWindow({eventElement:a,selectedDate:String.isNullOrEmpty(a.val())?this.NowDate:a.val(),enabledFrom:this.NowDate,language:"cn",onSelected:function(e){a.val(e);var g=validator.reFormatDateString(e);var f=validator.reFormatDateString(this.iFlightEndDate.val());if(g>f){var h=validator.convertDate(e);h=new Date(h.setHours(72));h=validator.reFormatDateString(h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate());this.iFlightEndDate.val(h);this.iFlightEndDate.next("span").text(this.GetWeekDay(h));}a.next("span").text(this.GetWeekDay(e));if(this.iFlightRound[0].checked){this.iFlightEndDate.focus();this.iFlightEndDate.click();}}.bind(this)});break;case"txtiFlightEndDate":if(a.val()=="yyyy-mm-dd"){a.val("");}new CalendarWindow({eventElement:a,selectedDate:String.isNullOrEmpty(a.val())?this.NowDate:a.val(),enabledFrom:this.NowDate,language:"cn",onSelected:function(e){a.val(e);a.focus();a.next("span").text(this.GetWeekDay(e));if(this.iFlightOneWay[0].checked){this.iFlightRound.click();}}.bind(this)});break;default:break;}},FlightSearchAction:function(c,d){switch(d){case"changeCity":var a=this.FlightDestCityName[0].City;var b=this.FlightDestCityName.val();this.FlightDestCityName[0].City=this.FlightSrcCityName[0].City;this.FlightDestCityName.val(this.FlightSrcCityName.val());this.FlightSrcCityName[0].City=a;this.FlightSrcCityName.val(b);break;case"ichangeCity":var a=this.iFlightDestCityName[0].City;var b=this.iFlightDestCityName.val();this.iFlightDestCityName[0].City=this.iFlightSrcCityName[0].City;this.iFlightDestCityName.val(this.iFlightSrcCityName.val());this.iFlightSrcCityName[0].City=a;this.iFlightSrcCityName.val(b);break;default:break;}},OnEnterKeyDowndvLeft:function(b){if(b.keyCode==13){var a=this.dvLeft.find("dl:visible");if(!a||a.length<1){return false;}a.find("input[type='button'][method^='search']").click();return false;}},Search:function(element,method){switch(method){case"searchHotel":this.SearchHotel(element,this.serverDateStr,this.dateToString(this.dateAdd(this.stringToDate(this.serverDateStr),-1)));break;case"searchiHotel":this.SearchiHotel(element);break;case"searchFlight":this.SearchFlight(element);break;case"searchiFlight":this.SearchiFlight(element);break;case"mapsearch":var CityId="0101";var select=this.hotelCityName[0].City;if(select!=null){CityId=select.CityId;}this.WriteHotelCookie();window.location.href=this.HotelMapUrl.eval({CityCode:CityId});break;default:break;}},OnHotelPlaceBlur:function(b){var a=Event.element(b);if(String.isNullOrEmpty(a.val())){a.val(this.HotelPlaceDefaultName);a.addClass("c9");}},KeydownFunction:function(c){var a=Event.element(c);var b=a.attr("class").trim();if(b=="txT c9"||b=="txT c9 com_input"){a.removeClass("c9");}},OnHotelPlaceFocus:function(b){var a=Event.element(b);if(a.val()==this.HotelPlaceDefaultName){a.val("");}},OnHotelNameBlur:function(b){var a=Event.element(b);if(String.isNullOrEmpty(a.val())){a.val(this.HotelDefaultName);a.addClass("c9");}},OnHotelNameFocus:function(b){var a=Event.element(b);if(a.val()==this.HotelDefaultName){a.val("");}},OniHotelNameBlur:function(b){var a=Event.element(b);if(String.isNullOrEmpty(a.val())){a.val(this.iHotelDefaultName);a.addClass("c9");}},OniHotelNameFocus:function(b){var a=Event.element(b);if(a.val()==this.iHotelDefaultName){a.val("");}else{a.select();}},OniHotelCityNameBlur:function(b){var a=Event.element(b);if(String.isNullOrEmpty(a.val())){a.val(this.iHotelCityDefaultName);a.addClass("c9");}},OniHotelCityNameFocus:function(b){var a=Event.element(b);if(a.val()==this.iHotelCityDefaultName){a.val("");}},OnDateBlur:function(c){var b=Event.element(c);var a=b.val();var d=b.attr("method");if(!validator.valid(a,"notEmpty & date")){if(this.FlightOneWay[0].checked&&d=="txtFlightEndDate"||this.iFlightOneWay[0].checked&&d=="txtiFlightEndDate"){b.val("yyyy-mm-dd");}else{$error(b,ElongNewIndexController.Resources.Validate_DateFormat);return false;}}else{var e=this.GetWeekDay(a);b.next().html(e);if(d=="txtFlightEndDate"&&this.FlightOneWay[0].checked){this.FlightRound.click();}if(d=="txtiFlightEndDate"&&this.iFlightOneWay[0].checked){this.iFlightRound.click();}}},OnFlightTypeLabelMouseOver:function(b){var a=Event.element(b);a.css("cursor","pointer");},SearchHotel:function(a,c,b){if(!this.HotelSearchValid()){return;}this.WriteHotelCookie();var d=jQuery.trim(this.hotelPlace.val());d=this.replaceCharCode(d);if(this.GlobalData.Name==""){this.GlobalData={Name:"",Type:99,PropertiesId:0,Lat:0,Lng:0,Accept:false};}if(!Object.isNull(this.hotelPlace[0].Data)&&this.hotelPlace[0].Data.Accept==true){this.GlobalData=this.hotelPlace[0].Data;}else{if(this.textWord.val().trim()==this.HotelPlaceDefaultName){if(this.GlobalData.Name==""){this.GlobalData.Type=-1;}}else{if(this.textWord.val().trim()!=""){if(this.hotelPlace.attr("firstSType")){this.GlobalData.Type=!String.isNullOrEmpty(this.hotelPlace.attr("firstSType"))?parseInt(this.hotelPlace.attr("firstSType")):99;this.GlobalData.Lat=String.isNullOrEmpty(this.hotelPlace.attr("firstSLat"))?"":this.hotelPlace.attr("firstSLat");this.GlobalData.Lng=String.isNullOrEmpty(this.hotelPlace.attr("firstSLng"))?"":this.hotelPlace.attr("firstSLng");this.GlobalData.PropertiesId=this.hotelPlace.attr("firstSPId");}else{this.GlobalData.Type=999;}this.GlobalData.Name+=this.textWord.val().trim();}}}var e=this.getSearchUrl();this.GoSearchList(e,a);},getSearchUrl:function(){var b="0101";var c="beijing";var g=this.hotelCityName[0].City;if(g!=null){b=g.CityId;c=g.CityNameEn;}var i="http://hotel.elong.com/search/list_cn_"+b+".html";if(ElongNewIndexController.WebCategory=="Online"){i+=(i.indexOf("?")!=-1?"&":"?")+"hotelsort=2";}i=this.GetUrlPattern(this.GlobalData,i,c);var j=this.SetSearchReqstInfo(this.GlobalData,this.GlobalHotelNameData);if(j!=""){i+=(i.indexOf("?")!=-1?"&":"?")+j;}var e=c.indexOf("（");var f=c.indexOf("）");if(e>-1&&f>-1){firstName=c.substr(0,e);secondName=c.substr(e+1,f-e-1);c=firstName+"_"+secondName;}var d=this.GlobalData;var h=-1;var a=this.textWord.val().trim()==this.HotelPlaceDefaultName?"":this.textWord.val();if(this.GlobalData.Accept=="1"&&!String.isNullOrEmpty(this.textWord.attr("selectIndex").toString())){h=parseInt(this.textWord.attr("selectIndex"));}i+=(i.indexOf("?")!=-1?"&":"?")+"aioIndex="+h+"&aioVal="+encodeURIComponent(a);return i;},GetUrlPattern:function(data,url,engname){var searchUrl=url;engname=engname.toLowerCase();switch(data.Type){case 1:case 2:case 4:case 99:if(!Object.isNull(data.PropertiesId)&&data.PropertiesId!="0"){searchUrl=this.HotelPlaceUrl.eval({CityNameEn:engname,PlaceCode:data.PropertiesId});}break;case 5:searchUrl=this.HotelBrandUrl.eval({CityNameEn:engname,BrandCode:data.PropertiesId});break;default:break;}return searchUrl;},SetSearchReqstInfo:function(a,b){var c="";var d=this.hotelPlace.val();if(a.Name!=""){}c+=(c==""?"":"&")+this.setRequestInfoByTypeOne(a);return c;},setRequestInfoByTypeOne:function(a){var b="";switch(a.Type){case 99:if(!Object.isNull(a.PropertiesId)&&a.PropertiesId!="0"){b+=(b==""?"":"&")+"PoiId="+a.PropertiesId;}if(!String.isNullOrEmpty(this.hotelPlace.val())){b+=(b==""?"":"&")+"PoiName="+encodeURIComponent(this.hotelPlace.val());}if(a.Lat!=""&&a.Lng!=""){b+=(b==""?"":"&")+"StartLat="+a.Lat+"&StartLng="+a.Lng;}b+=(b==""?"":"&")+"hotelsort=6";break;case 3:if(!String.isNullOrEmpty(a.Name)){b+=(b==""?"":"&")+"Keywords="+encodeURIComponent(a.Name)+"&KeywordsType=999";}break;case 6:b+=(b==""?"":"&")+"AreaId="+a.PropertiesId+"&AreaType=2";if(!String.isNullOrEmpty(a.Name)){b+=(b==""?"":"&")+"AreaName="+encodeURIComponent(a.Name);}break;case 5:break;case 9:b+=(b==""?"":"&")+"HotelName="+encodeURIComponent(a.Name);break;case -1:break;default:if(!String.isNullOrEmpty(a.Name)){b+=(b==""?"":"&")+"Keywords="+encodeURIComponent(a.Name)+"&KeywordsType="+a.Type;}break;}return b;},setRequestInfoByTypeTwo:function(a){var b="";switch(a.Type){case 5:b+=(b==""?"":"&")+"BrandId="+a.PropertiesId+"&BrandName="+encodeURIComponent(a.Name);break;case 9:b+=(b==""?"":"&")+"HotelName="+encodeURIComponent(a.Name);break;case -1:break;default:if(!String.isNullOrEmpty(a.Name)){b+=(b==""?"":"&")+"HotelName="+encodeURIComponent(a.Name);}break;}return b;},HotelSearchValid:function(){if(!validator.valid(this.hotelCityName.val(),"notEmpty & nonSpecialSign")){$error(this.hotelCityName,"请输入城市名称，且不可包含*&+等符号及阿拉伯数字。");return false;}if(Object.isNull(this.hotelCityName[0].City)){$error(this.hotelCityName,"该城市名称不存在，请重新输入！");return false;}if(!validator.valid(this.hotelCheckInDate.val(),"notEmpty & date")){$error(this.hotelCheckInDate,"请输入有效的入住日期。");return false;}if(!validator.valid(this.hotelCheckoutDate.val(),"notEmpty & date")){$error(this.hotelCheckoutDate,"请输入有效的离店日期。");return false;}var g=this.hotelCheckInDate.val();var f=this.hotelCheckoutDate.val();var e=validator.reFormatDateString(g);var d=validator.reFormatDateString(f);if(e<this.NowDate&&this.CalenderShowYesterday==false){$error(this.hotelCheckInDate,"入住日期须晚于或者等于当天日期。");return false;}if(d<this.NowDate){$error(this.hotelCheckoutDate,"离店日期须晚于或者等于当天日期。");return false;}var c=validator.convertDate(e);c=new Date(c.setHours(24));if(!validator.valid(this.hotelCheckoutDate.val(),"notEmpty & dateRange",validator.getDateString(c),null)){$error(this.hotelCheckoutDate,"离店日期须至少晚于入住日期1天。");return false;}var a=this.daysBetween(e,this.NowDate);if(a>this.afterDays){$error(this.hotelCheckInDate,"如果您需要预订"+e+"的酒店，请致电："+this.SiteTel+"，我们会竭诚为您服务。");return false;}var b=this.daysBetween(e,d);if(b>this.inDays){$error(this.hotelCheckoutDate,"如果您需要在酒店入住"+this.inDays+"天以上，请致电："+this.SiteTel+"，我们会竭诚为您服务。");return false;}return true;},SearchiHotel:function(evt){if(!this.iHotelSearchValid()){return;}var citycode="68678448-0BC9-4DF9-BEED-C7AC46D82CEE";var checkInDate=this.ihotelCheckInDate.val();var checkOutDate=this.ihotelCheckoutDate.val();var hotelName=this.ihotelName.val();var select=this.ihotelCityName[0].City;if(select!=null){citycode=select.CityCode;}if(!citycode){return;}if(select.CityId.toLowerCase()=="68678448-0bc9-4df9-beed-c7ac46d82cee"){if(ElongNewIndexController.WebCategory=="Elong"){window.location.href="http://hotel.elong.com/hongkong/?indate="+checkInDate+"&outdate="+checkOutDate+"";return;}else{window.location.href="http://travel.elong.com/hotel/hongkong/?campaign_id="+ElongNewIndexController.CampaignId+"&indate="+checkInDate+"&outdate="+checkOutDate+"";return;}}if(select.CityId.toLowerCase()=="95203ed3-374d-4b70-97cf-d9fceed5ad91"){if(ElongNewIndexController.WebCategory=="Elong"){window.location.href="http://hotel.elong.com/macau/?indate="+checkInDate+"&outdate="+checkOutDate+"";return;}else{window.location.href="http://travel.elong.com/hotel/macau/?campaign_id="+ElongNewIndexController.CampaignId+"&indate="+checkInDate+"&outdate="+checkOutDate+"";return;}}var RoomPerson=1;var GlobalUrl="";Globals.cookie("GlobalHotel","",{InDate:checkInDate,OutDate:checkOutDate});var url=this.GlobalHotel_ListCity.eval({citycode:citycode.replace(/\s/g,"")});if(hotelName==this.iHotelDefaultName){GlobalUrl=url;}else{GlobalUrl=url+"?hotelname="+encodeURIComponent(hotelName);}this.GoSearchList(GlobalUrl,evt);},iHotelSearchValid:function(){if(Object.isNull(this.ihotelCityName[0].City)||this.ihotelCityName.val()==this.iHotelCityDefaultName){$error(this.ihotelCityName,"该城市名称不存在，请重新输入！","right",false);return false;}if(!validator.valid(this.ihotelCheckInDate.val(),"notEmpty & date")){$error(this.ihotelCheckInDate,"请输入有效的入住日期。");return false;}if(!validator.valid(this.ihotelCheckoutDate.val(),"notEmpty & date")){$error(this.ihotelCheckoutDate,"请输入有效的离店日期。");return false;}if(this.ihotelName.val().indexOf("<")>0||this.ihotelName.val().indexOf(">")>0){$error(this.ihotelName,"酒店名称不可包含<>符号。");return false;}var g=this.ihotelCheckInDate.val();var f=this.ihotelCheckoutDate.val();var e=validator.reFormatDateString(g);var d=validator.reFormatDateString(f);if(e<this.NowDate){$error(this.ihotelCheckInDate,"入住日期须晚于或者等于当天日期。");return false;}if(d<this.NowDate){$error(this.ihotelCheckoutDate,"离店日期须晚于或者等于当天日期。");return false;}var c=validator.convertDate(e);c=new Date(c.setHours(24));if(!validator.valid(this.ihotelCheckoutDate.val(),"notEmpty & dateRange",validator.getDateString(c),null)){$error(this.ihotelCheckoutDate,"离店日期须至少晚于入住日期1天。");return false;}var a=this.daysBetween(e,this.NowDate);if(a>this.ihotelAfterDays){$error(this.ihotelCheckInDate,"如果您需要预订"+e+"的酒店，请致电："+this.SiteTel+"，我们会竭诚为您服务。");return false;}var b=this.daysBetween(e,d);if(b>this.ihotelInDays){$error(this.ihotelCheckoutDate,"如果您需要在酒店入住"+this.ihotelInDays+"天以上，请致电："+this.SiteTel+"，我们会竭诚为您服务。");return false;}return true;},SearchFlight:function(evt){var flighType=0;if(this.FlightRound[0].checked){flighType=1;}var ConditionValue;var url="";var now=validator.convertDate(ElongNewIndexController.ServerTime.substring(0,10));var departDate=this.daysBetween(this.FlightStartDate.val(),this.dateToString(now));if(flighType==0){if(!this.ValidateOneWay()){return;}if(this.FlightClass[0].Data.Value=="Y"){url=this.FlightOneWayList.eval({departcity:this.filterCityNameEn(this.FlightSrcCityName[0].City.CityNameEn.toLowerCase()),arrivecity:this.filterCityNameEn(this.FlightDestCityName[0].City.CityNameEn.toLowerCase()),departdate:departDate});}else{if(this.FlightClass[0].Data.Value=="M"){url=this.FlightBusinessOneWay.eval({departcity:this.filterCityNameEn(this.FlightSrcCityName[0].City.CityNameEn.toLowerCase()),arrivecity:this.filterCityNameEn(this.FlightDestCityName[0].City.CityNameEn.toLowerCase()),departdate:departDate});}else{url=this.FlightEconomyOneWay.eval({departcity:this.filterCityNameEn(this.FlightSrcCityName[0].City.CityNameEn.toLowerCase()),arrivecity:this.filterCityNameEn(this.FlightDestCityName[0].City.CityNameEn.toLowerCase()),departdate:departDate});}}ConditionValue={DateType:"Domestic",FType:flighType,DepCode:this.FlightSrcCityName[0].City.CityThreeSign,ArrCode:this.FlightDestCityName[0].City.CityThreeSign,DepDate:this.FlightStartDate.val(),DepName:encodeURIComponent(this.FlightSrcCityName[0].City.CityNameCn)+"|"+this.FlightSrcCityName[0].City.CityNameEn,ArrName:encodeURIComponent(this.FlightDestCityName[0].City.CityNameCn)+"|"+this.FlightDestCityName[0].City.CityNameEn};}else{if(!this.ValidateRound()){return;}var backDate=this.daysBetween(this.FlightEndDate.val(),this.dateToString(now));if(this.FlightClass[0].Data.Value=="Y"){url=this.FlightRoundGoList.eval({departcity:this.filterCityNameEn(this.FlightSrcCityName[0].City.CityNameEn.toLowerCase()),arrivecity:this.filterCityNameEn(this.FlightDestCityName[0].City.CityNameEn.toLowerCase()),departdate:departDate,backdate:backDate});}else{if(this.FlightClass[0].Data.Value=="M"){url=this.FlightBusinessRound.eval({departcity:this.filterCityNameEn(this.FlightSrcCityName[0].City.CityNameEn.toLowerCase()),arrivecity:this.filterCityNameEn(this.FlightDestCityName[0].City.CityNameEn.toLowerCase()),departdate:departDate,backdate:backDate});}else{url=this.FlightEconomyRound.eval({departcity:this.filterCityNameEn(this.FlightSrcCityName[0].City.CityNameEn.toLowerCase()),arrivecity:this.filterCityNameEn(this.FlightDestCityName[0].City.CityNameEn.toLowerCase()),departdate:departDate,backdate:backDate});}}ConditionValue={DateType:"Domestic",FType:flighType,DepCode:this.FlightSrcCityName[0].City.CityThreeSign,ArrCode:this.FlightDestCityName[0].City.CityThreeSign,DepDate:this.FlightStartDate.val(),BackDate:this.FlightEndDate.val(),DepName:encodeURIComponent(this.FlightSrcCityName[0].City.CityNameCn)+"|"+this.FlightSrcCityName[0].City.CityNameEn,ArrName:encodeURIComponent(this.FlightDestCityName[0].City.CityNameCn)+"|"+this.FlightDestCityName[0].City.CityNameEn};}Globals.cookie("FlightCondition","",ConditionValue,{expires:30,path:"/",secure:false});this.GoSearchList(url,evt);return true;},ValidateOneWay:function(){if(!validator.valid(this.FlightSrcCityName.val(),"notEmpty")){$error(this.FlightSrcCityName,ElongNewIndexController.Resources.Validate_DepartCityNull);return false;}if(!validator.valid(this.FlightDestCityName.val(),"notEmpty")){$error(this.FlightDestCityName,ElongNewIndexController.Resources.Validate_ArriveCityNull);return false;}if(Object.isNull(this.FlightSrcCityName[0].City)){$error(this.FlightSrcCityName,ElongNewIndexController.Resources.Validate_NoDepartCity);return false;}if(this.FlightSrcCityName[0].City.CityThreeSign==""){$error(this.FlightSrcCityName,ElongNewIndexController.Resources.Validate_NoDepartCity);return false;}if(Object.isNull(this.FlightDestCityName[0].City)){$error(this.FlightDestCityName,ElongNewIndexController.Resources.Validate_NoArriveCity);return false;}if(this.FlightDestCityName[0].City.CityThreeSign==""){$error(this.FlightDestCityName,ElongNewIndexController.Resources.Validate_NoArriveCity);return false;}if(!validator.valid(this.FlightStartDate.val(),"notEmpty & date")){$error(this.FlightStartDate,ElongNewIndexController.Resources.Validate_DateFormat);return false;}if(this.FlightSrcCityName.val().trim()==this.FlightDestCityName.val().trim()){$error(this.FlightSrcCityName,ElongNewIndexController.Resources.Validate_SameCity);return false;}var b=this.FlightStartDate.val();var a=validator.reFormatDateString(b);if(a<this.NowDate){$error(this.FlightStartDate,ElongNewIndexController.Resources.Validate_BeforeToday);return false;}if(a>this.NextDate){$error(this.FlightStartDate,"出发日期超出限制，请重新选择！");return false;}return true;},ValidateRound:function(){var e=this.ValidateOneWay();var f=true;if(!validator.valid(this.FlightEndDate.val(),"notEmpty & date")){$error(this.FlightEndDate,ElongNewIndexController.Resources.Validate_DateFormat);return false;}var d=this.FlightStartDate.val();var b=validator.reFormatDateString(d);var c=this.FlightEndDate.val();var a=validator.reFormatDateString(c);if(a<this.NowDate){$error(this.FlightEndDate,"返程日期不可早于今日，请重新选择！");return false;}if(a>this.NextDate){$error(this.FlightEndDate,ElongNewIndexController.Resources.Validate_LimitDate);return false;}if(b>a){$error(this.FlightEndDate,ElongNewIndexController.Resources.Validate_DateCheck);return false;}return e&&f;},SearchiFlight:function(evt){var flighType=0;var nowDate=ElongNewIndexController.ServerTime.substring(0,10);if(this.iFlightRound[0].checked){flighType=1;}if((flighType==0)||(flighType==1)){if(!validator.valid(this.iFlightSrcCityName.val(),"notEmpty")){$error(this.iFlightSrcCityName,ElongNewIndexController.Resources.Validate_DepartCityNull);return;}if(Object.isNull(this.iFlightSrcCityName[0].City)){$error(this.iFlightSrcCityName,ElongNewIndexController.Resources.Validate_NoDepartCity);return false;}if(!validator.valid(this.iFlightDestCityName.val(),"notEmpty")){$error(this.iFlightDestCityName,ElongNewIndexController.Resources.Validate_ArriveCityNull);return;}if(Object.isNull(this.iFlightDestCityName[0].City)){$error(this.iFlightDestCityName,ElongNewIndexController.Resources.Validate_NoArriveCity);return false;}if(!validator.valid(this.iFlightStartDate.val(),"notEmpty & date")){$error(this.iFlightStartDate,ElongNewIndexController.Resources.Validate_DateFormat);return;}if(this.iFlightSrcCityName.val().trim()==this.iFlightDestCityName.val().trim()){$error(this.iFlightSrcCityName,ElongNewIndexController.Resources.Validate_SameCity);return;}if(this.iFlightSrcCityName[0].City.ProvinceId=="Domestic"&&this.iFlightDestCityName[0].City.ProvinceId=="Domestic"){$error(this.iFlightSrcCityName,ElongNewIndexController.Resources.DomesticCity);return;}var StartDate=this.iFlightStartDate.val();var dateStart=validator.reFormatDateString(StartDate);if(dateStart<nowDate){$error(this.iFlightStartDate,ElongNewIndexController.Resources.Validate_BeforeToday);return;}var url="";if(flighType==0){url=this.iFlightList.eval({language:ElongNewIndexController.Language.toLowerCase(),pagename:"list",startcity:this.iFlightSrcCityName[0].City.CityThreeSign,endcity:this.iFlightDestCityName[0].City.CityThreeSign,startdate:validator.reFormatDateString(this.iFlightStartDate.val()),enddate:validator.reFormatDateString(this.iFlightStartDate.val()),adulttype:"0",aircorp:"ALL",passengercount:"1",childcount:"0",seatlevel:this.iFlightClass[0].Data.Value});}else{if(!validator.valid(this.iFlightEndDate.val(),"notEmpty & date")){$error(this.iFlightEndDate,ElongNewIndexController.Resources.Validate_DateFormat);return;}var EndDate=this.iFlightEndDate.val();var dateEnd=validator.reFormatDateString(EndDate);if(dateEnd<nowDate){$error(this.iFlightEndDate,"返程日期不可早于今日，请重新选择！");return;}if(dateStart>dateEnd){$error(this.iFlightEndDate,ElongNewIndexController.Resources.Validate_DateCheck);return;}url=this.iFlightList.eval({language:ElongNewIndexController.Language.toLowerCase(),pagename:"golist",startcity:this.iFlightSrcCityName[0].City.CityThreeSign,endcity:this.iFlightDestCityName[0].City.CityThreeSign,startdate:validator.reFormatDateString(StartDate),enddate:validator.reFormatDateString(EndDate),adulttype:"0",aircorp:"ALL",passengercount:"1",childcount:"0",seatlevel:this.iFlightClass[0].Data.Value});}}var ConditionValue={FT:flighType,SC:this.iFlightSrcCityName[0].City.CityThreeSign,EC:this.iFlightDestCityName[0].City.CityThreeSign,SD:this.iFlightStartDate.val(),ED:this.iFlightEndDate.val(),SCN:encodeURIComponent(this.iFlightSrcCityName[0].City.CityNameCn)+"|"+this.iFlightSrcCityName[0].City.CityNameEn,ECN:encodeURIComponent(this.iFlightDestCityName[0].City.CityNameCn)+"|"+this.iFlightDestCityName[0].City.CityNameEn};Globals.cookie("Condition","",ConditionValue,{expires:30,path:"/",secure:false});this.GoSearchList(url,evt);return true;},OndvFlightClick:function(c){var b=Event.element(c);var d=b.attr("method");if((b.is("a")||b.is("span"))&&(b.parents("li[method='city']").length>0)){var a=b.parents("li[method='city']");this.dvFlight.find("li[method='city']").removeClass("action");a.addClass("action");this.GetFlightPromotion(a.attr("csn"));}},GetFlightPromotion:function(a){if(this.FlightPromotion.length>0&&this.LocalCache(a)!=null){var b=this.LocalCache(a);this.RenderPromotion(b.Data);}else{this.dvFlight.find("div[method='flightNone']").hide();this.dvFlight.find("ul[method='flight']").html("");this.dvFlight.find("div[method='flightloading']").show();var c="http://flight.elong.com/lowestdiscount.jsonp";elongAjax.callBack(c,{city:a,recordcount:3},function(f){this.dvFlight.find("div[method='flightloading']").hide();var d={City:a,Data:[]};if(f!=undefined){for(var e=0;e<f.length;e++){d.Data.push({Price:f[e].Price,Date:this.FormatJsonDate(f[e].FlyDate),StartCity:f[e].FromCityName,EndCity:f[e].ToCityName,Discount:f[e].Discount,Url:f[e].URL});}}this.FlightPromotion.push(d);this.RenderPromotion(d.Data);}.bind(this),true,"GET",false,"jsonp");}},LocalCache:function(a){if(this.FlightPromotion.length==0){return null;}for(var b=0;b<this.FlightPromotion.length;b++){if(this.FlightPromotion[b].City==a){return this.FlightPromotion[b];}}return null;},RenderPromotion:function(data){if(data.length>0){this.dvFlight.find("div[method='flightNone']").hide();}else{this.dvFlight.find("div[method='flightNone']").show();}var sb=new StringBuilder();for(var i=0;i<data.length;i++){sb.append(this.PromotionTempldate.eval({Price:data[i].Price,Date:data[i].Date,StartCity:data[i].StartCity,EndCity:data[i].EndCity,Discount:(data[i].Discount.toString().indexOf(".")>0&&data[i].Discount.toString().length>3)?this.Round(data[i].Discount,1):data[i].Discount,Url:data[i].Url}));}this.dvFlight.find("ul[method='flight']").html(sb.toString());},OndvPoiTypeClick:function(evt){var element=Event.element(evt);if(element.is("a")){element=element.parents("li");}var method=element.attr("method");switch(method){case"poitype":var typeid=element.attr("typeid");var index=element.attr("index");var indexNum=index.substr(index.length-1,1);var actionClass=this.dvPoi.find("div[method='detail'] i").attr("class");var isHidden=this.dvPoi.find("div[method='detail']").is(":hidden");if(index!="0-1"&&(isHidden||actionClass!="action"+index)){for(var i=1;i<9;i++){this.dvPoi.find("div[method='dvPoiType'] li").removeClass("cate-"+i+"on");}element.addClass("cate-"+indexNum+"on");this.dvPoi.find("div[method='detail'] i").attr("class","action"+index);var detailTemplate=new Template('<li><a href="#{Url}" title="#{Name}">#{Name}</a></li>');if(this.PoiData.PoiTypeList[typeid].PoiDetailList.length>0){this.dvPoi.find("ul[method='tag']").hide();var sbDetail=new StringBuilder();for(var detail in this.PoiData.PoiTypeList[typeid].PoiDetailList){sbDetail.append(detailTemplate.eval({Url:this.PoiData.PoiTypeList[typeid].PoiDetailList[detail].Url,Name:this.PoiData.PoiTypeList[typeid].PoiDetailList[detail].PoiName}));}this.dvPoi.find("ul[method='poiDetail']").html(sbDetail.toString());}else{this.dvPoi.find("ul[method='tag']").show();var tagTemplate=new Template('<li #{Currnet}><a href="#?" typeid="#{TypeId}" tagid="#{TagId}" method="poiTag">#{TagName}</a></li>');var sbTag=new StringBuilder();var sbDetail=new StringBuilder();var currentCss='class="cur"';var i=0;for(var p in this.PoiData.PoiTypeList[typeid].PoiTagList){sbTag.append(tagTemplate.eval({TypeId:typeid,Currnet:i==0?currentCss:"",TagId:p,TagName:this.PoiData.PoiTypeList[typeid].PoiTagList[p].PoiTagName}));if(i==0){for(var detail in this.PoiData.PoiTypeList[typeid].PoiTagList[p].PoiDetailList){sbDetail.append(detailTemplate.eval({Url:this.PoiData.PoiTypeList[typeid].PoiTagList[p].PoiDetailList[detail].Url,Name:this.PoiData.PoiTypeList[typeid].PoiTagList[p].PoiDetailList[detail].PoiName}));}}i++;}this.dvPoi.find("ul[method='tag']").html(sbTag.toString());this.dvPoi.find("ul[method='poiDetail']").html(sbDetail.toString());}this.dvPoi.find("div[method='detail']").show();$("html,body").animate({scrollTop:$("div .adNo2").offset().top-5},800);}else{element.removeClass("cate-"+indexNum+"on");this.dvPoi.find("div[method='detail']").hide();}break;default:break;}},OndvPoiDetailClick:function(evt){var element=Event.element(evt);var method=element.attr("method");switch(method){case"poiTag":this.dvPoi.find("ul[method='tag'] li").removeClass("cur");element.parents("li").addClass("cur");var detailTemplate=new Template('<li><a href="#{Url}">#{Name}</a></li>');var sbDetail=new StringBuilder();for(var detail in this.PoiData.PoiTypeList[element.attr("typeid")].PoiTagList[element.attr("tagid")].PoiDetailList){sbDetail.append(detailTemplate.eval({Url:this.PoiData.PoiTypeList[element.attr("typeid")].PoiTagList[element.attr("tagid")].PoiDetailList[detail].Url,Name:this.PoiData.PoiTypeList[element.attr("typeid")].PoiTagList[element.attr("tagid")].PoiDetailList[detail].PoiName}));}this.dvPoi.find("ul[method='poiDetail']").html(sbDetail.toString());break;default:break;}},JsonNull:function(a){var b=true;for(var c in a){b=false;break;}return b;},RenderPoiType:function(){var sb=new StringBuilder();if(this.PoiData!=null){var template=new Template('<li class="cate-#{CssId}" typeid="#{TypeId}" index="0#{Index}" method="poitype"><a href="#?">#{TypeName}</a></li>');for(var i=0;i<this.PoiConfig.length;i++){if(this.PoiData.PoiTypeList[this.PoiConfig[i].PoiTypeId].PoiDetailList.length>0||!this.JsonNull(this.PoiData.PoiTypeList[this.PoiConfig[i].PoiTypeId].PoiTagList)){sb.append(template.eval({CssId:i+1,TypeId:this.PoiConfig[i].PoiTypeId,TypeName:this.PoiConfig[i].PoiTypeName,Index:i+1}));}else{sb.append(template.eval({CssId:(i+1)+"a",TypeId:this.PoiConfig[i].PoiTypeId,TypeName:this.PoiConfig[i].PoiTypeName,Index:-1}));}}this.dvPoi.find("ul[method='poiType']").html(sb.toString());}},CreateHotelNameBox:function(a){if(!Object.isNull(this.aioNameWind)){this.aioNameWind=null;}this.aioNameWind=new AiOWindow({cityId:a,resultNextId:"",lang:"cn",searchUrl:this.HotelAioSearchUrl,hotUrl:this.HotelAioHotUrl,eventElement:this.dvLeft.find("input[method='hotelName']"),onSelect:function(c,b){if(!Object.isNull(b.Type)&&!Object.isNull(b.Name)){this.isNameSelect=true;this.GlobalHotelNameData=b;if(c.attr("class")=="txT c9"){c.removeClass("c9");}}}.bind(this),directSearch:function(b){}.bind(this),isJsonp:"1",searchWidth:245,aioType:0});},CreateAllInOneBox:function(a){if(!Object.isNull(this.aioWind)){this.aioWind=null;}this.aioWind=new AiOWindow({cityId:a,resultNextId:"",lang:"cn",searchUrl:this.HotelAioSearchUrl,hotUrl:this.HotelAioHotUrl,eventElement:this.dvLeft.find("input[method='place']"),onSelect:function(c,b){if(!Object.isNull(b.Type)&&!Object.isNull(b.Name)){this.isSelect=true;this.GlobalData=b;}}.bind(this),directSearch:function(b){this.textWord[0]["Data"]=b;this.dvLeft.find("input[method='searchHotel']").trigger("click");}.bind(this),isJsonp:"1",searchWidth:245,aioType:0});},ReadHotelCookie:function(){var b=ElongNewIndexController.IPAddress;var a={CityId:"0101",CityName:"北京",CityNameEn:"beijing"};var c=Globals.cookie("ShHotel");if(c!=null&&c!=""&&String.isNullOrEmpty(b)){if(Globals.cookie("ShHotel","CityName")!=""&&c.indexOf("CityName")>0){a.CityName=Globals.cookie("ShHotel","CityName");if(Globals.cookie("ShHotel","CityID")!=""){a.CityId=Globals.cookie("ShHotel","CityID");}if(Globals.cookie("ShHotel","CityNameEN")!=""){a.CityNameEn=Globals.cookie("ShHotel","CityNameEN");}}this.initPoiCity(a);}else{ElongNewIndexController.GetLocalCity(b,function(d){if(d.success){this.dvLeft.find("#hotelCity").val(d.value.CityName);a.CityName=d.value.CityName;a.CityId=d.value.CityId;a.CityNameEn=d.value.CityNameEn;this.initPoiCity(a);this.CreateAllInOneBox(a.CityId);this.hotelCityName[0].City={CityId:a.CityId,CityNameCn:a.CityName,CityNameEn:a.CityNameEn};}}.bind(this));}return a;},initPoiCity:function(a){FunctionExt.defer(function(){this.PoiCity.val(a.CityName);}.bind(this),500);FunctionExt.defer(function(){ElongNewIndexController.GetPoiCity(a.CityId,a.CityNameEn,function(b){this.PoiData=b.value;this.RenderPoiType();}.bind(this));}.bind(this),500);},WriteHotelCookie:function(){Globals.cookie("ShHotel","",{InDate:this.hotelCheckInDate.val(),OutDate:this.hotelCheckoutDate.val(),CityName:this.hotelCityName.val().replace(/"/g,/\"/g),CityID:this.hotelCityName[0].City.CityId});if(this.hotelCityName[0].City&&!Object.isNull(this.hotelCityName[0].City.CityNameCn)){Globals.cookie("ShHotel","",{CityNameCN:this.hotelCityName[0].City.CityNameCn});}if(this.hotelCityName[0].City&&!Object.isNull(this.hotelCityName[0].City.CityNameEn)){Globals.cookie("ShHotel","",{CityNameEN:this.hotelCityName[0].City.CityNameEn});}},ReadiFlightCookie:function(){var e=Globals.cookie("Condition");if(e!=null&&e!=""){if(Globals.cookie("Condition","FT")=="1"){this.iFlightRound.click();}else{this.iFlightOneWay.click();}var h=String.isNullOrEmpty(Globals.cookie("Condition","SCN"))?"":Globals.cookie("Condition","SCN");var c=String.isNullOrEmpty(Globals.cookie("Condition","ECN"))?"":Globals.cookie("Condition","ECN");if(!String.isNullOrEmpty(Globals.cookie("Condition","SCN"))&&Globals.cookie("Condition","SCN").indexOf("=")==-1){var j=Globals.cookie("Condition","SCN");var g=j.split("|");if(!String.isNullOrEmpty(g[0])&&!String.isNullOrEmpty(g[1])&&g[1]!="undefined"){this.iFlightSrcCityName.val(decodeURIComponent(g[0]));this.iFlightSrcCityName.attr("CityName",decodeURIComponent(g[1]));this.iFlightSrcCityName.attr("CityThreeSign",decodeURIComponent(Globals.cookie("Condition","SC")));}}if(!String.isNullOrEmpty(Globals.cookie("Condition","ECN"))&&Globals.cookie("Condition","ECN").indexOf("=")==-1){var i=Globals.cookie("Condition","ECN");var g=i.split("|");if(!String.isNullOrEmpty(g[0])&&!String.isNullOrEmpty(g[1])&&g[1]!="undefined"){this.iFlightDestCityName.val(decodeURIComponent(g[0]));this.iFlightDestCityName.attr("CityName",decodeURIComponent(g[1]));this.iFlightDestCityName.attr("CityThreeSign",decodeURIComponent(Globals.cookie("Condition","EC")));}}if(Globals.cookie("Condition","SC")!=""&&e.indexOf("SC")>=0){var f=ElongNewIndexController.ServerTime.substring(0,10);var b=Globals.cookie("Condition","SD").split("+");if(b.length>0){if(this.getDateOffset(b[0],f)>0){b[0]=this.dateToString(this.dateAdd(this.stringToDate(f),3));}this.iFlightStartDate.val(b[0]);this.iFlightStartDate.next("span").text(this.GetWeekDay(b[0]));}if(this.iFlightRound[0].checked){var a=Globals.cookie("Condition","ED").split("+");if(a.length>0){var d=this.GetBackDate(b[0],a[0]);if(this.getDateOffset(d,f)>0){d=this.dateToString(this.dateAdd(this.stringToDate(f),6));}this.iFlightEndDate.val(d);this.iFlightEndDate.next("span").text(this.GetWeekDay(d));}}}this.iflightClass.SetName(this.iFlightClass.val());}else{this.iFlightOneWay.click();}},ReadFlightCookie:function(){var b=Globals.cookie("FlightCondition");if(b!=null&&b!=""){if(Globals.cookie("FlightCondition","FType")=="1"){this.FlightRound.click();}else{this.FlightOneWay.click();}if(!String.isNullOrEmpty(Globals.cookie("FlightCondition","DepName"))&&Globals.cookie("FlightCondition","DepName").indexOf("=")==-1){var g=Globals.cookie("FlightCondition","DepName");var d=g.split("|");if(!String.isNullOrEmpty(d[0])&&!String.isNullOrEmpty(d[1])&&d[1]!="undefined"){this.FlightSrcCityName.val(decodeURIComponent(d[0]));this.FlightSrcCityName.attr("CityName",decodeURIComponent(d[1]));this.FlightSrcCityName.attr("CityThreeSign",decodeURIComponent(Globals.cookie("FlightCondition","DepCode")));}}if(!String.isNullOrEmpty(Globals.cookie("FlightCondition","ArrName"))&&Globals.cookie("FlightCondition","ArrName").indexOf("=")==-1){var f=Globals.cookie("FlightCondition","ArrName");var d=f.split("|");if(!String.isNullOrEmpty(d[0])&&!String.isNullOrEmpty(d[1])&&d[1]!="undefined"){this.FlightDestCityName.val(decodeURIComponent(d[0]));this.FlightDestCityName.attr("CityName",decodeURIComponent(d[1]));this.FlightDestCityName.attr("CityThreeSign",decodeURIComponent(Globals.cookie("FlightCondition","ArrCode")));}}var e=this.CookieDate("DepDate");var c=ElongNewIndexController.ServerTime.substring(0,10);if(this.getDateOffset(e,c)>0){e=this.dateToString(this.dateAdd(this.stringToDate(c),1));}this.FlightStartDate.val(e);this.FlightStartDate.next("span").text(this.GetWeekDay(e));if(this.FlightRound[0].checked){var a=this.GetBackDate(this.CookieDate("DepDate"),this.CookieDate("BackDate"));if(this.getDateOffset(a,c)>0){a=this.dateToString(this.dateAdd(this.stringToDate(c),3));}this.FlightEndDate.val(a);this.FlightEndDate.next("span").text(this.GetWeekDay(a));}this.flightClass.SetName(this.FlightClass.val());}else{this.FlightOneWay.click();}},GetBackDate:function(b,a){if(!b){return"";}var c;var d=validator.convertDate(b);if(!a){c=new Date(d.setHours(24*3));}else{c=validator.convertDate(a);}if(c<d){c=new Date(d.setHours(24*3));}return validator.reFormatDateString(validator.getDateString(c));},CookieDate:function(a,c){var e="FlightCondition";if(null!=c&&c){e="Condition";}var d=Globals.cookie(e,a);if(d.indexOf("/")>-1){var b=this.getDateOffset(this.NowDate,validator.reFormatDateString(d));if(b<0){d=validator.reFormatDateString(this.NowDate);}else{d=validator.reFormatDateString(d);}}return d;},GoSearchList:function(b,a){if(window.location.host=="big5.elong.com"){b=b.replace("http://","http://big5.elong.com/gate/big5/");b+=b.indexOf("?")>0?"&isbig5=true":"?isbig5=true";}FunctionExt.defer(function(){a.hide();a.parent().find("div").show();}.bind(this),100);window.location.href=b;},dateAdd:function(a,b){a.setDate(a.getDate()+b);return a;},nextDay:function(a){var b=validator.convertDate(a);b=new Date(b.setHours(24));b=validator.reFormatDateString(b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate());return b;},getDateOffset:function(c,d){var a=validator.convertDateTime(c);var b=validator.convertDateTime(d);return(b.getTime()-a.getTime())/86400000;},stringToDate:function(e){var a,f,d,b;var c=new Array(3);c=e.toString().split("-");f=parseFloat(c[0]);d=parseFloat(c[1])-1;b=parseFloat(c[2]);return(new Date(f,d,b));},dateToString:function(a){var c,b;if((a.getMonth()+1)<10){c="0"+(a.getMonth()+1);}else{c=a.getMonth()+1;}if(a.getDate()<10){b="0"+(a.getDate());}else{b=a.getDate();}return a.getFullYear()+"-"+c+"-"+b;},GetWeekDay:function(c){var b=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];var e=this.NowDate;var a=this.daysBetween(e,c);if(a==0){return"今天";}else{if(a==1){return"明天";}else{if(a==2){return"后天";}else{var h=c.split("-")[0];var f=c.split("-")[1];var d=c.split("-")[2];var g=new Date(h,f-1,d).getDay();return b[g];}}}},daysBetween:function(b,c){var e=b.substring(5,b.lastIndexOf("-"));var d=b.substring(b.length,b.lastIndexOf("-")+1);var f=b.substring(0,b.indexOf("-"));var h=c.substring(5,c.lastIndexOf("-"));var g=c.substring(c.length,c.lastIndexOf("-")+1);var i=c.substring(0,c.indexOf("-"));var a=((Date.parse(e+"/"+d+"/"+f)-Date.parse(h+"/"+g+"/"+i))/86400000);return Math.abs(a);},daysBetweenVer2:function(b,c){var e=b.substring(5,b.lastIndexOf("-"));var d=b.substring(b.length,b.lastIndexOf("-")+1);var f=b.substring(0,b.indexOf("-"));var h=c.substring(5,c.lastIndexOf("-"));var g=c.substring(c.length,c.lastIndexOf("-")+1);var i=c.substring(0,c.indexOf("-"));var a=((Date.parse(e+"/"+d+"/"+f)-Date.parse(h+"/"+g+"/"+i))/86400000);return a;},GetWeekDayVer2:function(c){var b=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];var e=this.NowDate;var a=this.daysBetweenVer2(e,c);if(a==0){return"今天";}else{if(a==-1){return"明天";}else{if(a==-2){return"后天";}else{var h=c.split("-")[0];var f=c.split("-")[1];var d=c.split("-")[2];var g=new Date(h,f-1,d).getDay();return b[g];}}}},replaceCharCode:function(a){return a.replace(/(!)/g,"").replace(/(~)/g,"").replace(/(@)/g,"").replace(/(#)/g,"").replace(/($)/g,"").replace(/(%)/g,"").replace(/(^)/g,"").replace(/(&)/g,"").replace(/(\*)/g,"").replace(/(！)/g,"").replace(/(~)/g,"").replace(/(@)/g,"").replace(/(#)/g,"").replace(/(￥)/g,"").replace(/(%)/g,"").replace(/(……)/g,"").replace(/(&)/g,"").replace(/(\*)/g,"");},FormatJsonDate:function(a){var f="";var c=a.indexOf("+");f=a.substring(6,c);var e=new Date();e.setTime(f);var d=e.getMonth()+1;var b=e.getDate();d=(d<10)?"0"+d:d;b=(b<10)?"0"+b:b;return d+"月"+b+"日";},Round:function(d,c){var a=c+1;d=d.toString();var e=d.indexOf(".");if(d.length>e+a){if(parseInt(d.substring(e+a,e+a+1))>4){return d.substring(0,e)+"."+(parseInt(d.substring(e+1,e+a))+1);}else{return d.substring(0,e)+d.substring(e,e+a);}}return d;},filterCityNameEn:function(a){var b=a.replace(/[^\d\w]/g,"_").toLowerCase();while(b.indexOf("__")!=-1){b=b.replace("__","_");}return b;},destroyEvent:function(){},render:function(){},destroyDOM:function(){},dispose:function(){this.destroyEvent();this.destroyDOM();}});var client=null;$ready(function(){client=new ElongNewIndexClient();});