var AiOBox=Elong.Control.AiOBox;AiOBox=Class.create();Object.extend(AiOBox.prototype,{name:"AiOBox",windowElement:null,timeout:null,errtimeout:null,resultData:null,selectItem:null,currentCity:null,hotCacheList:null,dataCacheList:null,KeyCode:{Left:37,Up:38,Right:39,Down:40,Del:46,Tab:9,Return:13,Esc:27,Command:188,PageUp:33,PageDown:34,BackSpace:8,Tab:9},m_Hot:new Template('<div style="width:#{HotWidth}px;" class="com_hotresults"><div style="width:100%;"><div class="hotel_near">#{HotData}</div></div><div class="clear"></div><div class="com_cbox_b com_cbox_lt"></div><div class="com_cbox_b com_cbox_rt"></div><div class="com_cbox_b com_cbox_lb"></div><div class="com_cbox_b com_cbox_rb"></div><div class="clear"></div></div>'),m_Result:new Template('<div style="width:#{DataWidth}px;position:relative;" class="com_results"><div style="width: 100%;">#{Default}<ul method="ulData">#{Data}</ul></div><div class="clear"></div><div class="com_cbox_b com_cbox_lt"></div><div class="com_cbox_b com_cbox_rt"></div><div class="com_cbox_b com_cbox_lb"></div><div class="com_cbox_b com_cbox_rb"></div><div class="clear"></div></div>'),options:{eventElement:null,lang:"cn",cityId:"0101",onSelect:null,onClose:null,hotWidth:300,hotHeight:138,searchWidth:260,hotData:null,cityData:null,colLen:4,maxLen:10,enableSearch:true,delay:200,isJsonp:0,resultNextId:"",searchUrl:"http://hotel.elong.com/keywordssuggest.html",hotUrl:"http://hotel.elong.com/hotsuggest.html",aioType:0},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.hotCacheList=new Array();this.eventElement.attr("datacheck","");this.eventElement.attr("selectIndex",-1);this.eventElement.unbind("click");this.eventElement.unbind("keyup");this.eventElement.bind("click",this.onInputClick.bindAsEventListener(this));this.eventElement.bind("keyup",this.onInputKeyUp.bindAsEventListener(this));this.setHotSuggest(this.cityId);},getSelect:function(){return this.selectCity;},setHotSuggest:function(a){if(!String.isNullOrEmpty(a)){if(this.eventElement!=null){var c=false;for(var b=0;b<this.hotCacheList.length;b++){if(this.hotCacheList[b].CityId==this.cityId){this.currentCity=this.hotCacheList[b];c=true;break;}}if(!c){simpleAjax.callBack(this.hotUrl,"cityId="+this.cityId+"&language="+this.lang,function(e){var d={CityId:this.cityId,Data:e};this.hotCacheList.push(d);this.currentCity=d;}.bind(this),true,"get",(this.isJsonp=="1")?"jsonp":"json");}}}},destroyDOM:function(){this.windowElement=null;this.contentEndRegion=null;this.options=null;},initializeEvent:function(){if(this.windowElement){this.windowElement.bind("click",this.onClickRegion.bindAsEventListener(this));this.windowElement.bind("mouseout",this.onMouseOutRegion.bindAsEventListener(this));this.windowElement.bind("mouseover",this.onMouseOverRegion.bindAsEventListener(this));FunctionExt.defer(this.onOutClick.bindAsEventListener(this),100);}},destroyEvent:function(){this.windowElement.unbind("click");this.windowElement.unbind("mouseout");this.windowElement.unbind("mouseover");},buildHtml:function(keyword){var temp=encodeURIComponent(keyword.toLowerCase());var url=this.searchUrl;if(this.isJsonp==0){var appPath="";var host=window.location.host;if(host.toLowerCase().indexOf("travel.elong")>-1){var path=window.location.pathname;var pathtemp=path.split("/");if(pathtemp.length>1){appPath="/"+pathtemp[1];}}url=appPath+"hotsuggest.html";}if(this.windowElement){this.windowElement.remove();}this.contentEndRegion=$("#m_contentend");this.windowElement=$('<div  style="display:none; position: absolute; z-index: 2000;"></div>').appendTo(this.contentEndRegion);var defaultHtml="<div class='tuijian'><p method='fromArea' keyword='"+keyword+"'><tt class='poi'></tt>地点在<strong> "+keyword+"</strong> 附近的酒店</p><p method='fromName' keyword='"+keyword+"'><tt class='name'></tt>名称含 <strong>"+keyword+"</strong> 的酒店</p></div>";this.windowElement.html(this.m_Result.eval({DataWidth:this.searchWidth,Default:defaultHtml,Data:""}));this.initializeEvent();this.render();var queryString="q="+temp+"&limit="+this.maxLen+"&cityid="+this.cityId+"&language="+this.lang;if(this.aioType==2){queryString+="&type=5,9";}else{if(this.aioType==1){queryString+="&type=1,2,3,6,99";}}simpleAjax.callBack(url,queryString,function(data){this.eventElement[0]["Data"]=null;if(data!=null&&data.length>0){this.eventElement.attr("TypeId","");this.eventElement.removeAttr("firstSType");this.resultData=data||[];this.selectItem=this.resultData[0];this.eventElement[0]["Data"]=this.resultData[0];this.eventElement.attr("firstSType",this.resultData[0].Type);this.eventElement.attr("firstSPId",this.resultData[0].PropertiesId);if(!String.isNullOrEmpty(this.resultData[0].Lat)&&!String.isNullOrEmpty(this.resultData[0].Lng)){this.eventElement.attr("firstSLat",this.resultData[0].Lat);this.eventElement.attr("firstSLng",this.resultData[0].Lng);}if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}var dataSb=new StringBuilder();for(var i=0;i<this.resultData.length;i++){var termArr=new Array();termArr=keyword.split(" ");var hightResult=this.resultData[i].Name;for(var j=0;j<termArr.length;j++){if($.trim(termArr[j]).length>0){hightResult=this.highlight(hightResult,$.trim(termArr[j]));}}var highName=hightResult;dataSb.append(' <li method="liData" data="'+i+'" class="ac_odd"><span method="spanData" data="'+i+'" typeid="'+this.resultData[i].Type+'">'+highName+"</span></li>");}this.windowElement.html(this.m_Result.eval({DataWidth:this.searchWidth,Default:defaultHtml,Data:dataSb.toString()}));this.windowElement.attr("winstyle","data");}else{this.eventElement.removeAttr("firstSType");this.eventElement.removeAttr("firstSPId");this.eventElement.removeAttr("firstSLat");this.eventElement.removeAttr("firstSLng");}}.bind(this),true,"GET",(this.isJsonp=="1")?"jsonp":"json");},buildHotHtml:function(){this.reloadData();if(this.windowElement){this.windowElement.remove();}this.contentEndRegion=$("#m_contentend");this.windowElement=$('<div style="display:none; position: absolute; z-index: 2000;"></div>').appendTo(this.contentEndRegion);var hotNameSb=new StringBuilder();var hotDataSb=new StringBuilder();if(this.currentCity!=null&&!Object.isNull(this.currentCity.Data)&&this.currentCity.Data.length>0){for(var i=0;i<this.currentCity.Data.length;i++){var t=this.currentCity.Data[i].Type;if(this.aioType==1&&(t==1||t==2||t==3)){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}else{if(this.aioType==2&&t==5){if(this.currentCity.Data[i].TypeNameList.length>0){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}else{this.windowElement.remove();return false;}}}if(this.aioType==0){hotDataSb.append("<p>");hotDataSb.append('<tt class="t14 bold">'+this.currentCity.Data[i].Name+"</tt><br />");for(var j=0;j<this.currentCity.Data[i].TypeNameList.length;j++){hotDataSb.append(' <span method="hotData"  data="'+i+"|"+j+'">'+this.currentCity.Data[i].TypeNameList[j].Name+"</span>");}hotDataSb.append("</p>");}}if(String.isNullOrEmpty(hotDataSb.toString())){this.windowElement.remove();return false;}this.windowElement.html(this.m_Hot.eval({HotData:hotDataSb.toString(),HotWidth:this.hotWidth}));}this.windowElement.attr("winstyle","hot");},highlight:function(b,a){return b.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+a.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>");},reloadData:function(){if(this.windowElement){this.windowElement.remove();if(this.ie6FilterIFrame!=null){Globals.closeIE6Fliter(this.ie6FilterIFrame);}}},onInputClick:function(a){if(!Object.isNull(this.currentCity)&&this.windowElement==null){this.buildHotHtml();this.initializeEvent();this.render();this.eventElement.select();}},onInputKeyUp:function(b){if(!this.enableSearch){return;}var a=Event.element(b);if(this.windowElement&&this.windowElement.attr("winstyle")=="data"){var d=this.windowElement.find("ul[method='ulData']");var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");switch(b.keyCode){case this.KeyCode.Up:c.removeClass("ac_over");if(c.prev("li").length>0){c.prev("li").addClass("ac_over");}else{this.windowElement.find("ul[method='ulData'] li:last").addClass("ac_over");}d.scrollTop((c.offset().top-d.offset().top)<d.height()-30&&(c.offset().top-d.offset().top)>0?(c.offset().top-d.offset().top):c.offset().top);var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;case this.KeyCode.Down:c.removeClass("ac_over");if(c.next("li").length>0){c.next("li").addClass("ac_over");}else{this.windowElement.find("ul[method='ulData'] li:first").addClass("ac_over");}d.scrollTop((c.offset().top-d.offset().top)>d.height()-30?0:(c.offset().top-d.offset().top));var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;case this.KeyCode.Return:var c=this.windowElement.find("ul[method='ulData'] li[class*='ac_over']");this.selectData(c);break;default:clearTimeout(this.timeout);this.timeout=setTimeout(function(){this.reBuildData(a);}.bind(this),this.delay);}}else{switch(b.keyCode){case this.KeyCode.Up:case this.KeyCode.Down:case this.KeyCode.Left:case this.KeyCode.Right:case this.KeyCode.Return:break;default:clearTimeout(this.timeout);this.timeout=setTimeout(function(){this.reBuildData(a);}.bind(this),this.delay);}}b.stopPropagation();},reBuildData:function(b){var a=b;if(!String.isNullOrEmpty(this.cityId)){if(String.isNullOrEmpty(a.val())){this.eventElement.removeAttr("firstSType");this.eventElement.removeAttr("firstSPId");this.eventElement.removeAttr("firstSLat");this.eventElement.removeAttr("firstSLng");this.buildHotHtml();this.initializeEvent();this.render();}else{this.buildHtml(a.val());}}},onOutClick:function(){$(document).bind("click",function(b){var a=Event.element(b);if(this.windowElement!=null&&this.windowElement.find("*").index(a)==-1&&this.eventElement[0]!=a[0]){this.dispose();}}.bindAsEventListener(this));},selectData:function(a){if(!String.isNullOrEmpty(a.attr("data"))){var d;if(this.windowElement.attr("winstyle")=="hot"){var c=a.attr("data").split("|");var b=decodeURIComponent(this.currentCity.Data[c[0]].TypeNameList[c[1]].Name);this.eventElement.val(b);this.eventElement.attr("datacheck",a.attr("data"));d=this.currentCity.Data[c[0]].TypeNameList[c[1]];d.Accept=true;}else{var c=a.attr("data");var b=this.resultData[c].Name;this.eventElement.val(b);this.eventElement.attr("datacheck",c);this.eventElement.attr("selectIndex",c);d=this.resultData[c];d.Accept=true;}this.selectItem=d;this.eventElement[0]["Data"]=d;this.eventElement.attr("TypeId",d.Type);if(this.onSelect){this.onSelect(this.eventElement,d);}this.eventElement.focus();if(!String.isNullOrEmpty(this.resultNextId)){}}},onClickRegion:function(b){var a=Event.element(b);var c=a.attr("method");if(c==null||c==""){a=a.parent();c=a.attr("method");}switch(c){case"hotData":this.selectData(a);this.directSearch(this.selectItem);return;case"liData":case"spanData":this.selectData((c=="liData")?a:a.parent());this.directSearch(this.selectItem);return;case"fromArea":if(this.directSearch){this.eventElement.attr("selectIndex","-5");this.directSearch({Name:a.attr("keyword"),Type:99,PropertiesId:0,Lat:0,Lng:0,Accept:true});}return;case"fromName":if(this.directSearch){this.eventElement.attr("selectIndex","-6");this.directSearch({Name:a.attr("keyword"),Type:9,PropertiesId:0,Lat:0,Lng:0,Accept:true});}return;case"close":this.dispose();return;default:this.dispose();return;}},onMouseOverRegion:function(b){var a=Event.element(b);if(this.outTimer!=null){clearTimeout(this.outTimer);this.outTimer=null;}this.removeAllClass(a);if(a.is("li")||a.parent().is("li")){var c=a.is("li")?a:a.parent();c.addClass("ac_over");}},removeAllClass:function(a){if(a.is("li")||a.parent().is("li")){var b=a.is("li")?a:a.parent();b.removeClass("ac_over");b.siblings("li[class*=ac_over]").removeClass("ac_over");}},onMouseOutRegion:function(a){},render:function(){if(this.windowElement){var d=this.eventElement.offset().top+this.eventElement.height()+6;var b=this.eventElement.offset().left;var c=Globals.getScrollPosition();var a=Globals.browserDimensions();if(a.width-(this.eventElement.offset().left-c.x)>this.windowElement.width()){this.windowElement[0].style.top=d+"px";this.windowElement[0].style.left=b+"px";}else{this.windowElement[0].style.top=d+"px";b=b-this.windowElement.width()+this.eventElement.width();this.windowElement[0].style.left=b+"px";}this.ie6FilterIFrame=Globals.addIE6Filter(this.windowElement.width(),this.windowElement.height(),b,d,1999);this.windowElement.show();}},dispose:function(){if(this.windowElement){this.windowElement.hide();FunctionExt.defer(function(){if(this.windowElement){Globals.closeIE6Fliter(this.ie6FilterIFrame);if(this.windowElement.attr("winstyle")=="data"){if(this.onClose!=null){this.onClose(this.eventElement,this.windowElement);}}this.windowElement.remove();this.destroyEvent();this.destroyDOM();}}.bind(this),500);}}});var AiOWindow=Elong.Control.AiOWindow;AiOWindow=Class.create();Object.extend(AiOWindow.prototype,{name:"AiOWindow",aioSearch:null,options:{eventElement:null,lang:"cn",resultNextId:"",cityId:"0101",onSelect:null,directSearch:null,onClose:null,hotWidth:300,hotHeight:138,searchWidth:260,delay:200,maxLen:10,enableSearch:true,isJsonp:0,searchUrl:"http://hotel.elong.com/keywordssuggest.html",hotUrl:"http://hotel.elong.com/hotsuggest.html",aioType:0},initialize:function(a){Object.extend(Object.extend(this,this.options),a);this.aioSearch=new AiOBox(a);},getSelect:function(){return this.aioSearch.getSelect();},setHotSuggest:function(a){this.aioSearch.setHotSuggest();}});var NewIndexClient=Elong.Page.NewIndexClient;NewIndexClient=Class.create();Object.extend(NewIndexClient.prototype,{name:"NewIndex",hotelCity:null,pageLabelFlag:"flash",PoiData:null,PoiConfig:null,initialize:function(){this.initializeDOM();this.initializeEvent();this.initializeServerData();this.Language=HotelIndexController.Language.toLowerCase();this.Resources=HotelIndexController.Resources;this.CityNameEn="";this.aioWind=null;this.HotelListUrl=new Template(HotelIndexController.UrlConfig.HotelListUrl);this.HotelIndexMapUrl=new Template(HotelIndexController.UrlConfig.HotelIndexMapUrl);this.SearchRequestInfo=HotelIndexController.SearchRequestInfo;this.tempCityId=HotelIndexController.SearchRequestInfo.CityId;this.GlobalData={Type:"",Name:"",PropertiesId:0,Lat:0,Lng:0,Accept:false};this.selectName="";this.serverTime=HotelIndexController.ServerTime.substring(0,10);this.CalendarShowYesterday=HotelIndexController.CalendarShowYesterday;this.DefaultPlaceValue="输入 位置 酒店名 或品牌";this.CityList=new Template(HotelIndexController.UrlConfig.CityList);this.CitySowntownList=new Template(HotelIndexController.UrlConfig.CitySowntownList);this.CityRegionList=new Template(HotelIndexController.UrlConfig.CityRegionList);this.CityBrandList=new Template(HotelIndexController.UrlConfig.CityBrandList);this.CityPlaceList=new Template(HotelIndexController.UrlConfig.CityPlaceList);this.CitySowntownBrandList=new Template(HotelIndexController.UrlConfig.CitySowntownBrandList);this.CityRegionBrandList=new Template(HotelIndexController.UrlConfig.CityRegionBrandList);this.ViewedHotelTemp=new Template('<li class="#{liCass}"><span class="name"><a href="#{hotelUrl}" title="#{hotelName}">#{hotelName}</a></span><strong class="price"><span class="pfh">#{currencySymbol}</span>#{totalPrice}<span class="pfb">#{tailDesc}</span></strong><span hotelid="#{hotelid}" title="删除"   method="delSeenHotel" class="del"></span></li>');this.lowestPriceTemplate=new Template("<span>#{from}#{price}#{tail}</span>");this.HotelDetailUrlTemplate=new Template(HotelIndexController.UrlConfig.HotelDetailViewUrl);this.PoiConfig=HotelIndexController.PoiConfig.ConfigList;try{this.render();}catch(a){}},initializeDOM:function(){this.dvSearchRegion=$("#dvSearchRegion");this.InCityName=$("#m_city");this.CheckInDate=$("#m_preDate");this.CheckOutDate=$("#m_endDate");this.allInOne=$("#allInOne");this.m_search=$("#m_search");this.flashSaleRegion=$("#hotellist");this.viewed_divId=$("#viewed_divId");this.divMain=$("#divMain");this.HotSaleList=$("#HotSaleList");this.allInOneData={Name:"",Type:"",PropertiesId:0,Lat:0,Lng:0,Accept:-1};this.dvPoi=$("div[method='dvPoi']");this.PoiCity=this.dvPoi.find("input[method='poicity']");},destroyDOM:function(){this.dvSearchRegion=null;this.InCityName=null;this.CheckInDate=null;this.CheckOutDate=null;this.allInOne=null;this.m_search=null;this.flashSaleRegion=null;this.dvPoi=null;this.PoiCity=null;},initializeEvent:function(){var a=HotelIndexController.Language.toLowerCase();this.hotelCity=new CityWindow({eventElement:this.InCityName,cityType:"hotel",lang:a,resultNextId:"m_preDate",onSelect:function(c,b){$("#cityid").val(b.CityId);}});this.dvSearchRegion.bind("click",this.OnClickdvSearchRegion.bindAsEventListener(this));this.dvSearchRegion.bind("keydown",this.checkSearch.bindAsEventListener(this));this.CheckInDate.bind("blur",this.OnblurCheckInDate.bindAsEventListener(this));this.CheckOutDate.bind("blur",this.OnblurCheckOutDate.bindAsEventListener(this));this.allInOne.bind("focus",this.onAllInOneFocus.bindAsEventListener(this));this.allInOne.bind("blur",this.onAllInOneBlur.bindAsEventListener(this));this.flashSaleRegion.bind("click",this.OnClickflashSaleRegion.bindAsEventListener(this));this.HotSaleList.bind("mouseover",this.onHotSaleMouseOver.bindAsEventListener(this));this.viewed_divId.bind("click",this.OnClickViewedHotel.bindAsEventListener(this));this.divMain.bind("click",this.OnClickDivMain.bindAsEventListener(this));$("div[method='dvPoiType']").bind("click",this.OndvPoiTypeClick.bindAsEventListener(this));this.dvPoi.find("div[method='detail']").bind("click",this.OndvPoiDetailClick.bindAsEventListener(this));$(window).unload(this.dispose.bind(this));},destroyEvent:function(){this.dvSearchRegion.unbind("click");this.dvSearchRegion.unbind("keydown");this.CheckInDate.unbind("blur");this.CheckOutDate.unbind("blur");this.allInOne.unbind("focus");this.allInOne.unbind("blur");this.flashSaleRegion.unbind("click");},initializeServerData:function(){this.poiCity=new CityWindow({eventElement:this.PoiCity,cityType:"hotel",hotType:"hotel",lang:"cn",isJsonp:"1",enableSearch:false,onSelect:function(b,a){if(a.CityId!=""){this.dvPoi.find("div[method='detail']").hide();HotelIndexController.GetPoiCity(a.CityId,a.CityNameEn,function(c){this.PoiData=c.value;this.RenderPoiType();}.bind(this));}}.bind(this)});},render:function(){this.CityNameEn=HotelIndexController.City.CityNameEn;if(this.Language=="cn"){this.InCityName.val(HotelIndexController.SearchRequestInfo.CityNameCN);this.InCityName.attr("cityid",HotelIndexController.SearchRequestInfo.CityId);this.InCityName.attr("cityname",HotelIndexController.SearchRequestInfo.CityNameEN);}else{this.InCityName.val(HotelIndexController.SearchRequestInfo.CityNameEN);this.InCityName.attr("cityid",HotelIndexController.SearchRequestInfo.CityId);this.InCityName.attr("cityname",HotelIndexController.SearchRequestInfo.CityNameEN);}$("#inDateWeek").html(this.GetWeekDay(this.CheckInDate.val()));$("#outDateWeek").html(this.GetWeekDay(this.CheckOutDate.val()));new CityWindow({eventElement:this.InCityName,cityType:"hotel",lang:HotelIndexController.Language.toLowerCase(),resultNextId:"m_preDate",isAutoSelect:true,onSelect:function(evt,data){if(!Object.isNull(data.CityId)){this.CityName=HotelIndexController.Language.toLowerCase()=="cn"?data.CityNameCn:data.CityNameEn;this.CityNameCn=data.CityNameCn;this.CityNameEn=data.CityNameEn;this.tempCityId=data.CityId;if(data.Type!==undefined&&data.Type!=="city"){var cityNameSplit=data.CityNameCn.split("（");this.selectName=cityNameSplit[0];}else{this.selectName="";}this.createAllInOneBox(true);this.allInOne.attr("value",HotelIndexController.Resources.AllInOne);}}.bind(this)});new CityWindow({eventElement:$("#moreseasoncity"),cityType:"hotel",lang:HotelIndexController.Language.toLowerCase(),onSelect:function(evt,data){if(!Object.isNull(data.CityNameEn)){this.writeHotelCookie();var citynameEn=FilterPinyinForUrl(data.CityNameEn);window.location=this.CityList.eval({citynameen:citynameEn});}}.bind(this)});if(HotelIndexController.WebCategory=="Elong"){this.pageLabelFlag="flash";var item=["(限量抢购)","(限时抢购)","（限时抢购）","（限量抢购）","(龙萃专享)","（龙萃专享）","（限量抢）","(限量抢)","（限时抢）","(限时抢)","龙萃专享","限量抢购","限时抢购","限量抢","限时抢"];for(var i=0;i<item.length;i++){for(var j=0;j<HotelIndexController.FlashSale.length;j++){HotelIndexController.FlashSale[j].FavorableRateName=HotelIndexController.FlashSale[j].FavorableRateName.replace(item[i],"");HotelIndexController.FlashSale[j].FavorableRoomName=HotelIndexController.FlashSale[j].FavorableRoomName.replace(item[i],"");}}var flashSaleList=$("#FlashSaleHtml").tmpl({model:HotelIndexController.FlashSale,client:this});if(!String.isNullOrEmpty(flashSaleList)){$("#FlashSaleList").append(flashSaleList);}else{$("#noFlashSale").show();}}else{this.pageLabelFlag="hotSale";var flashSaleList=$("#HotSaleHtml").tmpl({model:HotelIndexController.FlashSale,recentOrders:HotelIndexController.RecentOrders,client:this});if(!String.isNullOrEmpty(flashSaleList)){$("#HotSaleList").append(flashSaleList);}else{$("#getDataFailed").show();}}this.loadViewedHotel();var isSelect=false;$("#cityList").find("li.on").each(function(){isSelect=true;});if(!isSelect){$("#cityList").find("a").each(function(){if($(this).attr("cityid")=="0101"){$(this).parent().addClass("on");}});}HotelIndexController.GetPoiCity("0101","Beijing",function(ret){this.PoiData=ret.value;this.RenderPoiType();}.bind(this));},OndvPoiTypeClick:function(evt){var element=Event.element(evt);if(element.is("a")){element=element.parents("li");}var method=element.attr("method");switch(method){case"poitype":if(Object.isNull(this.PoiData)||Object.isNull(this.PoiData.PoiTypeList)){break;}var typeid=element.attr("typeid");var index=element.attr("index");var indexNum=index.substr(index.length-1,1);var actionClass=this.dvPoi.find("div[method='detail'] i").attr("class");var isHidden=this.dvPoi.find("div[method='detail']").is(":hidden");if(index!="0-1"&&(isHidden||actionClass!="action"+index)){for(var i=1;i<9;i++){this.dvPoi.find("div[method='dvPoiType'] li").removeClass("cate-"+i+"on");}element.addClass("cate-"+indexNum+"on");this.dvPoi.find("div[method='detail'] i").attr("class","action"+index);var detailTemplate=new Template('<li><a href="#{Url}" title="#{Name}">#{Name}</a></li>');if(this.PoiData.PoiTypeList[typeid].PoiDetailList.length>0){this.dvPoi.find("ul[method='tag']").hide();var sbDetail=new StringBuilder();for(var detail in this.PoiData.PoiTypeList[typeid].PoiDetailList){sbDetail.append(detailTemplate.eval({Url:this.PoiData.PoiTypeList[typeid].PoiDetailList[detail].Url,Name:this.PoiData.PoiTypeList[typeid].PoiDetailList[detail].PoiName}));}this.dvPoi.find("ul[method='poiDetail']").html(sbDetail.toString());}else{this.dvPoi.find("ul[method='tag']").show();var tagTemplate=new Template('<li #{Currnet}><a href="#?" rel="nofollow" typeid="#{TypeId}" tagid="#{TagId}" method="poiTag">#{TagName}</a></li>');var sbTag=new StringBuilder();var sbDetail=new StringBuilder();var currentCss='class="cur"';var i=0;for(var p in this.PoiData.PoiTypeList[typeid].PoiTagList){sbTag.append(tagTemplate.eval({TypeId:typeid,Currnet:i==0?currentCss:"",TagId:p,TagName:this.PoiData.PoiTypeList[typeid].PoiTagList[p].PoiTagName}));if(i==0){for(var detail in this.PoiData.PoiTypeList[typeid].PoiTagList[p].PoiDetailList){sbDetail.append(detailTemplate.eval({Url:this.PoiData.PoiTypeList[typeid].PoiTagList[p].PoiDetailList[detail].Url,Name:this.PoiData.PoiTypeList[typeid].PoiTagList[p].PoiDetailList[detail].PoiName}));}}i++;}this.dvPoi.find("ul[method='tag']").html(sbTag.toString());this.dvPoi.find("ul[method='poiDetail']").html(sbDetail.toString());}this.dvPoi.find("div[method='detail']").show();}else{element.removeClass("cate-"+indexNum+"on");this.dvPoi.find("div[method='detail']").hide();}break;default:break;}},OndvPoiDetailClick:function(evt){var element=Event.element(evt);var method=element.attr("method");switch(method){case"poiTag":this.dvPoi.find("ul[method='tag'] li").removeClass("cur");element.parents("li").addClass("cur");var detailTemplate=new Template('<li><a href="#{Url}">#{Name}</a></li>');var sbDetail=new StringBuilder();for(var detail in this.PoiData.PoiTypeList[element.attr("typeid")].PoiTagList[element.attr("tagid")].PoiDetailList){sbDetail.append(detailTemplate.eval({Url:this.PoiData.PoiTypeList[element.attr("typeid")].PoiTagList[element.attr("tagid")].PoiDetailList[detail].Url,Name:this.PoiData.PoiTypeList[element.attr("typeid")].PoiTagList[element.attr("tagid")].PoiDetailList[detail].PoiName}));}this.dvPoi.find("ul[method='poiDetail']").html(sbDetail.toString());break;default:break;}},JsonNull:function(a){var b=true;for(var c in a){b=false;break;}return b;},RenderPoiType:function(){if(Object.isNull(this.PoiData)||Object.isNull(this.PoiData.PoiTypeList)){return;}var sb=new StringBuilder();if(this.PoiData!=null){var template=new Template('<li class="cate-#{CssId}" typeid="#{TypeId}" index="0#{Index}" method="poitype"><a href="#?" rel="nofollow">#{TypeName}</a></li>');for(var i=0;i<this.PoiConfig.length;i++){if(this.PoiData.PoiTypeList[this.PoiConfig[i].PoiTypeId].PoiDetailList.length>0||!this.JsonNull(this.PoiData.PoiTypeList[this.PoiConfig[i].PoiTypeId].PoiTagList)){sb.append(template.eval({CssId:i+1,TypeId:this.PoiConfig[i].PoiTypeId,TypeName:this.PoiConfig[i].PoiTypeName,Index:i+1}));}else{sb.append(template.eval({CssId:(i+1)+"a",TypeId:this.PoiConfig[i].PoiTypeId,TypeName:this.PoiConfig[i].PoiTypeName,Index:-1}));}}this.dvPoi.find("ul[method='poiType']").html(sb.toString());}},onHotSaleMouseOver:function(d){var c=Event.element(d);var e=c.attr("method");switch(e){case"coupon":var a=c.attr("amount");var b=$("#couponDesc"+c.attr("hotelid")).html();if(String.isNullOrEmpty(a)||parseInt(a)<=0||String.isNullOrEmpty(b)){return;}if(this.tipWindow!=null){this.tipWindow.close();}this.tipWindow=new TipWindow({htmlContent:b,eventElement:c,defer:true,width:400});break;}},OnClickDivMain:function(evt){var element=Event.element(evt);var method=element.attr("method");switch(method){case"moreCity":var itemId=element.attr("id");new CityWindow({eventElement:itemId=="moreCityId2"?$("#moreCityId2"):$("#moreCityId1"),cityType:"hotel",lang:HotelIndexController.Language.toLowerCase(),onSelect:function(evt,data){if(!Object.isNull(data.CityNameEn)){window.location=this.CityList.eval({citynameen:data.CityNameEn});}}.bind(this)});}},OnClickViewedHotel:function(d){var c=Event.element(d);var e=c.attr("method");switch(e){case"viewedspan":var f=c.attr("class");if(f=="collapse"){c.attr("class","expand");c.attr("title","展开");c.text("展开");$("#viewed_ulId").hide();}else{c.attr("class","collapse");c.attr("title","收起");c.text("收起");$("#viewed_ulId").show();}break;case"delSeenHotel":var b=c.attr("hotelid");b=String.format("{0},{1},{2},{3},{4},{5},{6};",b,"","","","","","");var a="";a=Globals.cookie("SHBrowseHotel",this.Language.toLowerCase());a=a.replace(b,"");Globals.cookie("SHBrowseHotel",this.Language.toLowerCase(),a,{expires:30,path:"/",secure:false});c.parent().remove();if(a==null||a==""){this.viewed_divId.hide();}break;}},loadViewedHotel:function(){var a=this.GetHistoryHotelIds();if(a!=""){HotelIndexController.GetHistoryBrowseHotels(this.SearchRequestInfo,a,function(c){if(c.success&&c.value!=null){var b=c.value.BrowerHotelList;this.showHistoryBrowseHotels(c.value.BrowerHotelList);}}.bind(this),false,"get");}},showHistoryBrowseHotels:function(historyHotelInfoList){var historyBrowseHotelHtml="";if(historyHotelInfoList!=null&&historyHotelInfoList!=""&&historyHotelInfoList!=undefined&&historyHotelInfoList.length>0){historyBrowseHotelHtml='<h2><span id="viewedspanId" method="viewedspan" class="collapse" title="收起">收起</span><tt></tt>我浏览过的酒店</h2>';historyBrowseHotelHtml+='<ul id="viewed_ulId"   class="list1">';for(var i=0;i<historyHotelInfoList.length;i++){var hotelId=historyHotelInfoList[i].HotelId;var hotelName="";var currency=historyHotelInfoList[i].MoneySymbol;var hotelPrice=parseFloat(historyHotelInfoList[i].LowestPrice)>0?historyHotelInfoList[i].LowestPrice.toString():"";var fromDesc="";var tailDesc="";if(this.Language=="en"){hotelName=String.isNullOrEmpty(historyHotelInfoList[i].HotelNameRealEn)?"":historyHotelInfoList[i].HotelNameRealEn;if(!String.isNullOrEmpty(hotelPrice)){fromDesc="from";tailDesc="";}}else{hotelName=String.isNullOrEmpty(historyHotelInfoList[i].HotelName)?"":historyHotelInfoList[i].HotelName;if(!String.isNullOrEmpty(hotelPrice)){fromDesc="";tailDesc="起";}}var hotelStar=parseInt(historyHotelInfoList[i].HotelStar);var display="none";var starCss="";if(historyHotelInfoList[i].IsElongStar){display=hotelStar>=25?"":"none";starCss=String.format("medal me-{0}",hotelStar);}else{if(hotelStar!=0){display=hotelStar>2&&hotelStar<25?"":"none";starCss=String.format("dx dx{0}",hotelStar);}}var starDesc="";var strtips="艺龙用户评定为{0}酒店";if(hotelStar>=25){switch(hotelStar){case 25:case 30:starDesc=String.format(strtips,"舒适型");break;case 35:case 40:starDesc=String.format(strtips,"高档型");break;case 45:case 50:starDesc=String.format(strtips,"豪华型");break;}}else{if(hotelStar!=0){starDesc=String.format("国家旅游局评定星级为{0}星级",hotelStar);}}var hotelDetailUrl=this.HotelDetailUrlTemplate.eval({cityNameEn:historyHotelInfoList[i].CityNameEn,hotelId:hotelId});hotelDetailUrl=String.format("{0}{1}fr=elrc_dt_vw_{2}_{3}",hotelDetailUrl,hotelDetailUrl.indexOf("?")!=-1?"&":"?",i+1,hotelId);historyBrowseHotelHtml+=this.ViewedHotelTemp.eval({liCass:"border clx",hotelUrl:hotelDetailUrl,hotelName:hotelName,display:display,starCss:starCss,starDesc:starDesc,currencySymbol:currency,totalPrice:hotelPrice,tailDesc:tailDesc,hotelid:hotelId});}historyBrowseHotelHtml+="</ul>";this.viewed_divId.html(historyBrowseHotelHtml);this.viewed_divId.show();}else{this.viewed_divId.hide();}},GetHistoryHotelIds:function(){var a="";a=Globals.cookie("SHBrowseHotel",this.Language.toLowerCase());var c="";var b="";if(a!=null){var f=a.split(";");if(a!=null&&a!=""){for(var e=0;e<f.length;e++){var d=f[e].split(",");if(d.length<1){continue;}var b=d[0];if(c==""){c+=b;}else{c+=","+b;}}}}return c;},checkSearch:function(a){if(a.keyCode==13){$("#m_search").click();}},GetWeekDay:function(c){var b=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];var g=new Date();var e=g.getFullYear().toString()+"-"+(g.getMonth()+1).toString()+"-"+g.getDate().toString();var a=this.daysBetween(e,c);if(a==0){return"今天";}else{if(a==-1){return"明天";}else{if(a==-2){return"后天";}else{var i=c.split("-")[0];var f=c.split("-")[1];var d=c.split("-")[2];var h=new Date(i,f-1,d).getDay();return b[h];}}}},OnblurCheckInDate:function(b){var a=Event.element(b);var c=a.attr("onblurmethod");switch(c){case"txtEnterDate":var d=this.CheckInDate.val();if(!validator.valid(d,"notEmpty & date")){$error(this.CheckInDate,HotelIndexController.Resources.NotPassInDate);return false;}else{var e=this.GetWeekDay(d);$("#inDateWeek").html(e);}break;}},OnblurCheckOutDate:function(b){var a=Event.element(b);var c=a.attr("onblurmethod");switch(c){case"txtOutDate":var d=this.CheckOutDate.val();if(!validator.valid(d,"notEmpty & date")){$error(this.CheckOutDate,HotelIndexController.Resources.NotPassOutDate);return false;}else{var e=this.GetWeekDay(d);$("#outDateWeek").html(e);}break;}},OnClickdvSearchRegion:function(evt){var element=Event.element(evt);var method=element.attr("method");switch(method){case"txtEnterDate":if(element.is("span")){element=element.prev("input");}var enabledFromDate=validator.reFormatDateString(this.serverTime);if(this.CalendarShowYesterday==true){var serverDate=validator.convertDate(this.serverTime);serverDate.setDate(serverDate.getDate()-1);enabledFromDate=validator.reFormatDateString(serverDate.getFullYear()+"-"+(serverDate.getMonth()+1)+"-"+serverDate.getDate());}new CalendarWindow({eventElement:element,selectedDate:element.val(),language:"cn",enabledFrom:enabledFromDate,onSelected:function(date){element.val(date);var weekDay=this.GetWeekDay(date);$("#inDateWeek").html(weekDay);var dateStart=validator.reFormatDateString(date);var dateEnd=validator.reFormatDateString(this.CheckOutDate.val());if(dateStart>=dateEnd){var edate=validator.convertDate(date);edate=new Date(edate.setHours(24));edate=validator.reFormatDateString(edate.getFullYear()+"-"+(edate.getMonth()+1)+"-"+edate.getDate());this.CheckOutDate.val(edate);weekDay=this.GetWeekDay(edate);$("#outDateWeek").html(weekDay);}$("#CheckOutDate").focus().click();}.bind(this)});break;case"txtOutDate":if(element.is("span")){element=element.prev("input");}var edate=validator.convertDate(this.CheckInDate.val());edate=new Date(edate.setHours(24));edate=validator.reFormatDateString(edate.getFullYear()+"-"+(edate.getMonth()+1)+"-"+edate.getDate());new CalendarWindow({eventElement:element,selectedDate:edate,language:"cn",enabledFrom:validator.reFormatDateString(edate),onSelected:function(date){element.val(date);var weekDay=this.GetWeekDay(date);$("#outDateWeek").html(weekDay);element.focus();}.bind(this)});break;case"m_search":evt.preventDefault();if(!this.searchValid()){break;}this.writeHotelCookie();var textWord=jQuery.trim(this.allInOne.val());textWord=this.replaceCharCode(textWord);this.GlobalData={Name:"",Type:99,PropertiesId:0,Lat:0,Lng:0,Accept:false};if(!Object.isNull(this.allInOne[0].Data)&&this.allInOne[0].Data.Accept==true){this.GlobalData=this.allInOne[0].Data;this.allInOneData=Object.clone(this.GlobalData);}else{if(textWord.trim()==this.Resources.AllInOne){this.GlobalData.Name=this.selectName;this.GlobalData.Type=this.selectName===""?-1:999;}else{if(textWord.trim()!=""){this.GlobalData.Name=this.selectName+textWord.trim();this.GlobalData.Type=999;}}}this.clearSearchRequest(this.SearchRequestInfo);this.searchDirect();break;case"searchByMap":evt.preventDefault();if(this.searchValid()){this.writeHotelCookie();this.SetSearchReqstInfo(this.SearchRequestInfo,this.GlobalData,this.GlobalHotelNameData);var url=this.HotelIndexMapUrl.eval({language:this.SearchRequestInfo.Language,cityid:this.tempCityId});var queryString=this.getQueryString(this.SearchRequestInfo);if(!String.isNullOrEmpty(queryString)){url+=(url.indexOf("?")!=-1?"&":"?")+queryString;}window.location=url;}break;}},clearSearchRequest:function(a){a.AreaId="";a.AreaType=0;a.PoiId=0;a.BrandId=0;a.Keywords="";a.KeywordsType=0;a.HotelName="";},searchValid:function(){if(!validator.valid(this.InCityName.val(),"notEmpty & nonSpecialSign")){$error(this.InCityName,HotelIndexController.Resources.InsertCity);return false;}if(!Object.isNull(this.InCityName[0].City)){this.tempCityId=this.InCityName[0].City.CityId;this.CityNameCn=this.InCityName[0].City.CityNameCn;this.CityNameEn=this.InCityName[0].City.CityNameEn;}else{$error(this.InCityName,HotelIndexController.Resources.NotExistCity);return false;}if(this.Language=="EN"){if(!validator.valid(this.CheckInDate.val(),"notEmpty & dateEn")){$error(this.CheckInDate,HotelIndexController.Resources.NotPassInDate);return false;}if(!validator.valid(this.CheckOutDate.val(),"notEmpty & dateEn")){$error(this.CheckOutDate,HotelIndexController.Resources.NotPassOutDate);return false;}}else{if(!validator.valid(this.CheckInDate.val(),"notEmpty & date")){$error(this.CheckInDate,HotelIndexController.Resources.NotPassInDate);return false;}if(!validator.valid(this.CheckOutDate.val(),"notEmpty & date")){$error(this.CheckOutDate,HotelIndexController.Resources.NotPassOutDate);return false;}}var g=validator.reFormatDateString(this.serverTime);var h=this.CheckInDate.val();var f=this.CheckOutDate.val();var e=validator.reFormatDateString(h);var d=validator.reFormatDateString(f);if(e<g&&this.CalendarShowYesterday==false){$error(this.CheckInDate,HotelIndexController.Resources.InDateAfterNow);return false;}if(d<g){$error(this.CheckOutDate,HotelIndexController.Resources.OutDateAfterNow);return false;}var c=validator.convertDate(e);c=new Date(c.setHours(24));if(!validator.valid(this.CheckOutDate.val(),"notEmpty & dateRange",validator.getDateString(c),null)){$error(this.CheckOutDate,HotelIndexController.Resources.OutDateAfterInDate);return false;}var a=this.daysBetween(e,validator.reFormatDateString(this.serverTime));var i=HotelIndexController.WebTel;if(Math.abs(a)>"180"){$error(this.CheckInDate,String.format(HotelIndexController.Resources.Date180Msg,e,i));return false;}var b=this.daysBetween(e,d);if(Math.abs(b)>"20"){$error(this.CheckOutDate,String.format(HotelIndexController.Resources.Date20Msg,"20",i));return false;}return true;},daysBetween:function(b,c){var e=b.substring(5,b.lastIndexOf("-"));var d=b.substring(b.length,b.lastIndexOf("-")+1);var f=b.substring(0,b.indexOf("-"));var h=c.substring(5,c.lastIndexOf("-"));var g=c.substring(c.length,c.lastIndexOf("-")+1);var i=c.substring(0,c.indexOf("-"));var a=((Date.parse(e+"/"+d+"/"+f)-Date.parse(h+"/"+g+"/"+i))/86400000);return a;},GetOneInfoByRequest:function(a){var b={areaType:-1,hType:-1,areaName:"",hName:"",areaId:"",hId:"",lat:0,lng:0,isAreaAccept:false,isNameAccept:false};if(!Object.isNull(a)){b.areaType=(a.AreaType==1&&3)||(a.AreaType==2&&6)||(!String.isNullOrEmpty(a.PoiName)&&99)||-1;b.hType=(!!a.BrandId&&5)||(a.HotelName!=""&&9)||-1;if(b.areaType==3||b.areaType==6){b.areaName=a.AreaName;b.areaId=a.AreaId;}if(b.areaType==99){b.areaName=a.PoiName;b.areaId=a.PoiId;b.lat=a.StartLat;b.lng=a.StartLng;}b.hName=b.hType==5?a.BrandName:a.HotelName;b.hId=b.hType==5?a.BrandId:"";b.isAreaAccept=a.IsNotAcceptRecommend;}return b;},writeHotelCookie:function(){Globals.cookie("ShHotel","",{InDate:this.CheckInDate.val(),OutDate:this.CheckOutDate.val(),CityID:this.tempCityId},{expires:11,path:"/",secure:false});if(this.Language=="cn"&&!Object.isNull(this.SearchRequestInfo.CityName)){Globals.cookie("ShHotel","",{CityNameCN:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});Globals.cookie("ShHotel","",{CityName:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});}if(this.Language=="en"&&!Object.isNull(ListController.CityNameEN)){Globals.cookie("ShHotel","",{CityNameEN:this.SearchRequestInfo.CityName},{expires:11,path:"/",secure:false});}},replaceCharCode:function(a){return a.replace(/(!)/g,"").replace(/(~)/g,"").replace(/(@)/g,"").replace(/(#)/g,"").replace(/($)/g,"").replace(/(%)/g,"").replace(/(^)/g,"").replace(/(&)/g,"").replace(/(\*)/g,"").replace(/(！)/g,"").replace(/(~)/g,"").replace(/(@)/g,"").replace(/(#)/g,"").replace(/(￥)/g,"").replace(/(%)/g,"").replace(/(……)/g,"").replace(/(&)/g,"").replace(/(\*)/g,"");},searchDirect:function(){if(!Object.isNull(this.allInOne[0].Data)){if(this.allInOne[0].Data.Name!=this.GlobalData.Name&&!this.allInOne[0].Data.Accept){this.allInOneData.Accept="2";this.allInOne.attr("selectIndex",-1);}else{this.allInOneData.Accept="1";}}else{this.allInOneData.Accept="0";this.allInOne.attr("selectIndex",-1);}var a=this.getSearchUrl();window.location.href=a;this.SearchDataCollect("hotelSearchButton");},SetSearchReqstInfo:function(b,a){var c="";if(a.Name!=""){c+=(c==""?"":"&")+"IsNotAcceptRecommend="+a.Accept;}c+=(c==""?"":"&")+this.setRequestInfoByTypeOne(b,a);return c;},setRequestInfoByTypeOne:function(b,a){var c="";switch(a.Type){case 1:case 2:case 4:case 99:this.resetRequestInfo(b,a);b.PoiId=a.PropertiesId;b.PoiName=a.Name;this.SearchRequestInfo.HotelSort=6;if(!Object.isNull(b.PoiId)&&b.PoiId!="0"){c+=(c==""?"":"&")+"PoiId="+a.PropertiesId;}if(!String.isNullOrEmpty(b.PoiName)){c+=(c==""?"":"&")+"PoiName="+encodeURIComponent(b.PoiName);}if(a.Lat!=""&&a.Lng!=""){b.StartLat=a.Lat;b.StartLng=a.Lng;c+=(c==""?"":"&")+"StartLat="+a.Lat+"&StartLng="+a.Lng;}c+=(c==""?"":"&")+"hotelsort=6";break;case 3:b.StartLat=0;b.StartLng=0;this.resetRequestInfo(b,a);if(!String.isNullOrEmpty(a.Name)){b.Keywords=encodeURIComponent(a.Name);b.KeywordsType=999;c+=(c==""?"":"&")+"Keywords="+encodeURIComponent(a.Name)+"&KeywordsType=999";}break;case 6:this.resetRequestInfo(b,a);b.AreaId=a.PropertiesId;b.AreaName=a.Name;b.AreaType="2";c+=(c==""?"":"&")+"AreaId="+a.PropertiesId+"&AreaType=2";if(!String.isNullOrEmpty(a.Name)){c+=(c==""?"":"&")+"AreaName="+encodeURIComponent(a.Name);}break;case 5:this.resetRequestInfo(b,a);b.BrandId=a.PropertiesId;b.BrandIds=a.PropertiesId;b.BrandName=a.Name;c+=(c==""?"":"&")+"BrandId="+a.PropertiesId+"&BrandName="+encodeURIComponent(a.Name);break;case 9:this.resetRequestInfo(b,a);b.HotelName=encodeURIComponent(a.Name);c+=(c==""?"":"&")+"HotelName="+encodeURIComponent(a.Name);break;default:if(!String.isNullOrEmpty(a.Name)){b.Keywords=a.Name;b.KeywordsType=a.Type;c+=(c==""?"":"&")+"Keywords="+encodeURIComponent(a.Name)+"&KeywordsType="+a.Type;}break;}return c;},resetRequestInfo:function(b,a){this.SearchRequestInfo.PageIndex=1;switch(a.Type){case 1:case 2:case 4:case 99:case 3:case 6:b.HotelSort="1";b.PoiId="";b.PoiName="";b.AreaId="";b.AreaType="";break;case 5:case 9:b.HotelSort="1";b.BrandId="";b.BrandIds="";b.HotelName="";break;}},getSearchUrl:function(){this.SearchRequestInfo.CityId=this.tempCityId;var url=this.HotelListUrl.eval({language:this.Language.toLowerCase(),cityid:this.tempCityId});var urlParams=this.SetSearchReqstInfo(this.SearchRequestInfo,this.GlobalData);var seoUrl=this.getSeoUrlBySearchRequestInfo(this.SearchRequestInfo);var sindex=-1;var aioVal=this.allInOne.val()==this.DefaultPlaceValue?"":this.allInOne.val();if(this.allInOneData.Accept=="1"&&!String.isNullOrEmpty(this.allInOne.attr("selectIndex"))){sindex=parseInt(this.allInOne.attr("selectIndex"));}if(seoUrl!=""){seoUrl+=(seoUrl.indexOf("?")!=-1?"&":"?")+"aioIndex="+sindex+"&aioVal="+encodeURIComponent(aioVal);return seoUrl;}if(urlParams!=""){url+=(url.indexOf("?")!=-1?"&":"?")+urlParams;}if(window.location.host=="big5.elong.com"){url="http://big5.elong.com/gate/big5/hotel.elong.com"+url;url+=url.indexOf("?")>0?"&isbig5=true":"?isbig5=true";}url+=(url.indexOf("?")!=-1?"&":"?")+"aioIndex="+sindex+"&aioVal="+encodeURIComponent(aioVal);return url;},getSeoUrlBySearchRequestInfo:function(searchRequestInfo){var cityId=searchRequestInfo.CityId;var cityNameEn=FilterPinyinForUrl(this.CityNameEn);var sowntownId="";var regionId="";var brandId="";var poiId="";var hasOtherParameter=false;if(!String.isNullOrEmpty(searchRequestInfo.AreaId)&&searchRequestInfo.AreaId.length==4){regionId=searchRequestInfo.AreaId;}if(!String.isNullOrEmpty(searchRequestInfo.AreaId)&&searchRequestInfo.AreaId.length==6){sowntownId=searchRequestInfo.AreaId;}if(searchRequestInfo.BrandId>0){brandId=""+searchRequestInfo.BrandId;}if(searchRequestInfo.PoiId>0){poiId=""+searchRequestInfo.PoiId;}hasOtherParameter=(!String.isNullOrEmpty(searchRequestInfo.Keywords)&&(searchRequestInfo.KeywordsType==9||searchRequestInfo.KeywordsType==999))||(poiId!=""&&brandId!="")||(poiId==""&&!String.isNullOrEmpty(searchRequestInfo.PoiName))||searchRequestInfo.HotelName!=""||HotelIndexController.WebCategory=="Online";if(hasOtherParameter||window.location.host=="big5.elong.com"){return"";}if(sowntownId!=""&&brandId!=""){return this.CitySowntownBrandList.eval({citynameen:cityNameEn,sowntownid:sowntownId,brandid:brandId});}if(regionId!=""&&brandId!=""){return this.CityRegionBrandList.eval({citynameen:cityNameEn,regionid:regionId,brandid:brandId});}if(sowntownId!=""){return this.CitySowntownList.eval({citynameen:cityNameEn,sowntownid:sowntownId});}if(regionId!=""){return this.CityRegionList.eval({citynameen:cityNameEn,regionid:regionId});}if(brandId!=""){return this.CityBrandList.eval({citynameen:cityNameEn,brandid:brandId});}if(poiId!=""){return this.CityPlaceList.eval({citynameen:cityNameEn,poiid:poiId});}return this.CityList.eval({citynameen:cityNameEn});},createAllInOneBox:function(b){var c=this.Language.toLowerCase()=="cn"?"http://hotel.elong.com/keywordssuggest.html?isNewB=true":"http://hotel.elong.net/keywordssuggest.html?isNewB=true";var a=this.Language.toLowerCase()=="cn"?"http://hotel.elong.com/hotsuggest.html":"http://hotel.elong.net/hotsuggest.html";if(this.selectName!==""){this.aioWind=new AiOWindow({cityId:null,resultNextId:"m_preDate",lang:this.Language.toLowerCase(),searchUrl:c,hotUrl:a,eventElement:this.allInOne});return false;}if((Object.isNull(this.aioWind)||b)){this.aioWind=new AiOWindow({cityId:this.tempCityId,resultNextId:"m_preDate",lang:this.Language.toLowerCase(),searchUrl:c,hotUrl:a,eventElement:this.allInOne,onSelect:function(e,d){if(!Object.isNull(d.Type)&&!Object.isNull(d.Name)){this.isSelect=true;this.allInOneData=d;}}.bind(this),directSearch:function(d){this.allInOne[0]["Data"]=this.selectName===""?d:null;this.m_search.trigger("click");}.bind(this),isJsonp:"1",hotWidth:245,searchWidth:245,aioType:0});}},onAllInOneFocus:function(){this.createAllInOneBox(false);if(this.allInOne.attr("value")==this.DefaultPlaceValue){this.allInOne.attr("value","");}this.allInOne.removeClass("l_black");},onAllInOneBlur:function(){if(this.allInOne.attr("value")==""){this.allInOne.attr("value",this.DefaultPlaceValue);}if(this.allInOne.attr("value")==this.DefaultPlaceValue){this.allInOne.addClass("l_black");}else{this.allInOne.removeClass("l_black");}},onOutClick:function(){$(document).one("click",function(b){var a=Event.element(b);if($("#firstCity").parent().attr("class")=="select select_on"&&a.attr("method")!="clickCity"&&a.parent("a").attr("method")!="clickCity"){$("#firstCity").parent().removeClass("select_on");$("#firstCity").parent().parent().find("ul").hide();}}.bindAsEventListener(this));},OnClickflashSaleRegion:function(evt){var element=Event.element(evt);var method=element.attr("method");if(String.isNullOrEmpty(method)){element=element.parent();method=element.attr("method");}var listCityId=this.tempCityId;var cityNameEn=FilterPinyinForUrl(this.CityNameEn);switch(method){case"flashSale":evt.preventDefault();this.pageLabelFlag="flash";element.addClass("flash_a");$("#pageLabel").find(".groupon").removeClass("groupon_a").addClass("groupon_o");$("#pageLabel").find(".hotsale").removeClass("hotsale_o").removeClass("hotsale_a");var cityIdForPageLabel=element.attr("cityId");this.GetFlashSaleData(listCityId,cityIdForPageLabel);break;case"hotSale":evt.preventDefault();this.pageLabelFlag="hotSale";element.removeClass("hotsale_o").addClass("hotsale_a");$("#pageLabel").find(".groupon").removeClass("groupon_a").removeClass("groupon_o");$("#pageLabel").find(".flash_a").removeClass("flash_a");var cityIdForPageLabel=element.attr("cityId");this.GetHotSaleData(listCityId,cityIdForPageLabel);break;case"groupHotel":evt.preventDefault();this.pageLabelFlag="groupHotel";element.removeClass("groupon_o").addClass("groupon_a");$("#pageLabel").find(".flash_a").removeClass("flash_a");$("#pageLabel").find(".hotsale").removeClass("hotsale_a").addClass("hotsale_o");var cityIdForPageLabel=element.attr("cityId");this.GetGroupHotelData(listCityId,cityIdForPageLabel);break;case"selectCity":var citynameEn=element.attr("citynameen");this.MoreHotelUrl(citynameEn);break;case"moreFlashSale":this.writeHotelCookie();var citynameen=FilterPinyinForUrl(cityNameEn);var url=String.format("http://qiang.elong.com/{0}/",citynameen);window.location=url;break;case"moreHotelSale":this.MoreHotelUrl(cityNameEn);break;case"refresh":var selectCityId=$("#firstCity").attr("cityId");var cityIdForPageLabel="";switch(this.pageLabelFlag){case"flash":cityIdForPageLabel=$("#pageLabel").find("a[method='flashSale']").attr("cityId");this.GetFlashSaleData(selectCityId,cityIdForPageLabel);break;case"hotSale":cityIdForPageLabel=$("#pageLabel").find("a[method='hotSale']").attr("cityId");this.GetHotSaleData(selectCityId,cityIdForPageLabel);break;case"groupHotel":cityIdForPageLabel=$("#pageLabel").find("a[method='groupHotel']").attr("cityId");cityIdForPageLabel=cityIdForPageLabel==""?"0101":cityIdForPageLabel;this.GetGroupHotelData(selectCityId,cityIdForPageLabel);break;}break;case"flashSaleDetial":var hotelId=element.attr("hotelid");var hotelUrl=new Template(HotelIndexController.UrlConfig.Hotel_DetailDynamic).eval({hotelId:hotelId,pageType:"hotel"});var room_url=hotelUrl+(hotelUrl.indexOf("?")==-1?"?":"&")+"roomid="+element.attr("roomid")+"_"+element.attr("rpid")+"#iTop";window.open(room_url);break;case"hotSaleDetial":if(element.is("span")){element=element.parents("strong");}var hotelId=element.attr("hotelid");var hotelUrl=new Template(HotelIndexController.UrlConfig.Hotel_DetailDynamic).eval({hotelId:hotelId,pageType:"hotel"});var room_url=hotelUrl+(hotelUrl.indexOf("?")==-1?"?":"&")+"roomid="+element.attr("roomid")+"_"+element.attr("rpid")+"#iTop";window.open(room_url);break;}},MoreHotelUrl:function(cityNameEn){this.writeHotelCookie();var citynameen=FilterPinyinForUrl(cityNameEn);window.location=this.CityList.eval({citynameen:citynameen});},GetGroupHotelData:function(b,c){$("#noFlashSale").hide();$("#getDataFailed").hide();$("#FlashSaleList").hide();$("#HotSaleList").hide();if(c==b){$("#GroupHotelList").show();$("#getDataFailed").hide();}else{$("#GroupHotelList").empty();var d="http://tuan.elong.com/isajax/CommonAjax/Products";var a={cityId:b,cityNameEn:"",sort:"1",pageIndex:1,pageSize:6};this.showLoadDataDiv();elongAjax.callBack(d,a,function(f){if(f.hasProduct){$("#pageLabel").find("a[method='groupHotel']").attr("cityId",b);this.closeLoadDataDiv();var e=$("#GroupHotelHtml").tmpl(f);$("#GroupHotelList").html(e);$("#getDataFailed").hide();$("#GroupHotelList").show();}else{this.showGetDataFieldDiv();}}.bind(this),false,"GET",null,"jsonp");}},GetHotSaleData:function(a,b){$("#noFlashSale").hide();$("#getDataFailed").hide();$("#FlashSaleList").hide();$("#GroupHotelList").hide();if(b==a){$("#HotSaleList").show();$("#getDataFailed").hide();}else{$("#HotSaleList").empty();this.showLoadDataDiv();HotelIndexController.GetHotSale(a,function(d){if(d.success){$("#pageLabel").find("a[method='hotSale']").attr("cityId",a);this.closeLoadDataDiv();var c=$("#HotSaleHtml").tmpl({model:d.value.Model,recentOrders:d.value.RecentOrders,client:this});$("#HotSaleList").append(c);$("#getDataFailed").hide();$("#HotSaleList").show();}else{$("#noFlashSale").hide();this.showGetDataFieldDiv();}}.bind(this));}},GetFlashSaleData:function(a,b){$("#HotSaleList").hide();$("#GroupHotelList").hide();if(b==a){$("#getDataFailed").hide();if($("#FlashSaleList").html()==""){$("#noFlashSale").show();}$("#FlashSaleList").show();}else{$("#FlashSaleList").empty();this.showLoadDataDiv();HotelIndexController.GetFlashSale(a,function(g){if(g.success){$("#pageLabel").find("a[method='flashSale']").attr("cityId",a);if(Object.isNull(g.value.Model)||g.value.Model.length==0){this.closeLoadDataDiv();$("#getDataFailed").hide();$("#noFlashSale").show();}else{this.closeLoadDataDiv();var e=["(限量抢购)","(限时抢购)","（限时抢购）","（限量抢购）","(龙萃专享)","（龙萃专享）","（限量抢）","(限量抢)","（限时抢）","(限时抢)","龙萃专享","限量抢购","限时抢购","限量抢","限时抢"];for(var d=0;d<e.length;d++){for(var f=0;f<g.value.Model.length;f++){g.value.Model[f].FavorableRateName=g.value.Model[f].FavorableRateName.replace(e[d],"");g.value.Model[f].FavorableRoomName=g.value.Model[f].FavorableRoomName.replace(e[d],"");}}var c=$("#FlashSaleHtml").tmpl({model:g.value.Model,client:this});$("#FlashSaleList").append(c);$("#getDataFailed").hide();$("#FlashSaleList").show();}}else{$("#noFlashSale").hide();this.showGetDataFieldDiv();}}.bind(this));}},showLoadDataDiv:function(){$("#noFlashSale").hide();$("#getDataFailed").hide();$("#loadData").show();},closeLoadDataDiv:function(){$("#loadData").hide();},showGetDataFieldDiv:function(){$("#loadData").hide();$("#getDataFailed").show();},setCuXiaoForSimpleList:function(a){var d={rpName:null,rpId:0,roomName:"",roomId:0,couponAmount:0,couponSymb:"",avgPrice:0,favorableMoneySymb:""};var g=null;var f=a.LongCuiHotelRoomSimpleList;if(!Object.isNull(f)){for(var b=0;b<f.length;b++){var e=f[b];for(var c=0;c<e.LongCuiRatePlanList.length;c++){if(e.LongCuiRatePlanList[c].FavorablePrice.toString()==a.LowestPrice){g=e.LongCuiRatePlanList[c];d.roomName=e.RoomName;d.roomId=e.RoomId;d.rpName=g.RatePlanName;d.rpId=g.RatePlanId;d.favorableMoneySymb=g.FavorableMoneySymb;d.couponAmount=g.CouponAmount;d.couponSymb=g.FavorableMoneySymb;d.avgPrice=g.AvgPrice;break;}}}}if(Object.isNull(g)){f=a.HotelRoomSimpleList;if(!Object.isNull(f)){for(var b=0;b<f.length;b++){var e=f[b];for(var c=0;c<e.RatePlanList.length;c++){if(e.RatePlanList[c].FavorablePrice.toString()==a.LowestPrice){g=e.RatePlanList[c];d.roomName=e.RoomName;d.roomId=e.RoomId;d.rpName=g.RatePlanName;d.rpId=g.RatePlanId;d.favorableMoneySymb=g.FavorableMoneySymb;d.couponAmount=g.CouponAmount;d.couponDesc=g.CouponDesc;d.couponSymb=g.FavorableMoneySymb;d.avgPrice=g.AvgPrice;break;}}}}}return d;},SearchDataCollect:function(c){try{var b;var d;var f=-1;if(!Object.isNull(this.GlobalData)&&!String.isNullOrEmpty(this.GlobalData.Name)){d=encodeURIComponent(this.GlobalData.Name);}else{d="";}if(this.allInOneData.Accept=="1"&&!String.isNullOrEmpty(this.allInOne.attr("selectIndex"))){f=parseInt(this.allInOne.attr("selectIndex"));}if(c=="hotelSearchButton"){Elong.sendTJ({DBItemName:"WebMSConnectionString",TableName:"searchKeyword ",channel:"hotel",query:d,sid:Globals.cookie("SessionGuid"),clientIp:this.ClientIP,logTime:(new Date()).toLocaleDateString(),cityId:this.tempCityId,inDate:Globals.cookie("ShHotel","InDate"),outDate:Globals.cookie("ShHotel","OutDate"),guid:Globals.cookie("SessionGuid"),app:"hotellistsearchbutton",hasSuggest:this.allInOneData.Accept=="0"?0:1,isSelect:this.allInOneData.Accept=="1"?1:0,sIndex:f});}}catch(a){}},getQueryString:function(b){var a="";if(!String.isNullOrEmpty(b.AreaId)){a+="&AreaId="+b.AreaId;}if(!String.isNullOrEmpty(b.StarLevels)){a+="&StarLevels="+b.StarLevels;}if(!String.isNullOrEmpty(b.BrandIds)){a+="&BrandIds="+b.BrandIds;}if(b.LowPrice>0){a+="&LowPrice="+b.LowPrice;}if(b.HighPrice>0){a+="&HighPrice="+b.HighPrice;}if(!String.isNullOrEmpty(b.FacilityIds)){a+="&FacilityIds="+b.FacilityIds;}if(b.PoiId>0){a+="&PoiId="+b.PoiId;}if(b.StartLat>0){a+="&StartLat="+b.StartLat;}if(b.StartLng>0){a+="&StartLng="+b.StartLng;}if(!String.isNullOrEmpty(b.PoiName)){a+="&PoiName="+encodeURIComponent(b.PoiName);}if(!String.isNullOrEmpty(b.HotelName)){a+="&HotelName="+encodeURIComponent(b.HotelName);}if(!String.isNullOrEmpty(b.Keywords)){a+="&Keywords="+encodeURIComponent(b.Keywords);a+="&KeyworsType="+b.KeywordsType;}if(!String.isNullOrEmpty(b.Campaign_Id)){a+="&Campaign_Id="+b.Campaign_Id;}if(b.IsBigBed){a+="&IsBigBed=true";}if(b.IsCashback){a+="&IsCashback=true";}if(b.IsCoupon){a+="&IsCoupon=true";}if(b.IsDoubleBed){a+="&IsDoubleBed=true";}if(b.IsPrePay){a+="&IsPrePay=true";}if(b.IsNoGuarantee){a+="&IsNoGuarantee=true";}if(!String.isNullOrEmpty(b.TagId)){a+="&TagId="+b.TagId;}return String.isNullOrEmpty(a)?a:a.substring(1);},dispose:function(){this.destroyEvent();this.destroyDOM();}});var indexClient=null;$ready(function(){indexClient=new NewIndexClient;});